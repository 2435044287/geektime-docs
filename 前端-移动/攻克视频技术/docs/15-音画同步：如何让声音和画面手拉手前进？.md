你好，我是李江。

在上节课中，我们讲述了音视频封装以及音视频数据是如何装到FLV和MP4文件里面的。这节课我们来讲讲播放这些文件的时候需要用到的一个非常重要的技术——音视频同步，也叫**音画同步**。

音视频同步是什么呢？它就是指在音视频数据播放的时候，播放的画面和声音是需要同步的，是能对得上的。相信你一定遇到过这种情况，就是看电视、电影或者直播的时候，人的口型和声音是对不上的，这样看起来会让人非常难受，这种问题就是音视频不同步导致的。因此做好音视频同步是非常重要的，当然也会有一定的难度，我们不妨先从一些基础知识讲起。

## PTS和DTS

首先就是PTS和DTS这两个概念。其实，我们在讲音视频封装的时候已经提到过了。

**PTS表示的是视频帧的显示时间，DTS表示的是视频帧的解码时间。**对于同一帧来说，DTS和PTS可能是不一样的。

为什么呢？主要的原因是B帧，因为B帧可以双向参考，可以参考后面的P帧，那么就需要将后面用作参考的P帧先编码或解码，然后才能进行B帧的编码和解码。所以就会导致一个现象，后面显示的帧需要先编码或解码，这样就有解码时间和显示时间不同的问题了。如果说没有B帧的话，只有I帧和P帧就不会有PTS和DTS不同的问题了。
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="" width="30px"><span>springXu</span> 👍（8） 💬（4）<div>收获最大的是那加餐篇。哈！那篇内容讲述了用现代浏览器提功的能力来实现音视频的方案。  十多年前浏览器播放音视频的方案主流是flash又或者是定义标签+插件的形式。
老师能不能来一篇课程全貌图。比如您开这课的思路，为什么需要这些内容呈现出来。
您在学习音视频中走过的路和遇上的坑？  对于要做音视频工作的人，需要哪些必备的知识以及建议是什么？</div>2021-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/54/20/abb7bfe3.jpg" width="30px"><span>Geek_wad2tx</span> 👍（2） 💬（2）<div>之前一直尝试学习音视频技术，但每次都是学了半吊子，学了忘，忘了就算，而且也不深入，老师的这堂课是我第一次比较系统的学习音视频技术，隔壁的《搞定音频技术》也在学习，非常感谢老师的付出，也非常珍惜这次学习机会。

下面我列出几点，我还想知道的：

1. 老师是否能以加餐的形式，介绍一下音频领域发展的状况，常用的库，技术，文章&#47;书籍参考，能给个大框架什么的，因为音视频这块涉及的领域还是非常多的，不同领域需要的技能树是什么？

2. 能否讲一些h265的编解码知识。

3. 非常希望老师能在开设一门实战性的课程。

以上，再次感谢老师的付出</div>2021-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f2/bc/ffc7ad67.jpg" width="30px"><span>Chris Zou</span> 👍（0） 💬（1）<div>请问一下老师，对于云端录制来说，也需要考虑音视频录制时音画同步的技术难点，这个的同步原理和播放的同步原理是否有共同点？
如果不同的话，需要利用原理来保证音画同步，希望老师能具体讲一讲？</div>2022-01-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/43/61/eeefa369.jpg" width="30px"><span>tony</span> 👍（0） 💬（1）<div>为什么会出现多个时间戳单位？大家不能统一吗</div>2021-12-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/ec/8a/4de35fb7.jpg" width="30px"><span>paradise</span> 👍（0） 💬（1）<div>视音频同步原理就是通过比较视频和音频的播放时间来去动态调整视频当前显示帧的播放时间，以达到齐头并进的目的。</div>2021-12-29</li><br/><li><img src="" width="30px"><span>springXu</span> 👍（2） 💬（1）<div>我想表达的是这位极客时间老师的想法:   
我觉得很多人缺少的不是更高深的知识。而是缺少一个成长路线的鸟瞰图。不知道自己在什么位置，也不知道终点在哪里。埋着头学下去，学了很多东西但却不知道用在哪里。

能有学习路线导航图。

</div>2021-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9a/e3/0a094b50.jpg" width="30px"><span>Wales</span> 👍（0） 💬（0）<div>感谢老师开设这门课程，深受启发👍

对音视频不同步的原因不太理解：

播放音频，是以系统时钟为基准，根据音频数据的时间戳来进行播放，视频播放亦然。

既然二者参照的是同一个系统时钟，用的是同样的时间戳，那么理论上应该不会出现音视频不同步的问题吧？

然而实际应用中还是出现了音视频不同步的问题，是不是因为：
①解码端的运算性能有限，解码视频和音频的速度会出现波动，导致了音、视频各自的实际播放时间有差别。
②实时通信模式下，音频和视频数据到达接收端的时间不同，导致了后续解码和播放的时间不同。

如果理解不到位，请老师指导*^_^*</div>2022-07-05</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132" width="30px"><span>idiot</span> 👍（0） 💬（0）<div>增加 last_duration 的值后，具体是如何解码的呢？是有接口控制每一帧的播放时间吗，增加某些帧的播放时间，还是平均增加各个帧的播放时间？</div>2022-07-03</li><br/>
</ul>