你好，我是李江。今天我们一起来聊一聊视频编码。

说到视频，我们首先想到的可能就是占内存。我们知道一个视频是由一连串图像序列组成的，视频中图像一般是YUV格式。现在，我们假设有一个电影视频，分辨率是1080P，帧率是25fps，并且时长是2小时，如果不做视频压缩的话，它的大小是1920 x 1080 x 1.5 x 25 x 2 x 3600 = 521.4G。而我们的电脑一般是500G的硬盘，那就连2部电影都放不下了。如果是在视频通话场景下的话，按照这个大小去传输视频数据，对流量和带宽资源的消耗也是非常大的，并且如此大的数据发送对网络要求也非常高，很显然我们是接受不了的。因此，做视频编码压缩就非常有必要。

那么，接下来我就深入讲讲视频编码，带你从预测编码、变换编码、熵编码等方面，系统了解下视频编码的原理。相信这节课过后，你会对视频编码有一个全面的了解。

## 视频编码的原理

视频编码是对一帧帧图像来进行的。一般我们所熟知的彩色图像的格式是RGB的，即用红绿蓝三个分量的组合来表示所有颜色。但是，RGB三个颜色是有相关性的，为了去掉这个相关性，减少需要编码的信息量，我们通常会把RGB转换成YUV，也就是 **1个亮度分量和2个色度分量**。
<div><strong>精选留言（24）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/67/f5/3a4021b4.jpg" width="30px"><span>Student</span> 👍（16） 💬（5）<div>1920 x 1080 x 1.5 x 25 x 2 x 3600 = 260.7G。其中的1.5是怎么来的 谢谢</div>2021-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/88/de/04784f86.jpg" width="30px"><span>ForwardsHao</span> 👍（7） 💬（1）<div>一帧图像即存在空间冗余又存在时间冗余，所以是帧间预测和帧内预测都是可以同时可以在一帧上应用的。这样一个编码的宏块，都会即由本帧内的前面的宏块又由相关帧的预测块影响。</div>2021-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/b4/7d/9455f31a.jpg" width="30px"><span>我有一条鱼</span> 👍（4） 💬（1）<div>上面中写av1和H265的编码速度是3fps和8fps。这样的速度是怎么在直播场景中使用的吗？在页面上展示的时候不是15fps左右吗？</div>2021-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/75/35/a0c15ca8.jpg" width="30px"><span>一頭蠻牛</span> 👍（3） 💬（2）<div>老师请问 宏块转像素串 为什么是之字形扫描？ 搜索无果 请求解答</div>2022-09-02</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/udFtP9pbRmYiawNS9RyCib4WZic95waXdto9IBC0UMCfMxDAcXdTdv58rzGEzyLtSHI38ibOZzDhhdKe5dXEbllB2A/132" width="30px"><span>Geek_495a1c</span> 👍（2） 💬（1）<div>在一帧中既有帧间预测又有帧内预测，最后是怎么确定使用哪种方式？</div>2021-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/b4/7d/9455f31a.jpg" width="30px"><span>我有一条鱼</span> 👍（2） 💬（2）<div>应该有一些被参考的帧是不可以帧间预测的，其他帧可以吧。要不每个帧都相互参考，没有一帧有完整的信息。在解码时，信息还能被解析出来吗？</div>2021-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/d7/c7/f3e783e8.jpg" width="30px"><span>Max(Deguang)</span> 👍（1） 💬（1）<div>问一下，文中提到帧间参考的时候，会使用运动矢量记录参考宏块位置。帧内参考的时候，如何记录参考宏块的位置呢？谢谢</div>2022-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/9e/89/6e9c05d6.jpg" width="30px"><span>被讨厌的勇气</span> 👍（1） 💬（2）<div>应该可以。帧内预测和帧间预测都是以块为基本单元的，而一帧包含多个块，所以，可以将帧间预测与帧内预测施加到同一帧的不同块上</div>2021-11-29</li><br/><li><img src="" width="30px"><span>Geek_9c9938</span> 👍（0） 💬（2）<div>李老师好

文中 &quot;假设 Y 分量这 16x16 个像素就是一个个数字，我们从左上角开始之字形扫描每一个像素值，则可以得到一个“像素串”。&quot;

假设是数字什么意思，事实上是数字吗 ？</div>2023-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/30/0f/4e/93214db9.jpg" width="30px"><span>CyanWoods</span> 👍（0） 💬（1）<div>这个DCT变换里面没有提到亮度和色度的量化矩阵，我研究生期间学这门课的时候记得是有这个步骤的啊</div>2023-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg" width="30px"><span>浩仔是程序员</span> 👍（0） 💬（1）<div>1080p，2个小时的视频，一般压缩有多大？</div>2022-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/ae/5d19d5dd.jpg" width="30px"><span>沉默的范大叔</span> 👍（0） 💬（1）<div>弱弱的问下12个字母怎么是13个字节？</div>2022-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2c/7b/8a/6c32d3ab.jpg" width="30px"><span>SJ</span> 👍（0） 💬（1）<div>请问做离散余弦变换的时候是对残差块进行变换，还是原图进行变换呢？</div>2022-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4f/ab/dd9ab224.jpg" width="30px"><span>EdwdChen</span> 👍（0） 💬（2）<div>你好，不太明白为什么“变换块左上角的系数值就是图像的低频信息，其余的就是图像的高频信息，并且高频信息占大部分。”这和上面的之字遍历有关吗？还是说就是人为地以左上角作为低频的标准？</div>2022-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/10/2c/330651c8.jpg" width="30px"><span>J</span> 👍（0） 💬（1）<div>编码过程看了很久，末尾才发现，以后的章节会详细介绍😂差点去翻外部资料哈哈

视频编码过程中，一帧图像能同时进行帧内预测和帧间预测吗？
答：流程来说是可以，实际应用的话，考虑到P B帧同时预测的性能耗损，也需要判断I帧。所以似乎需要不少成本</div>2021-12-18</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJV27QOK57cdpdh3E4hbArCOlccdtjCyWooF9fhjeSKAMo9SN1v9RODkrZUZD4RejjbdsqU2FIeMA/132" width="30px"><span>西钾钾</span> 👍（0） 💬（2）<div>应该可以，比如I帧。</div>2021-11-29</li><br/><li><img src="" width="30px"><span>Geek_cbfa0a</span> 👍（2） 💬（2）<div>1920 x 1080 x 1.5 x 25 x 2 x 3600 =521.4G 一个这样的视频算出来应该是521.4G，怎么语音说的是260.7G呢</div>2021-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/38/4c/d20f8abf.jpg" width="30px"><span>颜</span> 👍（1） 💬（1）<div>建议把思考题的标准答案，放在可以查看的地方，这样我们可以对比自己的答案</div>2022-06-18</li><br/><li><img src="" width="30px"><span>Geek_9c9938</span> 👍（0） 💬（0）<div>老师好，文中 “我们发现如果想要达到压缩的目的，我们必须要使得编码前的字符串中出现比较多连续相同的字符。这对于图像块也是一样的。我们需要使得扫描出来的“像素串”，也尽量出现连续相同的像素值，最好是一连串数字很小（比如 0）的“像素串”，因为 0 在二进制中只占 1 个位就可以了。” 这里要压缩成 0 跟现有编码算法是不是有关系，现在的压缩算法是 0 占的位比较少，如果是 1 占有的位较少，就期望压缩成连续的 1 了</div>2023-12-16</li><br/><li><img src="" width="30px"><span>龚长华</span> 👍（0） 💬（0）<div>可以。 两者都可以做， 然后依据残差像素绝对值和最小的预测块。</div>2022-06-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKH4ILYLTcZjkl4lqZL6r4ZqPCic6IgPNByYccszEwhI0CU8SWW8g96gdIWiapw1RI6eYiagP10rXusA/132" width="30px"><span>Geek_1760ca</span> 👍（0） 💬（0）<div>老师有DCT变换的介绍链接么？</div>2022-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/29/72/76838c57.jpg" width="30px"><span>白杨</span> 👍（0） 💬（0）<div>请问521.4G经过视频编码之后，会压缩到大概多少？比如h264，av1等</div>2022-05-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（0） 💬（0）<div>压缩图像的核心技术是利用图像的冗余特性将图像转换成可以通过熵编码将图像编码成传输数据量很小的图像数据，这需要将原始图像块转换成很多连续0的图像块：
1，通过帧内预测，将图像块和它周边的图像块做残差计算，选择绝对值和最小的残差块作为预测块。
2，用类似的方法，计算出下一帧的预测块，目的是在帧间制作连续0的图像块。
3，通过DCT变换将图像中低频和高频像素分离出来，低频和像素绝对值大的高频像素在序列前部，序列后部的数值更接近0。
4，所有像素除以一个QP、QSize进行量化，就得到了很多连续为0的图像块。</div>2022-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/66/c8/f598a816.jpg" width="30px"><span>Phantom01</span> 👍（0） 💬（1）<div>好奇 h264&#47;265 这种怎么收专利费。像 ffmpeg 这种开源软件也会向版权方支付费用吗</div>2021-12-18</li><br/>
</ul>