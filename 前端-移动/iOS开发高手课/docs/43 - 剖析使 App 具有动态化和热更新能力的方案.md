你好，我是戴铭。今天，我来和你聊聊iOS开发中的动态化和热更新方案。

热更新能力的初衷是，能够及时修复线上问题，减少Bug 对用户的伤害。而动态化的目的，除了修复线上问题外，还要能够灵活更新App 版本。

要实现动态化，就需要具备在运行时动态执行程序的能力。同时，实现了动态化，也就具备了热更新能力。通常情况下，实现动态化的方案有三种，分别是 JavaScriptCore 解释器方案、代码转译方案、自建解释器方案。接下来，我就和你详细说说这三种方案。

## JavaScriptCore 解释器方案

iOS 系统内置的JavaScriptCore，是能够在 App 运行过程中解释执行脚本的解释器。

JavaScriptCore 提供了易用的原生语言接口，配合 iOS 运行时提供的方法替换能力，出现了使用 JavaScript 语言修复线上问题的 [JSPatch](https://github.com/bang590/JSPatch)，以及把 JavaScriptCore 作为前端和原生桥梁的 [React Native](https://github.com/facebook/react-native) 和 [Weex](https://github.com/apache/incubator-weex)开发框架。这些库，让 App 具有了动态化能力。

但是，对于原生开发者来说，只能解释执行 JavaScript 语言的解释器 JSPatch、React Native 等，我们用起来不是很顺手，还是更喜欢用原生语言来开发。那么，有没有办法能够解决语言栈的问题呢？
<div><strong>精选留言（15）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/f3/1f/6c566c19.jpg" width="30px"><span>提手罢火兰</span> 👍（5） 💬（2）<div>是不是结课了 ? </div>2019-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/36/f5/ad3270be.jpg" width="30px"><span>Given</span> 👍（3） 💬（1）<div>老师，结束课程了以后怎么通过其他方式联系你，继续向你学习？</div>2019-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/37/3b/fe0492b9.jpg" width="30px"><span>AI</span> 👍（1） 💬（1）<div>我想问下作者，现在的热更新方案都是什么呢，swift选择的又是什么呢</div>2019-06-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2e/b1/85bbfa6b.jpg" width="30px"><span>Jeffrey</span> 👍（34） 💬（1）<div>吹了2年了 都没有见过DynamicCocoa长啥样 什么时候准备开源</div>2019-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/77/e1/fa7fd9f3.jpg" width="30px"><span>方金峰</span> 👍（15） 💬（1）<div>我们之前的热更新方案是:将下发的原生代码，通过自己实现的代码解析引擎，将代码转换为AST树，然后存储在相关的模型里面，在通过一个上下文注入到runtime里面，当runtime回调到当前函数的时候，上下文从存储的相关模型取出各个参数，然后放到当前堆栈里面去执行相关的逻辑，执行问之后，在返回之前调用的地方，这里跟腾讯的OCS有点像.</div>2019-07-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/05/3e2b8688.jpg" width="30px"><span>时光念你</span> 👍（8） 💬（0）<div>https:&#47;&#47;github.com&#47;YPLiang19&#47;Mango, 不知道是哪位大神写的语法类似OC的DSL,支持热更新.</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/4c/d976b42c.jpg" width="30px"><span>冯选刚</span> 👍（6） 💬（0）<div>现在使用jspatch会被苹果剧拒么</div>2019-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/41/12/bf0af337.jpg" width="30px"><span>Dean</span> 👍（4） 💬（0）<div>Daynamic cocoasdk不会开源了，只是滴滴自己内部在用，如果开源，被广泛应用可能会被苹果盯上，而导致滴滴都不能用了</div>2019-07-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ermPNNQAxibOtBseXNLLpnSHica0qGkvyxrgxbAfDT8Y0LuS9yBqjzXksKQW35F3916HcTg9QcxfcOg/132" width="30px"><span>卓小土</span> 👍（1） 💬（1）<div>“只不过，ExecutionEngine 里的 Interpreter，是专门用来解释 LLVM IR 的，缺少对 Objective-C 语法特性的支持，所以无法直接使用。”
———————-
没太懂。对于动态化方案来说，为啥非得要直接解释oc呢，把oc编译成ir，将ir下发给llvm解释器lli执行不就够了吗？</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/78/cf/f333b86f.jpg" width="30px"><span>抛到银河</span> 👍（1） 💬（0）<div>依稀记得孙源当时公布的开源计划，可惜被苹果打断了</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/44/59/b607b8c0.jpg" width="30px"><span>毛成方</span> 👍（1） 💬（0）<div>不知不觉快结束了 持续学习 提高了技术认知 大干一场 蓝岛点个赞</div>2019-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e4/35/bf5dfd8a.jpg" width="30px"><span>15827525622</span> 👍（0） 💬（0）<div>老师,问下swift一般使用什么方式热修复啊</div>2021-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/31/bd/62c945b4.jpg" width="30px"><span>Link</span> 👍（0） 💬（1）<div>objc咋是强类型语言了？</div>2019-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2c/9f/265106fb.jpg" width="30px"><span>Geek_自来也大人</span> 👍（0） 💬（1）<div>DynamicCocoa也是转成js？我看不是，如果都是转成js通过系统自带的js解析器，那和jspatch没啥区别！</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/39/b4/b0cb712a.jpg" width="30px"><span>景迪</span> 👍（0） 💬（0）<div>DynamicCocoa 啥时候开源呀，等了好久</div>2019-06-22</li><br/>
</ul>