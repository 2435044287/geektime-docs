你好，我是戴铭。今天，我要跟你说说怎么设计一个能够支持大型 iOS 工程的架构。

记得以前所在的团队，规模大了以后，客户端团队也被按照不同业务拆分到了不同的地方。当时，所有的代码都集中在一个仓库，团队里面一百多号人，只要有一个人提交错了，那么所有要更新代码的人都得等到修复后提交。这样一天下来，整个团队的沟通和互相等待都浪费了大量时间。同时，开发完成要进行测试时，由于代码相互耦合、归属不清，也影响到了问题排查的效率，并增加了沟通时间。

后来，我们痛定思痛，花了很大力气去进行架构整治，将业务完全解耦，将通用功能下沉，每个业务都是一个独立的 Git 仓库，每个业务都能够生成一个 Pod 库，最后再集成到一起。这样经过架构整治以后，也就没再出现过先前的窘境，开发效率也得到了极大的提升。由此可见，合理的架构是多么得重要。

其实，这并不是个例。当业务需求量和团队规模达到一定程度后，任何一款App都需要考虑架构设计的合理性。

而谈到架构治理，就需要将老业务、老代码按照新的架构设计模式进行重构。所以，架构重构考虑得越晚，重构起来就越困难，快速迭代的需求开发和漫长的重构之间的矛盾，如同在飞行的飞机上换引擎。及早考虑架构设计就显得尤为重要。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/74/0a/abad1aa1.jpg" width="30px"><span>Sasori</span> 👍（17） 💬（2）<div>协议化的方式有两个好处，一是可以明确知道组件提供了哪些服务，二是组件一旦修改了接口会立刻引发编译错误，而CTMediator会推迟到运行时。</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/40/65/a6c41b4f.jpg" width="30px"><span>曾剑南</span> 👍（16） 💬（1）<div>老师，这里面讲到了架构方面的知识，有什么入门的资料可以推荐一下吗</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5b/b4/abb7bfe3.jpg" width="30px"><span>wang</span> 👍（10） 💬（3）<div>组件化架构的目的主要是解耦各个具体业务模块的耦合，而在业务模块的内部也还是需要用到像MVC、MVP、MVVM这些设计模式。  大神，我的理解是没错吧</div>2019-03-19</li><br/><li><img src="" width="30px"><span>Geek_2844bd</span> 👍（4） 💬（1）<div>swift项目架构解藕有什么好的推荐吗</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3c/03/d94ab93f.jpg" width="30px"><span>流氓兔</span> 👍（4） 💬（1）<div>现在负责的是一个很小的项目，用的还是普通的MVC模式，是否也需要改变架构，就是说，在小型项目中（没有变成大项目的可能性），使用中间者架构会不会更麻烦了</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/42/c4/b9166b7d.jpg" width="30px"><span>Hello灬麦德姆</span> 👍（3） 💬（1）<div>戴明老师，我对这个有些疑问，接口隔离原则：接口的用途要单一，不要在一个接口上根据不同入参实现多个功能。假如我需要实现功能，显示或隐藏一个试图，那我是应该写两个方法，一个是func show()一个是func hide()吗，这个隐藏或显示功能应该算一个功能还是两个功能呢？或者说刨根问底，这个功能划分到什么程度呢？</div>2019-08-14</li><br/><li><img src="" width="30px"><span>Geek_pzvm2w</span> 👍（2） 💬（2）<div>协议式编程接口定义模式过于规范，从而使得架构的灵活性不够高。

老师好，我理解目前主流的协议式编程基本是ModuleManager+Protocol—Class注册的方式. 即组件将提供的服务以Protocol为key, protocol—impl为value，注册到Manager中.  
这样调用方不直接依赖组件，只依赖组件提供的Protocol即可. 

我认为这里和CT一个很大的不同是调用方除了Manager（中间者）还需要依赖对应的Protocol才能发现服务，而CT只依赖中间者.  

但是对于老师提到的Protocol方式过于规范导致灵活性降低，有一点疑惑. 
Protocol方式如果组件提供的接口有变更，需要修改protocol和对应的impl，而CT同样需要修改CTMediator+组件X这个分类，这里不灵活具体体现在哪里呢？  

恳请戴老师解惑！

</div>2019-04-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/71/95/9df437ae.jpg" width="30px"><span>几缕阳光</span> 👍（2） 💬（1）<div>依赖反转原则：方法应该依赖抽象，不要依赖实例。

这句话应该怎么理解?我有点懵哦，希望大神能举个栗子。</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/ac/d5/c1deff12.jpg" width="30px"><span>Geforceyu</span> 👍（2） 💬（1）<div>自己写了一个模块化解耦方案的DEMO，请大佬过过目
https:&#47;&#47;github.com&#47;Geforceyu&#47;FisherMan</div>2019-03-28</li><br/><li><img src="" width="30px"><span>执意为莱</span> 👍（2） 💬（1）<div>戴老师,从开是到现在一直是一个人开发,对于组件化或者架构一窍不通,该如何下手呢?</div>2019-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/46/5e/2da0d188.jpg" width="30px"><span>Bifico</span> 👍（2） 💬（1）<div>oc里面可以利用运行时来实现，但是swift项目里面有什么好的办法啊？</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/35/2f/474946c9.jpg" width="30px"><span>うずまきナルト</span> 👍（1） 💬（1）<div>组件间通信如果选择暴露Model的话，model的维护成本很高，但是如果选择字典之类的又会失去编译时检查和参数提示的好处。这两个到底怎么选择呢</div>2019-03-22</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqr5ibqxYwcSgqPA7s49MZb1vEKKXT4mPTojwiclXkJf3ug26NuzTa6A5gbicR2rAUHdEkUAn13Rr2KQ/132" width="30px"><span>吴小安</span> 👍（1） 💬（1）<div>请问一下对于业务无关组件，例如网络，但是很多工程中网络模块都有一些跟业务相关的配置，例如token，服务器域名这些信息，你们是怎么拆分的？把这些信息都用delegate的方式让外面来实现？或者其他的方式？谢谢</div>2019-03-22</li><br/><li><img src="" width="30px"><span>drunkenMouse</span> 👍（1） 💬（1）<div>同时还可以避免.h 文件的耦合，但是其对代码编写效率的降低也比较明显。。不是很理解，平常自己调用函数时的参数，也是String方法传递的啊</div>2019-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/34/37/ae07d946.jpg" width="30px"><span>热血CZ👻</span> 👍（1） 💬（1）<div>戴老师写的demo暴露了自己是怪物猎人玩家</div>2019-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6b/3d/ae41c2b3.jpg" width="30px"><span>data</span> 👍（1） 💬（1）<div>老师 你这个目录 Cdnt 是啥意思</div>2019-03-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIsqaoarwqshsY0R3cFcNCVCN9hia2NMmickPsp1Zibic8RKvZiaBvktgydauM8nUE7P2X4aJjoTx4JUvw/132" width="30px"><span>Geek_76828b</span> 👍（1） 💬（1）<div>目前项目刚好在拆分组件的后期阶段，用的也是CTMediator，一开始的规划感觉很清晰，也是分了三层，想要做到理想的是：高层向底层依赖，同层间互不依赖，不跨层依赖。但是拆完组建后发现因为代码遗留问题完全无法避免同层间的相互依赖。只能硬着头皮先做完，拆分组装后慢慢优化了。</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/39/00/30664850.jpg" width="30px"><span>好好学习</span> 👍（1） 💬（1）<div>使用pod私有仓库分仓管理，每次改代码都需要提交一个版本号吗</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/42/c4/b9166b7d.jpg" width="30px"><span>Hello灬麦德姆</span> 👍（0） 💬（1）<div>戴明师傅，染头发是大牛的标志吗？😀</div>2019-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg" width="30px"><span>矮个子先生😝</span> 👍（0） 💬（1）<div>目前我们也是自己仿造CTMediator写的一套中间者进行组件间通信,之前就是觉得传参数比较麻烦,今天学习到了可以通过扩展明确方法和参数</div>2019-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3c/78/9f052793.jpg" width="30px"><span>LeeWong</span> 👍（0） 💬（1）<div>开闭原则：扩展是开放的，修改是封闭的。
修改是封闭的 是可以理解的 比如通过设置readonly让某些属性是只读 不让外界去修改
扩展是开放的是指？通过子类分类这种形式的扩展？ 这里扩展具体是什么样的操作呢

接口隔离原则：接口的用途要单一，不要在一个接口上根据不同入参实现多个功能。

我们项目中有很多地方实际上在入参时加上type区分 内部做不同操作 按照这个原则 这种场景下 应该怎么解决呢 写两个方法吗？</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/ca/43/63bdc516.jpg" width="30px"><span>二木又土</span> 👍（0） 💬（1）<div>基本每个app都会用到登录，注册这样相似的功能，这块代码是用本地pod方式作为组件吗？还是有其他办法？</div>2019-03-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/30/47/90300016.jpg" width="30px"><span>PPAbner</span> 👍（0） 💬（1）<div>新项目一开始就用了CT，但是，现在遇到一个问题，因为开发时间赶，有些模型在不同的模块都有，只是取用不同属性罢了，不同的开发人员定义不同的模型，用感觉这样不完美，请问是把模型独立成单独的组件还是就现在，不同开发定义各自的模型？或者你有什么好的建议？谢答！！！</div>2019-03-22</li><br/><li><img src="" width="30px"><span>drunkenMouse</span> 👍（0） 💬（2）<div>方法应该依赖抽象，不要依赖实例。iOS 开发就是高层业务方法...
不是很理解，是指写方法的时候，要把实例抽象化去实现吗？</div>2019-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/39/00/30664850.jpg" width="30px"><span>好好学习</span> 👍（0） 💬（1）<div>主工程通过pod安装私有仓库。修改私有仓库的代码的时候怎么使用主工程的代码进行实时查看效果？大佬，求翻牌。</div>2019-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2f/25/2d2cc1c5.jpg" width="30px"><span>skywalker</span> 👍（0） 💬（1）<div>我项目之前蓝牙POS机模块我用的单例(总控类)+协议+工厂模式。完成统一所有类型的POS机操作，这样算不算一种小规模协议化的应用呢？</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0b/1b/d4fb3c6c.jpg" width="30px"><span>有钱才可以为所欲为</span> 👍（0） 💬（1）<div>“”接硬编码的调用方式，参数是以 string 的方法保存在内存里，虽然和将参数保存在 Text 字段里占用的内存差不多，同时还可以避免.h 文件的耦合，但是其对代码编写效率的降低也比较明显。”戴老师，Text字段是什么意思？</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3f/cb/ad5bc960.jpg" width="30px"><span>invisible-single</span> 👍（0） 💬（1）<div>看到组件化粒度选择那一段，我有个疑问，如果使用可视化的工具比如xib或者SB，那么如果组件化粒度比VC小这种如何处理，因为各种控件都是集成在一个VC的sb上的</div>2019-03-19</li><br/><li><img src="" width="30px"><span>长安</span> 👍（0） 💬（1）<div>独立开发的该怎么整</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/54/61/68160639.jpg" width="30px"><span>五天几年</span> 👍（92） 💬（5）<div>我现在做的项目就很好的做了模块化设计，将一些常用功能抽出构建成了单独模块banner（横幅广告）、network（网络连接）、window（界面相关）、validator（响应式校验），还有一个通用基础模块，封装了一些常用工具和MVP系统架构。MVP架构和泛型一起使用，好的不要不要，哈哈哈。最厉害的是，我们的封装模块Android端和iOS端类、接口、方法一模一样，文档注释非常清晰，方便两端开发者沟通交流，更方便快速定位错误，只要一端出了问题，另一端可以快速检查测试，查找是否错误重现。</div>2019-03-19</li><br/>
</ul>