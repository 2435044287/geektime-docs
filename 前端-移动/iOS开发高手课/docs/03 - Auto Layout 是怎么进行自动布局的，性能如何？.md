你好，我是戴铭。今天我来跟你聊下 Auto Layout 。

Auto Layout ，是苹果公司提供的一个基于约束布局，动态计算视图大小和位置的库，并且已经集成到了 Xcode 开发环境里。

在引入 Auto Layout 这种自动布局方式之前，iOS 开发都是采用手动布局的方式。而手动布局的方式，原始落后、界面开发维护效率低，对从事过前端开发的人来说更是难以适应。所以，苹果需要提供更好的界面引擎来提升开发者的体验，Auto Layout 随之出现。

苹果公司早在 iOS 6 系统时就引入了 Auto Layout，但是直到现在还有很多开发者迟迟不愿使用 它，其原因就在于对其性能的担忧。即使后来，苹果公司推出了在 Auto Layout 基础上模仿前端 Flexbox 布局思路的 UIStackView工具，提高了开发体验和效率，也无法解除开发者们对其性能的顾虑。

那么，Auto Layout 到底是如何实现自动布局的，这种布局算法真的会影响性能吗？

另外，苹果公司在 WWDC 2018 的“ [WWDC 220 Session High Performance Auto Layout](https://developer.apple.com/videos/play/wwdc2018/220)”Session中介绍说： iOS 12 将大幅提高 Auto Layout 性能，使滑动达到满帧，这又是如何做到的呢？你是应该选择继续手动布局还是选择Auto Layout呢？
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/0f/2e/1d3e9f38.jpg" width="30px"><span>一剑寒潇</span> 👍（26） 💬（3）<div>使用 Auto Layout 一定要注意多使用 Compression Resistance Priority 和 Hugging Priority，利用优先级的设置，让布局更加灵活，代码更少，更易于维护。

能否举一些详细的代码事例！！！</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e7/bb/18eb89fd.jpg" width="30px"><span>开发小能手</span> 👍（60） 💬（4）<div>关于 UI 的布局，是使用 frame 还是 Auto Layout ？这个问题困扰了我很久，在之前的团队中是建议使用 frame 的，原因是在 layoutSubviews 中做布局，将所有的子视图按照 UI 显示从上至下、从左至右的顺序来布局，感觉也很规范，代码也不会导致不易维护的程度。
我一直有这么一条原则：简单的 UI 使用 Auto Layout ，复杂的 UI 使用 frame。原因如下：
1、从代码量上来看，两种布局方式相差不大。有时候发现复杂的 UI 使用  Auto Layout 的话，代码量反而会变多，因为复杂的 UI 往往会有复杂的逻辑，比如根据数据的不同，部分 UI 的显示会有变动（比如某个子视图隐藏与显示， 会影响到其它视图的布局）。
2、会将那种仅做了一次约束之后，就可以不用做太多 update 的那种视为简单的布局，这种情况下使用 Auto Layout 还是挺方便的。
3、会将 Cell 的高度会随着数据的不同而不同的布局视为复杂的 UI 布局，这种情况下使用 Auto Layout 来布局，感觉就不合适。因为不管是 frame 还是 Auto Layout，都需要去计算高度，其实在计算 高度的时候，所有的子视图的 frame 都已经决定了，这种情况下，直接使用 frame 会比较精简。
4、我见过这样的代码：动态的通过文本，计算出尺寸之后，再使用 Auto Layout 进行 update，感觉太没有这个必要了。

以上是我对 UI 布局的一点思考，请教大神：凭您的经验，这样的思考有什么不合理之处么？（简单的 UI 使用 Auto Layout ，复杂的 UI 使用 frame。）</div>2019-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3c/b9/42b228f8.jpg" width="30px"><span>徐秀滨</span> 👍（42） 💬（2）<div>针对Auto Layout的生命周期，我是这么理解的：
Auto Layout拥有一套Layout Engine引擎，由它来主导页面的布局。App启动后，主线程的Run Loop会一直处于监听状态，当约束发生变化后会触发Deffered Layout Pass（延迟布局传递），在里面做容错处理（约束丢失等情况）并把view标识为dirty状态，然后Run Loop再次进入监听阶段。当下一次刷新屏幕动作来临（或者是调用layoutIfNeeded）时，Layout Engine 会从上到下调用 layoutSubviews() ，通过 Cassowary算法计算各个子视图的位置，算出来后将子视图的frame从Layout Engine拷贝出来，接下来的过程就跟手写frame是一样的了。
这样可对？</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/34/bc/fecc1070.jpg" width="30px"><span>burning😕🙄</span> 👍（30） 💬（1）<div>没有讲到 cell 里面 label的高度自适应问题，这个在layout应该使用频率比较高吧</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/d7/12/416b60ba.jpg" width="30px"><span>Sean Ma</span> 👍（16） 💬（1）<div>我想了解下自动布局会在哪一个时机下能够拿到相应的frame和center，因为有时候做完约束，我想在viewdidlayer前拿到其frame。另外自动布局怎么做动画</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3f/70/5a1b3aa3.jpg" width="30px"><span>徐大炮</span> 👍（11） 💬（3）<div>autolayout 的布局代码应该写在什么地方，是在view 的layoutsubview 方法里面写，还是在view 加载完成后写，那个更合理呢？</div>2019-03-18</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJVegfjqa0gM4hcRrBhZkIf7Uc5oeTMYsg6o5pd76IQlUoIIh2ic6P22xVEFtRnAzjyLtiaPVstkKug/132" width="30px"><span>xilie</span> 👍（5） 💬（3）<div>Hi，看了你写的“AutoLayout情况如何计算UITableView的变高高度”，问个问题：

有时候cell里面的一些 label 会在不同情况下切换显示和隐藏，这时 label 的上下间距，会出现异常，比如：
竖着排列3个 label: a-b-c，间距都是20，这时 b 隐藏，c 和 a 的间距是20，设计要求是10，这种怎么处理？</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/49/bd/ae37990b.jpg" width="30px"><span>geeklyc</span> 👍（4） 💬（3）<div>看了篇文章比较几种不同计算cell高度性能的问题，从好到坏：手动frame+计算高度，AutoLayout+计算高度，AutoLayout+自动计算。铭神，你的建议是？现在三种情况都用了下</div>2019-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/31/47/0e8305c6.jpg" width="30px"><span>wlgemini</span> 👍（3） 💬（1）<div>我也写了一个基于Auto layout的swift框架，在这里：https:&#47;&#47;github.com&#47;wlgemini&#47;Driftwood</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/52/0a/27da878c.jpg" width="30px"><span>轩</span> 👍（2） 💬（1）<div>关于 Autolayout，iOS 12 具体做了哪些优化呢？</div>2019-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/9c/b3/d1653155.jpg" width="30px"><span>张松超</span> 👍（2） 💬（1）<div>不推荐使用xib吗，还是不推荐使用拖线的方式</div>2019-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3c/b9/42b228f8.jpg" width="30px"><span>徐秀滨</span> 👍（2） 💬（1）<div>请问，使用xib画页面能够快速提高开发效率，但是怎么在MVC架构上合理使用呢？比如新建一个VC，勾上xib选项后，那么就会创建一个xib文件，这时候xib文件与VC位于同一目录下。
1. 从文件分类来讲，xib属于View层，VC属于C层，这就不对了。
2. 而且xib上有响应动作的话该怎么处理才能做到符合MVC分离，且不失了直接拉线写method这种便利性呢？</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/31/64/0e65616b.jpg" width="30px"><span>Anyeler</span> 👍（2） 💬（1）<div>主要公司的APP支持iOS8.0以上，所以UIStackView比较少用</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/38/93/fd3de018.jpg" width="30px"><span>断虹残雪</span> 👍（2） 💬（1）<div>铭神、请问使用Autolayout，如何适配多套主题（夜间模式）呢？我们现在的做法是每一个xib的view都拉线到代码，然后再代码做主题适配。一直感觉不太好，很繁琐...</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/58/abb7bfe3.jpg" width="30px"><span>Kai</span> 👍（2） 💬（1）<div>如何练习auto layout的代码编写？</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/34/d2/fff5be2b.jpg" width="30px"><span>Kinarobin</span> 👍（1） 💬（2）<div>戴老师，使用Auto Layout确实挺便利的，最近遇到一个问题，产品需要设置文本控件最多显示为10行，这就跟Auto Layout产生冲突了，想问一下如果使用Auto Layout有好的解决方案吗？谢谢！</div>2019-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3c/b9/42b228f8.jpg" width="30px"><span>徐秀滨</span> 👍（1） 💬（1）<div>感谢老师抽空回复。“作者回复: VC.view 了解下。以外的才是 C 层”具体在操作上要怎么处理呢？（指创建VC的时候直接带有xib的方式）</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/37/32/758ef1c7.jpg" width="30px"><span>西京富贵兔</span> 👍（1） 💬（1）<div>平时开发的时候，可能没有遇到过太复杂的UI层级，auto layout使用上也都还顺畅。但每每遇到和动画相关的问题的时候，使用auto layout就经常感觉做不到想要的效果，或者出来的效果不理想，都会改用手写布局，戴老师对于面对复杂动画的时候，布局方式这方面有哪些经验能否分享一二。</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/34/40/a84b6612.jpg" width="30px"><span>FR</span> 👍（1） 💬（1）<div>请问对facebook开源的yoga有了解吗，可以使用yoga代替AL吗</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3d/da/a5bff26f.jpg" width="30px"><span>汉茂</span> 👍（1） 💬（0）<div>使用xib布局性能怎么样？</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/35/c5/6758484a.jpg" width="30px"><span>sergeant</span> 👍（1） 💬（0）<div>关于xib上的自动布局会讲吗</div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/33/cb/a57f65cb.jpg" width="30px"><span>大太阳</span> 👍（1） 💬（1）<div>刚刚听完，感觉懵懵的，不过还要继续多刷几次，结合文稿，学习不能一蹴而就，加油加油加油💪。希望戴老师可以多多和我们交流，一起进步</div>2019-03-16</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK5icO2A4K7HYTYfQoagTz7VbtgxfS2ibBqLnKVWwQZgsePibZWFvFJEhPT8BtpQSaFx9IEodyp6c0dw/132" width="30px"><span>Geek_jg3r26</span> 👍（0） 💬（2）<div>您好，STMAssembleView
 下载下来跑不起来， xcode10.14 提示ld: library not found for -lPods ，删了libPods也不好使，下载也pod install了</div>2019-05-13</li><br/><li><img src="" width="30px"><span>强哥就是光头强呗</span> 👍（0） 💬（1）<div>我也习惯用Auto Layout 和 布局，但是随着xib文件增多，每次打开xib的速度都很慢， 有什么办法优化一下吗</div>2019-04-19</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/b4oNLTaYfCBibPibneZVz8GqiciavzhbloQicwoIMz8E9cJibjLpOmibOrWYiamKXXwqDWicWwgCZOawlOte6icJkn3iby8GQ/132" width="30px"><span>lhjzzu</span> 👍（0） 💬（1）<div>请教一下，您是怎么了解到layout engine相关的知识的，这部分知识可以从哪里看到?</div>2019-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/74/3f/52fa1e72.jpg" width="30px"><span>findU</span> 👍（0） 💬（1）<div>react-native的渲染布局是不是使用这个啊？</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/30/fe/fc686f23.jpg" width="30px"><span>李乾坤David</span> 👍（0） 💬（1）<div>并没有知道Autolayout性能怎么就提高了？</div>2019-03-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2f/29/dd370ae9.jpg" width="30px"><span>_Dzy</span> 👍（0） 💬（1）<div>有没有大佬的 DSL 作业做完了的，想看看，不是很理解怎么做。 </div>2019-03-26</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLVZRHorm7z67yJxOCpYWJESPfhia00RDg4oicvPuyCwTKln2BFRMiahOKz9z22RnnEmickA64bHdB7pA/132" width="30px"><span>土豆小小</span> 👍（0） 💬（1）<div>老师，现在xib和纯代码在布局性能方面的如何优先选择，抛开业务逻辑，您如何看待现在开发纯代码呢，最优的开发思路是如何选择呢</div>2019-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/b6/0f/89711af2.jpg" width="30px"><span>Kean</span> 👍（0） 💬（1）<div>想了解下，tableVIewHeaderView进行动态自动布局时候，布局警告的解决思路</div>2019-03-22</li><br/>
</ul>