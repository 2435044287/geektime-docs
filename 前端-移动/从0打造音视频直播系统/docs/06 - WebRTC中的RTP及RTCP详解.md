可以毫不夸张地说，WebRTC 是一个 “**宝库**”，它里面有各种各样的 “**好东西**”。无论你从事什么行业，几乎都可以从它里边吸取能量。

在学习 WebRTC 时，你不光要学习如何使用它，还应该多去看它底层的代码，多去了解它都能做些什么，争取对它的原理和使用都了然于心。如此一来，当遇到某个恰当的时机，你就可以从 WebRTC 库中抽取一点“精髓”放到你自己的项目中，让你的项目大放异彩。

比如，你是搞音频的，你就可以从 WebRTC 中提取 3A（AEC、AGC、ANC）的算法用到自己的项目中，这些算法可是目前世界上最顶级处理音频的算法；如果你是搞网络的，网络带宽的评估、平滑处理、各种网络协议的实现在WebRTC中真是应有尽有，你完全可以从中抽取你想用的。

鉴于WebRTC的强大“光环”，所以本文我将向你讲解学习WebRTC时你不得不知道的几个与网络相关的基本知识，让你在前期就能夯实基础。

## UDP还是TCP？

如果抛开 WebRTC，让你自己实现一套**实时互动**直播系统，在选择网络传输协议时，你会选择使用**UDP**协议还是**TCP**协议呢？

这个问题在2011年至2012年一直是一件困扰着我们整个团队的大事儿，因为当时在国内很少有用 UDP 作为底层传输协议的。UDP虽然传输快，但不可靠，尤其是在用户的网络质量很差的情况下，基本无法保障音视频的服务质量。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ae/a7/6d3a5d44.jpg" width="30px"><span>Dump</span> 👍（15） 💬（1）<div>老师，请教一下，使用UDP的确可以解决网络不好重传导致的延时问题，RTP协议解决了数据包组装的问题，而RTCP只是用于了解发送端和接收端的网络质量，那么UDP导致的丢包问题是如何解决的呢? 另外，传输过程的视频数据，关键帧间隔是小点好呢还是大点好，从我们直播使用情况来看，关键帧间隔如果设大，貌似容易出现跳帧的问题，我的理解是P、B帧数据丢失引起，但是I帧就不容易丢吗？不太理解其中的原理。问题有点长，还望了解解答。多谢了
</div>2019-08-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLqw36DnEjicRuXZO3fg3FftGLu6Kyvf7mOh456wicRan0hnghLoGowpYjnic5aTVESLE7oWqjljvj4A/132" width="30px"><span>scorpio</span> 👍（9） 💬（8）<div>老师您好，我们现在做的项目是从NVR推流到Web端展示实时视频的项目。实现方式是通过ffmpeg获取NVR流，并将rtsp转成rtmp，推向nginx；nginx作为流服务器；
遇到的问题：
1、cpu消耗高，i7-8700 cpu @3.2Ghz 3.19Ghz，8G内存配置 同时最高只能推11个视频流
2、视频延迟会随着推流的时长，延迟越来越来，一开始的时候就1-2秒的延迟
希望老师提供下解决思路，怎样能增加推流的数量，怎样降低延迟</div>2019-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg" width="30px"><span>John</span> 👍（5） 💬（1）<div>這篇特別重要 精華中的精華</div>2019-08-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ5Hnw1tL9EWGdzhibCw89hibKjibwcyUBCSJsQWaxxfGu5AkBibibV0anaKqw3nf3ZP0UWy5BaEYyw2Q/132" width="30px"><span>smilekaka</span> 👍（2） 💬（4）<div>老师您好，我想请教一个我们在使用WebRTC时遇到的一个问题，有一个网络环境明明网速很快，测试网速时也没发现丢包的情况，但是使用WebRTC连接时，一直提示ICE连接失败，而我们同时用另一个网络访问时，网速很慢都能连接成功，并能拉取到对端的画面，这是什么原因？</div>2019-07-28</li><br/><li><img src="" width="30px"><span>Geek_leo长沙</span> 👍（2） 💬（1）<div>老师你好，我现在可以实现wifi不同局域网下的连接，但是4g设备，不管移动还是联通或者电信互联，怎么都看不到对方的画面 不知道啥情况。能帮分析一下吗</div>2019-07-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLAxia7JictXmRQ02VwuibKOpib5bMcWbQHZeeQhsV17KeGh5u7ySyibgMVLwcoqCA3ZiayI3dLaVOjibRg/132" width="30px"><span>Geek_82d1fd</span> 👍（1） 💬（1）<div>老师，请教一个问题，UDP有发送缓冲和接收缓冲吗？</div>2020-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/b9/84/45df2b49.jpg" width="30px"><span>XiaoLong</span> 👍（1） 💬（1）<div>在读RFC-3550时，关于RTCP发送者信息中NTP timestamp和RTP timestamp的区别和作用不是很理解，希望老师能够指导，谢谢。</div>2020-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4b/71/591ae170.jpg" width="30px"><span>大恒</span> 👍（1） 💬（1）<div>老师，请问在RTCP协议中，客户端在接收到SR后，何时发送RR？如何计算这个时间点呢？</div>2019-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/0f/67/1cfb574e.jpg" width="30px"><span>Sunney</span> 👍（1） 💬（4）<div>老师您好，我想咨询一下对于网络摄像头在页面展示，有什么比较好的方式？
还有一般视频流在消息队列一般是如何传输的？</div>2019-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/b9/84/45df2b49.jpg" width="30px"><span>XiaoLong</span> 👍（0） 💬（1）<div>“PT=98 是视频数据，PT=111 是音频数据”，在rfc3551-《RTP Prole for Audio and Video Conferences with Minimal Control》中只说明PT:96-127为dynamic，但并没有指明具体是哪种类型。请问老师，哪里可以看到PT:96-127具体的定义，谢谢！</div>2020-01-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/b5/93/4358dfc8.jpg" width="30px"><span>Oan</span> 👍（1） 💬（0）<div>老师您好，关于rtp有一点不太理解：帧与帧之间可以用timestamp区分，但是我觉得无法做到“省去了前面所讲的起始标记和结束标记”，尤其是结束标记。我的疑问是：如果最后一个数据包丢失了应该作何处理呢？我们无法得到一共有多少个数据包用于传输这一I帧，也就不知道最后一帧是不是丢了。</div>2022-09-25</li><br/><li><img src="" width="30px"><span>Geek_770ff1</span> 👍（1） 💬（0）<div>有一个老师，请教一个问题，rtp包里面的时间戳是以秒计的吧？那如果同一秒多个帧数据怎么区分不同的帧包数据呢</div>2022-05-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKOCkbWo7KTAUYkTk5sqgOSAdjS51ZH8bTxiaBNLVnIFUOMsicBHRJBoXSOX6sZp5uORE2waGyz3ysw/132" width="30px"><span>npersonal</span> 👍（0） 💬（0）<div>老师，有什么办法可以查看收到的数据包，不是指chrome:&#47;&#47;webrtc-internals里的那个，就是收发原始的数据包</div>2022-05-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg" width="30px"><span>大斌</span> 👍（0） 💬（0）<div>老师，请教一下，为啥需要起始标记和结束标记，光有序号不行吗，这个标记是指标记对应帧的吗？还有为啥有了timestamp就不需要起始标记和结束标记了。</div>2022-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/d9/c0/c83e7023.jpg" width="30px"><span>努力奋斗fighting</span> 👍（0） 💬（1）<div>老师你好，我在做webrtc的时候遇到了一个问题，我自己写了采集和编码器，把编码之后的数据塞到webrtc中，发到对端，这中间的延迟大约有3秒，我看了一下采集和编码耗时都挺低的，老师你有思路这个主要延迟点在哪儿么？</div>2021-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/30/0d/77bb0d62.jpg" width="30px"><span>xiaopang</span> 👍（0） 💬（0）<div>学习</div>2020-10-20</li><br/>
</ul>