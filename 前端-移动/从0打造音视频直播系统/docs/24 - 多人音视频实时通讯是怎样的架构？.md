在前面的章节里，我们通过大量的篇幅介绍了WebRTC 在浏览器上对实时通信的各种支持。WebRTC 本身提供的是1对1的通信模型，在 STUN/TURN 的辅助下，如果能实现 NAT 穿越，那么两个浏览器是可以直接进行媒体数据交换的；如果不能实现 NAT 穿越，那么只能通过 TURN服务器进行数据转发的方式实现通信。目前来看，Google 开源的用于学习和研究的项目基本都是基于 STUN/TURN 的1对1通信。

如果你想要通过 WebRTC 实现多对多通信，该如何做呢？其实，基于 WebRTC 的多对多实时通信的开源项目也有很多，综合来看，多方通信架构无外乎以下三种方案。

- **Mesh方案**，即多个终端之间两两进行连接，形成一个网状结构。比如 A、B、C 三个终端进行多对多通信，当A想要共享媒体（比如音频、视频）时，它需要分别向 B 和 C发送数据。同样的道理，B 想要共享媒体，就需要分别向 A、C 发送数据，依次类推。这种方案对各终端的带宽要求比较高。
- **MCU（Multipoint Conferencing Unit）方案**，该方案由一个服务器和多个终端组成一个星形结构。各终端将自己要共享的音视频流发送给服务器，服务器端会将在同一个房间中的所有终端的音视频流进行混合，最终生成一个混合后的音视频流再发给各个终端，这样各终端就可以看到/听到其他终端的音视频了。实际上服务器端就是一个音视频混合器，这种方案服务器的压力会非常大。
- **SFU（Selective Forwarding Unit）方案**，该方案也是由一个服务器和多个终端组成，但与MCU不同的是，SFU不对音视频进行混流，收到某个终端共享的音视频流后，就直接将该音视频流转发给房间内的其他终端。它实际上就是一个音视频路由转发器。
<div><strong>精选留言（17）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/9a/38/f7c979e1.jpg" width="30px"><span>Derek</span> 👍（4） 💬（2）<div>思考题：录制桌面？</div>2019-09-15</li><br/><li><img src="" width="30px"><span>宇宙之王</span> 👍（3） 💬（1）<div>老师您好，我的需求就是让多个用户通过浏览器观看服务器上的MP4视频时能实现边下载边播放，因为视频比较大，所以想到流媒体，搜到了咱们的教程，发现好像没有讲这方面内容，请问要实现我的需求采用什么架构比较好呢，或用什么开源的工具实现呢？谢谢老师！</div>2020-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7c/61/76b1b888.jpg" width="30px"><span>被雨水过滤的空气</span> 👍（3） 💬（2）<div>怎么样让浏览器和服务器建立webrtc连接呢？有什么开源的库吗？望老师解答！</div>2020-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/93/bd/f3977ebb.jpg" width="30px"><span>John</span> 👍（3） 💬（3）<div>SFU相当于中转服务器 他的outbound bandwidth流量会消耗很大呀 很烧钱呀 李哥有没有更省钱又不影响效果的方案呢</div>2019-09-17</li><br/><li><img src="" width="30px"><span>涂滔</span> 👍（2） 💬（2）<div>老师，请问怎么用webRTC实现播放以前录制的视频呢</div>2020-04-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/42/ba/9183f6c2.jpg" width="30px"><span>A周峰</span> 👍（2） 💬（1）<div>李老师您好！media soap 怎么实现级连！jitsi meet 好像原生支持级连，这个适合商用吗</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4e/31/aab3f1ce.jpg" width="30px"><span>澈</span> 👍（2） 💬（5）<div>使用Mesh架构，如果客户端全是Native的（iOS和Android设备，不允许浏览器接入，那么允许最对的连接数是多少）</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/07/6d/f2d3bb3e.jpg" width="30px"><span>小沙弥</span> 👍（2） 💬（1）<div>老师，我想问一下，浏览器中用js可以实现回音消除吗？我在做一个sip的终端与浏览器互通的项目，噪声回音怎么处理啊？</div>2019-09-09</li><br/><li><img src="" width="30px"><span>Walter</span> 👍（2） 💬（1）<div>1对1 方案中的云服务器需要2M的带宽，sfu方案是不是需要更高的带宽呢？</div>2019-09-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a8/7e/c9201b20.jpg" width="30px"><span>三角形小于零</span> 👍（1） 💬（1）<div>Mesh 的方案 : 能穿过去确实可以节省服务器资源。   但如果全部走了 relay ，那此时 Mesh 应该是3种中最耗服务器资源的吗？ </div>2020-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/a5/e0d96e36.jpg" width="30px"><span>helloa</span> 👍（1） 💬（1）<div>目前的实际应用中，是使用Simulcast多还是SVC多呢？WebRTC支持它们吗？</div>2019-10-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJw0VnT9fk33w0Kgic1udf85TmuzBhibIzic188HIlhJ5SLMnVuM8ia9GDpLTia5k2zy0EoXgCj9ibYzvZA/132" width="30px"><span>tiga</span> 👍（1） 💬（1）<div>在 SFU 方案中，可以制作一个虚拟客户端接入 SFU 服务器，仅拉流，不上传流。
这个虚拟客户端接收每个成员的音视频流后，写入文件。
如果需要录制成一个文件，那虚拟客户端还要实现混屏和混音功能。</div>2019-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3e/e0/f9488a9a.jpg" width="30px"><span>雨夜</span> 👍（0） 💬（1）<div>svc里面多层是什么意思？</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4e/31/aab3f1ce.jpg" width="30px"><span>澈</span> 👍（0） 💬（1）<div>Mesh 方案如果客户端全是用 Adnroid和iOS设备不使用浏览器 是否可以支持多人连接</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/1f/14/57cb7926.jpg" width="30px"><span>ShawnWu</span> 👍（0） 💬（0）<div>课后题有点难啊，老师能解答一下吗？</div>2023-11-29</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJW8PREFPamKa8z1fgiaGib83l1IV6grtSxESQz832BACELvB8pDoz9icGuU4R3lbwlulzHH0L1RokZQ/132" width="30px"><span>林克盛</span> 👍（0） 💬（0）<div>mcu的c是control吧？</div>2022-04-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/f7/a6/79a835ac.jpg" width="30px"><span>Leeing</span> 👍（0） 💬（0）<div>思考题：参考《04 | 可以把采集到的音视频数据录制下来吗？》</div>2022-04-05</li><br/>
</ul>