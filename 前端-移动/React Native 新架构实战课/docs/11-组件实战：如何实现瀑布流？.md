你好，我是蒋宏伟。

现在，国内购物 App 的首页大都采用了双列瀑布流的布局，假如你的产品经理也想实现同样的瀑布流效果，你在网上找了很多的 React Native 列表组件，但都满足不了需求，你会怎么办？你会选择改让产品改方案，还是自己再研究研究？

大概是 2019 年的时候，我们的产品也提了同样的需求，使用 React Native 实现瀑布流效果。当时我们有个同事试了很多方案，比如双 List、多层嵌套 List，性能都很差效果不好，后来我们开会的时候提到了这个问题，我也参与了讨论。

当时我提出了一种思路：改 RecyclerListView 的源码。我说，RecyclerListView 的布局原理是绝对定位，每个 item 的 x、y 轴坐标是根据传入的 height、width 值算出来的，现在它的布局算法是单列的，我们只要把单列布局算法改成双列布局算法，这件事情应该能成。

后来我们团队的另一个大牛把它落地实现了，实现了一个 React Native 瀑布流页面。

在准备写实战案例的时候，我又想起了当初的这个事情。使用瀑布流的业务场景很多，却没有直接能用的开源方案，但它的实现原理其实并不复杂，应该是一个很好的实战案例。于是我就基于 RecyclerListView 最新的版本，又实现了一版。
<div><strong>精选留言（15）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg" width="30px"><span>dao</span> 👍（2） 💬（1）<div>三列布局还没有来得及写，单纯抄老师的思路来搞两列的瀑布布局就花了好几个小时。用上了 npm 包的几种修改方式——这是个额外的收获。（https:&#47;&#47;github.com&#47;hdouhua&#47;hybrid-mobile-app&#47;tree&#47;main&#47;AwesomeProject&#47;src&#47;c11）
要扩展这个组件的瀑布布局就必须阅读源码。阅读源码是很有必要的，也是每个程序员成长和进阶的必经之路！
</div>2022-05-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3c/88/6bef27d6.jpg" width="30px"><span>大神博士</span> 👍（0） 💬（1）<div>没有现成的高性能瀑布流组件吗，改开源库源码也不是很方便呐</div>2022-05-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/49/bd/ae37990b.jpg" width="30px"><span>geeklyc</span> 👍（0） 💬（1）<div>老师，对于列表垂直滑动吸顶，水平也可以滑动的切换不同的列表，有什么好的实现不？</div>2022-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/31/76/8e3347a1.jpg" width="30px"><span>学习中...</span> 👍（0） 💬（1）<div>大佬，这种方式会影响RecyclerListView的复用逻辑吗，感觉这种方式布局view复用逻辑会有问题？</div>2022-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4e/a0/67782623.jpg" width="30px"><span>贺子华</span> 👍（0） 💬（2）<div>运行时修改这个方法没太理解
</div>2022-04-21</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLib4GiaK4KB3UvnnzIkMAD4QzKBAkOzdntPwsb8RX1xjHYgr2w0GLWhmoPdwy3iby3zOHbeTBR2DgRQ/132" width="30px"><span>songyq</span> 👍（4） 💬（0）<div>这个学习曲线有点陡峭</div>2022-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/31/76/8e3347a1.jpg" width="30px"><span>学习中...</span> 👍（3） 💬（1）<div>老师讲的很好，不过试用了demo和结合自己实际项目中的需求来说，魔改RecyclerListView成瀑布流之后还是需要在layoutProvider中设置Dimension.width和height，但是在需求上有可能UI并不能确定好当前瀑布流item的高度，也就是无法说我区分type的方式来确定item，例如文字一行两行多行等需要在item进行了layout之后才能确定，我们没有办法measure，这样的话如果在item的onLayout之后再次刷新高度的话就会出现抖动等问题了。

请教老师一下这种情况有什么解决办法吗？是否能够让recyclerListView和FlatList一样在布局的时候可以自己动态的计算高度或者宽度进行布局呢</div>2022-06-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/a2/89/7098b532.jpg" width="30px"><span>wilson</span> 👍（1） 💬（0）<div>我按着修改完后，瀑布流效果是有了，但是为啥不能滑动了。一滑动就卡死</div>2022-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9d/5f/06671a0d.jpg" width="30px"><span>python4</span> 👍（1） 💬（0）<div>长见识了，以前都是直接复制</div>2022-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/a6/f3/5cd5cf28.jpg" width="30px"><span>iXay</span> 👍（0） 💬（0）<div>https:&#47;&#47;shopify.github.io&#47;flash-list&#47;docs&#47;guides&#47;masonry&#47;
还好现在有 FlashList 了</div>2024-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/64/1f/66839cba.jpg" width="30px"><span>，，，</span> 👍（0） 💬（0）<div>是否支持虚拟列表渲染？</div>2024-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3c/88/6bef27d6.jpg" width="30px"><span>大神博士</span> 👍（0） 💬（0）<div>为什么不用嵌套原生视图的方式？</div>2023-04-30</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/eMtXYzYicV03GIlIMx7tiabZq0HFve24jQ8QRqaatvd5BGE2DssrFIEdAk8ZTJHiad4XJNWcaBDWTndGzDPhsEq9Q/132" width="30px"><span>未月</span> 👍（0） 💬（0）<div>老师，请问下，按照上面修改完之后调用WaterfallLayoutProvider里面无限回调是什么原因？</div>2022-07-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/60/a1/45ffdca3.jpg" width="30px"><span>静心</span> 👍（0） 💬（0）<div>高手，不仅把原理解释清楚了，改的代码成本也很低</div>2022-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg" width="30px"><span>dao</span> 👍（0） 💬（0）<div>分享一下 RN 升级助手 https:&#47;&#47;react-native-community.github.io&#47;upgrade-helper&#47;</div>2022-05-09</li><br/>
</ul>