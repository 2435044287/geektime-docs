你好，我是陈航。

为了把Flutter引入到原生工程，我们需要把Flutter工程改造为原生工程的一个组件依赖，并以组件化的方式管理不同平台的Flutter构建产物，即Android平台使用aar、iOS平台使用pod进行依赖管理。这样，我们就可以在Android工程中通过FlutterView，iOS工程中通过FlutterViewController，为Flutter搭建应用入口，实现Flutter与原生的混合开发方式。

我在[第26篇](https://time.geekbang.org/column/article/127601)文章中提到，FlutterView与FlutterViewController是初始化Flutter的地方，也是应用的入口。可以看到，以混合开发方式接入Flutter，与开发一个纯Flutter应用在运行机制上并无任何区别，只需要原生工程为它提供一个画板容器（Android为FlutterView，iOS为FlutterViewController），Flutter就可以自己管理页面导航栈，从而实现多个复杂页面的渲染和切换。

关于纯Flutter应用的页面路由与导航，我已经在[第21篇文章](https://time.geekbang.org/column/article/118421)中与你介绍过了。今天这篇文章，我会为你讲述在混合开发中，应该如何管理混合导航栈。
<div><strong>精选留言（19）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLFbNiaADSSo6SQhsoDRX95ey8zngVaj2fHqaVc6JAd1uXJFAle1sl4SaicicpSzcKwa4JjLvkpKItZQ/132" width="30px"><span>Geek_joestar</span> 👍（6） 💬（6）<div>原生页面打开Flutter页面时会黑屏一两秒，然后出现Flutter页面内容，这个体验很不好</div>2019-09-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/50/90/8cb1bf5d.jpg" width="30px"><span>阿水</span> 👍（4） 💬（3）<div>老师我想请教一下，原生界面和flutter界面互相跳转的时候出现屏幕一闪的现象，有解决方案吗</div>2019-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/3b/44/dd534c9b.jpg" width="30px"><span>菜头</span> 👍（3） 💬（2）<div>请教一下
如何能够确保这两种页面过渡动画在应用整体的效果是一致的？

</div>2019-11-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/55/48de9a24.jpg" width="30px"><span>Carlo</span> 👍（3） 💬（1）<div>从 Flutter 页面跳转至原生页面 或者 从原生页面跳转至Flutter页面 如何传参呢？</div>2019-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/6c/2b/adc58a65.jpg" width="30px"><span>陆大胖</span> 👍（2） 💬（1）<div>Push FlutterViewController的方案不可取。起码现在stable分支上没有解决内存泄漏的问题。另外需知道每个FlutterViewController的创建都应了整个Flutter App的启动（xcode上暂停应用，会看到多了一套完整的Flutter线程，UI、io那些），无论你是否setInitialRoute，都是从Flutter代码的main函数开始运行，感觉上就是在你的应用内，启动了2个同样的Flutter App&#47;模块， 这还意味着2个FlutterViewController之间不做特殊处理的情况下不共享任何信息，以上，大多数情况下都会带来些水土不服。另外作者在回复中提到的“或者纯FlutterApp全部都是FlutterViewController，不释放其实也没什么问题”，这里的“全部都是FlutterViewController”可能我理解有偏差，先打个问号。</div>2019-09-18</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132" width="30px"><span>Geek_e7jq8k</span> 👍（0） 💬（1）<div>看文中提到的头条的文章，FlutterView -&gt; Engine —&gt; vm中的isolate，然后使用isolate共享，FlutterView -&gt; Engine还是一一对应的就解决了内存的问题，那请问下在iOS中，初始化FlutterViewController的方法中initWithEngine中传入同一个engine，是否是多个FlutterViewController对应同一个engine然后对应一个isolate呢？</div>2019-10-30</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJnugUNWBtcsyacCEbWaHVooT8TPzaZ5onicKQibggicnI7X6KibS3l0S8gdg8PuJR5w517hIHuiboquBg/132" width="30px"><span>Geek_icua5w</span> 👍（0） 💬（1）<div>跳转到的原生页面继承AppCompatActivity会崩溃   继承Activity就没事  这是为啥</div>2019-10-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/0b/73/4f1c9676.jpg" width="30px"><span>舒大飞</span> 👍（0） 💬（1）<div>如果混合开发中，多个不连续的flutter页面那个就会创建多个Flutter引擎吗</div>2019-10-11</li><br/><li><img src="" width="30px"><span>辉哥</span> 👍（0） 💬（1）<div>老师，请教一下，对于android来说，Flutter实例是不是对应的FlutterView对象？同时开启多个Flutter实例会占用过多的内存，那关闭当前Flutter容器所在的Activity是否能回收Flutter实例所占的内存？</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/dc/77/05b119eb.jpg" width="30px"><span>Tony</span> 👍（0） 💬（1）<div>我想问下老师，用什么画图软件画的图</div>2019-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/81/45/9aa91b75.jpg" width="30px"><span>矮个子先生😝</span> 👍（0） 💬（1）<div>老师,不知您是否有出现,push FlutterViewController之后,然后closeFlutterPage,但是内存依然居高不下.</div>2019-09-04</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZmm5lWL0PlY7P8SRw7iaB9An0MbLCAP8jS4t2yZd9v4pUtP49UCHfWbUFiaaSeQaRYPMXVo5pE1Jg/132" width="30px"><span>度木</span> 👍（1） 💬（0）<div>多引擎开销大的问题，官方在2.0版本优化掉了  https:&#47;&#47;docs.flutter.dev&#47;add-to-app&#47;multiple-flutters</div>2023-11-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/1dD8rnYEI7V6wJkXOUQcENxicwhEEjUYbtYPEgjNfaSbTYzQVT0Ktl4KotNflbGHOWePriaGaIRFiabAO4mDYxqHQ/132" width="30px"><span>Geek_efan</span> 👍（1） 💬（0）<div>请教一下，Flutter自1.12，不再支持用Android端使用Flutter.createView的方式了，而是用新的io.flutter.embedding.android包下的FlutterActivity和FlutterFragment，初始化路由也改到了FlutterEngine里，我想请教，是不是这样就一个引擎只能有一个初始化路由了，也就没办法做到灵活的原生端启动Flutter页面的时候传参了？</div>2020-06-23</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/qia3ujDMNj5sIavicvh3ib7rfDnS7ofAMVic0EA0VFE1Hpu5N1R8PibhjgBnicJQNuWS77tVHTS0BlhibmeqZ1ELdHPFg/132" width="30px"><span>Geek_fef1f7</span> 👍（1） 💬（1）<div>您好！我按照您的代码编译试了一次，一直提示 Unhandled Exception: MissingPluginException(No implementation found for method openNativePage on channel samples.chenhang&#47;navigation) ，请问可用从哪些方面定位问题呢</div>2020-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/72/89/a346ba9b.jpg" width="30px"><span>mirrors</span> 👍（0） 💬（0）<div>因此我们在实际业务开发中，应该尽量用 Flutter 去开发闭环的业务模块，原生只需要能够跳转到 Flutter 模块，剩下的业务都应该在 Flutter 内部完成，而尽量避免 Flutter 页面又跳回到原生页面，原生页面又启动新的 Flutter 实例的情况。

这个感觉没法避免，单个业务线可以做到flutter闭环，但如果我有多个业务线，那从另一个业务线退回到原生，然后又打开另一条业务线。这种情况应该比较常见，有什么好的方案吗？除非很极端原生只是个壳子，其他全用flutter实现，但这样混编还有什么意义呢？</div>2021-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/72/89/a346ba9b.jpg" width="30px"><span>mirrors</span> 👍（0） 💬（0）<div>Flutter 实例的初始化成本非常高昂，每启动一个 Flutter 实例，就会创建一套新的渲染机制，即 Flutter Engine，以及底层的 Isolate。而这些实例之间的内存是不互相共享的，会带来较大的系统资源消耗。

现在有一种写法：
iOS在AppDelegate中
&#47;&#47;flutter engine启动
self.flutterEngine = [[FlutterEngine alloc] initWithName:@&quot;WMFlutterEngine&quot;];
&#47;&#47; Runs the default Dart entrypoint with a default Flutter route.
[self.flutterEngine run];

这样的话，我是不是之后创建的FlutterViewController实例都是共用的这个flutter engine。效率上会提升吗？还是说，只是提前启动了引擎，每次创建的FlutterViewController实例还是不共用flutter engine。</div>2021-06-03</li><br/><li><img src="" width="30px"><span>小</span> 👍（0） 💬（0）<div>有个问题想请问下：通过OpenNativePage跳转到原生Activity(SomeNativePageActivity)后，我们返回，应该是退到FlutterHomeActivity吧？是PageA页面还是DefaultPage页？</div>2020-04-30</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/rRCSdTPyqWdJkIdySLkRpKDkg6oXhGibbCsMVEBVumXZbWGHNW1dwVjAeazeTOukiauJxH9mB8dQM681Kbe7kVRA/132" width="30px"><span>王文亮</span> 👍（0） 💬（0）<div>为了更加灵活的打开原生页面 可以考虑使用deeplink跳转，传参也方便</div>2020-04-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（0） 💬（0）<div>跟着老师一起精进，感谢老师的分享。</div>2019-09-03</li><br/>
</ul>