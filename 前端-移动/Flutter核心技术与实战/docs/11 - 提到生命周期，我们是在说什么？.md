你好，我是陈航。今天，我要和你分享的主题是Flutter中的生命周期是什么。

在上一篇文章中，我们从常见的StatefulWidget的“万金油”误区出发，一起回顾了Widget的UI更新机制。

通过父Widget初始化时传入的静态配置，StatelessWidget就能完全控制其静态展示。而StatefulWidget，还需要借助于State对象，在特定的阶段来处理用户的交互或其内部数据的变化，并体现在UI上。这些特定的阶段，就涵盖了一个组件从加载到卸载的全过程，即生命周期。与iOS的ViewController、Android的Activity一样，Flutter中的Widget也存在生命周期，并且通过State来体现。

而App则是一个特殊的Widget。除了需要处理视图显示的各个阶段（即视图的生命周期）之外，还需要应对应用从启动到退出所经历的各个状态（App的生命周期）。

对于开发者来说，无论是普通Widget（的State）还是App，框架都给我们提供了生命周期的回调，可以让我们选择恰当的时机，做正确的事儿。所以，在对生命周期有了深入理解之后，我们可以写出更加连贯流畅、体验优良的程序。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（26） 💬（1）<div>在构造函数中Widget还未生成，所以只能做一些参数传入的处理，initState中可以做初始化State的变量的操作。</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/6a/01/d9cb531d.jpg" width="30px"><span>这得从我捡到一个鼠标垫开始说起</span> 👍（17） 💬（3）<div>实际上打印监听的时候发现并不是文中所描述的那样。
从前台退居后台的时候执行inactive-&gt;paused
从后台进入前台的时候执行inactive-&gt;resumed
paused和resumed不会同时执行，是不是文中有错？
AppLifecycleState
</div>2019-08-26</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/YBA5YMSKhTNnKZlQW2Gk4mL0icBr28piadtbYmASf9PibjYxuvhzibOOqpsNuvKuS6qtTcA7eSvZM9SVw3y0VpdPbg/132" width="30px"><span>Geek_b09541</span> 👍（10） 💬（2）<div>大牛，你好，我想买一本关于flutter的工具书，麻烦推荐一本
</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/a9/09/fd67d691.jpg" width="30px"><span>jia58960</span> 👍（9） 💬（4）<div>为啥navigator.push()之后当前的widget deactivate了还要build一次？对老师给的工程代码验证了确实是这样，还请老师解释下</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/16/20562cdf.jpg" width="30px"><span>离尘不离人คิดถึง</span> 👍（4） 💬（2）<div>`width WidgetsBindingObserver` 这里没看懂， 明明用的是 with `WidgetsBindingObserver`，但是代码却使用的是 `WidgetsBinding`，查看源码，发现 `WidgetsBindingObserver` 只是 `binding.dart` 里面的一个抽象类；老师这里能解答下吗</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（4） 💬（1）<div>老师你好，为什么项目启动时Resolving dependencies和Running Gradle task &#39;assembleDebug&#39;阶段要很长的时间，大概2分钟。有什么办法可以加快速度吗？</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9f/06/287d77dd.jpg" width="30px"><span>承香墨影</span> 👍（3） 💬（1）<div>您好，有问题请教。
AppLifecycleState 中还有一个 suspending 的状态，这个状态表示什么意义？会在什么场景下触发？</div>2019-11-15</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/lQ1HcxQ49piaG5IImkt08ibkHk1GBY1lUSic2gQ9CbDE8UMhuYIUbmmSfke47XMyk0RyJEQT0vc47xGRaP0BpNQOw/132" width="30px"><span>Geek_60d7a7</span> 👍（3） 💬（2）<div>关于dart的mixin，老师能讲讲么，尤其是mixin on，看了好多资料都还不是很清晰…</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/55/48de9a24.jpg" width="30px"><span>Carlo</span> 👍（2） 💬（2）<div>除了需要监听 App 的生命周期回调做相应的处理之外，有时候我们还需要在组件渲染之后做一些与显示安全相关的操作。

能具体解释一下这个是什么意思么？比如说什么是显示安全相关的操作？
</div>2019-10-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ODicJCxia34EqbeBCwQeyWxcc0F25RP9fnI1r3o1Nt7S3ibRCvQI6zUlUKORL0kZic0PmCGX912bCZ5ERXPE785ZTw/132" width="30px"><span>咖啡凉了</span> 👍（1） 💬（2）<div>在iOS中，我们会用到viewWillAppear中实现方法刷新上一个页面的数据。Flutter中有类似的生命周期吗，怎么解决子页面数据提交后，返回到上一个页面刷新视图</div>2019-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/5a/e8/c31e06a8.jpg" width="30px"><span>赤茗</span> 👍（0） 💬（1）<div>而且那四个（PostFrameCallback）对应的状态 顺序为 inactive－&gt;paused-&gt;inactive-&gt;resume(只是唤起的过程)完整的日志如下：
I&#47;flutter (27127): AppLifecycleState.inactive
I&#47;flutter (27127): AppLifecycleState.resumed
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PersistentFrameCallback
I&#47;flutter (27127): PostFrameCallback AppLifecycleState.inactive
I&#47;flutter (27127): PostFrameCallback AppLifecycleState.paused
I&#47;flutter (27127): PostFrameCallback AppLifecycleState.inactive
I&#47;flutter (27127): PostFrameCallback AppLifecycleState.resumed</div>2019-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/5a/e8/c31e06a8.jpg" width="30px"><span>赤茗</span> 👍（0） 💬（1）<div>老师，我在didChangeAppLifecycleState 里加了Frame的两个回调，发现唤起的时候PostFrameCallBack调了四次，而我在setStatus里加这两个回调时只调用了一次，为什么会出现这种情况？</div>2019-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6c/56/07920099.jpg" width="30px"><span>微笑美男😄</span> 👍（0） 💬（1）<div>课件下载后,怎么用visual studio code 打开。我用Mac 发现无法打开</div>2019-10-08</li><br/><li><img src="" width="30px"><span>Geek_0793f1</span> 👍（0） 💬（1）<div>statelessWidget 没有 类似 deactivate 之类的生命周期钩子吗</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c0/30/34bd94f2.jpg" width="30px"><span>YangHong</span> 👍（0） 💬（1）<div>inactive处于不活动状态是指线程都挂起了吗，为什么前台切后台要经历这个处理？</div>2019-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/55/e4/7061abd5.jpg" width="30px"><span>Mr.J</span> 👍（0） 💬（1）<div>老师，Flutter的源码是怎么分类的，感觉分包好乱，经常找不到源码，不知道该去哪儿找</div>2019-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/6a/71/d28392a9.jpg" width="30px"><span>Bula</span> 👍（0） 💬（2）<div>可能是我前面的知识没理解透彻  切换一个新的视图，当前的widget就会回调deactivate ,移除了。那返回回来  这个视图是需要再重建一次吗  ，返回操作很常见，为什么要移除前一个视图的widget啊</div>2019-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e5/08/dfda5266.jpg" width="30px"><span>YJ</span> 👍（0） 💬（1）<div>ios 中的viewWillAppear 在这里有对应的回调吗？ 比如当前页面显示的时候此时想做点事情</div>2019-07-24</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqr5ibqxYwcSgqPA7s49MZb1vEKKXT4mPTojwiclXkJf3ug26NuzTa6A5gbicR2rAUHdEkUAn13Rr2KQ/132" width="30px"><span>吴小安</span> 👍（0） 💬（2）<div>deactivate 函数会被调用，这时 State 会被暂时从视图树中移除。值得注意的是，页面切换时，由于 State 对象在视图树中的位置发生了变化，需要先暂时移除后再重新添加，重新触发组件构建，因此这个函数也会被调用。
为什么push的时候当前的widget还需要buildbu？pop的时候不是执行一次build了么，push的时候执行的build有什么意义</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/83/e8/f726c635.jpg" width="30px"><span>加温后的啤酒</span> 👍（0） 💬（1）<div>老师 因为我在iOS开发中，用到dispatch_async(dispatch_get_mainQueue).是用来切换到主线程，但是你文章提到是用来 &quot;帧绘制回调”，并且Dart中没有多线程的概念，所以有点困惑、不是很理解这个“帧绘制回调”，能举个具体的例子解释下吗？</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2d/c9/0d8983f3.jpg" width="30px"><span>张简</span> 👍（25） 💬（1）<div>42节和43节其实可以提前讲讲，大多数开发者都是这种混合接入方式，和具体开发无关。首先遇到的就是混合接入问题。</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4a/7a/dc4f0ea2.jpg" width="30px"><span>知</span> 👍（6） 💬（3）<div>flutter1.14.7 之后，使用Navigator.push()时，当前的widget已经不会再调deactivate()和build()了，从上一个页面回来时，也都不会调用。</div>2020-09-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/86/02/791d0f5e.jpg" width="30px"><span>dranni</span> 👍（5） 💬（1）<div>App 生命周期中有没有类似 Android Application.onCreate() 的回调，在这里做App初始化的一些操作。或者 APP 初始化的操作应该放在哪里？</div>2020-01-14</li><br/><li><img src="" width="30px"><span>Geek_24cc07</span> 👍（1） 💬（1）<div>push到下一个页面，为啥当前页面调用了 deactivate 后，还要调用build？</div>2021-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/2b/a6/a851deb4.jpg" width="30px"><span>偷心人</span> 👍（1） 💬（3）<div>今天试了一下生命周期的监测  with WidgetsBindingObserver
发现从后台到前台 只有AppLifecycleState.paused-&gt;AppLifecycleState.resumed

前台到后台AppLifecycleState.resumed-&gt;AppLifecycleState.inactive-&gt;AppLifecycleState.paused

环境   Flutter (Channel master, v1.16.3-pre.30, on Mac OS X 10.15.3 19D76, locale
    zh-Hans-CN)</div>2020-03-28</li><br/><li><img src="" width="30px"><span>Geek_763c44</span> 👍（0） 💬（0）<div>flutter有没有类似android的Log.e(&quot;&quot;,&quot;&quot;)的方法，这样可以分级和根据键打印日志</div>2021-03-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/80/ea/801521ed.jpg" width="30px"><span>老花</span> 👍（0） 💬（2）<div>请问一下老师，现在使用flutter进行开发app，接入微信登录，QQ登录，微信支付，支付宝支付，QQ支付等功能，目前支持吗？比较担心这个问题，正在学习中，后续因为需要用到这些。</div>2020-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4e/a4/433305bb.jpg" width="30px"><span>卡洛斯(๑Ő௰Ő๑)</span> 👍（0） 💬（0）<div>大佬你好，有组件可见的声明周期吗？另外 didChangeDependencies 具体是什么场景导致依赖变化的呢？</div>2020-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/65/2b/446ef7b6.jpg" width="30px"><span>许先森</span> 👍（0） 💬（0）<div>State内部的widget对象，在State的构造函数中是null，所以不可以在State构造函数中使用widget对象属性，在initState中可以。</div>2020-09-14</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epcs6PibsP9vEXv4EibUw3bhQPUK04zRTOvfrvF08TwM67xPb1LBh2uRENHQwo2VqYfC5GhJmM7icxHA/132" width="30px"><span>蹦哒</span> 👍（0） 💬（0）<div>老师请问：iOS中每一帧都对应着一次runloop的执行，对应Flutter就是每一帧会执行一次addPostFrameCallback回调，是这样的吗？</div>2020-08-01</li><br/>
</ul>