你好，我是陈旭。

编辑器是低代码平台一个非常重要的基础设施，而代码生成器是编辑器的引擎，是编辑器做到所见即所得效果的基础。

在上一讲中，我从架构的角度详细理清了代码生成器和编辑器之间的关系，以及代码生成器与低代码长期演进之间的关系。

那么今天，我们就从实现的角度说清楚代码生成器是如何实现的。

## 人类是如何写代码的？

虽然写代码是我们日常工作内容，没有啥特别的。但这一讲的目的，是让代码代替人工来生成代码，所以我们需要快速回顾一下我们日常敲代码的过程，以及敲出的代码都有哪些部分。为了帮你快速回顾这个过程，我把手工正常开发一个组件的部分过程录屏下来了。

需要特别说明的是，首先我是用Angular写的这段代码，即使你没学过Angular，但你光看代码也是可以轻松理解的；其次我今天介绍的这个方法是通用的，不限于生成Angular的代码，你可以用这个方法生成任意框架代码，甚至用来生成Java/C/C++等后端代码。

下面我们看第一段视频，演示的是创建组件骨架代码：

![图片](https://static001.geekbang.org/resource/image/75/2f/7540d122a954d3f287a7a6dc0eecb92f.gif?wh=524x237)

把这十来秒的视频多播放几次后，你会有一个感触：**正常敲代码的整个过程是按需的**。显然你不会一上来就去敲第一行的import，而是当前需要用到Component这个渲染器时，你才会想起来：哦，我应该去import一下。
<div><strong>精选留言（9）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg" width="30px"><span>Joe Black</span> 👍（5） 💬（1）<div>学过编译原理的应该都不难懂，中间结构类似一个AST吧。</div>2022-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f0/b2/0d324d41.jpg" width="30px"><span>山巅最小的费马质数颗松</span> 👍（3） 💬（0）<div>结构化代码生成的条件是逻辑也是结构化的，标准化的，如果逻辑是一段非结构化的算法，则只能用类似于: codesegment: string的形式，把代码片段作为一个字符串由使用者整体传入，而不关心里面的内容，这其实也部分实现了pro code的兜底，也就是凡是不能结构化生成或者要有灵活扩展新的地方，都可以直接变成一个人工代码片段。</div>2022-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7e/8b/c5715002.jpg" width="30px"><span>xsnowholy</span> 👍（1） 💬（2）<div>GMTC 深圳站上关于低代码平台实现方法的演讲，在演讲的 17 分 36 秒到 20 分 43 秒
这个链接进去提示付费内容只能观看 3分钟，怎么办？</div>2022-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c7/64/340b60c1.jpg" width="30px"><span>崧阳</span> 👍（1） 💬（0）<div>老师Awade什么时候开源呀，非常想试试</div>2022-05-10</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>通过为不同的代码片段定义相应的插入点，代码生成器可以灵活地组合和生成符合这两种语言规范的代码。</div>2024-06-14</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>如果采用结构化代码生成法来生成 Java 或 C++ 代码，我会根据这两种语言的语法和特性来设计出相应的插入点。以下是一些可能的插入点设计：

Java 插入点设计
包（Package）定义：
packageSection：用于定义 Java 类的包路径。
导入（Import）语句：
importSection：列出所有需要的类库导入语句。
类（Class）定义：
classSection：定义类的名称、访问修饰符（如 public）、是否实现接口或继承其他类。
类成员变量：
memberVariableSection：定义类的成员变量，包括变量类型、名称和访问修饰符。
构造函数（Constructor）：
constructorSection：定义类的构造函数，包括参数列表和函数体。
方法（Method）定义：
methodSection：定义类的方法，包括方法名称、返回类型、参数列表和函数体。
内部类（Inner Class）定义：
innerClassSection：如果类包含内部类，则需要定义内部类的插入点。
注释（Comment）：
commentSection：用于插入类、方法或变量的注释。
接口（Interface）定义（如果需要）：
interfaceSection：定义接口的名称、访问修饰符和方法签名。
枚举（Enum）定义（如果需要）：
enumSection：定义枚举类型及其枚举值。
C++ 插入点设计
由于 C++ 相比 Java 更为复杂，具有更多的语言特性，因此插入点设计也会更加详细和多样。

命名空间（Namespace）定义：
namespaceSection：定义 C++ 代码的命名空间。
预处理指令（如 #include、#define）：
preprocessorSection：包含所有需要的预处理指令。
类（Class）定义：
与 Java 类似，但 C++ 还支持类的访问控制（如 public、protected、private）和继承方式（如 public、protected、private 继承）。
结构体（Struct）和联合体（Union）定义：
structSection 和 unionSection：定义 C++ 中的结构体和联合体。
模板（Template）定义：
templateSection：用于定义泛型类、函数等。
函数（Function）定义：
functionSection：定义全局函数或类的成员函数。
枚举（Enum）定义：
enumSection：与 Java 类似，但 C++ 枚举可以指定底层类型。
友元（Friend）声明：
friendSection：用于声明类的友元函数或类。
运算符重载：
operatorOverloadingSection：定义类中运算符的重载实现。
类型转换函数：
conversionFunctionSection：定义类型转换函数，用于类的隐式或显式类型转换。
这些插入点设计覆盖了 Java 和 C++ 语言的主要语法特性，</div>2024-06-14</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>虽然函数式编程与结构化代码生成法在某些方面存在差异，但通过将两者结合起来，可以发挥各自的优势，构建出更加健壮、可靠和易读的代码。在 Scala 等支持函数式编程的语言中应用结构化代码生成法时，需要根据语言的特点和特性进行相应的调整和优化。通过不断的实践和探索，我们可以找到一种更加高效和灵活的方式来生成函数式代码。</div>2024-06-14</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>确实，函数式编程（Functional Programming）与结构化代码生成法之间的关系是一个值得探讨的话题。函数式编程强调不可变数据和纯函数（即没有副作用的函数），这可能会给结构化代码生成法带来一些额外的考虑，但并不意味着这种方法不适用于函数式编程语言。

以下是对函数式编程和结构化代码生成法相结合的一些思考：

函数式编程的特点
不可变数据：函数式编程中，数据一旦创建就不可变，这有助于减少错误和提高程序的可靠性。
纯函数：纯函数没有副作用，只根据输入产生输出，这使得函数更加可预测和可测试。
高阶函数和函数组合：函数式编程鼓励使用高阶函数（接收函数作为参数或返回函数的函数）和函数组合（将多个函数组合成一个新函数）来构建程序。
结构化代码生成法在函数式编程中的应用
插入点的设计：在函数式编程中，插入点可能需要考虑不同的函数定义、高阶函数的调用以及函数组合的实现。
结构化数据的处理：结构化数据在函数式编程中仍然适用，可以用于描述程序的各个部分（如函数定义、模块结构等）。然而，由于数据不可变，可能需要在生成代码时考虑到这一点，例如通过生成新的函数定义来替代原有的函数。
递归和模式匹配：函数式编程中经常使用递归和模式匹配来处理数据。在结构化代码生成法中，可以通过定义相应的插入点和代码片段来支持这些特性。
类型系统和类型推断：函数式编程语言通常具有强大的类型系统和类型推断能力。在结构化代码生成法中，可以利用这些特性来生成更加健壮和可靠的代码。
Scala 语言的例子
Scala 是一种支持函数式编程和面向对象编程的混合语言。在 Scala 中应用结构化代码生成法时，可以考虑以下几点：

利用 Scala 的 case 类和模式匹配：Scala 的 case 类提供了一种简洁的方式来定义不可变数据，而模式匹配则可以用于处理这些数据。在结构化代码生成法中，可以利用这些特性来生成更加简洁和易读的代码。
高阶函数和函数组合：Scala 支持高阶函数和函数组合，这使得在结构化代码生成法中处理函数定义和函数调用变得更加灵活和强大。
隐式转换和隐式参数：Scala 的隐式转换和隐式参数提供了一种隐式地扩展现有类型或函数的方法。在结构化代码生成法中，可以利用这些特性来简化代码生成过程。
结论
</div>2024-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2023-02-20</li><br/>
</ul>