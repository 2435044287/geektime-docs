你好，我是陈旭。

今天这一讲，我会带你推开编译器协议层的大门，并在协议层中实现一个功能，这个功能将会解除低代码编辑器和组件之间的耦合。我这里放了一张架构图，当然今天我们会对这个图进行详细讲解，现在你只需要有个大概印象就可以了：

![图片](https://static001.geekbang.org/resource/image/11/60/117ac0b9d6d21a9ffa9ea93806aafe60.jpg?wh=1871x996)

在开始之前，我想请你思考一下这个问题：**低代码编译器（指代码生成器）是怎么知道自己应该如何使用一个组件的呢？**

这个问题乍一想挺简单的，但是思考越深，你会发现它越难。因为我们人类是通过学习组件API的方式来使用组件的，但编译器没有智能，它能像人一样去学习组件的API吗？不仅如此，我们还希望编译器除了“学会”内置组件集的用法，还能“学会”外来的其他组件，这可能吗？

## 教会编译器使用组件

图文是人与人之间传递知识最好的方式，就像这个专栏一样，我把我的知识以图文形式记录下来，你通过图文来学习。但图文对代码（编译器实质就是一串代码）是极不友好的，对代码友好的“教材”至少需要包含这些特征：

1. 是结构化的：与人类相反，代码擅长处理结构化数据；
2. 是指令式的：即这个“教材”必须是指出“怎么做”，而不是“做成啥”这种描述性的。

那如何给编译器提供一份符合这些特征的“教材”呢？

我们通过几个例子来逐步归纳。我在[05讲](https://time.geekbang.org/column/article/497779)讲低代码基础设施的时候，用到了一个表格的例子，我们以它为例。下面这些内容就是典型给人类阅读的API内容：
<div><strong>精选留言（13）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/aM00uMFibmtMG9OcSiaB9Hwe4oFZhuzbJibOYfKSaHlUjQ7NvnNedteZHzGVlAbyicLyAxP1zOzxJd75tN1IklxNGw/132" width="30px"><span>黄健楸</span> 👍（1） 💬（2）<div>请问您假设读者有怎样的能力呢？一方面，读这篇文章起码要熟悉编程，而且最好是node.js；另一方面，又用了“教材”这样模糊的类比。个人觉得两头不讨好。</div>2022-04-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/73/56/9cfb1e43.jpg" width="30px"><span>sheeeeep</span> 👍（0） 💬（2）<div>这一章有点没看懂。请教一下老师，这一章的属性编辑器，是为了实现编辑器能生成组件代码的功能对吗。按这种设计，将一个组件变成一个编辑器可用的物料，是不是对组件内部代码侵入太大？举个例子，业务上通常是先有组件集，后有物料集。大部分情况下，大家都是希望组件集和物料集是独立的，通过npm包的方式让物料集导入组件。
但是这一章介绍的方法，看上去是要直接修改组件代码的，不知道是不是我理解有误，请老师解惑</div>2022-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/b4/a1/5a3d5d18.jpg" width="30px"><span>团子团</span> 👍（1） 💬（1）<div>受益匪浅，感觉思路打开了，老师讲的是核心思想，关键是理解这个思想。这个对成天写业务代码的我来说帮助很大。</div>2022-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7d/f7/2fe4c1a1.jpg" width="30px"><span>洛河</span> 👍（1） 💬（0）<div>受益匪浅。。。感谢
1.  为编辑器使用组件提供了协议标准，并对生成器与编辑器进行了解耦
2. 为后续业务组件的接入提供了协议通道，充分体现了协议标准的优越性

后期可以动态加载业务组件。间接解决了平台核心层和业务方的耦合</div>2022-05-17</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>总之，在选择将哪些功能内置到低代码平台作为通用组件，哪些功能以插件形式集成时，需要综合考虑功能的通用性、使用频率、业务特定性以及维护和扩展的难易程度等因素。通过合理的功能划分和集成方式，可以提高平台的稳定性、灵活性和可扩展性，满足不同业务场景的需求</div>2024-06-14</li><br/><li><img src="" width="30px"><span>Geek_12e8fd</span> 👍（0） 💬（0）<div>在决定哪些功能适合内置到低代码平台作为通用组件，哪些功能适合以插件形式集成时，通常需要考虑多个因素，包括功能的通用性、使用频率、业务特定性以及维护和扩展的难易程度。以下是一些建议和分析：

适合内置为通用组件的功能
基础UI组件：如按钮、文本框、下拉列表等，这些组件在所有应用程序中都非常常见，且使用频率极高。内置这些组件可以提高开发效率，减少重复工作。
通用业务流程：如用户登录、权限管理、数据验证等，这些流程几乎在每个应用程序中都需要实现。内置这些功能可以减少开发者在构建基础功能上的投入，使他们能够更专注于业务逻辑的实现。
核心数据服务：如数据库连接、数据访问层等，这些服务是应用程序的基石。内置数据服务可以确保平台的稳定性和数据安全性，同时为开发者提供一致的数据访问接口。
适合以插件形式集成的功能
业务特定功能：某些功能可能仅适用于特定行业或业务场景，如金融行业的风险评估模型、医疗行业的病历管理系统等。将这些功能作为插件集成到平台中，可以保持平台的通用性和灵活性，同时满足特定业务的需求。
高级特性或扩展：一些高级特性或扩展功能可能不是所有应用程序都需要，如复杂的报表生成、实时数据分析等。将这些功能作为插件提供，可以使开发者根据项目的实际需求选择是否集成这些功能。
第三方服务集成：对于需要与第三方服务（如支付网关、社交媒体API等）集成的应用程序，将集成逻辑作为插件提供是一个好选择。这样可以减少平台与第三方服务之间的耦合度，同时方便开发者根据需要添加或移除集成。
原因分析
通用性和灵活性：内置通用组件可以确保平台的基本功能和稳定性，同时提供一致的开发体验。而以插件形式集成特定功能可以保持平台的灵活性，满足不同业务场景的需求。
维护和扩展：内置组件的维护和扩展通常由平台团队负责，可以确保组件的质量和兼容性。而插件的维护和扩展可以由业务团队或第三方开发者负责，这样可以减少平台团队的负担，同时鼓励社区参与和贡献。
资源分配：将常用和核心功能内置到平台中可以确保这些功能得到足够的关注和支持。而将特定功能作为插件提供可以根据项目的实际需求进行资源分配，避免在不必要的功能上浪费资源。
。</div>2024-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/0c/89/a695f9ba.jpg" width="30px"><span>bravepg</span> 👍（0） 💬（0）<div>是不是可以直接使用社区内的组件呢？比如说 antd，这样通用性很强，“教材”需要改动的地方也会比较少甚至不需要。</div>2024-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2023-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/62/1e/ad721e61.jpg" width="30px"><span>flow</span> 👍（0） 💬（0）<div>老师讲的属性配置器主要是生成代码层面的. 想问下业务组件如何自定义属性配置器以及如何在视图上呈现&#47;使用属性配置器呢?</div>2022-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/a1/0e/108d6fb7.jpg" width="30px"><span>Kobe的篮球</span> 👍（0） 💬（0）<div>Type&lt;SVD&gt;这种写法直接报错了，是不是应该是SVD</div>2022-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/a1/0e/108d6fb7.jpg" width="30px"><span>Kobe的篮球</span> 👍（0） 💬（0）<div>老师，请问SVD的全称是啥啊</div>2022-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/a1/0e/108d6fb7.jpg" width="30px"><span>Kobe的篮球</span> 👍（0） 💬（0）<div>老师能写个简单的例子吗？看的差不多能明白，但是写得时候还是有些地方写不对</div>2022-06-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI9kA8IicSJFKkQsXcLsNzeBC0w4TUkKywFSQAlPc9cSxzibNF5shtycl4PfD8zxfmLVT0O0icVp2Flw/132" width="30px"><span>李鑫海</span> 👍（0） 💬（0）<div>这篇我读一遍就理解很透彻了，在于思想的传递，解耦组件和编译器，靠协议规范，基于协议实现扩展机制。</div>2022-04-14</li><br/>
</ul>