你好，我是秦粤。上一讲我们介绍了什么是Serverless，从概念的角度我们已经对Serverless有了一个深入的了解；那从应用角度来看，Serverless对于开发者究竟有什么魔力呢？这一讲，我准备通过快速部署纯FaaS的Serverless应用，给你讲一讲FaaS应用背后的运行原理。

为了让你更好地体验Serverless带来的变革，这节课我们以Serverless版本的"Hello World"实操例子进行展示。鉴于我的熟悉程度，我选择了阿里云，当然，你也可以选择你熟悉的云服务商（我在专栏的最后一课还会讲到如何解除云服务商的限制，混合使用多云运营商服务等等）。

另外，需要注意的是，如果你是跟着我一步步实操练习的，那么开通云服务可能会产生少量费用，遇到充值提示你要自行考虑一下。当然，如果你不着急体验，我觉得看我的视频演示也已经足够了。

我们从上面的演示也看到了，会用Serverless这个目标我觉得不难实现，但这不是我们这节课的终极目的。今天我就想带着你打开这个FaaS "Hello World"应用的引擎盖，来看看它内部到底是如何运行的。为什么要急着给你讲原理呢？因为如果你不理解原理的话，后面在应用Serverless化的时候就无从下手了。
<div><strong>精选留言（29）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/65/c1/afcd981b.jpg" width="30px"><span>程序员二师兄</span> 👍（9） 💬（3）<div>采用留言式学习法学习本专栏，小结：
1、Serverless 是对服务端运维体系的极端抽象。
2、关于 Faas 三层结构非常形象的描述，容器是操作系统，Runtime 是播放器，代码是小电影。
3、容器、Runtime 和函数实例的关系，一旦容器和 Runtime 启动后，就会维持一段时间，这段时间内函数实例可以直接处理用户数据请求。当一段时间内没有用户请求时，则会销毁函数实例，这样子可以达到缩容为 0。这里举手提个小问题，文章中提到的一段时间通常是多久呢？
今天把作业完成了再来留言 ~~
</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（8） 💬（1）<div>老师有个疑问，一个函数实例就会启动启动一个 runtime 吗? 会不会出现一个 runtime 运行多个函数实例？ 每个函数实例都初始化一个runtime 会不会浪费资源？

还有在新建函数的时候都会有个函数运行内存，这个是一个runtime 限制的内存吗？ 如果超过这个内存限制会怎么样的？</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/b5/d8/56148446.jpg" width="30px"><span>张英杰</span> 👍（6） 💬（2）<div>目前发展来说，是不是更适合一些个人项目？</div>2020-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/21/30/8ecce1e1.jpg" width="30px"><span>北天魔狼</span> 👍（4） 💬（4）<div>老师：我最近在做即时通讯，faas可以创建websocket数据类应用吗</div>2020-05-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/cf/32/9aede769.jpg" width="30px"><span>麦乐</span> 👍（3） 💬（1）<div>老师您好，如何解决这个 &quot;F&quot; 不够纯函数的问题？FaaS 里面的函数理论上应该尽可能以函数式编程的思想去编写，那就意味着，函数本身是无状态的，但是业务逻辑是有状态的。比如，用户鉴权，如果只用一个函数去完成这样的逻辑，那这个函数与业务就强耦合了。怎么让这个函数与业务解耦呢？
第二个问题是怎么实现像 Koa 中间件那样的场景呢？是一个 函数实例 调用另一个 函数实例吗？</div>2020-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg" width="30px"><span>吴小智</span> 👍（3） 💬（2）<div>runtime 是一个进程吗？</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（2） 💬（1）<div>“云服务商可以预热大量的容器实例，将物理服务器的计算资源碎片化。Runtime 的实例适用性较低，可以少量预热”
Runtime实例适用性较低，指的是语言的多样性和单个语言的多版本？</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/58/b0/417b4117.jpg" width="30px"><span>哎呦歪</span> 👍（2） 💬（2）<div>老师这句话有点不太懂
“云服务商可以预热大量的容器实例，将物理服务器的计算资源碎片化。Runtime 的实例适用性较低，可以少量预热” 
为什么 Runtime 的实例适用性较低？按照 window 和 播放器来理解的话，既然要播放U盘里面的视频，那么window和播放器不都应该是打开的嘛</div>2020-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/0c/30/d4737cd5.jpg" width="30px"><span>lyonger</span> 👍（2） 💬（3）<div>请问下老师，serverless当前只支持http类型的触发器是吧？</div>2020-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/cb/07/e2df01d8.jpg" width="30px"><span>liuyu5337</span> 👍（2） 💬（1）<div>复杂应用场景适合吗？比如要用到连接池 数据库 redis Kafka等中间件，这些中间件都是一个函数实例吗？</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7e/a6/188817b6.jpg" width="30px"><span>郭嵩阳</span> 👍（2） 💬（1）<div>老师能不能说一下如果是java服务的流程应该是怎样启动的，还有就是FaaS如果调用的是java的服务 这个java的微服务是否应该是先部署的</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/eb/13/74a9bf35.jpg" width="30px"><span>寻云</span> 👍（2） 💬（5）<div>“一旦容器 &amp;Runtime 启动后，就会维持一段时间，这段时间内……数据请求。当一段时间内没有用户请求事件发生（各个云服务商维持实例的时间和策略不同），则会销毁这个函数实例。”

请问老师，函数应用实例具体会在什么时候（或者说多少时间无访问后）被缩容释放？各个主流云平台具体是多少？</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/96/79/6c371511.jpg" width="30px"><span>cheless</span> 👍（1） 💬（1）<div>像 go 这样的编译型语言，用户代码和运行时代码是一起编译的。可以做到 runtime 预热吗？</div>2023-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（1） 💬（1）<div>函数计算，好东西。我已经在阿里云了时间了，分分钟就可以部署好。
不过要开通东西还真不少，阿里云的账号，函数计算，oss等等等等</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c1/60/f5439f04.jpg" width="30px"><span>Geek_dn82ci</span> 👍（1） 💬（1）<div>个人觉得IT技术架构的演进不外乎逻辑架构分层（顶层设计）——调用链bypaas优化（软件层面优化）——硬件offload（掏钱解决），这么看的话serverless的本质也是优化冷启动来提升应用的敏捷响应，然后尽量把用户侧的工作做最大化精简，后端的工作能封装的封装，尽量对用户黑盒，至于冷启动、预留实例，其实都是比较tricky的手段</div>2020-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4e/94/0b22b6a2.jpg" width="30px"><span>Luke</span> 👍（1） 💬（1）<div>得益于 Google 的 JavaScript 引擎 Just In Time 特性，Node.js 在冷启动方面速度是最快的。
老师，很多语言都支持JIT特性，为什么Node.js就最快呢？</div>2020-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9c/f9/2a2be193.jpg" width="30px"><span>GL€</span> 👍（1） 💬（1）<div>函数代码文中提到有云服务商和用户负责一半，具体云服务商负责哪些？用户负责哪些代码？</div>2020-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/39/6a/239f3063.jpg" width="30px"><span>leo</span> 👍（1） 💬（3）<div>解释性语言在这里可能是个优势， 静态语言的编译耗时、运行时加载耗时都是很大的问题吧。
另外更期待课程聊聊如何自己搞Serverless平台而不是借助公有云实现， 因为在业务场景实现上可能会有限制， 自己测试玩玩还是可以的</div>2020-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/df/32/9a003239.jpg" width="30px"><span>dony.zhang</span> 👍（1） 💬（1）<div>老师，Faas平台目前主流云厂商也是通过文章中分层来实现，其中：
1. 容器：通过k8s集群管理docker容器；
2. runtime：定制各运行时中间件平台，如Node.js, Java等，并开发各平台的framework,提供给云函数开发者；
3. function code：基于各平台framework，开发者编写云函数代码；
其中runtime这层具体实现原理，可以讲解下吗？</div>2020-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/84/2d/7f6555c7.jpg" width="30px"><span>Fxjeep</span> 👍（1） 💬（1）<div>有没有可能自己的机器上搭一个serverless环境？</div>2020-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/09/c2/4e086a4b.jpg" width="30px"><span>demo123567</span> 👍（1） 💬（2）<div>serverless是基于rpc实现的吗？对请求链路的抽象是不是相当于隐藏了rpc调用过程中的command处理，最后直接返回结果？</div>2020-04-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/wyWwCHwOEibfepUzaNc1hBqZbfzgJkibnVH14GTQwfibBliaLbFfwMBslkg7cx1tljFic05jjv2JwKMOT8E5ux8K6SA/132" width="30px"><span>竹子</span> 👍（0） 💬（2）<div>老师，你好，这个课件里面的视频操作，是不是和现在网站有些出入哇，一直没有找到类似的页面，只有一个函数计算FC，是否是对应我们这一节的视频呢&#47;</div>2021-11-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/68/3f/40d1cd7f.jpg" width="30px"><span>stubborn</span> 👍（0） 💬（2）<div>FaaS之所以快，实际上创建和销毁的粒度是函数实例，不适针对runtime和容器的。 runtime和容器是云服务厂商针对某种特定的应用（比如spring boot）定制的，函数的编写需要遵守规范。换句话说，如果应用对应的容器和runtime也伴随函数实例一块销毁了，云服务厂商是不可能做得到100~700ms的快速启动函数实例。  所以云服务厂商肯定会预留一定量的容器和对应的应用类型的runtime环境，这段资源是平台共享的，具体某个用户的函数实例可以基于这个共享资源去调用，不知道我的理解是否正确。</div>2020-06-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg" width="30px"><span>piboye</span> 👍（0） 💬（1）<div>erlang 支持远程执行代码的功能， 有厂商提供这种方式的FaaS 的产品吗？</div>2020-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg" width="30px"><span>TKbook</span> 👍（0） 💬（1）<div>老师这个讲解够细致，本来真是一头雾水，看了之后，有种豁然开朗的感觉。</div>2020-04-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg" width="30px"><span>探索无止境</span> 👍（0） 💬（1）<div>老师您好，文中提到冷启动是100毫秒，但是如果程序并非像hello这么简单的程序，那启动时间应该也会变长吧？</div>2020-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a8/37/00ed15af.jpg" width="30px"><span>胡浩🐸</span> 👍（0） 💬（1）<div> FAAS 的应用，每个函数都是平级的吗，还是也是多个函数构成一个对象，多个对象构成一个包呀，不会几千个函数怼一块把</div>2020-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/33/d0/d88feba3.jpg" width="30px"><span>被单</span> 👍（0） 💬（0）<div>老师讲得真好</div>2020-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg" width="30px"><span>骨汤鸡蛋面</span> 👍（0） 💬（0）<div>如果是java语言的话，定义“函数”时，应该不会直接写一个public String hello(HttpServletRequest){} 就好了吧。我是java 程序猿，设想一下基于java 做FaaS 的两个方向
1.  把java 函数或java 类 带上web 框架等做成一个完整的 java镜像，然后FaaS 负责在请求到来时 拉取镜像并创建容器运行。如果是这种方案的话，感觉很难做到冷启动耗时100ms 的效果
2.  本身有一个 通用java runtime 在执行，请求到来时，拉取java 代码 动态类加载到jvm 并执行。 这样有机会做到快速的冷启动，但感觉使用场景会非常受限
老师可以以java 为例讲下FaaS 实现思路嘛</div>2020-05-04</li><br/>
</ul>