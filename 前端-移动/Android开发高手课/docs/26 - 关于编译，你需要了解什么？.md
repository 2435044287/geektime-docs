作为Android工程师，我们每天都会经历无数次编译；而对于大型项目来说，每次编译就意味着要花去一杯咖啡的时间。可能我讲具体的数字你会更有体会，当时我在微信时，全量编译Debug包需要5分钟，而编译Release包更是要超过15分钟。

如果每次编译可以减少1分钟，对微信整个Android团队来说就可以节约1200分钟（团队40人 × 每天编译30次 × 1分钟）。所以说优化编译速度，对于提升整个团队的开发效率是非常重要的。

那应该怎么样优化编译速度呢？微信、Google、Facebook等国内外大厂都做了哪些努力呢？除了编译速度之外，关于编译你还需要了解哪些知识呢？

## 关于编译

虽然我们每天都在编译，那到底什么是编译呢？

你可以把编译简单理解为，将高级语言转化为机器或者虚拟机所能识别的低级语言的过程。对于Android来说，这个过程就是把Java或者Kotlin转变为Android虚拟机运行的[Dalvik字节码](https://source.android.com/devices/tech/dalvik/dalvik-bytecode)的过程。

编译的整个过程会涉及词法分析、语法分析 、语义检查和代码优化等步骤。对于底层编译原理感兴趣的同学，你可以挑战一下编译原理的三大经典巨作：[龙书、虎书、鲸鱼书](https://www.itcodemonkey.com/article/3521.html)。

但今天我们的重点不是底层的编译原理，而是希望一起讨论Android编译需要解决的问题是什么，目前又遇到了哪些挑战，以及国内外大厂又给出了什么样的解决方案。
<div><strong>精选留言（17）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/e0/87/b7242f1c.jpg" width="30px"><span>Mograine</span> 👍（19） 💬（2）<div>微信这么大的一个app，android才40人？</div>2019-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b1/5a/d6b19c4d.jpg" width="30px"><span>汪海游龙</span> 👍（9） 💬（1）<div>对编译有了更深的认识，另外，Gradle 官方有个 build-scan 的功能，可以生成构建期间的详细报告，其中有性能相关的统计，可以帮助分析一些耗时的 task 等。</div>2019-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/71/17/abb7bfe3.jpg" width="30px"><span>饮识止渴(Vilin)</span> 👍（3） 💬（1）<div>odex文件，oat文件什么区别？是同时存在的吗？</div>2019-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4c/b4/7bffba42.jpg" width="30px"><span>zp</span> 👍（0） 💬（2）<div>看到有用到热修复的方法，这个基于插件化技术的方式在安卓9.0以后就用不了吧，这个怎么解决呢？</div>2019-05-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4b/26/3bea96f9.jpg" width="30px"><span>Victory</span> 👍（0） 💬（1）<div>以前用的windows 每次编译基本要两分钟了，特别影响开发效率，现在换的mac，比以前快了，但还是觉得慢😊</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/6c/e9/072b33b9.jpg" width="30px"><span>splm</span> 👍（0） 💬（1）<div>1.为什么把常量替换成方法对于大项目不行？是因为方法数吗？
2.对于annotation processor出现全量更新问题，gradle4.7的文档该如何解读？</div>2019-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/f9/66/e8fb8ca2.jpg" width="30px"><span>xlogic</span> 👍（0） 💬（1）<div>请问作者有没有了解过 JRebel for Android，虽然现在下线了，但是去年我用的时候感觉热部署很快，不知道是啥原理？</div>2019-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/56/25/ba0e44af.jpg" width="30px"><span>恒</span> 👍（0） 💬（2）<div>项目大了之后，一直受编译速度的折磨，即使换了机器，依旧还是那么慢，真的很恼火。google flutter的秒级编译速度刚开始确实让我眼前一亮，只可惜用flutter写的代码太难看了，不知道业界有什么办法能让flutter代码更加简洁一些呢？</div>2019-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/00/24/676cc31d.jpg" width="30px"><span>Innocence</span> 👍（4） 💬（1）<div>编译原理的三大经典巨作：龙书、虎书、鲸鱼书， 这个链接访问不到了</div>2021-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg" width="30px"><span>程序员小跃</span> 👍（4） 💬（0）<div>其实做人、做事也是如此，我们经常会陷入局部最优解的困局，或者走进“思维怪圈”，这时如果能跳出路径依赖，从更高的维度重新思考、审视全局，得到的体会可能会完全不一样。----最近在搞Java的微服务，很多问题一直困扰，我就出去走走，休息下，然后回去尝试从其他路径解决，效果真的还行</div>2019-06-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/7f/fb/49507baa.jpg" width="30px"><span>blithe</span> 👍（2） 💬（0）<div>看了很多遍，越看越回顾又看几遍，后来看一篇就直接写个总结</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/0b/2ccf7908.jpg" width="30px"><span>...</span> 👍（1） 💬（0）<div>看了下apply changes源码发现 其实对编译速度提升并没有帮助  主要功能是代码热部署</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（0）<div>有谁可以放点gradle 的资料吗？ 感谢</div>2021-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/48/53/3600edf2.jpg" width="30px"><span>🍎</span> 👍（0） 💬（0）<div>以前没了解过这块，今天算是懂了大部分原理了。厉害</div>2019-04-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/6c/e9/072b33b9.jpg" width="30px"><span>splm</span> 👍（0） 💬（0）<div>annotation processor遇到的问题就是，一旦修改了生成规则，所有类都需要重新解析生成再编译。如果不改，会不会依旧重新编译，没有仔细观察过。</div>2019-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/22/e9/32f5fa34.jpg" width="30px"><span>QuincySx</span> 👍（0） 💬（0）<div>分享 ProGuard 的用法 ：http:&#47;&#47;blog.smallraw.com&#47;index.php&#47;category&#47;javaProGuard&#47;</div>2019-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/47/5a/8ae70207.jpg" width="30px"><span>Sc</span> 👍（0） 💬（0）<div>编译一下的时间 都可以去厕所蹲一会了。。。</div>2019-02-19</li><br/>
</ul>