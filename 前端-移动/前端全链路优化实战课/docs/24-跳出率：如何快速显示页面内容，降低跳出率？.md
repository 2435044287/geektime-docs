你好，我是三桥。

首次内容绘制（FCP）是网页核心指标，也是前端全链路中的关键节点之一。这节课，我们将重点探讨如何优化这个首次内容绘制指标。

## 首次内容绘制和首次绘制的区别

首先，我们要先理解什么是首次内容绘制（FCP）和首次绘制（FP）。

### FCP的概念

首次内容绘制 (FCP) 衡量的是从页面加载到页面的一部分内容呈现在屏幕上的时间。通俗来说，这个指标显示了用户从输入链接到看到第一个画面的时间。

首次内容绘制的时间单位是毫秒，谷歌建议FCP应控制在1800毫秒以内。如果是1800毫秒到3000毫秒，就被认为稍慢，需要改进。超过3秒，说明首屏内容绘制时间过长。

根据我的经验，即使是1800毫秒，我都认为太长了。FCP时间越长，用户看到的内容就越久，退出率就越高。而用户的耐心是有限的，没有人愿意等待一个需要等待很长时间加载的网站。所以我认为，最终的目标要做到秒开。

好，我们回顾一下上节课提到的以极客官网为例的示图。

![图片](https://static001.geekbang.org/resource/image/4a/85/4a21dc12f267ac9637b8b19b69641a85.png?wh=2000x943)

这是一份开发者工具的性能报告，记录了4G网络访问官网首页时的性能。图中红框圈出的部分，对应的是页面顶部的图片和文字部分经过首次内容绘制之后看到的内容。

在此过程中，FCP指标的时间包括了TTFB时间（白屏时间）、资源下载时间、浏览器解析DOM时间以及浏览器渲染页面时间。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/2b/86/73/5190bbde.jpg" width="30px"><span>苏果果</span> 👍（0） 💬（0）<div>完整源码入口：
https:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course</div>2024-07-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/38/49/2f/590142fb.jpg" width="30px"><span>JuneRain</span> 👍（0） 💬（0）<div>async 和 defer 属性的作用都是异步加载js资源，差别是js加载后的执行时机，async 是加载后立马执行，而 defer 是加载后在 DOMContentLoaded 事件前执行。
同时还有个很重要的前提：js代码里没有操作DOM的代码，才使用这两个属性来异步加载js资源。因为DOM的解析过程中遇到js资源，会暂停解析，等js资源加载并执行完之后再恢复解析，此时如果js代码里有操作DOM的代码的话，DOM的结构就可能会改变。所以如果把会操作DOM的js资源异步加载，可能会出现意外的情况。</div>2024-07-21</li><br/>
</ul>