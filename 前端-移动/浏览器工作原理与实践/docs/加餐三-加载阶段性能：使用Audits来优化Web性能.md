你好，我是李兵。

作为一名前端工程师，除了需要编写功能性的代码以外，我们还需要关注Web应用的性能问题，我们应该有能力让我们的Web应用占用最小的资源，并以最高性能运行，这也是前端工程师进阶的必要能力。既然性能这么重要，那么我们今天要来聊聊Web性能问题。

## 到底什么是Web性能?

我们看下wiki对Web 性能的[定义](https://en.wikipedia.org/wiki/Web_performance)：

> Web 性能描述了Web应用在浏览器上的加载和显示的速度。

因此，当我们讨论Web性能时，其实就是讨论Web应用速度，关于Web应用的速度，我们需要从两个阶段来考虑：

- 页面加载阶段；
- 页面交互阶段。

在本文中，我们会将焦点放到第一个阶段：页面加载阶段的性能，在下篇文章中，我们会来重点分析页面交互阶段的性能。

## 性能检测工具：Performance vs Audits

要想优化Web的性能，我们就需要有监控Web应用的性能数据，那怎么监控呢？

如果没有工具来模拟各种不同的场景并统计各种性能指标，那么定位Web应用的性能瓶颈将是一件非常困难的任务。幸好，Chrome为我们提供了非常完善的性能检测工具：**Performance**和**Audits**，它们能够准确统计页面在加载阶段和运行阶段的一些核心数据，诸如任务执行记录、首屏展示花费的时长等，有了这些数据我们就能很容易定位到Web应用的**性能瓶颈** 。
<div><strong>精选留言（22）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/15/0b/b0/ff8585d9.jpg" width="30px"><span>莣孒</span> 👍（17） 💬（5）<div>老师，请问audits 一直生成不出报告是怎么回事呢</div>2020-04-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIVA6yj0YzARUJV3uqD5Qu0OUNbypl5QvCEwx0rTXubaXlU9TPoorQaZT8SMMvXZMnHLjIpBvIsnA/132" width="30px"><span>歌顿</span> 👍（10） 💬（1）<div>文中：我们先来分析下第一项指标 FP，如果 FP 时间过久，那么直接说明了一个问题，那就是页面的 HTML 文件可能由于网络原因导致加载时间过久，这块具体的分析过程你可以参考。

这里 FP 应该是 FCP 吧，FP  创建空白界面跟网络有关系吗？</div>2019-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/32/49/a97fc6df.jpg" width="30px"><span>Mr. Cheng</span> 👍（6） 💬（1）<div>终于等到这部分内容了，感谢老师</div>2019-12-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/fe/5e/9b723d19.jpg" width="30px"><span>空山鸟语</span> 👍（2） 💬（2）<div>老师，文中介绍了一些性能指标，比如fp  fcp等，但是这些数据如何使用performance.timing里的数据，给统计出来呢？
比如首屏时间，这个结束点在工具里很容易看到，但是如何拿到这个点的时间数据呢？</div>2019-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c9/56/2caa9d38.jpg" width="30px"><span>70K</span> 👍（0） 💬（2）<div>Audits 是不是要翻墙才能用？</div>2019-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/10/30/c07d419c.jpg" width="30px"><span>卡尔</span> 👍（77） 💬（1）<div>原来 chrome v83.0.4103.61的Audits升级成Lighthouse了。</div>2020-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（28） 💬（0）<div>老师真的是太良心了，又回来给我们加餐了，感谢老师。</div>2019-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/05/c9/637ca6a6.jpg" width="30px"><span>空空Ryan</span> 👍（4） 💬（2）<div>老师文章中的“接下来继续执行 JavaScript 脚本，当首屏内容完全绘制完成时，我们把这个时间点称为 Largest Content Paint，简称 LCP”，但我在查资料时 LCP 指的是最大内容绘制的所需时间。最大内容和全部的内容绘制完成，这两者是一样的吗？</div>2022-01-06</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/yyibGRYCArsUNBfCAEAibua09Yb9D5AdO8TkCmXymhAepibqmlz0hzg06ggBLxyvXicnjqFVGr7zYF0rQoZ0aXCBAg/132" width="30px"><span>james</span> 👍（2） 💬（2）<div>老师，我在chrome开发者工具中找不到Audits这面板</div>2020-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d9/c6/8be8664d.jpg" width="30px"><span>ytd</span> 👍（2） 💬（0）<div>赞~</div>2019-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2024-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/1f/04/1cddf65b.jpg" width="30px"><span>不二</span> 👍（0） 💬（0）<div>老师，有相关的学习资料，书籍推荐吗？想再系统学习一下</div>2022-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/91/09/6f0b987a.jpg" width="30px"><span>陈坚泓</span> 👍（0） 💬（0）<div>感谢老师 这专栏学到很多知识 (留下学习的痕迹)</div>2021-09-27</li><br/><li><img src="" width="30px"><span>Geek_panda</span> 👍（0） 💬（0）<div>也有情况是先触发domContentLoad事件，再去触发FP的，这是为啥</div>2021-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/b1/f2/eaea01b5.jpg" width="30px"><span>lemon</span> 👍（0） 💬（0）<div>老师写的太好了</div>2021-03-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/bd/d9/6adf17e2.jpg" width="30px"><span>c1992chen</span> 👍（0） 💬（1）<div>老师，为什么我用 performance 和 lighthouse  查看到的 fcp 时间会不一样？performance是3s，lighthouse是6s？ chrome版本是最新的88版本</div>2021-02-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/60/a1/45ffdca3.jpg" width="30px"><span>静心</span> 👍（0） 💬（0）<div>加餐的文章很好，感觉既实用，又细致</div>2020-06-26</li><br/><li><img src="" width="30px"><span>chenji</span> 👍（0） 💬（1）<div>老师，有个问题想咨询一下你，为什么我用 performance 和 audit 查看到的 fcp 时间会不一样了？是因为 audit 的 Network throttling 导致的吗？</div>2020-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/2e/01/14a478bb.jpg" width="30px"><span>happychap</span> 👍（0） 💬（0）<div>老师，您好！本文中提到的speed index指标与web page test中的差异极大，wpt的si计算的是从空白页到页面完全绘制整个时间段里对已绘制区域百分比的积分，个人觉得这种计算方式更能表达页面给人带来的体验。</div>2020-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg" width="30px"><span>-_-|||</span> 👍（0） 💬（1）<div>文中“上图中，bundle.js 是关键资源，因此需要完成加载之后，渲染进程才能执行该脚本，然后脚本会修改 DOM，引发重绘和重排等一系列操作，当页面中绘制了第一个像素时，我们把这个时间点称为 First Content Paint，简称 FCP”，那如果bundle.js 是放在body标签之后的，那我觉得即使没有下载完bundle.js ，其实浏览器也是可以解析上面的html结构的，也可以完成渲染一部分，难道非待等bundle.js 下载完后才执行脚本修改dom,重绘重排，绘制第一个像素，如果真是这样那平时把script标签放在head上，不考虑获取dom，首屏性能是一样的。假如说这个bundle.js 里面没有操作dom的代码，还会等bundle.js加载之后，渲染进程才能执行该脚本。或者给bundle.js加了async和defer属性里面也没操作dom的js代码，那首屏渲染还会等bundle.js下载完才能完成吗？</div>2019-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg" width="30px"><span>-_-|||</span> 👍（0） 💬（1）<div>文中“页面加载过程”这个图中，在解析html的过程中有个Token阶段还有AST阶段是包含在“Parser HTML”阶段中了吗？那文中“在渲染进程确认要渲染当前的请求后，渲染进程会创建一个空白页面”中渲染进程是如何确认要渲染当前请求的，有没有一些判断确定它到底该不该、能不能，怎么解析？</div>2019-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d7/5a/9d6a4abf.jpg" width="30px"><span>logic</span> 👍（0） 💬（0）<div>期待老师的下一篇 performance 的讲解。</div>2019-12-06</li><br/>
</ul>