前面两篇文章我们分析了HTTP/1和HTTP/2，在HTTP/2出现之前，开发者需要采取很多变通的方式来解决HTTP/1所存在的问题，不过HTTP/2在2018年就开始得到了大规模的应用，HTTP/1中存在的一大堆缺陷都得到了解决。

HTTP/2的一个核心特性是使用了多路复用技术，因此它可以通过一个TCP连接来发送多个URL请求。多路复用技术能充分利用带宽，最大限度规避了TCP的慢启动所带来的问题，同时还实现了头部压缩、服务器推送等功能，使得页面资源的传输速度得到了大幅提升。在HTTP/1.1时代，为了提升并行下载效率，浏览器为每个域名维护了6个TCP连接；而采用HTTP/2之后，浏览器只需要为每个域名维护1个TCP持久连接，同时还解决了HTTP/1.1队头阻塞的问题。

从目前的情况来看，HTTP/2似乎可以完美取代HTTP/1了，不过HTTP/2依然存在一些缺陷，于是就有了HTTP/3。和通常一样，介绍HTTP/3之前，我们先来看看HTTP/2到底有什么缺陷。

## TCP的队头阻塞

虽然HTTP/2解决了应用层面的队头阻塞问题，不过和HTTP/1.1一样，HTTP/2依然是基于TCP协议的，而TCP最初就是为了单连接而设计的。你可以把TCP连接看成是两台计算机之前的一个虚拟管道，计算机的一端将要传输的数据按照顺序放入管道，最终数据会以相同的顺序出现在管道的另外一头。
<div><strong>精选留言（28）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132" width="30px"><span>有铭</span> 👍（19） 💬（4）<div>我的看法：这些年但凡觉得TCP不满足自己需求的人，基本都是在UDP上重新“发明”一套自己的流控和包顺序控制算法。说白了吧，就是重新造轮子再做一个（自己认为）更好的TCP。只是这类型的协议，目前没有一个能真的威胁到TCP的，固然有老师说的TCP协议僵化存在的原因，但是我也在想：TCP就真的这么不堪吗</div>2019-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/6c/e9/072b33b9.jpg" width="30px"><span>splm</span> 👍（13） 💬（2）<div>意思是H1.1到H2解决的队头阻塞，只是形式上的。因为这个问题本质上依旧没有解决，因为TCP特性就是这样的，是不是只要不摆脱TCP就意味着一直会有阻塞的问题？这个版本升级感觉更多的应该是减少长连接的个数，减少了带宽抢占，增加了资源优先级。而从H2到H3，骨子里就不想依赖TCP，使用UDP，并附上了TCP一些优秀特性，减少握手和增加可靠性。这是我对这几个版本迭代过程的理解。</div>2019-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/e5/2b/59bde898.jpg" width="30px"><span>Jack.Huang</span> 👍（11） 💬（0）<div>腾讯这篇文章讲http3，也讲的不错。https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;iF0wbV5o7HVjGG_Cb-RcOg</div>2020-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/63/27/deefd03f.jpg" width="30px"><span>HucerF</span> 👍（10） 💬（0）<div>非科班的看起来都比较舒服，讲解的不错</div>2020-06-17</li><br/><li><img src="" width="30px"><span>Geek_f74777</span> 👍（10） 💬（1）<div>能翻墙的同学推荐可以看看Revisiting HTTP2 https:&#47;&#47;youtu.be&#47;wR1gF5Lhcq0</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/b9/0d/ae745ec0.jpg" width="30px"><span>刹那</span> 👍（3） 💬（0）<div>之前看的一知半解，现在把tcp协议学习了之后发现看起来轻轻好多，果然基础很重要啊</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/15/9c/575cca94.jpg" width="30px"><span>LearnAndTry</span> 👍（3） 💬（0）<div>从http发展历程中也看到我们项目迭代的影子。 有好的优化方案往往因为历史包袱久久不能落地。改动越接近底层推动难度越大。  渐进式改动比较容易推行。
</div>2020-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/85/48/efbffe7e.jpg" width="30px"><span>xh</span> 👍（2） 💬（0）<div>tcp2会使用二进制分针层将请求分成一个一个帧，它和tcp将请求分成一个一个包有什么区别？帧还会分成多个包吗</div>2022-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/8a/d6/00cf9218.jpg" width="30px"><span>撒哈拉</span> 👍（1） 💬（1）<div>http3 核心是要解决 TCP 数据包丢包严重时带来的性能问题。

基于 UDP，添加一个 QUICK 层，实现 TCP 所拥有的优点，流量控制，拥塞控制，数据包重传等特性；集成TLS加密，能更快的握手，支持多路复用，一个连接传送多路数据，缩短握手时间
</div>2021-11-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> 👍（1） 💬（0）<div>很多时候，重新设计，比在现有设计上做优化，更容易，也会更优雅。
但现实中经常遇到的是，推到重来的代价付不起，只能不断优化。
希望最终可以推动TCP-IP整个协议族的进步，逐步从根源上解决问题。</div>2020-07-16</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/noTIfbBmzicH6oZaBqycVzKTLN5ibWWrDleVgnaQYCHJAAhUhNmgSCdFzrr1VRABwUQ7hROU7BgGVwHiaaHeHAiaVQ/132" width="30px"><span>Geek_28d96d</span> 👍（1） 💬（3）<div>在建立 TCP 连接的时候，需要和服务器进行三次握手来确认连接成功，也就是说需要在消耗完 1.5 个 RTT 之后才能进行数据传输。这里为什么是1.5个RTT，而不是三个RTT </div>2020-05-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/e0/6c/ef405cc1.jpg" width="30px"><span>关山楂</span> 👍（1） 💬（0）<div>有个问题，UDP本身是不保证可靠传输，因此有时候丢包率很高，您说HTTP&#47;3在此基础上封装了一层QUIC保证了数据的可靠性，那这个也需要类似于TCP的可靠性校验吧，那这个数据包丢失，就不需要等待校验吗？这不阻塞吗？如果说是多链路，那这个是多少条链路呢？是有多少请求就有多少吗？</div>2019-12-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/17/00/06f82787.jpg" width="30px"><span>抹茶冰淇淋</span> 👍（0） 💬（1）<div>请问下HTTP&#47;2是不支持同一个域名开启6个TCP连接吗？</div>2024-08-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2024-05-19</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/FibG12SyqesllyM4ooZdO0EI1d2ooVI23vvxFdGwCKMzkS2UjdAVh8pibtWLppq4KkFgysibTGO8FSlehib7d8JDwQ/132" width="30px"><span>Geek_137781</span> 👍（0） 💬（1）<div>http2解决了http1的队头阻塞 但是http2为什么还是存在队头阻塞没说清楚</div>2023-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/a2/89/7098b532.jpg" width="30px"><span>wilson</span> 👍（0） 💬（1）<div>http2为什么不也默认开启6个TCP连接呢</div>2022-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fb/96/72c9c095.jpg" width="30px"><span>曼珠沙华</span> 👍（0） 💬（1）<div>TLS1.3已经花了一个RTT,QUIC包含了TLS1.3,为何说它建立连接只花了0-1个RTT呢</div>2021-08-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/a1/41/ed8f8c37.jpg" width="30px"><span>李响</span> 👍（0） 💬（0）<div>tcp这样的设计也是为了数据的准确性。想问下什么情况使用http2优于http1.1呢</div>2021-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c2/e1/db127301.jpg" width="30px"><span>闷倒驴</span> 👍（0） 💬（1）<div>http协议的版本使用1.1还是2.0是谁控制的，通过什么方式控制的</div>2021-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/a3/71/649104fe.jpg" width="30px"><span>wu</span> 👍（0） 💬（1）<div>可以介绍下TLS协议吗。我看图中有出现</div>2020-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ee/28/c04a0c83.jpg" width="30px"><span>小炭</span> 👍（0） 💬（0）<div>TCP的设计很好，只是网络层面拖后腿了。现在似乎更多是在网络层面的突破，比如5G。</div>2020-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f8/f6/3e2db176.jpg" width="30px"><span>七月有风</span> 👍（0） 💬（2）<div>UDP有慢启动的问题吗？</div>2020-03-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c9/d5/08139264.jpg" width="30px"><span>雯欣</span> 👍（0） 💬（2）<div>老师你好 ，你在上一节说http2通过多路复用解决队头阻塞，我不是很明白，既然http2还是基tcp协议，并且只有一条tcp链接，那么一旦出现丢包的情况，不是效果比http1.1还差吗（至少http1.1支持六条tcp链接），如果http2只是为了解决慢启动的问题而将http1.1的六条链接合成一条，会不会有种丢西瓜捡芝麻的感觉</div>2020-02-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/eb/d3/92573feb.jpg" width="30px"><span>Geek_185c7d</span> 👍（0） 💬（4）<div>Network面板看到的请求条数是tcp连接个数吗</div>2020-01-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg" width="30px"><span>-_-|||</span> 👍（0） 💬（0）<div>“实现了快速握手功能。由于 QUIC 是基于 UDP 的，所以 QUIC 可以实现使用 0-RTT 或者 1-RTT 来建立连接.......”，由于是基于UDP的，所以实现0～1个RTT，那我感觉就面临一个问题，相比于TCP的三次握手，它的准确性就有问题了，搞不好还有极小的概率“串台“。</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg" width="30px"><span>-_-|||</span> 👍（0） 💬（1）<div>&quot;实现了 HTTP&#47;2 中的多路复用功能。和 TCP 不同，QUIC 实现了在同一物理连接上可以有多个独立的逻辑数据流（如下图）。实现了数据流的单独传输，就解决了 TCP 中队头阻塞的问题。&quot;,个人感觉不管怎么传输，还待保证数据包不会丢失，丢了还是要重新传输，重新传就会有队头阻塞问题，所以，文中说“数据流的单独传输，就解决了 TCP 中队头阻塞的问题”，感到疑惑，单独传就不阻塞了吗，丢了一堆包也不管了。</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/a9/64/819fccec.jpg" width="30px"><span>蔡孟泳</span> 👍（0） 💬（0）<div>老师您好，我想请问就是因为UDP本身是不保证可靠传输，因此有时候丢包率很高，您说HTTP&#47;3在此基础上封装了一层，那封装后的丢包率和TCP封装的相比较相差多少？有数据对比吗</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/a4/24/0f4a9157.jpg" width="30px"><span>伪装</span> 👍（0） 💬（0）<div>这章的概念都比较新 学习了</div>2019-10-15</li><br/>
</ul>