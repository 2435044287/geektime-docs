你好，我是王沛。

React 作为目前最为主流的前端框架，自2013年诞生至今已经有近8年的时间了。这8年来，在其他前端框架发生翻天覆地变化的同时，React 的 API 则非常稳定，几乎从来没有出现过重大的向后兼容的问题，而且每一次版本的升级也都非常顺滑。

这不仅说明React 在 API 的设计上经受住了考验，同时也可以看到 React 团队在稳定 API 上所做的努力。

但是即使在这样稳定的背景下，React 还是在两年前的 16.8 版本中推出了一套全新的 Hooks 机制。新版本的发布，在让人耳目一新的同时，也让广大早就恐惧于各种新轮子的前端同学心头一紧，产生本能的抗拒：这是什么东西？有什么用？难道现在的 API 不好吗？

如果你也有这样的疑问，那我要先给你吃一颗定心丸，这样的担忧是没有必要的。

其实对于 React 开发而言，这只是多了一个选择。因为**原来的基于Class的组件完全可以继续使用**，这意味着这两种开发方式可以并存，已有代码不需要做任何改动，而新的代码可以根据具体情况采用 Hooks 的方式来实现就行了。

那么，既然在追求极致向后兼容性的原则下，React 还是推出了新的 Hooks API，一定有其过人的一面。所以今天这节课，我就跟你一起探讨它的过人之处究竟是什么；为什么要发明 Hooks；以及它所解决的问题是什么。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/94/45/7ea3dd47.jpg" width="30px"><span>开开之之</span> 👍（28） 💬（13）<div>老师，为什么说react组件不会相互继承？我之前做过一个项目，就是通过继承来实现代码复用的</div>2021-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/fc/c3/0991edfc.jpg" width="30px"><span>闲闲</span> 👍（15） 💬（5）<div>老师我有个疑问，麻烦看到帮忙解答一下：

上面的例子里面说是窗口大小发生变化，组件就会更新，对于这一点我不太理解，class封装的还可以理解为，state发生改变了，导致重新render了，但是hook感觉这么理解不通顺，hook哪里写的就类似一个纯函数调用，是怎么驱动组件重新更新的呢？</div>2021-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/f8/3a/dbf7bdee.jpg" width="30px"><span>凡凡</span> 👍（9） 💬（1）<div>路由变化可以作为数据源吗</div>2021-05-27</li><br/><li><img src="" width="30px"><span>Geek_d221bc</span> 👍（5） 💬（1）<div>王老师，你好，想请教hooks是如何让函数组件具备随状态变化触发组件重新执行返回更新的呢？这是要去读hooks相关源码？</div>2021-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/db/38/9df8992e.jpg" width="30px"><span>刘洋</span> 👍（4） 💬（1）<div>多久更新完啊</div>2021-05-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIcOPgba5hadxiawicnLjSpRjlskQ22hnLEw1iayU5xibQ2YoqngJ2r6Sjp8RcoW6ODuLBr6dibiascz0vA/132" width="30px"><span>Geek_9878c1</span> 👍（3） 💬（2）<div>最喜欢的React地方就是  “在其他前端框架发生翻天覆地变化的同时，React 的 API 则非常稳定，几乎从来没有出现过重大的向后兼容的问题，而且每一次版本的升级也都非常顺滑。“ ， 隔多久都没有隔阂</div>2021-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f1/73/6f7e3b35.jpg" width="30px"><span>独白</span> 👍（3） 💬（1）<div>思考题：首先想到的是官方的一个api  useReducer。还有的话，就是监听滚动条向上向下呀。
看了老师这节课，才弄清除hooks真正重要的东西是啥。</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/2a/c6/fab94c55.jpg" width="30px"><span>小馋猫</span> 👍（2） 💬（2）<div>hooks没有出现之前如果想实现逻辑复用只能通过高阶组件的方式来实现</div>2021-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/59/ab/1f6d9ad8.jpg" width="30px"><span>哈哈哈[吃瓜]</span> 👍（1） 💬（1）<div>求教 我还是对hook的想法有一些疑问 主要是开发思想上 之前一直用jq 最近才看react 总是感觉有点别扭。

用hook的时候总是想 setState了之后 函数再运行一遍会有什么结果 总是在脑补函数组件内部的运行顺序 感觉一直在函数组件内部打转。

蓝黄对比那个图 useEffect为什么要写两个 

另外怎么能更好的从jq这种可以很细的去操作dmo的开发思想上转变到react上来呢？</div>2021-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/47/74/5e292ded.jpg" width="30px"><span>寇云</span> 👍（1） 💬（1）<div>定时器，监听滚动，键盘事件，复用Fetch。</div>2021-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/2a/c6/fab94c55.jpg" width="30px"><span>小馋猫</span> 👍（1） 💬（1）<div>函数组件没有自己的state及生命周期方法，hooks使react在函数组件中可以使用state和生命周期方法称为可能，hooks的最大的优点是逻辑可复用，</div>2021-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/6c/fd/0c5c254e.jpg" width="30px"><span>陶佳佳</span> 👍（0） 💬（1）<div>您好，老师，我想咨询一下，组合和继承的区别是什么？</div>2021-06-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e4/75/57809f30.jpg" width="30px"><span>Ada</span> 👍（0） 💬（1）<div>数据源，父组件传递下来的也是吧？</div>2021-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/bd/ec/cc7abf0b.jpg" width="30px"><span>L</span> 👍（0） 💬（1）<div>组合大于继承，特别是对组件这种大部分都是组合而成的内容来说就更是这个样子了</div>2021-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/0e/df/a64b3146.jpg" width="30px"><span>长林啊</span> 👍（0） 💬（1）<div>逻辑复用应该是hook的最大优点吧</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c0/99/259a412f.jpg" width="30px"><span>Geeker</span> 👍（0） 💬（1）<div>加深了我对 hooks 的理解</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7c/c0/09fd07c2.jpg" width="30px"><span>Geek_0b2691</span> 👍（1） 💬（0）<div>1.回答思考题： 
异步获取的数据，可能有点显而易见，但很常见，数据一开始是没有的，但是获取之后，需要触发hooks去更新组件，再渲染一次。
还有就是交互产生的状态改变，比如点击按钮弹窗出来，弹窗原本是不出来的状态，点击一下按钮，更新一下弹窗的显示状态，弹窗组件收到状态改变，就进行重绘，就弹出来了。
2. 跟老师请教一个问题，就是刚接触hooks的时候，有两个场景表示很疑惑，
一个是用一个useEffect去管理一个函数A的执行，我把多个依赖状态都写在useEffect里面了，没有用useCallback包裹处理函数A，就会发现如果某个操作，导致依赖里面的多个状态发生了变化，这个函数就会执行多次，这正常吗? 那时我一直以为这种情况不应该等所有依赖项都稳定后再去触发一次函数执行吗？为啥会执行多次？这个问题当时也不知道该从哪里寻找答案，就姑且认为是，只要一个依赖发生变化就执行一次函数了，老师这样理解对吗？
另外一个场景是，我还是让useEffect帮我去执行函数B，让useEffect也依赖状态了，但依赖的状态不是函数B里面用到的所有状态，是其中某一个，当初设计的思想就是，不是依赖的状态，每一个变它都执行嘛，那我只依赖一个，那是不是只会在依赖的状态变化时才会执行，函数B里用到的其他状态发生变化时就不执行了，这样函数就会少重复执行多次了，是不是就能提效一些了呢？这样的确是只会因为依赖的状态变化而执行函数，现在看来带来的后果就是，函数B中用到的其他状态值，不是最新的，想问老师，这种设计思路是不是本身就是有问题的？我一开始就错了，那减少函数B执行次数的方案，用usaCallback包一下函数B，其实这样也会执行多次，有什么更好的解决方案吗？是不是不应该从这个角度去想提效的问题？函数的多次执行是避免不了的？</div>2021-11-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/76/61/33d13087.jpg" width="30px"><span>Levon</span> 👍（1） 💬（2）<div>老师，react组件在页面切换时，如果页面实例已经销毁后，有请求返回去执行了setState，会报错，这个错误有最佳的实践解决吗</div>2021-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f5/95/a362f01b.jpg" width="30px"><span>Geek1560</span> 👍（0） 💬（0）<div>React hooks 有什么弊端</div>2024-11-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7d/4d/d98865b2.jpg" width="30px"><span>老实人Honey</span> 👍（0） 💬（0）<div>  const [size, setSize] = useState(getSize());
  这个写法有个疑问呢 每次render 都会执行一次getSize吗？ 
为什么不是useState(initFn)的写法呢</div>2024-09-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/37/f5/3e421eee.jpg" width="30px"><span>骏采星驰</span> 👍（0） 💬（0）<div>组合优于继承</div>2023-10-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f5/98/c490d236.jpg" width="30px"><span>小团</span> 👍（0） 💬（0）<div>关注分离这块感觉表述不太恰当，觉得应该这样表述：在React中，组件的生命周期方法通常会包含多个不同的业务逻辑，这样会导致代码的可读性和可维护性下降。而使用Hooks可以将同一个业务逻辑的代码尽可能聚合在一块，从而实现关注分离，提高代码的可读性和可维护性。</div>2023-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2c/55/f4c908ef.jpg" width="30px"><span>bequiet</span> 👍（0） 💬（0）<div>hooks里的render函数是哪个</div>2023-06-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI7iakTvMwXWBHCK6WicIV2M3yQMZ8BtBgYgzARcEjbEtcWfKsQ2JqpZianKibZ2D7l1D3rwyTOL56Pzw/132" width="30px"><span>Jackchoumine</span> 👍（0） 💬（0）<div>&quot;能够把一个外部的数据绑定到函数的执行&quot; 不太理解这句话，能否详细解释一下呢？</div>2023-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/55/51/c7bffc64.jpg" width="30px"><span>Andrew</span> 👍（0） 💬（0）<div>函数组件没有 State, 通过Hooks使得函数组件能够有State，其实是通过闭包的机制保留State吗？</div>2022-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/55/51/c7bffc64.jpg" width="30px"><span>Andrew</span> 👍（0） 💬（0）<div>如果是复用的话，除了高阶组件外，是否还可以采用继承的方式? 这样在子类中也能够调用父类定义的size成员
MyComponent extends WindowSizeComponent extends React.component</div>2022-07-15</li><br/><li><img src="" width="30px"><span>刘闯</span> 👍（0） 💬（0）<div>useWindowSize是不是可以理解为一个utils函数呢？如果没有hooks，外部引入一个utils函数貌似也可以解决此逻辑复用的问题。</div>2022-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/dd/29/d2b5af6c.jpg" width="30px"><span>JUST</span> 👍（0） 💬（0）<div>还能想到的有：浏览器属性，PC还是移动端</div>2022-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/a7/1a/efb17bff.jpg" width="30px"><span>世界很大</span> 👍（0） 💬（0）<div>请教 最近开始使用hooks，有时需要批量更新多个state后才触发某段逻辑，这用hooks 该怎么处理呢，类似setState 的callback？感谢～</div>2022-03-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJQLfPbnibuQwaXIgyr3hxUdVAuaZfsn4pjic3lDvUmlpfPqvMJ2aSfetI18lKpRyzLuIbYeY2K15ibg/132" width="30px"><span>聂鹏</span> 👍（0） 💬（0）<div>高阶组件加装饰器模式</div>2022-02-10</li><br/>
</ul>