你好，我是宫文学。

在上一节课里，我们实现了基本的面向对象特性，包括声明类、创建对象、访问对象的属性和方法等等。

本来，我想马上进入对象的继承和多态的环节。但在准备示例程序的过程中，我发现有一些技术细节还是值得单独拿出来，和你剖析一下的，以免你在看代码的时候可能会抓不住关键点，不好消化。俗话说，魔鬼都在细节中。搞技术的时候，经常一个小细节就会成为拦路虎。

我想给你剖析的技术细节呢，主要是**语义分析**和**AST解释器**方面的。通过研究这些技术细节，你会对面向对象的底层实现技术有更加细致的了解。

## 技术细节：语义分析

语义分析方面的技术细节包括：如何设计和保存class的符号、如何设计class对应的类型、如何给This表达式做引用消解、如何消解点符号表达式中变量等等。

**首先看看第一个问题，就是如何在符号表里保存class的符号**。

我们知道，符号表里存储的是我们自己在程序里声明出来的那些符号。在上一节课之前，我们在符号表里主要保存了两类数据：变量和函数。而class也是我们用程序声明出来的，所以也可以被纳入到符号表里保存。

你应该还记得，我们的符号表采用的是一种层次化的数据结构，也就是Scope的层层嵌套。而且，TypeScript只允许在顶层的作用域中声明class，不允许在class内部或函数内部嵌套声明class，所以class的符号总是被保存在顶层的Scope中。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/21/7e/fb725950.jpg" width="30px"><span>罗 乾 林</span> 👍（1） 💬（0）<div>class的符号信息，这些符号可以不在在虚拟机或者可执行程序中保存，如果保存了这些信息，可以让我们的语言更加灵活，如实现运行时的类加载，类自省等能力比如JAVA。不保存这些信息的有C&#47;C++(c++有typeinfo不知道算不算）。

Norminal和Structural的类型系统，感觉Structural的类型系统更加灵活动态性更好，在编程上C++的模板机制也能提供像Structural的类型系统的能力，即所谓的鸭子类型。
</div>2021-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2022-09-27</li><br/>
</ul>