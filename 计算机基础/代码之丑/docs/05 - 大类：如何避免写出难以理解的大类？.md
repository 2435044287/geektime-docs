你好，我是郑晔。

上一讲我们讲了长函数，一个让你感受最直观的坏味道。这一讲，我们再来讲一个你一听名字就知道是怎么回事的坏味道：大类。

一听到大类，估计你的眼前已经浮现出一片无边无际的代码了。类之所以成为了大类，一种表现形式就是我们上节课讲到的长函数，一个类只要有几个长函数，那它就肯定是一眼望不到边了（长函数的话题，我们上一讲已经讨论过了，这里就不再赘述了）。

大类还有一种表现形式，类里面有特别多的字段和函数，也许，每个函数都不大，但架不住数量众多啊，这也足以让这个类在大类中占有一席之地。这一讲，我们就主要来说说这种形式的大类。

## 分模块的程序

我先来问你一个问题，为什么不把所有的代码都写到一个文件里？

你可能会觉得这个问题很傻，心里想：除了像练习之类的特定场景，谁会在一个正经的项目上把代码写到一个文件里啊？

没错，确实没有人这么做，但你思考过原因吗？把代码都写到一个文件里，问题在哪里呢？

事实是，把代码写到一个文件里，一方面，相同的功能模块没有办法复用；另一方面，也是更关键的，把代码都写到一个文件里，其复杂度会超出一个人能够掌握的认知范围。简言之，**一个人理解的东西是有限的，没有人能同时面对所有细节。**

人类面对复杂事物给出的解决方案是分而治之。所以，我们看到几乎各种程序设计语言都有自己的模块划分方案，从最初的按照文件划分，到后来，使用面向对象方案按照类进行划分，本质上，它们都是一种模块划分的方式。这样，人们面对的就不再是细节，而是模块，模块的数量显然会比细节数量少，人们的理解成本就降低了。
<div><strong>精选留言（29）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg" width="30px"><span>qinsi</span> 👍（38） 💬（3）<div>正如类太大会超出人的理解范畴，类太多也会。举个java的例子，做业务开发时大部分需求都可以通过spring boot完成，但如果要对spring进行定制，需要理解的内容就多了一个数量级。框架本身在满足更多需求的同时不断重构，类的职责越来越单一，数量也越来越多。虽然每个改动都有正当的理由，但如果不知道这些改动的历史，一下子就被那么多类糊一脸，任谁也是吃不消的。个人理解这可能是在业务优先的场景下，两害相权取其轻的结果吧。</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a7/42/f510bb91.jpg" width="30px"><span>wang_acmilan</span> 👍（18） 💬（5）<div>目前在做嵌入式的项目，里面的C代码如郑老师所言，大部分都是以“效率”为名，写的巨长无比。
我有一个问题想咨询郑老师，我们的项目不算法，4万行左右，我在进行一代往二代的重构，我个人感觉应该把功能都拆开，以不同文件夹的层级方式进行代码的整理；而组内的同事以及外包的员工觉得代码不算多，一个文件夹，几个文件一把就搞定了，没必要搞那么复杂。

这个问题就和老师这篇文章所述有一点不一样了：如果觉得代码架构和代码逻辑能够理解，是不是clean code的必要性或者说急迫性就没有那么大了。先以交付为目标进行coding，后续再看情况。</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/84/0b8e2d25.jpg" width="30px"><span>邓志国</span> 👍（10） 💬（2）<div>看了郑大的例子，正合我当前做法，给自己吃颗定心丸。我现在java一个4万行代码的项目，最大的类不到300行代码。普遍100行以下。很多是得益于对象健身操。操练了对象健身操，对面向对象会有更深刻理解</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/59/21/d2efde18.jpg" width="30px"><span>布凡</span> 👍（8） 💬（1）<div>老师，请问一下，一般来说实体的大小和数据表的列是对应关系的，User类拆分出了Contact这个类，那么数据库的层面是否也应该差分出一个Contact表还是把信息都存储在User表的列中呢？</div>2021-02-09</li><br/><li><img src="" width="30px"><span>life吖</span> 👍（8） 💬（2）<div>有的时候，拆分和聚合是需要做取舍的。比如，微服务的聚合层，是为了适配和性能考虑会做裁剪或聚合，不可避免的会出现些大类，此时可以进行字段分组，但是聚合后的大类是无法进行拆分。</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e6/28/1d3aace3.jpg" width="30px"><span>Hobo</span> 👍（7） 💬（1）<div>将user里的联系信息单独拆出一个类来以后，我要对外暴露一个修改联系信息的方法是应该放user里还是放contact里？</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/87/4e/98173974.jpg" width="30px"><span>明</span> 👍（7） 💬（2）<div>老师，我也有个一直找不到平衡点的问题，就是类爆炸问题，如果拆分的类太多 会不会出现累爆炸的问题呢，从而影响系统性能，这个有没有个比较数字化的标准呢。还是我看这个问题的角度就完全不对。（ps 拍个马屁：我真的越来越崇拜老师了😍😍）</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/bb/11/28d86278.jpg" width="30px"><span>人月聊IT</span> 👍（5） 💬（5）<div>每个类两个字段？？？？</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a8/e8/bc84c47d.jpg" width="30px"><span>熊斌</span> 👍（5） 💬（1）<div>我们的项目中，或者是用到的类似于JPUSH这种开源软件中，都存在“大类”的问题。最头疼的是遇见没有注释说明的大类，里面罗列了很多字段、函数，但是你都没法一眼就看出来各自都是干嘛的，只能先猜一下，完了之后根据调用关系去梳理。

最近用PHP进行二次开发，用到一个扩展包，里面的入口class写得巨长无比......

目前来看，把类写小，越小越好能做到的是凤毛麟角呀。也可能是我见得太少了</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3c/52/5951ffb4.jpg" width="30px"><span>Sinvi</span> 👍（4） 💬（1）<div>今天有了新的追求</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg" width="30px"><span>芒果少侠</span> 👍（3） 💬（1）<div>老师，字段分组后，在做序列化反序列化（如json）的时候，就会多产生一个嵌套层级（由a.b变成了a.c.b）这样可能会破坏一些上下游服务的交互协议</div>2021-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e6/28/1d3aace3.jpg" width="30px"><span>Hobo</span> 👍（3） 💬（5）<div>我们项目实体类和数据库表是直接映射的，如果拆分成上面这样的话，数据库是也需要拆多表？(用户、作者、编辑)</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ac/87/8ed5880a.jpg" width="30px"><span>大碗</span> 👍（2） 💬（3）<div>MVC里常出现的大类是UserService,提供登陆，注册，修改密码，查询用户等方法里面会有UserDao,LoginRecordDao，CacheDao等很多个注入的“字段”。这种应该怎么拆分呢，如果按职责拆分成UserLoginService,UserRegisterService,UserPasswordService,UserInfoService，保持每个service里面又少量注入“Service、Dao”，这么拆对不对呢</div>2021-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（2） 💬（1）<div>1.总结：小类大对象+面相意图的抽象。

2.好的抽象只需关心使用不用关心实现，所以能降低复杂性。但不好的抽象。。。

3.个人觉得还是讲究平衡，没必要一上来就拆分得很细致。当复杂度让你皱眉头时再拆也许更物有所值。</div>2021-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/cb/49/0b9ffc8e.jpg" width="30px"><span>刘大明</span> 👍（2） 💬（2）<div>现在项目中很多大类，把很多东西都返回前端。美其名曰这样前端想怎么用怎么用。还有就是拆分成多个小类之后，很多人没有管理好小类的能力。分散的越来越复杂。</div>2021-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/8d/b4/ff82483d.jpg" width="30px"><span>邵俊达</span> 👍（2） 💬（1）<div>郑老师您好，「对象健身操」中有一条规则是「封装所有的原生类型和字符串」，请问这些封装好的对象在项目中一般放在什么目录下比较合适？</div>2021-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2b/39/19041d78.jpg" width="30px"><span>😳</span> 👍（1） 💬（1）<div>项目中好像都是大类，每个人加点东西，就更庞大了。</div>2021-01-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/c8/f4/c2bdf8e8.jpg" width="30px"><span>good-goose</span> 👍（0） 💬（1）<div>请问郑老师，User里面引用了Contact实例，对应到数据表应该怎么设计呢？分成两个表吗？</div>2022-01-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（0） 💬（3）<div>contact类不用存对象id么</div>2021-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg" width="30px"><span>小袁</span> 👍（4） 💬（0）<div>一个类不超过两个字段？典型的从一个极端走到另外一个极端！</div>2022-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/ca/89/dc1949c1.jpg" width="30px"><span>王展鹏</span> 👍（1） 💬（0）<div>目前做前端工作，采用vue的单文件组件模式进行开发。由于业务场景的原因，之前采用1000行作为组件的最大长度，现在看来设置得大了。但是前端的交互、状态、展示会比较多，可能做不到100行以内。</div>2022-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2d/f5/e8/6142eaec.jpg" width="30px"><span>行者</span> 👍（1） 💬（1）<div>提了很不专业的问题，拆分成多个小类，怎么用呢？ 用一个基础类来继承多个小类么？</div>2022-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/6f/f1/35f9f16f.jpg" width="30px"><span>李叶</span> 👍（1） 💬（0）<div>分而治之 单一职责 字段分组 分离变化 将类设计了小类，不超出可控范围</div>2021-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/60/a8/76486dfc.jpg" width="30px"><span>乌拉呀哈</span> 👍（0） 💬（0）<div>请问像日常CRUD这种，创建的DTO和查询的DTO是不是也应该划分开，保证职责单一呢</div>2024-01-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e6/d5/20c2fb6b.jpg" width="30px"><span>天空提提</span> 👍（0） 💬（0）<div>老师您好，用户、作者、编辑的表设计是否可以用rbac那套呢？作者，编辑用一张角色表可以吗？</div>2022-08-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg" width="30px"><span>杯莫停</span> 👍（0） 💬（0）<div>已发布线上的代码是不敢大动的。但那种紧耦合，复杂度高的代码就为后面维护它的人很不友好，嘴上抱怨着谁写的烂代码，但该继续开发还得继续。而且为了不重构改稳定版本的代码，会做很多“迁就”，走上老路。这就是个恶性循环!</div>2022-07-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>把类写小，越小越好--记下来</div>2022-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/8b/a7/b6471f02.jpg" width="30px"><span>远逝的栀子花</span> 👍（0） 💬（0）<div>open stack  nova代码中的manage模块中的类都是大类，尤其是compute.manage，一个类有几十个方法与成员变量。</div>2022-05-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg" width="30px"><span>授人以🐟，不如授人以渔</span> 👍（0） 💬（0）<div>课前思考：
1. 大类有哪些特征？如何判定一个类是一个大类？
2. 为什么会写出大类？
3. 大类反应出来的编码本质问题是什么？或者换一种说法，把大类拆解成小的模块，带来了哪些改变？
4. 如何重构大类？</div>2022-04-24</li><br/>
</ul>