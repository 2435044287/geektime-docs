你好，我是郑晔。

我前面课程讲的所有坏味道都是告诉你如何在已有的代码中发现问题。不过你要明白，即便我们能够极尽所能把代码写整洁，规避各种坏味道，但我们小心翼翼维护的代码，还是可能因为新的需求到来，不经意间就会破坏。

一个有生命力的代码不会保持静止，新的需求总会到来，所以，**写代码时需要时时刻刻保持嗅觉。**

这一讲加餐，我来给你讲讲两个发生在真实项目中的故事。

## 一次驳回的实现

我们的系统里有这样一个功能，内容作品提交之后要由相应的编辑进行审核。既然有审核，自然就有审核通过和不通过的情况，这是系统中早早开发完成的功能。

有一天，新的需求来了：驳回审核通过的章节，让作品的作者重新修改。造成作品需要驳回的原因有很多，比如，审核标准的调整，这就会导致原先通过审核的作品又变得不合格了。

在实现这个需求之前，我们先来看看代码库里已经有怎样的基础。

首先，系统里已经有了审核通过和审核不通过的接口。

```
PUT /chapter/{chapterId}/review
DELETE /chapter/{chapterId}/review
```

在这个设计里，将章节（chapter）的审核（review）当作了一个资源。在创建章节的时候，章节的审核状态就创建好了。审核通过，就相当于对这次审核进行了修改，而审核不通过，就相当于删除了这个资源。

对应着这两个接口，就有两个对应的服务接口：
<div><strong>精选留言（12）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg" width="30px"><span>qinsi</span> 👍（8） 💬（1）<div>应该不是所有的需求都可以像文中描述的一样，最终避免改动接口的。一样要改动接口的话，增加新接口的同时保留和有计划地废弃旧接口，应该也是合理的接口升级实践。基础设施做得好（开发效率高，接口监控到位），搬砖熟练的话，可能新需求还没分析完，新接口已经实现好了...</div>2021-02-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（4） 💬（2）<div>1.案例一，面对同个问题，未看郑大佬的解法时我的思路是相反的。
2.入口要写成2个方法，决策依据是单一职责(如果可以明确走不同分支，就不该通过状态判断来让一个函数实现复用)。至于实现部分是否走相同函数，那是关于复用和隔离的权衡，与时间和场景有关，并不绝对。
3.我的理解，郑老师是把审批不通过和驳回都归为&quot;拒绝&quot;的方法，所以也符合单一职责。从业务的角度来评定单一职责。而我是从代码实现的角度来评定。</div>2021-02-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg" width="30px"><span>return</span> 👍（4） 💬（1）<div>老师好，请教一个问题， 如果因为需求变动 确认过眼神 某个实体确实不需要了， 该不该把他删了。
不删的话 代码有误导性， 删的话， 所有用到过这个实体的地方都得改。
老师有啥好办法吗😄</div>2021-02-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/b9/a0/ed4c3eae.jpg" width="30px"><span>修冶</span> 👍（3） 💬（2）<div>老师你好，请教下一个应用不同模块都有查询功能，入参和出参都类似，请问这种情况是对外暴露一个接口，入参里加个业务类型做区分，还是暴露2个接口，感谢</div>2021-03-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/87/4e/98173974.jpg" width="30px"><span>明</span> 👍（16） 💬（9）<div>老师，我想问一个和这节课内容无关，但是我很迷茫的事情，就是-&gt;如何提高“解决问题的思路”，事情是这样的：
	前两天我们有个项目，需要导出客户账单的pdf，每个月每个账号要导出来多个账单pdf（比如这个月10个pdf，上个月20个pdf），然后这些pdf要以导出时候的时间戳做命名（例如今天导出时间戳是12384958293 ，明天同样导出本月的话单 时间戳就是 12384923049）并可以根据时间戳作为pdf账单内容的顺序（时间戳最小的是第一个账单，时间戳最大的是最后一页账单），客户导出的时候根据pdf的顺序一个一个的将pdf下载下来。这样产生的问题就是，明明只需要每个月只生成一份的pdf，变成了每次导出都要重新生成。
	然后我们负责开发这块的同事（我们技术最厉害的，解决问题的思路很“宽”） 就和产品经理说这个事，
	产品经理说：这是要求的，必须要以时间戳做名称，
	开发的同事：但是这样很浪费系统资源，每次都要重新生成重新导出。

	。。。。。。（争吵十分钟）

当时 他们在讨论的时候，我也在考虑这个问题，如果是我，我要怎么办才能既保证产品经理要求的时间戳方式，又能不浪费系统资源（即，每个月的pdf无论客户导出多少次，系统内都只生成一份当月的pdf），但是我没跳出来“根据pdf的顺序一个一个的将pdf下载下来”这个圈，一直以这个为依据去思考如何解决这个问题。
	这时候，我那个负责开发这块内容的同事就说，那这样吧，我把这些pdf封装到一个zip里边，然后把zip按照时间戳来命名，可以吧，这样既可以打到你说的 每次下载都要根据时间戳命名的要求，又能满足每个月只需要生成一份pdf，不浪费系统资源的要求。
	当时我就眼前一亮  是啊，我咋就没有想到用“zip压缩封装”的方式呢，这样不仅时间戳的要求满足了（pdf在zip里边排序的方式也可以用其他方式表示），还将本来需要下载多次的pdf，变成了下载一次，优化了下载的体验，一举多得啊。
	
	说了上边的事情，我主要想表达的就是，怎么样才能提高自己解决问题的思路呢，zip我知道，将多个pdf封装到一个zip里我也见过，可以说这些东西我全懂，但是我就是没能将他们联系到一起，去解救这个问题。其实，也许还有更好的办法去解决这个东西。但是，通过这个事情我就发现了-&gt;我解决问题的思路真的很“狭隘”,水平很低。

	因此，老师有没有什么推荐的书籍之类的，能提高遇到问题的时候，解决这些问题的思路呢，我觉得解决问题的思路这件事太重要了，可能比学技术更重要。学技术只要下功夫基本就差不多，但是提高自己解决问题的能力这件事自己完全不知道该怎么做，才能提高自己这方面的能力，还希望老师能指点一下</div>2021-02-02</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDFo5d0p9V2D2XyPjJYU3CcFROe0YeBMN8BTelJ4NwTznb5ezqibUr1paKL68CKQwiboVOtrcZHPIg/132" width="30px"><span>子铭</span> 👍（1） 💬（2）<div>我在思考另外一个事情，就是关于改动接口和系统稳定性之间的关系问题。我个人理解，不增加新接口，在原有基础上修改，这样的做法会不会破坏原接口的稳定性，如果原接口是一个影响面较广，使用场景较多（类似支付消费这样的接口），那如果有一个系的需求过来，那在原有接口基础上修改和增加一个新的接口进行一个选择，我个人认为还是增加一个新的接口更有利于系统的稳定性，在原有基础上对老接口的修改，势必会破坏接口的稳定性，甚至出现可能预料以外的接口，就借用郑老师在文中的那句话。
“接口，是系统暴露出的能力，一旦一个接口提供出去，你就不知道什么人会以什么样的方式使用这个接口。”，尤其是一些比较敏感的接口，总是在老接口的基础上作修改，就有一种“超级接口”的坏味道的感觉，不知道我的理解 是不是表述清楚，是不是片面，欢迎指正。</div>2022-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a1/6d/a4ff33bb.jpg" width="30px"><span>Lee</span> 👍（0） 💬（0）<div>想请教一下，比如对于同一个实体，可能存在多个组合条件，不同场景下查询，此时在controller层时提供多个API，然后转为内部领域对象进行一个查询逻辑？</div>2022-11-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>谨慎地对待接口和实体的变动--记下来</div>2022-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/84/0d/4e289b94.jpg" width="30px"><span>三生</span> 👍（0） 💬（0）<div>老师，碰到一个这样的需求，一个开关值，还有一个是动态值，我想在不修改实体的情况下，共用在一个字段内，但是其他人说，这样这个字段业务就不够明确（单一）别人可能看不懂，所以他添加了一个字段，我觉得是否应该讲开关和动态放在一起，这样既明确又不用新增字段</div>2022-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/84/2c/1b0926b4.jpg" width="30px"><span>Even</span> 👍（0） 💬（0）<div>1. 为什么对外提供的接口越少越好。因为提供的接口越好，管理成本会上升、以后难收敛。
2. </div>2022-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7a/ef/20818c3f.jpg" width="30px"><span>Beluga</span> 👍（0） 💬（2）<div>老师，我还是没搞明白为什么提交时间和任务调度时间不是同一个时间。</div>2021-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8a/5a/b67a82e3.jpg" width="30px"><span>shen</span> 👍（0） 💬（0）<div>最后例子提交时间属于实体本身的属性，调度时间属于外部发起的操作时间，属于其他部分的</div>2021-06-12</li><br/>
</ul>