上两节我们讲了二分查找算法。当时我讲到，因为二分查找底层依赖的是数组随机访问的特性，所以只能用数组来实现。如果数据存储在链表中，就真的没法用二分查找算法了吗？

实际上，我们只需要对链表稍加改造，就可以支持类似“二分”的查找算法。我们把改造之后的数据结构叫做**跳表**（Skip list），也就是今天要讲的内容。

跳表这种数据结构对你来说，可能会比较陌生，因为一般的数据结构和算法书籍里都不怎么会讲。但是它确实是一种各方面性能都比较优秀的**动态数据结构**，可以支持快速地插入、删除、查找操作，写起来也不复杂，甚至可以替代[红黑树](https://zh.wikipedia.org/wiki/%E7%BA%A2%E9%BB%91%E6%A0%91)（Red-black tree）。

Redis中的有序集合（Sorted Set）就是用跳表来实现的。如果你有一定基础，应该知道红黑树也可以实现快速地插入、删除和查找操作。**那Redis为什么会选择用跳表来实现有序集合呢？** 为什么不用红黑树呢？学完今天的内容，你就知道答案了。

## 如何理解“跳表”？

对于一个单链表来讲，即便链表中存储的数据是有序的，如果我们要想在其中查找某个数据，也只能从头到尾遍历链表。这样查找效率就会很低，时间复杂度会很高，是O(n)。

![](https://static001.geekbang.org/resource/image/e1/6d/e18303fcedc068e5a168de04df956f6d.jpg?wh=1142%2A268)

那怎么来提高查找效率呢？如果像图中那样，对链表建立一级“索引”，查找起来是不是就会更快一些呢？每两个结点提取一个结点到上一级，我们把抽出来的那一级叫做**索引**或**索引层**。你可以看我画的图。图中的down表示down指针，指向下一级结点。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLhicDSmL4vicPF4mF9g5icORERwDSqZv5Guk0TyhiacuBsiaVxCdktI6oCrKzcycwFlpyL6Q1nDbvJZzA/132" width="30px"><span>leo</span> 👍（311） 💬（9）<div>跳表是我非常喜欢的数据结构，之前写过一篇文章，希望大家斧正（https:&#47;&#47;cloud.tencent.com&#47;developer&#47;article&#47;1353762）。另外，严格来讲，Redis的对象系统中的每种对象实际上都是基于使用场景选择多种底层数据结构实现的，比如ZSET就是基于【压缩列表】或者【跳跃表+字典】（这也跟之前排序中提到的Sort包实现的思想一样，基于数据规模选择合适的排序算法），体现了Redis对于性能极致的追求。</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（138） 💬（9）<div>如果每三个或者五个节点提取一个节点作为上级索引，那么对应的查询数据时间复杂度，应该也还是 O(logn)。

假设每 5 个节点提取，那么最高一层有 5 个节点，而跳表高度为 log5n，每层最多需要查找 5 个节点，即 O(mlogn) 中的 m = 5，最终，时间复杂度为 O(logn)。

空间复杂度也还是 O(logn)，虽然省去了一部分索引节点，但是似乎意义不大。

不知道在一般的生产系统，跳表的提取是按照多少个节点来实现？还是每个系统根据实际情况，都不一样。

看了跳表的 Java 实现，查找部分的代码真是漂亮，插入部分看了半天才看明白。</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg" width="30px"><span>董航</span> 👍（102） 💬（2）<div>redis有序集合是跳跃表实现的，直接这么说有失偏驳，他是复合数据结构，准确说应该是由一个双hashmap构成的字典和跳跃表实现的，不知道我说的有问题吗😊</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg" width="30px"><span>长期规划</span> 👍（20） 💬（3）<div>感觉跳表跟B+树有些像，父节点会出现在子节点中，而且B+的叶节点也是链接起来的。不同的是跳表每个结点只有一个子结点，而且除叶结点相连外，每层内都相连。从结构上来，很像树的变种，层内相连。老师，跳表是受树的启发两来的吗？</div>2019-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg" width="30px"><span>許敲敲</span> 👍（13） 💬（2）<div>我是机械行业打算换行的，不知道应该怎么把这些知识掌握的扎实一点，今天课里面的红黑树不了解.</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/4d/a2/9450ef89.jpg" width="30px"><span>刘涛涛</span> 👍（7） 💬（2）<div>github上的代码，我理解的p=p.forwars[i]代表第i层的下一结点，不知道对不对</div>2019-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d7/ab/15c9b94e.jpg" width="30px"><span>Pluto</span> 👍（7） 💬（1）<div>学到了，这个厉害了，不过实现还是没有看的太懂</div>2018-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e1/31/eb103bdc.jpg" width="30px"><span>kakasi</span> 👍（6） 💬（1）<div>感觉github上的实现好难理解，希望老师有时间能解释下。 
我有一个思路：定义两个数据结构，一个是普通的单链表Node，一个索引类Index。索引类中两个域：单链表节点Node， 下一个Index引用。用Index数组表示1 - level索引层。
这样数据结构里就不会出现数组了，不知这样的思路是否正确。</div>2018-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/63/53/b4590ccc.jpg" width="30px"><span>阿文</span> 👍（5） 💬（1）<div>老师，跳表的索引使用数组是不是就不用建立多级索引了？</div>2019-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/78/51/4790e13e.jpg" width="30px"><span>Smallfly</span> 👍（5） 💬（5）<div>老师想问下文章中出现的等比数列求和怎么算的，因为整数除法是取整的，所以公式好像不好使……，用数据代入老师的公式又是正确的，希望能指点一下。</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e9/88/941e488a.jpg" width="30px"><span>hugeo</span> 👍（4） 💬（1）<div>代码看了半天才明白，为自己捉急</div>2018-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2b/ef/a90b3ffc.jpg" width="30px"><span>kinghua</span> 👍（4） 💬（1）<div>我记得Redis是基于内存的，如果数据对象的信息量过大，会不会爆内存呢？还是说redis适合少量数据存储？还有一个问题，条表的使用率高么？</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/9f/1d/edb464cf.jpg" width="30px"><span>莫名</span> 👍（2） 💬（1）<div>github,java版，地址是多少。在哪呢，没有看到</div>2019-10-22</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132" width="30px"><span>null</span> 👍（2） 💬（1）<div>re: 老师，第 4 张图，64 结点的例子，第二级索引到第五级索纳塔都遍历了末结点，第一级索引是否也需要遍历末结点（63）？

re: 不需要的 我们找的是62 找到就可以结束了

可是第 4 张图的第一级索引，最后两个数应该是 61 和 63。
我们要找的是 62，应该也需要跟 63 这节点做比较吧？
因为需要确定是在 61 还是 63 节点下降到原始链表吧？
谢谢老师</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/29/b4/f95e8e9e.jpg" width="30px"><span>孑</span> 👍（1） 💬（1）<div>删除一个元素时，若该元素也出现在索引，也需删除，这个过程有点匆忙，到底还怎么怎么做</div>2018-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/11/11/52a78856.jpg" width="30px"><span>D→_→M</span> 👍（1） 💬（1）<div>老师，红黑树的相关知识在后面会讲到吗？</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e5/d6/37a1be71.jpg" width="30px"><span>凡</span> 👍（1） 💬（1）<div>这个数据结构是我第一次听哦！相当精妙的设计！不知道什么时候讲红黑树？很想知道红黑树是如何操作的！</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/4c/8f/83eefcff.jpg" width="30px"><span>厚积薄发</span> 👍（0） 💬（1）<div>看了老师的图解，知道跳表是怎么一回事，代码的实现勉强能看懂，但自己实现比较困难，我的理解是真正实现的时候并不是严格3个结点抽1个或者5个结点抽1个，而是50%的概率向上扩展，forward变量主要是从纵向考虑
</div>2019-10-14</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/xNerZNhJgdtmpicynBO7v2SHbCI8G9FK3iaIOmAZiaPREsQatKIFf4c02KEL8hObHAOEAEI9SHaIzqU169OEpTeGg/132" width="30px"><span>Geek_282c7f</span> 👍（0） 💬（1）<div>k-1级只需要遍历y和z之间的那个节点呀，y和z不需要重复遍历吧</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0c/e2/8a5e14b1.jpg" width="30px"><span>ujshenry</span> 👍（0） 💬（1）<div>GitHub上的代码，看了三天，才大致看懂了( Ĭ ^ Ĭ )</div>2019-10-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ed/43/7d91b07a.jpg" width="30px"><span>jaynnay</span> 👍（0） 💬（1）<div>我有个问题，假如一个数字在多层都出现了，可以不可以共用数据域，相当于只有一个节点，里面有一个数据对象，然后有n个指针，这样可以减少内存使用率，实际业务场景中，跳表节点里存储的数据可能很大
例如把图中的7，只存一个7，和三个指针域</div>2019-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f4/9b/d2ba5bb8.jpg" width="30px"><span>不爱学习Mr.Du</span> 👍（0） 💬（1）<div>老师，zset底层不用b+树，是不是因为插入删除效率太低</div>2019-09-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg" width="30px"><span>渔村蓝</span> 👍（0） 💬（2）<div>那具体多少个结点提取一个结点做索引才合理，要根据什么来判断呢？</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/93/6d/04c4dd7b.jpg" width="30px"><span>ffflag</span> 👍（0） 💬（1）<div>有一个问题，在找16的例子中，16在13,17中，我们是找到了17才能确定是在13-17中，但这里是单向列表，所以我们应该是又从1开始。这样看来的话，遍历的次数会增加吧。这里不是很明白，还请老师解答下，谢谢。</div>2019-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg" width="30px"><span>ileruza</span> 👍（0） 💬（1）<div>用php实现了一个跳表，提到小争哥的pull request去了，希望被pick一下啊：https:&#47;&#47;github.com&#47;SHQHDMR&#47;algo&#47;tree&#47;master&#47;php&#47;17_skiplist</div>2019-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/95/02/7e35d275.jpg" width="30px"><span>陈祥云</span> 👍（0） 💬（1）<div>我就是想问下，文章中的图是用什么工具绘制的。。。</div>2019-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/af/d8/0f85fc8f.jpg" width="30px"><span>肖邦的学徒</span> 👍（0） 💬（1）<div>插入的第一个元素的高度因该固定是最大值吧 ，代码看也是随机的啊 </div>2019-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f7/40/cba812dc.jpg" width="30px"><span>好人</span> 👍（0） 💬（1）<div>在算时间复杂度的时候？老师，为什么每层要遍历三个呢？为啥我感觉老师你画的图和我的理解是两个就够了？</div>2019-03-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/5f/5d/63010e32.jpg" width="30px"><span>有匪君子</span> 👍（0） 💬（1）<div>老师，我见过一种数据结构，两层，第一层用数组实现，存的全部是指针，第二层存的是new出来的数据结构空间。这样既可以随机存取，又可以内存不联续。（第一层内存连续，插入删除需要平移第一层，其实第一层占的内存与实际数据第二层占的内存相比微乎其微，所以效率也很高）。这种数据结构感觉是不是比跳表更好?它有没有专业的名字?</div>2019-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/67/27/202fde3b.jpg" width="30px"><span>宋蛋</span> 👍（0） 💬（1）<div>老师你好，有一个疑问，跳表的第一个元素是不是要建立所有层的索引，这样才能方便查找</div>2019-01-04</li><br/>
</ul>