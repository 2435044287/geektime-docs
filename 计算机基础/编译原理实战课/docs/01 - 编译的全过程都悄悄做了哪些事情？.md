你好，我是宫文学。

正如我在开篇词中所说的，这一季课程的设计，是要带你去考察实际编译器的代码，把你带到编译技术的第一现场，让你以最直观、最接地气的方式理解编译器是怎么做出来的。

但是，毕竟编译领域还是有很多基本概念的。对于编译原理基础不太扎实的同学来说，在跟随我出发探险之前，最好还是做一点准备工作，磨刀不误砍柴工嘛。所以，在正式开始本课程之前，我会先花8讲的时间，用通俗的语言，帮你把编译原理的知识体系梳理一遍。

当然，对于已经学过编译原理的同学来说，这几讲可以帮助你复习以前学过的知识，把相关的知识点从遥远的记忆里再调出来，重温一下，以便更好地进入状态。

今天这一讲，我首先带你从宏观上理解一下整个编译过程。后面几讲中，我再针对编译过程中的每个阶段做细化讲解。

好了，让我们开始吧。

**编译，其实就是把源代码变成目标代码的过程。**如果源代码编译后要在操作系统上运行，那目标代码就是汇编代码，我们再通过汇编和链接的过程形成可执行文件，然后通过加载器加载到操作系统里执行。如果编译后是在解释器里执行，那目标代码就可以不是汇编代码，而是一种解释器可以理解的中间形式的代码即可。

我举一个很简单的例子。这里有一段C语言的程序，我们一起来看看它的编译过程。
<div><strong>精选留言（23）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/fd/83/b432b125.jpg" width="30px"><span>鱼_XueTr</span> 👍（87） 💬（3）<div>自然语言与编程语言翻译基本都是经过相同的步骤流程：词法分词，语法分析，语义分析，token翻译，重组，优化结构，到最后的结果。
但是编程语言与自然语言相比：
1. 词汇量：编程语言的关键字等标识有限，自然语言的词汇量巨量无限
2. 结构化：编程语言是结构化的，自然语言是非结构化
3. 歧义性：编程语言都有确定的语义表达，自然语言不同语境不同的意思
4. 容错性：程序必须保证拼写绝对正确，自然语言更随意，也容许有错误表达
5. 易变性：编程语言的变化缓慢又小，自然语言的变化随着社会发展
6. 简略性：编程语言要求准确细致满足所有运行条件，自然语言简略干练形式不限</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ce/c6/958212b5.jpg" width="30px"><span>sugar</span> 👍（13） 💬（4）<div>回答课后思考题： 计算机语言编译和自然语言的翻译，做的事情本质上都是输入“遵循某种文法所说出的话”，输出“按照另外一种文法，把同样的话给表达出来”，这么件事～ 
如果说区别的话，处理的文法是不一样复杂的，自然语言是0型文法，而计算机语言的处理基本上都是在2型文法和3型文法的层面上，只有涉及意义处理才会做一些1型文法层面的事儿。
毕竟，计算机语言在设计时就要考虑到可以被计算机去执行，所以其必须考虑逻辑严谨；
而自然语言，中文、英文这些语言的历史包袱很重，而且语言最初设计的目的也不是为了给机器去跑，而是服务于广大人民群众呀～
按形式语言这门学科的定义，自然语言对应的是图灵机，所以对自然语言的处理已经是AI领域研究的范畴～
望老师指点～</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/c5/e5/fbacb7bf.jpg" width="30px"><span>😐饲养员小张😐</span> 👍（5） 💬（1）<div>老师可以在这些流程里面带上符号表么？我理解编译的整个过程都会贯穿符号表，但好像这里面一直没有提，之前的那个编译原理之美中也没有提及</div>2020-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/9a/ee/f996f864.jpg" width="30px"><span>吃鱼</span> 👍（3） 💬（1）<div>老师，引用消解和我之前在二进制学习里面看到的符号决议是一个概念吗？还有就是汇编的代码以后能否提供intel语法😅表示看这种不是很明了</div>2020-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fa/7f/de5b3c3f.jpg" width="30px"><span>Matrix</span> 👍（3） 💬（1）<div>计算机语言的编译和自然语言的翻译，从编译器的角度来看，二者在“前端”上是相同的，在“中端”和“后端”上是不同的。自然语言的翻译也需要经过词法分析：获取每个单词；语法分析：分析句子的语法结构；语义分析：通过单词的含义结合句型来获取句子的含义。机器语言的编译为了生成质量更高的目标代码，“中端”会对“前端”的输出进行一系列的优化。而自然语言的翻译会直接利用“前端”的输出，将源语言翻译为目标语言。</div>2020-06-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ZutpibYYahKIaIwuc84oBD30CZ7ZGLXHwZjm4zHG6ynaGxKqIzqrTGMQVr3CauAOcOic5MnzXnR0CYiaicP7bqkFicg/132" width="30px"><span>thomas1994</span> 👍（3） 💬（2）<div>赞，希望多点图，有图就直观多了</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/85/49/585c69c4.jpg" width="30px"><span>皮特尔</span> 👍（2） 💬（1）<div>问一个小白问题：不同编程语言的AST规则都一样吗？</div>2020-06-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（2） 💬（1）<div>希望老师 能详细 讲解一下 AST 有关的知识， AST 在日常工作中用的还是很多的

https:&#47;&#47;astexplorer.net&#47;  这个网站经常用，但是有些AST知识还不是很懂</div>2020-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f2/f6/7c1d9b72.jpg" width="30px"><span>Charles</span> 👍（2） 💬（1）<div>自然语言翻译的是人与人之间的语言，包含人的感性（动物性）语言和理性语言。计算机语言编译一般是将人类语言的理性部分翻译为计算机的语言（CPU指令），以驱动计算机为人类工作。计算机语言编译的抽象语法树可以很深，自然语言一般不会。计算机语言一般要求有明确的语意，而自然语言的上下文可能会非常庞大，同一段语言在不同场合和文化中有不同语意（比如“意思意思“这样的段子），有的甚至是by design的（比如双关）。自然语言以生命（大脑）为基础，从建立于动物（人类）的视觉，听觉，触觉等感官之上的感性语言发展至建立在逻辑之上的理性语言，并在此处与基于二进制运算的计算机语言汇合。</div>2020-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/e5/be/b8c46568.jpg" width="30px"><span>Nulk</span> 👍（1） 💬（1）<div>完整读下来花了将近30分钟，从整体大概理解了编译做的事。打算试着做一个最简单语法的js for循环的解析试下，熟悉整个过程</div>2020-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/c5/e5/fbacb7bf.jpg" width="30px"><span>😐饲养员小张😐</span> 👍（1） 💬（1）<div>https:&#47;&#47;swift.org&#47;swift-compiler&#47;
老师能不能更具象的讲讲 Swift 语言里面 Clang importer，SIL generation，SIL guaranteed transformations，SIL Optimizations 几个步骤的内容，再解释下他们的意义和作用
十分感谢</div>2020-06-07</li><br/><li><img src="" width="30px"><span>面向工资编程</span> 👍（1） 💬（1）<div>相同点都是从 a 到 b, 不同点在于翻译的上下文或者规则过于复杂，比如周星驰给百度的打的广告语“你不知道我知道你不知道”，从什么地方断句都可能是对的，但意思可能又不同。

优化那块比如删除没有使用到的变量，GO 语言里编辑器（ 比如 goland ）直接会用红色波浪线标出来报错，这是怎么实现的？

利用寄存器优化 PHP 7 里面也有类似的优化。

指令重排听马士兵讲 Java 里似乎会带来一些问题，忘了是什么问题了，不知道有没有同学知道。

最后，既然诗词传播效率高，为啥平时不用诗词沟通？是不是以前没纸，龟壳不够，只能尽量简短。</div>2020-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/fe/b4/6902ac00.jpg" width="30px"><span>王成</span> 👍（1） 💬（1）<div>我的理解
计算机(自然)语言编译是通过词法(单词)，文法(语法)，语义(句子含义)分析，最终生成计算机(大脑)直接理解的语言，或者生成中间代码IR等(自然语言中母语应该全是中间语言吧)</div>2020-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg" width="30px"><span>小晏子</span> 👍（1） 💬（1）<div>看了留言，总结的很全面了，网上找了找资料，发现还不少，其中知乎上有一篇文章解释的更详细，看有的同学已经贴出来了总结的部分，但是详细解释的部分没有放上去，那么我把链接放上来吧，：编程语言有与自然语言一样的语法么，可否比较一下编程与自然语言的异同？ - 人民邮电出版社的回答 - 知乎
https:&#47;&#47;www.zhihu.com&#47;question&#47;358491132&#47;answer&#47;1010503138</div>2020-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d5/12/ba7214ce.jpg" width="30px"><span>Zachary</span> 👍（0） 💬（1）<div>老师好, 生成目标代码这块有个问题一直很疑惑,：编译器如何选择合适的指令集. 像x86这种有很多扩展指令集, arm指令集也在不断演进, 而实际上大部分不使用动态库的可执行程序都可直接执行, 这里面的奥妙是什么?</div>2020-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/f8/4c/150551ed.jpg" width="30px"><span>我夏了夏天</span> 👍（0） 💬（1）<div>相同的地方：

- 都需要对源语言和目标语言非常熟悉
- 都需要经历词法分析、语法分析、语义分析等过程
- 都经过一个 **意译** 的过程，翻译后和原来的语句不通，但是信息具有等价性

不同的地方：

- 自然语言要比一门编程语言的复杂性要大得多
- 自然语言的翻译有更大的模糊性，或者说自然语言本身就不像编程语言那般精确，没有歧义
- 自然语言的词汇量和语法要复杂很多
- 编程语言的翻译可以经过很强的优化，优化过后的代码机器还可以正确执行，但是如果对自然语言进行这样的优化，可能会丢失很多有用的信息，变得不易读，不易理解</div>2020-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/a0/20/e92cd9e0.jpg" width="30px"><span>ESC____</span> 👍（0） 💬（1）<div>有针对Java JVM的疑问：

一般情况下称javac的过程为编译过程生成字节码（IR），在JVM上运行属于运行期，又解释器读取字节码并由累加器加载，然后运行期还有AOT，JIT等编译过程...

为什么在运行时是解释器执行，然后又有编译的说法呢？又好像是编程充满整个阶段（每个阶段干不同的事），有点不太好理解</div>2020-09-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg" width="30px"><span>神经旷野舞者</span> 👍（0） 💬（1）<div>自然语言可以不严格符合语法，编程语言必须严格符合。
自然语言翻译有时候需要意译，有时候需要直译，编程语言能意译的都要意译。
自然语言可以通过机器学习的方法增强翻译，编程语言好像不能通过训练样本实现翻译。
自然语言可以处理复杂的思想，编程语言只能处理有限的操作符。
</div>2020-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f0/d2/72230da6.jpg" width="30px"><span>GeekDaoScheme</span> 👍（0） 💬（1）<div>SIMD，RISC究竟选哪种指令集做编译器研发标的，应该是很重要的事，强大的编译器能反过来优化指令集体系结构乃至集成点路设计结构，但是在SIMD上优化相对困难，在RISC上优化相对简单，这也是不得不考虑的</div>2020-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg" width="30px"><span>浩仔是程序员</span> 👍（1） 💬（0）<div>老师功底太强了</div>2023-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg" width="30px"><span>Allan</span> 👍（0） 💬（0）<div>1、都是经过词法分析明白，每个单词意思
2、经过语法分析，明白谁和谁是一个什么意思。必须指定规范，无规矩不成方圆
3、经过语法分析以后，我们就有了一个语法树。
4、语法树经过语义分析好像我们自然语言的翻译就明白啥意思了。也就算是结束了。语义分析完毕以后，其实就是做了一个校验工作，之后把语法树交给下一步的组件。这个阶段也就是前端编译阶段完毕
5、本来可以之间翻译为汇编语言的，但是因为要适配不同的机器，这样很麻烦。所以就生成了以个中间代码，有了中间代码，解释性的语言，就直接可以使用了。同时中间代码还可以做很多优化的问题，避免在汇编语言中做起来复杂度。
6、拿到中间代码就可以之间翻译为汇编代码交给计算机，操作系统又直接解析为机器指令，就可以明白了。
不知道我的理解是不是正确？</div>2024-11-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>不错，计算机语言也是语言。</div>2022-01-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0a/83/f916f903.jpg" width="30px"><span>风</span> 👍（0） 💬（0）<div>有人说自然语言比编程语言复杂，我觉得不能这么说，就这几十年而言，
自然语言尽管变化很快，各种新词儿层出不穷，词的语义经常变化，表示能力在不断扩展，但仔细想想，这些变化都是词的变化，或者说，是词法规则和局部语义的变化，其语法结构几乎不变，一个20年前的人穿越到现代，相信他很快就能适应这些变化。
而编程语言正好相反，这些年，新的编程语言，新的编程范式，他们没给词法规则带来太多改变，但是却给语法和语义规则引入了很多东西，一个20年前的程序员穿越到现代，让他掌握这些变化，我感觉需要不少时间，哈哈。</div>2020-11-14</li><br/>
</ul>