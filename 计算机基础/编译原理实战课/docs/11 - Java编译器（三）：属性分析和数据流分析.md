你好，我是宫文学。

在上一讲，我们主要讨论了语义分析中的ENTER和PROCESS阶段。今天我们继续往下探索，看看ATTR和FLOW两个阶段。

**ATTR的字面意思是做属性计算。**在[第4讲](https://time.geekbang.org/column/article/245754)中，我已经讲过了属性计算的概念，你应该还记得什么是S属性，什么是I属性。那么，Java编译器会计算哪些属性，又会如何计算呢？

**FLOW的字面意思是做数据流分析。**通过[第7讲](https://time.geekbang.org/column/article/248770)，你已经初步了解了数据流分析的算法。但那个时候是把数据流分析用于编译期后端的优化算法，包括删除公共子表达式、变量传播、死代码删除等。而这里说的数据流分析，属于编译器前端的工作。那么，前端的数据流分析会做什么工作呢？

这些问题的答案，我今天都会为你一一揭晓。好了，我们进入正题，首先来看看ATTR阶段的工作：属性分析。

## ATTR：属性分析

现在，你可以打开**com.sun.tools.javac.comp.Attr类**的代码。在这个类的头注释里，你会发现原来ATTR做了四件事，分别在4个辅助类里实现：

1. Check：做类型检查。
2. Resolve：做名称的消解，也就是对于程序中出现的变量和方法，关联到其定义。
3. ConstFold：常量折叠，比如对于“2+3”这种在编译期就可以计算出结果的表达式，就直接计算出来。
4. Infer：用于泛型中的类型参数推导。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/17/8c/d4/5972b7cc.jpg" width="30px"><span>宫文学Richard</span> 👍（8） 💬（0）<div>上一讲思考题的参考解答：
针对示例程序，Java会形成5个词法作用域：
1.类作用域
2.方法作用域，这里主要放参数
3.方法体作用域
4.if语句块的作用域
5.else语句块的作用域
实际上，你把2和3合并也没有问题。但在编译过程中，2和3还是有区别的。作用域2在一开始就可以建立，参数对应的符号也可以一开始就加入到作用域2中去。而方法体中的作用域和本地变量，必须是边做引用消解，边建立作用域，边添加符号。把它们区分开，程序更容易处理。</div>2020-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>难</div>2022-01-11</li><br/>
</ul>