你好，我是宫文学。今天是Java编译器的最后一讲，我们来探讨编译过程最后的两个步骤：**去除语法糖和生成字节码**。

其实今天要讲的这两个编译步骤，总体上都是为生成字节码服务的。在这一阶段，编译器首先会把语法糖对应的AST，转换成更基础的语法对应的AST，然后基于AST和符号表，来生成字节码。

从AST和符号表，到变成字节码，这可是一个很大的转变，就像把源代码转化成AST一样。**那么，这个过程的实现思路是什么？有什么难点呢？**

今天这一讲，我们就一起来解决以上这些问题，在这个过程中，你对Java编译器的认识会变得更加完整。

好了，我们首先来看看去除语法糖这一处理步骤。

## 去除语法糖（Syntactic Sugar）

Java里面提供了很多的语法糖，比如泛型、Lambda、自动装箱、自动拆箱、foreach循环、变长参数、内部类、枚举类、断言（assert），等等。

你可以这么理解语法糖：它就是提高我们编程便利性的一些语法设计。既然是提高便利性，那就意味着语法糖能做到的事情，用基础语法也能做到，只不过基础语法可能更啰嗦一点儿而已。

不过，我们最终还是要把语法糖还原成基础语法结构。比如，foreach循环会被还原成更加基础的for循环。那么，问题来了，**在编译过程中，究竟是如何去除语法糖的？基础语法和语法糖又有什么区别呢？**
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/de/52/aa18facb.jpg" width="30px"><span>龚攀峰</span> 👍（3） 💬（1）<div>请问下继承关系信息在字节码里有体现吗？好像只是在头部信息有描述，运用期用的就是这个？</div>2020-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0a/83/f916f903.jpg" width="30px"><span>风</span> 👍（0） 💬（1）<div>怎么感觉去除语法糖应该在数据流分析的前面，能保证去糖以后的代码，都不需要数据流分析里做的优化吗？</div>2020-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/d9/8c/c9b35dac.jpg" width="30px"><span>南</span> 👍（0） 💬（0）<div>思考题个人的一些想法
java编译器的大部分功能应该是可以复用的，要做的事包括以下：
1. 是否需要在词法解析阶段定义新的关键词token 
2.在语法解析过程中定义新的数据结构，即符合语法规则的新的AST
3.对AST进行修改转换，尽量复用java已有的AST规则
4.无法复用的部分需要添加新的AST对应的字节码生成指令</div>2022-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>挺难</div>2022-01-12</li><br/>
</ul>