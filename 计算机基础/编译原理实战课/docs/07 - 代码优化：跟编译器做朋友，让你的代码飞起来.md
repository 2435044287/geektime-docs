你好，我是宫文学。

一门语言的性能高低，是它能否成功的关键。拿JavaScript来说，十多年来，它的性能多次得到成倍的提升，这也是前端技术栈如此丰富和强大的根本原因。

因此，编译器会无所不用其极地做优化，而优化工作在编译器的运行时间中，也占据了很大的比例。

不过，对编译技术的初学者来说，通常会搞不清楚编译器到底做了哪些优化，这些优化的实现思路又是怎样的。

所以今天这一讲，我就重点给你普及下编译器所做的优化工作，及其工作原理。在这个过程中，你还会弄明白很多似曾相识的术语，比如在前端必须了解的AST、终结符、非终结符等，在中后端必须熟悉的常数折叠、值编号、公共子表达式消除等。只有这样，你才算是入门了。

首先，我带你认识一些常见的代码优化方法。

## 常见的代码优化方法

对代码做优化的方法有很多。如果要把它们分一下类的话，可以按照下面两个维度：

- **第一个分类维度，是机器无关的优化与机器相关的优化。**机器无关的优化与硬件特征无关，比如把常数值在编译期计算出来（常数折叠）。而机器相关的优化则需要利用某硬件特有的特征，比如SIMD指令可以在一条指令里完成多个数据的计算。
- **第二个分类维度，是优化的范围。**本地优化是针对一个基本块中的代码，全局优化是针对整个函数（或过程），过程间优化则能够跨越多个函数（或过程）做优化。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg" width="30px"><span>qinsi</span> 👍（2） 💬（1）<div>有两个例子怀疑有误：

“x*9”等价于“x&lt;&lt;3+1”
-----------------
怀疑是&quot;(x&lt;&lt;3)+x&quot;


int j = 0;
for (int i = 0; i &lt; 100; i++) {
    j = 2*i;  &#47;&#47;2*i可以替换成j+2
}
return j;
-------------------------
怀疑是&quot;for (int i = 1; i &lt;= 100; i++) {&quot;</div>2020-06-16</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdzXiawss5gGiax48CJGAJpha4pJksPia7J7HsiatYwjBA9w1bkrDicXfQz1SthaG3w1KJ2ibOxpia5wfbQ/132" width="30px"><span>chris</span> 👍（2） 💬（1）<div>一直有两个关于各种优化算法与ssa的关系的困惑，不知老师能否解答：
1.现代编译器的优化流程，一般ssa从哪个阶段开始使用，到哪个阶段不再使用
2.在ssa的情况下，各种优化算法本身要发生什么变化，或者可能都变得不必要了</div>2020-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（0） 💬（1）<div>值编号和公共子表达式都可以减少重复计算，值编号侧重于变量的值的重复，公共子表达式侧重于表达式的重复；如果有两个包含a,b两个变量的表达式，a,b两个变量的值相同，并且除了这两个变量之外的其他部分都相同的话，则可以用值编号来优化，不能用公共子表达式来优化。
感觉可以看明白这些优化都做了什么，但是到实际使用的时候可能只能想起来一点点……</div>2020-06-15</li><br/>
</ul>