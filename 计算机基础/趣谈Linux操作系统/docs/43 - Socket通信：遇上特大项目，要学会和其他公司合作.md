上一篇预习文章说了这么多，现在我们终于可以来看一下，在应用层，我们应该如何使用socket的接口来进行通信。

如果你对socket相关的网络协议原理不是非常了解，建议你先去看一看上一篇的预习文章，再来看这一篇的内容，就会比较轻松。

按照前一篇文章说的分层机制，我们可以想到，socket接口大多数情况下操作的是传输层，更底层的协议不用它来操心，这就是分层的好处。

在传输层有两个主流的协议TCP和UDP，所以我们的socket程序设计也是主要操作这两个协议。这两个协议的区别是什么呢？通常的答案是下面这样的。

- TCP是面向连接的，UDP是面向无连接的。
- TCP提供可靠交付，无差错、不丢失、不重复、并且按序到达；UDP不提供可靠交付，不保证不丢失，不保证按顺序到达。
- TCP是面向字节流的，发送时发的是一个流，没头没尾；UDP是面向数据报的，一个一个地发送。
- TCP是可以提供流量控制和拥塞控制的，既防止对端被压垮，也防止网络被压垮。

这些答案没有问题，但是没有到达本质，也经常让人产生错觉。例如，下面这些问题，你看看你是否了解？

- 所谓的连接，容易让人误以为，使用TCP会使得两端之间的通路和使用UDP不一样，那我们会在沿途建立一条线表示这个连接吗？
- 我从中国访问美国网站，中间这么多环节，我怎么保证连接不断呢？
- 中间有个网络管理员拔了一根网线不就断了吗？我不能控制它，它也不会通知我，我一个个人电脑怎么能够保持连接呢？
- 还让我做流量控制和拥塞控制，我既管不了中间的链路，也管不了对端的服务器呀，我怎么能够做到？
- 按照网络分层，TCP和UDP都是基于IP协议的，IP都不能保证可靠，说丢就丢，TCP怎么能够保证呢？
- IP层都是一个包一个包地发送，TCP怎么就变成流了？
<div><strong>精选留言（22）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg" width="30px"><span>莫名</span> 👍（18） 💬（1）<div>『连接功夫在两端，而不在通路。通过两端的底层sock结构体维持状态信息。』老师这句话总结很到位结合socket系统调用的源码分析会更加容易理解。</div>2019-08-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132" width="30px"><span>程序水果宝</span> 👍（12） 💬（1）<div>为什么要两个socket？</div>2019-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/83/0c/b9e39db4.jpg" width="30px"><span>韩俊臣</span> 👍（4） 💬（1）<div>撑过进程间通信后，这里终于多少能看懂了</div>2020-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/50/4a/04fef27f.jpg" width="30px"><span>kdb_reboot</span> 👍（4） 💬（1）<div>老师厉害了, 依然在更新;
最近我有时间学习这个专栏了, 但是目前只跟到第十课, 把专栏作为引子,每天的阅读量还是很大的
然后, 我有个问题: 专栏更新完老师还会答疑吗?因为进度原因,可能还没学到最后面,专栏已经更新完了</div>2019-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4c/8f/a90b3969.jpg" width="30px"><span>oldman</span> 👍（3） 💬（1）<div>老师，有个问题，一直没有想明白，希望老师看到之后给解答一下，我知道服务端会维护一个连接的队列，比如这个队列里面是a,b,c,d,e,f,g这个样的多个连接，那当客户端有请求过来，比如说某一个请求过来，服务端是怎么区分他是a还是b或者c对应的连接呢？谢谢。</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/15/5c/aa3f8306.jpg" width="30px"><span>潇是潇洒的洒</span> 👍（0） 💬（1）<div>老师我有一个疑问，服务端和客户端都调用 socket，得到文件描述符。这里是服务端和客户端分别打开了不同的文件，然后各自写对方的文件，读自己的文件，还是说打开是同一个文件，读和写。</div>2019-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d1/15/7d47de48.jpg" width="30px"><span>咖啡猫口里的咖啡猫🐱</span> 👍（0） 💬（1）<div>其实我对tcp和udp的理解就是tcp协议栈由分段maxsegment(握手阶段的附加)，自己尽量来处理最大MTU问题，尽量防止ip分片，对端网络层组包，从而导致的tcp应用使用协议需要考虑处理分包，粘包。</div>2019-07-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg" width="30px"><span>安排</span> 👍（65） 💬（5）<div>老师，可不可以在答疑篇，增加一个select,poll,epoll的内核机制分析？</div>2019-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/df/ca/7c223fce.jpg" width="30px"><span>天使也有爱</span> 👍（2） 💬（0）<div>看了趣谈网络协议专栏，在结合这里看，感觉对网络通信知识有了更深的理解</div>2019-09-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/97/83/845b48e2.jpg" width="30px"><span>Allen_</span> 👍（1） 💬（0）<div>这一章解决了我一年都问不到的答案 谢谢老师</div>2021-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/d0/d0/a6c6069d.jpg" width="30px"><span>坚</span> 👍（1） 💬（0）<div>老师，UDP流程的图片中，客户端不需要bind吧？</div>2021-02-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/93/cc/dfe92ee1.jpg" width="30px"><span>宋桓公</span> 👍（1） 💬（1）<div>原来0000，是指监听一个服务器的全部网卡，soga</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/a2/55/1092ebb8.jpg" width="30px"><span>边城路远</span> 👍（0） 💬（0）<div>老师好，多个网卡可以bind多次吗</div>2022-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg" width="30px"><span>Sunny</span> 👍（0） 💬（0）<div>监听 socket 在服务端，已连接 socket 在客户端？💔</div>2021-09-12</li><br/><li><img src="" width="30px"><span>K菌无惨</span> 👍（0） 💬（0）<div>不错 讲的很清晰</div>2020-11-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/79/14/dc3e49d1.jpg" width="30px"><span>Geek_29c23f</span> 👍（0） 💬（2）<div>三次握手是在listern阶段还是accept阶段。listen不阻塞，执行完后直接在accept下阻塞等待三次握手。那三次握手应该在accept阶段才 啊</div>2020-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg" width="30px"><span>高志强</span> 👍（0） 💬（0）<div>用户态和内核态交互要通过socket操作tcp或udp协议，所以socket必然存在，可以这样理解么  老师</div>2019-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c5/71/f7c43b49.jpg" width="30px"><span>风向北吹</span> 👍（0） 💬（1）<div>在编写java socket发现一个问题，客户端通过socket发送数据到通过socket接收数据的过程中，必须调用socket. shutdownOutput()才可以收到，而服务端发送到接收或者接收到发送中间转换却不需要一个关流的操作，这是为什么呀</div>2019-10-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/b4/ee/c3ff8615.jpg" width="30px"><span>恒</span> 👍（0） 💬（0）<div>老师，UDP不需要listen和connect，那是不是UDP从头到尾就一个socket就够了，不像TCP区分监听socket和已连接socket？</div>2019-10-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg" width="30px"><span>靠人品去赢</span> 👍（0） 💬（1）<div>TCP面向连接，HTTP无状态总是搞混，问一下基于TCP的HTTP为什么不设置一个状态依赖的东西，要靠cookie和session来帮忙呢？
这个UDP上学的时候知道实时通话视频会用到，丢包丢多了是不是就是我们感觉“卡卡的”掉帧的情况。</div>2019-09-10</li><br/><li><img src="" width="30px"><span>Geek_92c4e9</span> 👍（0） 💬（0）<div>超级棒</div>2019-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/e0/0a/bf7ece06.jpg" width="30px"><span>bo</span> 👍（0） 💬（1）<div>老师好！udp中的connect背后做了什么工作？</div>2019-07-05</li><br/>
</ul>