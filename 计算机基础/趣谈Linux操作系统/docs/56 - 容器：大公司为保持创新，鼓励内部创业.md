上一章，我们讲了虚拟化的原理。从一台物理机虚拟化出很多的虚拟机这种方式，一定程度上实现了资源创建的灵活性。但是你同时会发现，虚拟化的方式还是非常复杂的。这有点儿像，你去成立子公司，虽然说公司小，但毕竟是一些独立的公司，麻雀虽小，五脏俱全，因而就像上一章我们看到的那样，CPU、内存、网络、硬盘全部需要虚拟化，一个都不能偷懒。

那有没有一种更加灵活的方式，既可以隔离出一部分资源，专门用于某个进程，又不需要费劲周折的虚拟化这么多的硬件呢？毕竟最终我只想跑一个程序，而不是要一整个Linux系统。这就像在一家大公司搞创新，如果每一个创新项目都要成立一家子公司的话，那简直太麻烦了。一般方式是在公司内部成立一个独立的组织，分配独立的资源和人力，先做一段时间的内部创业。如果真的做成功了，再成立子公司也不迟。

在Linux操作系统中，有一项新的技术，称为容器，它就可以做到这一点。

容器的英文叫Container，Container的另一个意思是“集装箱”。其实容器就像船上的不同的集装箱装着不同的货物，有一定的隔离，但是隔离性又没有那么好，仅仅做简单的封装。当然封装也带来了好处，一个是打包，二是标准。

在没有集装箱的时代，假设我们要将货物从A运到B，中间要经过三个码头、换三次船。那么每次都要将货物卸下船来，弄得乱七八糟，然后还要再搬上船重新摆好。因此在没有集装箱的时候，每次换船，船员们都要在岸上待几天才能干完活。
<div><strong>精选留言（19）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/9f/74/d6a89648.jpg" width="30px"><span>dwjwlxs</span> 👍（9） 💬（1）<div>这个课程卖99块真是太便宜了，应该卖999😂</div>2020-04-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（8） 💬（1）<div>Docker使用宿主机的内核，通过cgroup和namespaces加上UnionFS来实现，真是的妙啊。</div>2019-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg" width="30px"><span>饭粒</span> 👍（7） 💬（1）<div>终于来一节不是那么深且比较熟悉的。弹性伸缩上 k8s 更好，顺带安利下张磊老师的 k8s 专栏，也是很不错的一个专栏。示例 dockerfile 的几行 RUN 命令好像用 &amp;&amp; 或 ；弄成一句更好，这样镜像的 UFS 可以少几层。</div>2019-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6e/84/45a909a6.jpg" width="30px"><span>卡斯瓦德</span> 👍（1） 💬（1）<div>貌似docker还有device-mapper技术吧，关于物理存储分配，这里会细讲吗？</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3d/f8/b13674e6.jpg" width="30px"><span>LiYanbin</span> 👍（0） 💬（1）<div>docker run -d 中 官方文档的解释 是detach的short command， https:&#47;&#47;docs.docker.com&#47;engine&#47;reference&#47;run&#47;#detached--d</div>2020-05-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIGJBAIhEC7VpIcGiaxCjc5Wvp7aH5j9u3tl3GlWcJEM07BED0TI9uOlTnmm9RXMpF9jicwIXFm0gIg/132" width="30px"><span>Geek_a1s7m8</span> 👍（0） 💬（1）<div>大侠好，请问下 按照架构图，docker中没有OS这么一部分的么，但是为何任意的基础镜像中都有linux，还有就是docker是如何和系统共享内核的呀。</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/b4/65/71454201.jpg" width="30px"><span>小桌子</span> 👍（5） 💬（1）<div>我一直想不通有了容器化之后，是不是可以完全替代虚拟化，他们的场景好像重叠，并且docker更有优势啊，虚拟化还有未来吗？</div>2020-02-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg" width="30px"><span>罗辑思维</span> 👍（3） 💬（1）<div>注：以下在ubuntu 18.04.4 LTS docke-ce:19.03.6操作成功
	1.  docker pull tomcat #下载tomcat镜像
	2. docker run -d -p 20000:8080 tomcat #运行tomcat镜像， 「-d 」是以后台方式运行；「-p  20000:8080」:20000是宿主机端口号，可以自定义；8080是tomcat服务端口号，默认是8080
如果用浏览访问宿主机IP，出现网页404，那么执行如下步骤3
	3. docker exec -it 3cae48db60ee &#47;bin&#47;bash #3cae48db60ee是container id，用docker ps命令查询 
下面进到「tomcat container」操作
root@3cae48db60ee:&#47;usr&#47;local&#47;tomcat# rm -rf webapps
root@3cae48db60ee:&#47;usr&#47;local&#47;tomcat# mv webapps.dist webapps</div>2020-02-23</li><br/><li><img src="" width="30px"><span>GeekCoder</span> 👍（2） 💬（1）<div>docker中没有包含os部分，底层系统调用都是调用主机的，那比如我在linux最新版本制作了的一个镜像，用到了最新的系统调用A，而在旧版本LINUX中没有这个系统调用A，那么这个镜像可以在旧版本中可以运行吗？</div>2021-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/66/4835d92e.jpg" width="30px"><span>潘政宇</span> 👍（1） 💬（0）<div>集装箱，20世纪最伟大的发明之一！！！</div>2019-09-04</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/bmgpp5wc8GLmOdHNQccSgrunK0VdIicB6rpTHXCTF5xEkm2YvPHOX2DwNt2EqTzJ70JD41h0u5qW4R0yXRY1ZCg/132" width="30px"><span>Eazow</span> 👍（0） 💬（0）<div>docker镜像里如何用老的内核呢</div>2024-12-22</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>linux下打包的镜像是不是可以在windows下跑，前提是windows上安装了docker?</div>2023-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/88/f3/c7244a1c.jpg" width="30px"><span>画船听雨眠</span> 👍（0） 💬（0）<div>-d=false: Detached mode: Run container in the background, print new container id
-d是Detached的意思吧</div>2022-11-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0d/e9/2f02a383.jpg" width="30px"><span>冬瓜蔡</span> 👍（0） 💬（0）<div>文末这张图很赞</div>2022-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg" width="30px"><span>小鳄鱼</span> 👍（0） 💬（1）<div>还有一个非常大的好处：统一应用的环境！避免运维手动操作导致某些中间件&#47;环境配置不一致！</div>2022-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9b/88/34c171f1.jpg" width="30px"><span>herongwei</span> 👍（0） 💬（0）<div>老师讲的课非常认真，下了班回到家连看三节不知不觉已经深夜</div>2022-03-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/42/13/860e176a.jpg" width="30px"><span>外国肉夹馍</span> 👍（0） 💬（0）<div>思考题：
先pull一个tomcat镜像，这里选用8.5的：
docker pull tomcat:8.5
pull下来后，运行自己的war包有两种方式：
1.基于tomcat:8.5的镜像，写一个DockerFile，把war包拷贝进去，buildy一个专属镜像，运行
2.直接通过命令运行
我用的是第二种：
docker run -v &#47;xxx&#47;xxx.war:&#47;usr&#47;local&#47;tomcat&#47;webapps&#47;xxx.war -it -p 9090:8080 tomcat:8.5</div>2020-07-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/42/13/860e176a.jpg" width="30px"><span>外国肉夹馍</span> 👍（0） 💬（0）<div>老师我想问下如果是macos上跑docker，比如运行一个ubuntu的镜像，还是共享宿主机内核吗？感觉应该不是吧？是否也是用到了类似KVM的虚拟化技术？</div>2020-07-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/39/ba/631a128a.jpg" width="30px"><span>是Coding少女啊</span> 👍（0） 💬（1）<div>“当程序员根据产品设计开发完毕之后，可以将代码连同运行环境打包成一个容器镜像。接下来，无论是在开发环境、测试环境，还是生产环境运行代码，都可以使用相同的镜像。”

我想问下，如果测试过程中发现问题，是需要开发工程师重新修改代码打包一个新的镜像吗？镜像可以只包括运行的环境而不包括测试的脚本吗，就是docker build好镜像，然后docker run -it进入到容器中，运行测试代码。这个时候如果代码有问题，是可以直接修改代码，不需要再重新打包一个镜像对吗？请老师指教～</div>2020-03-29</li><br/>
</ul>