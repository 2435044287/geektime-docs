你好，我是LMOS。

上节课，我们学习了信号和管道这两种通信方法，这节课我们接着看看消息队列和共享内存这两种通信方式。在大型商业系统中，通常会把功能拆分成几大模块，模块以应用形式存在，就需要消息队列和内存共享来使模块之间进行通信和协作，这就是利用通信机制将应用解耦。

这节课的配套代码，你可以从[这里](https://gitee.com/lmos/Geek-time-computer-foundation/tree/master/lesson29~30)下载。话不多说，我们正式开讲吧！

### 消息队列

**消息队列**是Linux提供的一种进程间通信方法，**它能让进程之间互相发送消息**。这些消息的形式由进程自己决定，可以是文本，也可以是二进制的，格式可以随意，只要另一个进程认识就行。

你可以把消息想象成一个数据记录，并且这个记录具有特定的格式以及特定的顺序。消息队列实质就是一个“收纳”消息的链表，消息会依次挂入这个叫做队列的链表中，一个链表节点就对应着一个消息。

接下来的问题就是，谁有权操作这个消息队列？答案是对这个消息队列有写权限的进程可以向其中插入新的消息；对消息队列有读权限的进程，则可以从其中读出消息。逻辑结构如下图所示：

![图片](https://static001.geekbang.org/resource/image/a8/6c/a8817f5ce2b227894a784fb97c546b6c.jpg?wh=1920x782)

Linux采用消息队列来实现消息传递，新的消息总是放在队列的末尾，但接收的时候通常是从队列头开始，也可以从中间抽取。发送消息的方式可以是同步的，也可以是异步的。在同步方式的情况下，发送方在消息队列为满时，要进入等待状态。接收方在消息队列为空时，也要进入等待状态；而异步方式中，发送方和接收方都不必等待，而是直接返回。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（2）<div>请教老师一个问题：
Q1：消息类型和键的数值有什么含义？
文中消息队列的代码中，“消息类型#define MSG_TYPE (041375)；消息队列键#define MSG_KEY (752364)”，这两个数字有特别含义吗？ 还是随机定义的？</div>2022-10-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/d4/4b/ec621442.jpg" width="30px"><span>范廷东</span> 👍（0） 💬（0）<div>请问老师，像rabbitMQ这类软件实现的消息队列，算是哪一种类型呢？ 微服务架构中的消息总线服务算是哪一种机制呢？</div>2023-10-05</li><br/>
</ul>