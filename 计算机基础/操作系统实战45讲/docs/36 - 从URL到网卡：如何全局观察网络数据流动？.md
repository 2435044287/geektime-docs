你好，我是 LMOS。

从这节课起，我们就要开始学习网络篇的内容了。网络是一个极其宏大的知识结构，我会通过五节课带你了解计算机网络的关键内容。

具体我们是这样安排的。作为网络篇的开始，今天这节课我会从一个面试中高频出现的问题切入，带你梳理从输入URL到网卡的网络数据流动过程中都发生了什么事。如果你真正理解了这个过程，相信你对整个网络架构的认知也会有质的飞跃。

网络篇的第二节课，我会带你分析网络数据包在内核中如何流转；第三节课，我们一起探讨互联网架构演进过程，并动手做一次协议栈移植；最后两节课，我还是照例带你看看Linux，让你理解套接字在Linux内核中怎样实现。

## 从一道经典面试题说起

下面我们一起来看看一个问题，估计你多多少少会觉得熟悉。

> 输入URL，从一个请求到响应都发生了什么事？

没错，这是一道非常经典的面试题，你在网上随便一搜，也会找到各种各样的资料解答这道题。

不过啊，那些答案都有一些笼统，今天我会尽量详细地为你梳理一下这个过程。跟着我学完这节课，你就能明白，为什么面试官对这道题青睐有加了。

这里我先给你概括一下全过程，让你有个整体印象。

1.常规的网络交互过程是从客户端发起网络请求，用户态的应用程序（浏览器）会生成HTTP请求报文、并通过DNS协议查找到对应的远端IP地址。  
2.在套接字生成之后进入内核态，浏览器会委托操作系统内核协议栈中的上半部分，也就是TCP/UDP协议发起连接请求。  
3.然后经由协议栈下半部分的IP协议进行封装，使数据包具有远程定位能力。  
4.经过MAC层处理，找到接收方的目标MAC地址。  
5.最终数据包在经过网卡转化成电信号经过交换机、路由器发送到服务端，服务端经过处理拿到数据，再通过各种网络协议把数据响应给客户端。  
6.客户端拿到数据进行渲染。  
7.客户端和服务端之间反复交换数据，客户端的页面数据就会发生变化。
<div><strong>精选留言（9）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg" width="30px"><span>pedro</span> 👍（9） 💬（2）<div>内核接管应用层数据后依次将其打包为tcp包(传输层)，帧(数据链路层)，并数据其从内核拷贝到网卡，后续由网卡负责数据的发送；反过来内核收到网卡数据后层层解析，并将数据包交给用户态应用程序。</div>2021-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2d/06/30/c26ea06a.jpg" width="30px"><span>艾恩凝</span> 👍（2） 💬（1）<div>天呐，这文章真的超赞，这是我见过讲的最通俗易懂的关于“ 输入 URL，从一个请求到响应都发生了什么事？”计算机网络是个人来说最欠缺的，因为不感兴趣，这篇直接点燃了内心兴趣之火，听说星星之火可以燎原，哈哈哈</div>2022-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg" width="30px"><span>青玉白露</span> 👍（2） 💬（1）<div>在内核中是分层级处理的，一层包一层。</div>2021-07-30</li><br/><li><img src="" width="30px"><span>springXu</span> 👍（1） 💬（1）<div>这道思考题是下节课的内容么？ </div>2021-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/81/2127e215.jpg" width="30px"><span>梦醒十分</span> 👍（0） 💬（1）<div>精彩的文章。</div>2023-02-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/df/74/134f3a7a.jpg" width="30px"><span>memora</span> 👍（0） 💬（1）<div>小白发问，第一张图ISO-OSI中最右边的箭头是不是先指向SO物理介质？</div>2021-08-04</li><br/><li><img src="" width="30px"><span>Geek_a10391</span> 👍（0） 💬（0）<div>网卡检验Mac地址，还是操作系统的驱动做这个事的？</div>2024-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/85/49/585c69c4.jpg" width="30px"><span>皮特尔</span> 👍（0） 💬（0）<div>有个问题：
MAC 地址是唯一且无重复的，由国际标准化组织分配，用来确保网络中的每个网卡是唯一的。但是 Windows 系统可以修改网卡的 MAC 地址，这个是怎么回事呢？
</div>2024-04-19</li><br/><li><img src="" width="30px"><span>Geek_b3ad17</span> 👍（0） 💬（0）<div>讲的非常好</div>2024-03-09</li><br/>
</ul>