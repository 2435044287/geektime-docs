你好，我是微扰君。

上一讲我们学习了在分布式系统中，生成全局唯一ID的两种方式，既可以通过引入独立组件远程调用申请ID，也可以通过约定的方式让各个节点独立生成唯一ID。

那对于有多个节点的服务，其他服务或者客户端在访问这个服务的时候，具体应该访问哪一个节点呢？

## 负载均衡问题

大部分情况下，我们都希望集群在分配流量时，能够比较均衡或者按照某种预期的权重比例，这样每个机器都可以得到比较充分的使用，也不容易出现单点服务过载的情况，能够发挥集群的最大价值。

如何分配流量的问题，也通常被称为负载均衡问题，根据不同的业务需要，解决的方式也很多。

比如最直接的，我们可以引入一个中间的负载均衡层，集中记录收到的请求序号；然后按照Round-Robin的轮询方式，轮流将外界的请求转发给内部的服务集群，或者直接用随机转发的方式也可以。当然你也可以引入权重，让这两种算法对流量的分配不是均匀的，而是按照一定比重分配在不同的机器上。这两种算法也被称为**加权轮询和加权随机**。

其实，不止可以通过引入中间层实现，如果整个系统完全可信、可控，你也可以让客户端自己按照随机或轮询的策略，直接调用需要负载均衡的服务，同样可以达到负载均衡的效果。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（2） 💬（1）<div>请教老师两个问题：
Q1：长连接网关的问题
A 长连接网关有开源框架吗？
B 长连接是双向还是单向的？
   比如客户端连接到长连接网关，网关到客户端一直有数据流量，需要一直处于连接状态，
   但是，客户端到网关数据量小，需要一直处于连接状态吗？
   （不过好像连接不可能是一个方向通而一个方向不通啊，哈）
Q2：节点2移除后为什么需要移动4和3？
   在“节点数量变化问题”部分，节点2下线后，为什么要移动4和3？
Q3：实现部分，例子是练习LRU吗？
      “能很好地帮助你练习 LRU”，这句话是说此例子可以用来练习LRU。
       应该是练习一致性Hash吧。</div>2022-02-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（0） 💬（0）<div>没有讲扩容或者缩容时，本来请求路由的问题</div>2022-10-19</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（0） 💬（0）<div>讲的真好</div>2022-10-19</li><br/>
</ul>