你好，我是微扰君。

今天我们来聊一个经典问题“分布式事务”，以及它的常见解决方案“两阶段提交”。

关于事务，我们之前在介绍日志型文件系统的时候就已经一起学习过了（戳[这里](https://time.geekbang.org/column/article/478396)复习），主要特点就是需要保证在应用程序中，一系列连续操作要么全部成功执行，要么一个都不能执行，这个特点我们一般也称为原子性。

在单体应用中，通常用来保证事务特性的主要手段就是引入日志，比如MySQL中的redo log就是这样一种通过日志保证数据完整性的机制。

但是随着互联网不断发展，我们的应用规模也在稳固提升，单机服务已经没有办法满足需要，分布式系统自然而然也就登上了历史舞台。**在分布式系统下，如何保证应用的事务性，就是所谓的分布式事务问题**，也是我们今天要研究的内容。

## 分布式事务问题

在分布式应用场景中，分布式事务问题是不可回避的，在目前流行的微服务场景下更是如此。

我来举一个工作遇到的实际例子。在我参与开发的一款云产品的建设中，我们引入了开源的Keycloak组件，作为用户鉴权和账号创建的认证中心服务，但同时，因为业务也有许多和用户相关的字段需要在创建用户时生成，这一部分数据我们最终选择在数据库中自行维护。

因此，创建用户的步骤就分成了两个部分，首先要去Keycloak中创建账号，然后再在我们的数据库中存储一些额外的用户信息数据。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/24/eb/2e/90fea784.jpg" width="30px"><span>柒</span> 👍（3） 💬（3）<div>有个问题，老师说：
C阶段失败的话：有全局信息的协调者，如果收到了任意参与者发来的提交失败或者等待超时，都应该像第一个阶段一样，立刻终止事务，并向所有参与者发起回滚的请求。
如果收到失败或者超时前，有部分参与者已经commit了，这个怎么回滚？感觉没办法吧。 </div>2022-08-30</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epNoWjGv759Dn3v4kkRhUGr2wN48VwMdIDrH6q1XYHqmia21iaRqekQNslUefPyfsylnSeLnEuhBwdw/132" width="30px"><span>shupian416</span> 👍（0） 💬（0）<div>在提交阶段有部分参与者已committed了，部分参与者失败了，后续是如何处理的？没有表述清楚！</div>2023-09-16</li><br/>
</ul>