你好，我是黄申。今天我们来聊聊矩阵操作和推荐算法的关系。

我这里说的推荐，是指为用户提供可靠的建议、并协助用户挑选物品的一种技术。一个好的推荐系统需要建立在海量数据挖掘基础之上，并根据用户所处的情景和兴趣特点，向用户推荐可能感兴趣的信息和商品。

协同过滤（Collaborative Filtering）是经典的推荐算法之一，它充分利用了用户和物品之间已知的关系，为用户提供新的推荐内容。我会从这种二元关系出发，给你讲讲如何使用矩阵计算，来实现协同过滤推荐算法。

## 用矩阵实现推荐系统的核心思想

矩阵中的二维关系，除了可以表达图的邻接关系，还可以表达推荐系统中用户和物品的关系。如果你不懂推荐系统，不用急，我这里先给你简单讲讲它的核心思想。

简单地理解就是，推荐系统会根据用户所处的场景和个人喜好，推荐他们可能感兴趣的信息和商品。比如，你在阅读一部电影的影评时，系统给你推荐了其他“你可能也感兴趣的电影”。可以看出来，推荐系统中至少有2个重要的角色：用户和物品。用户是系统的使用者，物品就是将要被推荐的候选对象。

例如，亚马逊网站的顾客就是用户，网站所销售的商品就是物品。需要注意的是，除了用户角色都是现实中的自然人，某些场景下被推荐的物品可能也是现实中的自然人。例如，一个招聘网站会给企业雇主推荐合适的人才，这时候应聘者承担的是物品角色。
<div><strong>精选留言（14）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" width="30px"><span>拉欧</span> 👍（7） 💬（1）<div>基于物品的相似度计算时，物品喜好度矩阵是用户喜好度矩阵的转置，是这样吗？
是选择基于用户的协同过滤还是基于物品的协同过滤，要考虑用户和物品哪一个维度数量比较少，相乘后产生的矩阵小，可以这样理解么？</div>2019-03-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/52/1323a451.jpg" width="30px"><span>不熬夜爱益力多的小松</span> 👍（1） 💬（1）<div>这一章有较多东西不理解，其中基于用户的过滤中 X.X`得出的矩阵Y的意义是什么，是仅为为了余弦公式的分子吗？然后得出的Y如何使用，文章都是没有说到本质，很难理解</div>2020-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/5c/02/e7af1750.jpg" width="30px"><span>teddytyy</span> 👍（1） 💬（2）<div>基于相似物品的推荐中，物品矩阵中存放的数据代表什么？值又是什么呢？</div>2019-12-20</li><br/><li><img src="" width="30px"><span>Paul Shan</span> 👍（1） 💬（1）<div>先用夹角余弦计算两两用户之间的相似度，用这个相似度再重新计算用户i对某个物体j的喜好程度。即用所有用户对物品j的喜欢程度按照和用户i的相似度加权计算。今天的内容有点像马尔可夫过程，用户的喜好在原来的图中按照用户之间的相似度扩散了。</div>2019-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/5b/6f/113e24e6.jpg" width="30px"><span>阿信</span> 👍（1） 💬（1）<div>刚又翻了下《数学之美》，基于物品相似度推荐，感觉可以借用信息量中“互信息”这个概念来描述。
“互信息”描述两个随机事件“相关性”的量化度量。这里用来描述物品的相关性。
如果物品A、B，被同一个用户购买的次数，在总购买次数中占比较大，则认为二者相关性高，可以作为彼此的候选推荐商品。

基于用户相似度推荐，计算用户对某个商品的喜好度，实践时选取哪些考量特征会是一个难点。如购买次数，针对快消品(如食品、饮料等)，考量价值较大；但如果是家电之类的，可能需要考虑报障维修次数、回访调查满意度等信息。

如果是百货类的电商平台，基于物的相似度推荐，通用性是否更好？</div>2019-07-20</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/2Zh1NJFhKQPUXXQFt5MicFQ1jWqP13jSNP95NSjhLm5dCjzyJibJ7DsicFTW2yO9wicsOVibuwx2ibzZ88uyIvcj2a8Q/132" width="30px"><span>Geek_7bc035</span> 👍（0） 💬（1）<div>想问下，哪个pi，j公式里的m是啥意思，总人数嘛。</div>2022-02-10</li><br/><li><img src="" width="30px"><span>常振华</span> 👍（0） 💬（1）<div>还是得复习一下线性代数才行，不然公式不好懂，原理倒是容易懂</div>2020-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/98/2c/cff47039.jpg" width="30px"><span>米饭</span> 👍（0） 💬（2）<div>确实越来越难了，其中使用矩阵求解公式上看了很多遍，尤其是Y 来计算 US这部分，由于老师在图上的公式有笔误，所以看了很多遍才理解，希望老师尽快修改下图中的公式
正确的公式为: us(1, 2)=Σ x(1, j) * x(2, j) &#47; ( sqrt( Σ pow(x(1, j), 2)) * sqrt(Σ pow(x(2, j), 2)) )</div>2020-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/08/79/770c7d85.jpg" width="30px"><span>弋轰</span> 👍（0） 💬（2）<div>使用 Y 来计算 US 的配图是不是有误？分子分母的其中一个 x_{1,j} 应为 x_{2,j} ？</div>2020-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg" width="30px"><span>qinggeouye</span> 👍（6） 💬（1）<div>基于物品的协同过滤矩阵操作：

Y = X&#39;·X

物品相似度：
IS = [ [1.49655792,  0.04042765,  0.             ],  
        [0.04042765,  1.22789784,  1.10442966],
        [0.        ,        1.10442966,  1.49655792] ]

用户对物品对喜好度 归一化矩阵：
P = [[0.26833698,  0.38846963,  0.34319338],
       [0.97369679,  0.0263032 ,   0.        ],
       [0.00886581,  0.47294886,  0.51818533],
       [0.              ,  0.42461935,  0.57538065]]

应该是这样。markdown 表示 https:&#47;&#47;github.com&#47;qinggeouye&#47;GeekTime&#47;tree&#47;master&#47;MathematicProgrammer&#47;38_Matrix2CollaborativeFiltering</div>2019-03-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/42/df/a034455d.jpg" width="30px"><span>罗耀龙@坐忘</span> 👍（2） 💬（1）<div>茶艺师学编程

思考题：当基于物品的过滤，协同过滤推荐之中有怎么样的矩阵操作?

因为是基于物品，对于原喜好度矩阵X来说，就是里面的列向量。在求Y，那么就应该是X′X，算出对应的is矩阵。

同样的，在求P矩阵中，也应该用X′。</div>2020-05-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0b/04/de5370a7.jpg" width="30px"><span>aidway</span> 👍（1） 💬（0）<div>计算的物品相似度矩阵为：
array([[1.   , 0.03 , 0.   ],
       [0.03 , 1.   , 0.848],
       [0.   , 0.848, 1.   ]])

用户-物品矩阵为：
array([[0.113, 0.108, 0.092],
       [0.786, 0.013, 0.   ],
       [0.026, 0.803, 0.804],
       [0.   , 0.19 , 0.227]])
请问是这个吗？</div>2022-11-08</li><br/><li><img src="" width="30px"><span>013923</span> 👍（0） 💬（0）<div>学习完一节，谢谢！</div>2022-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg" width="30px"><span>建强</span> 👍（0） 💬（0）<div>基于物品的协同过滤矩阵操作步骤：

第一步：计算任意两个物品间的相似度：
这一步中，利用喜好度矩阵X计算两个物品的夹角余弦值，首先把X转置后得到X&#39;, 把X&#39;和X进行点乘运算，假设运算后的矩阵为Y，则Y = X&#39;.X，再用Y来计算IS，IS[j1,j2] = Y[j1, j2] &#47; sqrt(Y[j1, j1] * Y[j2, j2])

第二步：计算推荐矩阵P
这一步中，首先利用物品的相似矩阵is和喜好度矩阵X，计算出推荐公式中的分子矩阵，假设为ISP，则ISP = X.IS，然后对IS中的每一列求和得到推荐公式中的分母矩阵，假设为ISR，则ISR[i,j] = sum(IS[:,j])，最后计算推荐矩阵P = ISP &#47; ISR。</div>2020-10-04</li><br/>
</ul>