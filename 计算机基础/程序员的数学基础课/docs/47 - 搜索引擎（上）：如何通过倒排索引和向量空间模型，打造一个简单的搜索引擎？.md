你好，我是黄申。

上一节，我们充分利用了哈希表时间复杂度低的特点，设计了一个简单的缓存系统。在实际项目中，哈希表或者类似的哈希数据结构，有着更为广泛的运用。比如，搜索引擎中的倒排索引，也是基于哈希表结构来设计的。这种倒排索引可以大大提升数据对象的检索效率。

除了搜索的效率，搜索引擎另一个需要考虑的问题是相关性，也就是说，我们需要保证检索出来的信息是满足用户需求的。最简单的基于倒排索引的实现，属于一种布尔排序模型，它只考虑了单词是不是出现在文档之中，如果出现了就返回相应的文档，否则就不返回，对应于布尔模型中的真假值。在这种实现中，只要出现了相关搜索词的文档都会被检索出来，因此相关性比较差。对于这点，我们可以利用向量空间模型，来衡量文档和用户查询之间的相似程度，确保两者是相关的。不过，向量空间模型需要涉及两两之间的比较，时间复杂度比较高。

考虑到上述两点，今天，我们就以文档检索为例，参照倒排索引加向量空间模型的设计思路，设计一个简单的搜索引擎。

## 搜索引擎的设计框架

之前在讲解向量空间模型的时候，我们介绍了信息检索的基础知识，而我们平时经常使用的搜索引擎，就是一种典型的信息检索系统。在讲解如何结合倒排索引和向量空间模型之前，我们先来看，常见的文本搜索引擎都由哪些模块组成。
<div><strong>精选留言（6）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg" width="30px"><span>建强</span> 👍（2） 💬（1）<div>思考题：
想用Python语言来实现一个简单的搜索引擎，现在暂时还没时间和精力去做，不过有了老师给出的框架和算法，实现起来应该不难
另外有两个细节问题再请教一下：
(1)计算文档向量和查询向量的夹角余弦时，由于查询向量的关键词较少，对于出现在文档中的关键词，查询向量元素值取1，否则就取0，这样是否可行。
(2)分母部分，是把文档向量的L2范数在离线处理时先计算好，作为一个常量，然后在计算和查询向量的夹角时，只需要计算查询向量的L2范数然后再乘上事先计算好的文档向量的L2范数，是这样处理吗 </div>2020-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg" width="30px"><span>qinggeouye</span> 👍（2） 💬（1）<div>23节中基于自然语言预处理方法(分词&#47;取词干和归一化&#47;停用词&#47;同义词和扩展词等)、35节把文档和查询转换为向量形式，为了减小计算查询向量和所有文档向量间的夹角余弦的时间复杂度，利用17节的倒排索引可先过滤掉与查询关键词无关的文档。</div>2019-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" width="30px"><span>拉欧</span> 👍（2） 💬（1）<div>“如果文档中词条的平均数量是 n，查询中词条的平均数量是 m，那么计算某个查询和某个文档之间的夹角余弦，时间复杂度是 O(n×m)。”
这里两个向量的维度不同，怎么计算余弦夹角?</div>2019-04-04</li><br/><li><img src="" width="30px"><span>013923</span> 👍（1） 💬（1）<div>学习了搜索引擎上</div>2022-09-15</li><br/><li><img src="" width="30px"><span>Paul Shan</span> 👍（3） 💬（0）<div>倒排索引是通过词找出现这个词的文档集合。有了倒排索引，我们就可以快速找出包含用户输入的关键词序列的所有文档，这里用到了归并排序的思想加速求出包含所有关键字的文档集合。有了结果集合，下面找到结果集合的内部顺序，用的是向量夹角余弦从大到小排序。这里的两个向量分别是输入关键词序列对应的向量和文档对应的向量，每个分量是每个词的tf-idf值。向量夹角余弦可以看作两个单位向量的乘积，文档单位向量可以离线计算好，查询关键词向量维度少，容易计算。这样就能通过倒排索引快速找出相关程度从大到小的文档集合。
</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（3） 💬（0）<div>        其实觉得搜索这块真的没有答案：自己把数据库索引的性能几乎用到了极限。
         搜索引擎觉得也如此：追求的是有效率，然后调整排序，适当调整各种顺序。。。
        觉得这是一条没有终点的路：老师的课程中推荐的计算机的原理的书大多买了，看了多遍还是。。。</div>2019-07-16</li><br/>
</ul>