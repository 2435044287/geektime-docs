你好，我是黄申。

上一节，我详细解释了向量空间和向量空间模型。你也许觉得理论上的内容还是过于抽象，不太好理解。别急，今天我就来具体演示一下如何使用这个模型。由于学者们最初是在信息检索领域使用这个模型的，所以我会结合文本信息检索领域的知识，阐述如何在这个领域使用向量空间模型。

## 什么是信息检索？

首先，我们先来看一下，什么是信息检索，以及最基本的排序模型有哪些。这样，你就能理解为什么我们需要使用向量空间模型了。

现在的信息检索技术已经相当成熟，并影响我们日常生活的方方面面。搜索引擎就是这项技术的最佳体现，人们输入一个查询，然后系统就能返回相关的信息。

笼统地说，**信息检索就是让计算机根据用户信息需求，从大规模、非结构化的数据中，找出相关的资料。**这里的“非结构化”其实是针对经典的关系型数据库（Relation Database）而言的，比如DB2、Oracle DB、MySQL等等。

数据库里的记录都有严格的字段定义（Schema），是“结构化”数据的典型代表。相反，“非结构化”没有这种严格的定义，互联网世界里所存储的海量文本就是“非结构化“数据的典型代表。因为这些文章如果没有经过我们的分析，对于其描述的主题、写作日期、作者等信息，我们是一无所知的。自然，我们也就无法将其中的内容和已经定义好的数据库字段进行匹配，所以这也是数据库在处理非结构化数据时非常乏力的原因。这时候就需要采用信息检索的技术来帮助我们。
<div><strong>精选留言（15）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/6f/3d4f7e31.jpg" width="30px"><span>娄江国</span> 👍（24） 💬（2）<div>新增文档后，N肯定会发生变化，有很多的 df也会发生变化。
但当数据量大到一定程度时，少量的新增文档而导致的idf变化不大。实际处理时，应该不会每新增一个文档，就重新构建原文档的向量，而是在一定条件下触发原文档向量的构建，如：多长时间重新构建一次；或新增了多少文档重新构建一次；或手工触发重新构建。</div>2019-03-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg" width="30px"><span>qinggeouye</span> 👍（7） 💬（1）<div>整个文档集合的词典的单词和词组的个数假设为 M ，文档数量假设为 N ，每个文档向量的维度是一致的吧，那么文档向量的维度应该也是 M 吧；所有文档向量就可以构成一个 M*N 的矩阵；

这样看来，假设文档集合新增了文档之后，要看从新增文档中提取出来的单词或词组，是否已经在包含在已有的词典当中，如果不是，那么就需要将这些单词或词组添加进词典，原有的文档向量就可能需要进行调整。

不知是否应该这样理解？</div>2019-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg" width="30px"><span>李二木</span> 👍（6） 💬（2）<div>这就是elasticesearch 查询原理吧</div>2019-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/29/c3/791d0f5e.jpg" width="30px"><span>渣渣辉</span> 👍（3） 💬（2）<div>文本检索跟trie树有什么关联吗？</div>2020-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/a2/79/e7d758c1.jpg" width="30px"><span>gaoch</span> 👍（3） 💬（1）<div>我想到这个向量的夹角可以描述不同文本的相似度，这里介绍了原理，就是不知道有没有哪个包可以实现向量构建？</div>2019-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/78/db99f4fd.jpg" width="30px"><span>CC9098</span> 👍（3） 💬（1）<div>第二，查询里出现了文档集合里没有的词。简单的做法是直接去除这维分量，也可以使用相对于其他维度来说极小的一个数值，这和分类中的平滑技术类似。

这里的去除这维分量，是说构建查询词的向量时，直接忽略词典没有的维度，保持和文档向量维度一致吗？

如果需要保持维度一致，那么选择极小值如何理解，这个是已经查询词向量已经比文档向量多了一个维度了吧？向量空间模型不需要保持两边维度一致吗？多出来的一些维度采用极小值就可以了吗？不会影响相似度计算效果吗？</div>2019-05-11</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/2Zh1NJFhKQPUXXQFt5MicFQ1jWqP13jSNP95NSjhLm5dCjzyJibJ7DsicFTW2yO9wicsOVibuwx2ibzZ88uyIvcj2a8Q/132" width="30px"><span>Geek_7bc035</span> 👍（1） 💬（1）<div>老师，我觉得查询 用户输入和文档相似度的时候，时间复杂度应该以文档的维数为基准，而不是以用户输入的单词长度为准，因为用户输入里面没出现的维度，就用零来代替</div>2022-02-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（1） 💬（1）<div>信息检索领域的应用向量空间模型，只需要把文档和查询转成向量，再计算这些向量间夹角，找出相关性最强的文档。向量的维度数就是所有文档唯一词条的数量，向量的分量自然是与文档、查询的词条有关。如果向量分量是布尔值，就损失掉了词条的权重信息；如果用词频代替布尔值，词条信息就会被众多高频词冲掉，因此还要加上词条在整个集合中出现的逆词频信息，即tf-idf。
向量空间模型有一个很大的缺点，即向量维度过大。在推断时，假设字典大小是n，而查询字符串的长度是m，那要构建一个查询向量的时间复杂度就是O(n*m)</div>2020-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg" width="30px"><span>建强</span> 👍（1） 💬（1）<div>思考题：
文档集合中新增文档后，如果用tf-idf来构建文档向量，除了构建新增文档的向量，也需要更新其它文档的向量，因为idf的计算公式中，需要用文档总数和词条在所有文档中出现的频率来计算，因此，文档总数发生变化，idf也需要随之变化。</div>2020-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/64/9b/d1ab239e.jpg" width="30px"><span>J.Smile</span> 👍（1） 💬（1）<div>“假设查询的平均长度（或词条数量）远远小于文档的平均长度，我们把查询的平均长度记做 m，那么对于每次计算查询向量和文档向量的相似度，时间复杂度都是 O(m)“
---------------------------------------------------------------------------------
老师，这个时间复杂度O(m)中的m指的是平均的查询的分词个数吧？比如我爱北京天安门，如果分词为[我，爱，北京，天安门]这四个词，构建出的查询向量也只有这四个有效的维度，因此时间复杂度就是O(4),是这样理解的吗？</div>2020-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/62/8f/c0f40d98.jpg" width="30px"><span>danvid</span> 👍（1） 💬（1）<div>elasticsearch和新版本的lucene使用的评分模型是BM25</div>2019-05-08</li><br/><li><img src="" width="30px"><span>013923</span> 👍（1） 💬（0）<div>学习了！</div>2022-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/42/df/a034455d.jpg" width="30px"><span>罗耀龙@坐忘</span> 👍（1） 💬（0）<div>茶艺师学编程

思考题：假设使用了 tf-idf 的机制来构造向量，那么当文档集合中新增了文档之后，是不是只需要为新增文档构建向量？原有文档的向量是否需要更新？

按照我的理解，这要分两种情况：

1、如果是与原文档集合很类似的文档，比如原来的就是医学的期刊选集，现在加进来一些《柳叶刀》（医学专业期刊）的论文，那么不光是新文档，原文档的向量都要重新算。

2、如果是与原文档集合完全不搭干的，比如在一堆医学的期刊选集里丢进一些电工操作手册·······那就把新文档的向量算出来就好了。

3、然而实际上的情况，往往是上面的两种（极端）情况的过渡状态······</div>2020-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/e4/2a/0e78269c.jpg" width="30px"><span>村长@极客时间</span> 👍（1） 💬（0）<div>我来打个卡</div>2019-03-06</li><br/><li><img src="" width="30px"><span>Paul Shan</span> 👍（0） 💬（0）<div>关键词匹配技术是基于特定关键词是否存在的判断，可以看作一个关于布尔类型向量的的函数。

向量空间方法的四个步骤
1.将文章转化成向量空间的一个向量。
2.将查询转化成向量空间的一个向量，检查文章向量和查询向量的相关性，例如求余弦。
3.按照相关性给文档排序，返回相关性高的文档
4.评估相关性

构建向量空间
向量空间的一个维度是某一单词
维度上的值，简单的做法就是单词的次数，也就是单词出现的次数代表了文章类型信息。这里从0到1,影响较大，1到2,影响就少了一些，这也符合实际情况。但是，某些单词对某些文章特别有用，例如阿司匹林就和医学文章相关和其他文章无关，而某些其他词例如中国，反应文档的信息量就很少。为了把这个因素也考虑进来，统计这个词的唯一程度，用逆文档频率调整词频。

文档的向量用词频+逆文档频率
查询的向量用稀疏词频+文档逆文档频率
计算余弦和排序

向量构造需要O(m)的复杂度，m为向量维度
n篇文章需要O(m*n)的复杂度

新增文档会影响逆文档频率，全部都得重算！应该有些中间变量例如词频可以记录下来，重算得时候用的上。


</div>2019-09-24</li><br/>
</ul>