上一节，我们见证了IP地址的诞生，或者说是整个操作系统的诞生。一旦机器有了IP，就可以在网络的环境里和其他的机器展开沟通了。

故事就从我的大学宿舍开始讲起吧。作为一个八零后，我要暴露年龄了。

我们宿舍四个人，大一的时候学校不让上网，不给开通网络。但是，宿舍有一个人比较有钱，率先买了一台电脑。那买了电脑干什么呢？

首先，有单机游戏可以打，比如说《拳皇》。两个人用一个键盘，照样打得火热。后来有第二个人买了电脑，那两台电脑能不能连接起来呢？你会说，当然能啊，买个路由器不就行了。

现在一台家用路由器非常便宜，一百多块的事情。那时候路由器绝对是奢侈品。一直到大四，我们宿舍都没有买路由器。可能是因为那时候技术没有现在这么发达，导致我对网络技术的认知是逐渐深入的，而且每一层都是实实在在接触到的。

## 第一层（物理层）

使用路由器，是在第三层上。我们先从第一层物理层开始说。

物理层能折腾啥？现在的同学可能想不到，我们当时去学校配电脑的地方买网线，卖网线的师傅都会问，你的网线是要电脑连电脑啊，还是电脑连网口啊？

我们要的是电脑连电脑。这种方式就是一根网线，有两个头。一头插在一台电脑的网卡上，另一头插在另一台电脑的网卡上。但是在当时，普通的网线这样是通不了的，所以水晶头要做交叉线，用的就是所谓的**1－3**、**2－6交叉接法**。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/d6/42/bafec9b7.jpg" width="30px"><span>盖</span> 👍（759） 💬（12）<div>ARP广播时，交换机会将一个端口收到的包转发到其它所有的端口上。
比如数据包经过交换机A到达交换机B，交换机B又将包复制为多份广播出去。
如果整个局域网存在一个环路，使得数据包又重新回到了最开始的交换机A，这个包又会被A再次复制多份广播出去。
如此循环，数据包会不停得转发，而且越来越多，最终占满带宽，或者使解析协议的硬件过载，行成广播风暴。</div>2018-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d6/42/bafec9b7.jpg" width="30px"><span>盖</span> 👍（339） 💬（7）<div>之前有无盘工作站，即没有硬盘的机器，无法持久化ip地址到本地，但有网卡，所以可以用RARP协议来获取IP地址。RARP可以用于局域网管理员想指定机器IP（与机器绑定，不可变），又不想每台机器去设置静态IP的情况，可以在RARP服务器上配置MAC和IP对应的ARP表，不过获取每台机器的MAC地址，好像也挺麻烦的。这个协议现在应该用得不多了吧，都用BOOTP或者DHCP了。</div>2018-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/6a/06/66831563.jpg" width="30px"><span>阡陌</span> 👍（215） 💬（3）<div>不得不说，看留言也能学到很多东西</div>2018-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/fe/8f/466f880d.jpg" width="30px"><span>没心没肺</span> 👍（162） 💬（6）<div>Hub：
1.一个广播域，一个冲突域。
2.传输数据的过程中易产生冲突，带宽利用率不高
Switch：
1.在划分vlan的前提下可以实现多个广播域，每个接口都是一个单独的冲突域
2.通过自我学习的方法可以构建出CAM表，并基于CAM进行转发数据。
3.支持生成树算法。可以构建出物理有环，逻辑无环的网络，网络冗余和数据传输效率都甩Hub好几条街。SW是目前组网的基本设备之一。</div>2018-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/69/df/71563d52.jpg" width="30px"><span>戴劼 DAI JIE🤪</span> 👍（84） 💬（1）<div>当年上课学习记住了交叉线和直连线的区别，工作后有一次两台机器对拷，发现网卡能自适应直连线，懵逼了。</div>2018-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/46/00/51f09059.jpg" width="30px"><span>hujunr</span> 👍（69） 💬（9）<div>当时用的交换机，把一条网线的2端同时接到交换机了，结果所有电脑都连不上网了，这是为什么？</div>2018-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/d2/f7/fabad335.jpg" width="30px"><span>天边的一只鱼</span> 👍（59） 💬（18）<div>看了前几章，个人理解下访问外网ip的流程，不知道对不对，  我现在在公司的内网想要访问一个北京的外网ip， 首先把我自己的ip地址，mac地址，端口，外网的ip地址，端口，在内网吼一下，被公司网关收到，判断下这个ip是不是内网的， 不是的话，添加上公司自己的mac地址，然后往更上一层吼一下(某个区域电信的网关)，然后这个区域的电信网管判断下ip是不是我这一片的,再试再加上自己的mac地址，再层层往上吼，一直找到这个ip为止。   不知道这么裂解对不对，刘老师。</div>2019-04-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/6a/03/cb597311.jpg" width="30px"><span>远心</span> 👍（38） 💬（1）<div>用网线直接连接两台计算机的方式，如何知道另一台计算机的 MAC  地址？使用 ARP 协议吗？也就是说其实每一台计算机都安装着 ARP Client&#47;Server 吗？</div>2018-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/45/cdfe6842.jpg" width="30px"><span>Z3</span> 👍（34） 💬（4）<div>当年玩魔兽经常出现他建房我看不见，我建房他能看见之类的问题。 这些可能是应用层的问题吗？
</div>2018-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/85/0a/e564e572.jpg" width="30px"><span>N_H</span> 👍（23） 💬（9）<div>老师，根据你前面的几个讲解，我理解到，机器A知道机器B的ip无法准确进行通信，因为ip可以在局域网内进行分配。但是知道mac地址肯定是能进行通信的，因为mac地址是唯一的，无论这个机器到哪里去了，我都能通过mac地址找到这个机器，既然这样，那为什么还需要ip地址？
这是我看了几期课程以来一直的疑问。</div>2019-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/fc/75/af67e5cc.jpg" width="30px"><span>黑猫紧张</span> 👍（22） 💬（6）<div>ARP协议是在局域网中的，那么在公网中二层如何获得目标mac地址？</div>2018-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/63/14/06eff9a4.jpg" width="30px"><span>Jerry银银</span> 👍（20） 💬（1）<div>文章开头说到：一旦机器有了 IP，就可以在网络的环境里和其他的机器展开沟通了。

我有个疑问：机器没有ip，就不能和其它机器通信了吗？</div>2019-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/52/19553613.jpg" width="30px"><span>刘培培</span> 👍（19） 💬（1）<div>ARAP 协议：https:&#47;&#47;tools.ietf.org&#47;html&#47;rfc903 因为太难实现，被后来的 BOOTP 协议：https:&#47;&#47;tools.ietf.org&#47;html&#47;rfc951 和 DHCP 协议：https:&#47;&#47;tools.ietf.org&#47;html&#47;rfc2131  替代。</div>2019-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg" width="30px"><span>楊_宵夜</span> 👍（18） 💬（1）<div>连续看了好几篇！真的是大道至简！逻辑无比清晰！细节的深度刚刚好！赞！以太网也是个很有趣的东西，记得在知乎上看到过，最离奇的Bug都有哪些。其中一个关于以太网的是说，某个大学因为建筑施工，挖掘机的声波频率影响了光纤电缆中的信号传输，导致信号最多只能传输520多公里哈哈哈，也就是说520公里以外的服务器都访问不到了。
这里细节肯定记错了，抛个砖，有兴趣的各位可以在知乎搜搜😂😂</div>2018-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3c/fb/ac114c4c.jpg" width="30px"><span>高磊</span> 👍（15） 💬（4）<div>局域网玩的是魔兽争霸，不是魔兽世界</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/df/d7/ee3da208.jpg" width="30px"><span>Yuki</span> 👍（14） 💬（1）<div>非科班出身，理解很困难。但每天坚持看一篇，多看看一定能慢慢理解～</div>2019-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/4d/1d1a1a00.jpg" width="30px"><span>magict4</span> 👍（13） 💬（9）<div>两台电脑直连的情况下，谁是网关呢？电脑可以充当网关吗？</div>2018-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e9/86/d34800a4.jpg" width="30px"><span>heyman</span> 👍（11） 💬（5）<div>&quot;这里还有一个没有解决的问题，当源机器知道目标机器的时候，可以将目标地址放入包里面，如果不知道呢？一个广播的网络里面接入了 N 台机器，我怎么知道每个 MAC 地址是谁呢？这就是ARP 协议，也就是已知 IP 地址，求 MAC 地址的协议。&quot;

请问一下，机器a是怎么知道机器b的ip？</div>2019-05-23</li><br/><li><img src="" width="30px"><span>天天向⬆️</span> 👍（10） 💬（2）<div>老师，一直没明白你说的mac层是什么？是物理层吗？还是数据链路层？</div>2018-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/10/4f/ac326acf.jpg" width="30px"><span>绿豆先生</span> 👍（9） 💬（1）<div>ip更换时，如果没到过期时间，交换机如何感知呢？</div>2019-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/d7/454a1b90.jpg" width="30px"><span>leon</span> 👍（9） 💬（1）<div>文中提到ARP缓存和交换机转发表都有过期时间，这个时间设置多长如何取呢？当arp缓存或转发表里的内容不对时有办法知道吗？</div>2019-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/17/c8/ca17d37e.jpg" width="30px"><span>夕夕熊</span> 👍（7） 💬（2）<div>我已经搞糊涂了 “IP 层要封装了 MAC 层才能将包放入物理层”到底是MAC层封装IP层  还是IP层封装MAC层 。在前几节我接触的应该是网络包经过到达MAC层之后 已经包含了IP层  也就是说MAC层会封装IP层的吧。</div>2019-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg" width="30px"><span>hunterlodge</span> 👍（7） 💬（1）<div>交换机学习后如果把两个网口的线互换会出现什么情况呢？交换机能识别出错误更新配置吗？</div>2018-06-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epyb06M55D5wXsDrsObicnNJtph90rsuKug7KYOJWleyGJrltDA2PAkp3jRAzIxFfUbnA96ic5TibLTQ/132" width="30px"><span>MrGuo</span> 👍（6） 💬（1）<div>老师  mac缓存这些有个有效时间 如果有效时间还没到  但是局域网有其他设备改变了ip mac，这时缓存的mac不就不对了吗</div>2018-11-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/52/19553613.jpg" width="30px"><span>刘培培</span> 👍（5） 💬（1）<div>1. RARP 用来主动获取 IP 地址，不过现在都用 DHCP 了</div>2019-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" width="30px"><span>QQ怪</span> 👍（5） 💬（2）<div>原来集线器和交换机是有区别的啊！之前一直以为是一个东西！</div>2019-03-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/81/2127e215.jpg" width="30px"><span>梦醒十分</span> 👍（5） 💬（1）<div>看到现在了，感觉还是没进入状态，或许这种知识不好说清楚吧！一头雾水！</div>2019-03-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/58/97/8e14e7d0.jpg" width="30px"><span>楚人</span> 👍（3） 💬（1）<div>老师讲得好，留言也很赞👍，永久保存，常拿出来看看！获益匪浅！</div>2018-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/53/d4/2ed767ea.jpg" width="30px"><span>wmg</span> 👍（2） 💬（2）<div>老师，lvs的dr模式，rs向客户端的回报会不会刷新交换机里vip对应的mac地址，这样会不会导致网络出错，有什么解决办法吗？</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/d5/8c/1a6cc556.jpg" width="30px"><span>Y</span> 👍（2） 💬（3）<div>作者说ip层封装了mac层才能被物理层接受，这个不对吧，封包是从上而下，解包是从下而上</div>2019-07-19</li><br/>
</ul>