对于云平台中的隔离问题，前面咱们用的策略一直都是VLAN，但是我们也说过这种策略的问题，VLAN只有12位，共4096个。当时设计的时候，看起来是够了，但是现在绝对不够用，怎么办呢？

**一种方式是修改这个协议**。这种方法往往不可行，因为当这个协议形成一定标准后，千千万万设备上跑的程序都要按这个规则来。现在说改就放，谁去挨个儿告诉这些程序呢？很显然，这是一项不可能的工程。

**另一种方式就是扩展**，在原来包的格式的基础上扩展出一个头，里面包含足够用于区分租户的ID，外层的包的格式尽量和传统的一样，依然兼容原来的格式。一旦遇到需要区分用户的地方，我们就用这个特殊的程序，来处理这个特殊的包的格式。

这个概念很像咱们[第22讲](https://time.geekbang.org/column/article/10386)讲过的**隧道理论**，还记得自驾游通过摆渡轮到海南岛的那个故事吗？在那一节，我们说过，扩展的包头主要是用于加密的，而我们现在需要的包头是要能够区分用户的。

底层的物理网络设备组成的网络我们称为**Underlay网络**，而用于虚拟机和云中的这些技术组成的网络称为**Overlay网络**，**这是一种基于物理网络的虚拟化网络实现**。这一节我们重点讲两个Overlay的网络技术。

## GRE

第一个技术是**GRE**，全称Generic Routing Encapsulation，它是一种IP-over-IP的隧道技术。它将IP包封装在GRE包里，外面加上IP头，在隧道的一端封装数据包，并在通路上进行传输，到另外一端的时候解封装。你可以认为Tunnel是一个虚拟的、点对点的连接。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="" width="30px"><span>Geek_f6f02b</span> 👍（8） 💬（1）<div>是不是大的逻辑来说还是传统的7层网络模型，但是有了 OpenvSwitch 之后，就可以对数据包做任意的更改，所以在 IP 层跟 TCP 直间加一个 VXLAN 层数据包头，这里面有足够多的VXLAN ID (24位)，让 OpenvSwitch 去解决 VLAN ID 不足问题，知道这个 Tunnel ID 跟 VXLAN ID 有对应关系，但是不知道有 VXLAN ID 为什么还要 Tunnel ID。不知道理解的对不对</div>2019-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/80/ac/37afe559.jpg" width="30px"><span>小毅(Eric)</span> 👍（1） 💬（1）<div>太难了，太难了，要多用多读啊</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/94/c9/374a69f2.jpg" width="30px"><span>张爽</span> 👍（0） 💬（2）<div>请问老师，有没有什么软件可以将专栏的这些知识实现一遍，记得Cisco公司有开发过一种做网络拓扑的工具，平时开发过程时很少接触到一些协议，光看理论没法更好的理解，看得云里雾里</div>2019-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg" width="30px"><span>秋天</span> 👍（0） 💬（1）<div>已经不能联系起来啦，请作者指点从哪普及一下基础</div>2018-09-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/12/ce/a8c8b5e8.jpg" width="30px"><span>Jason</span> 👍（61） 💬（1）<div>一定是我基础差，最近几篇感觉有点难，不能系统的理解，准备复读！</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/da/dd/a8b93a4a.jpg" width="30px"><span>晨晨ada</span> 👍（14） 💬（0）<div>ARP 抑制是一种减缓ARP广播风暴的方案。</div>2018-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8f/8b/9080f1fa.jpg" width="30px"><span>猫头鹰波波</span> 👍（11） 💬（1）<div>建议老师多讲点WHY，再讲WHAT，这样比较好理解一些，一上来就讲细节有点难理解</div>2020-02-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/68/c3/8e1a8dbf.jpg" width="30px"><span>Plantegg</span> 👍（9） 💬（0）<div>flow table图箭头缺了是、否。另外这里面vlan ID也不是一定需要的吧，感觉图有点问题</div>2018-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/5e/2b/df3983e2.jpg" width="30px"><span>朱显杰</span> 👍（6） 💬（0）<div>问题1:可以采用underlay网络，比如calico。问题二：容器云</div>2018-07-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIvMlvSXsYgJibIyDO78gPacZR1qukEOJrpfHAJmyGVtWPO3XMqVA9dImHhGJm2icp6lDuBw1GrNDbA/132" width="30px"><span>赤脚小子</span> 👍（4） 💬（0）<div>问题1 广播风暴的主要原因就是环路了，传统网络采用stp，针对overlay ，通过路由协议ecmp实现</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ac/c8/4b1c0d40.jpg" width="30px"><span>勤劳的小胖子-libo</span> 👍（3） 💬（0）<div>第一个跟vpc虚拟专用网络有关吗？
第二个是容器云吧，会讲k8s吗</div>2018-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b0/77/cb933f6c.jpg" width="30px"><span>hill</span> 👍（3） 💬（0）<div>overlay一般对广播报文进行抑制和代理，来将广播限制在接入设备下面</div>2018-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1b/e4/d5e021f9.jpg" width="30px"><span>crysSuenny</span> 👍（3） 💬（0）<div>自打老师直播提到、录音时间长会嘴瓢，我就老赶脚在录音中听到嘴瓢....不然累的时候就别录了？～好心疼噢..～</div>2018-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/3b/daa0ff2d.jpg" width="30px"><span>千岁寒</span> 👍（2） 💬（0）<div>问题一:  广播抑制，典型的方案是ARP代理和ARP代答。
问题二：容器云，Docker和k8s。</div>2020-02-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/a1/07027529.jpg" width="30px"><span>偏偏喜欢你</span> 👍（2） 💬（0）<div>虽然干货满满，基础太差，得多读几遍了</div>2018-10-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4akcIyIOXB2OqibTe7FF90hwsBicxkjdicUNTMorGeIictdr3OoMxhc20yznmZWwAvQVThKPFWgOyMw/132" width="30px"><span>Chuan</span> 👍（1） 💬（0）<div>哇。。真的是膜拜老师了。。三年前大学搞SDN的时候，好多时候都没太理解VXLAN这些东西怎么搞、为什么这么搞，老师这个云计算网络章节，真的是完全解惑了，感谢感谢，再下去多消化下：）</div>2020-05-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/46/2e/1017900c.jpg" width="30px"><span>牛逼中…</span> 👍（1） 💬（0）<div>“OpenvSwitch 支持三类隧道：GRE、VXLAN、IPsec_GRE。”，所以文章中的例子是使用GRE隧道了？那没明白为什么有vlan id和tunnel id的转换？或者说这里为什么出现vlan id？</div>2020-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg" width="30px"><span>饭粒</span> 👍（1） 💬（0）<div>最后这个 Flow Table  太绕了，这篇粗糙点过了先。</div>2019-12-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/11/b2/dd0606b2.jpg" width="30px"><span>水先生</span> 👍（1） 💬（1）<div>老师，请问GRE的隧道两端的端口，是怎么实现封包和解包的呢？</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/fc/8e/ff99e2b2.jpg" width="30px"><span>于琳琳</span> 👍（1） 💬（0）<div>有点听不懂了(￣∀￣)</div>2018-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（1） 💬（0）<div>思考题2   容器云</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2025-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg" width="30px"><span>piboye</span> 👍（0） 💬（0）<div>gre和vxlan各用于什么场景？</div>2022-08-23</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132" width="30px"><span>Geek_93970d</span> 👍（0） 💬（0）<div>&quot;网络包到达 VTEP1 之后，VTEP1 解开 VXLAN 封装，将包转发给虚拟机 1。&quot;
图里面为啥是 ICMP ？</div>2022-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/23/e8/9f445339.jpg" width="30px"><span>章潘</span> 👍（0） 💬（0）<div>Neutron的架构精髓就这样通俗的讲清楚了，拜膜大佬</div>2022-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/43/24/3f9f7c70.jpg" width="30px"><span>zixuan</span> 👍（0） 💬（0）<div>可读性有点差</div>2022-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/67/0f/3cb10900.jpg" width="30px"><span>菜鸟</span> 👍（0） 💬（0）<div>使用GRE通道通信时、两端私网IP如何知道对端的公网IP和私网IP？</div>2022-01-18</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epG46rRwzg6HEJBHk01x0j9NGxeG41H3iadrkwlPEfQIic4edZ9JClFHZiafMwxeia0NOpNr8PaS2zOMw/132" width="30px"><span>牛学真</span> 👍（0） 💬（0）<div>容器网络重头戏来了</div>2021-07-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/6d/8b417c84.jpg" width="30px"><span>Wheat Liu</span> 👍（0） 💬（0）<div>从openvswitch开始就读不懂了</div>2021-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/37/2b/b32f1d66.jpg" width="30px"><span>Ball</span> 👍（0） 💬（0）<div>这几篇有点难，要找机会实践一下</div>2021-02-22</li><br/>
</ul>