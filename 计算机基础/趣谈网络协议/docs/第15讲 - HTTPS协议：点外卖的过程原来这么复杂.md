用HTTP协议，看个新闻还没有问题，但是换到更加严肃的场景中，就存在很多的安全风险。例如，你要下单做一次支付，如果还是使用普通的HTTP协议，那你很可能会被黑客盯上。

你发送一个请求，说我要点个外卖，但是这个网络包被截获了，于是在服务器回复你之前，黑客先假装自己就是外卖网站，然后给你回复一个假的消息说：“好啊好啊，来来来，银行卡号、密码拿来。”如果这时候你真把银行卡密码发给它，那你就真的上套了。

那怎么解决这个问题呢？当然一般的思路就是**加密**。加密分为两种方式一种是**对称加密**，一种是**非对称加密**。

在对称加密算法中，加密和解密使用的密钥是相同的。也就是说，加密和解密使用的是同一个密钥。因此，对称加密算法要保证安全性的话，密钥要做好保密。只能让使用的人知道，不能对外公开。

在非对称加密算法中，加密使用的密钥和解密使用的密钥是不相同的。一把是作为公开的公钥，另一把是作为谁都不能给的私钥。公钥加密的信息，只有私钥才能解密。私钥加密的信息，只有公钥才能解密。

因为对称加密算法相比非对称加密算法来说，效率要高得多，性能也好，所以交互的场景下多用对称加密。

## 对称加密

假设你和外卖网站约定了一个密钥，你发送请求的时候用这个密钥进行加密，外卖网站用同样的密钥进行解密。这样就算中间的黑客截获了你的请求，但是它没有密钥，还是破解不了。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg" width="30px"><span>万历十五年</span> 👍（427） 💬（10）<div>各大CA机构的公钥是默认安装在操作系统里的。所以不要安装来路不明的操作系统，否则相当于裸奔</div>2018-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg" width="30px"><span>LEON</span> 👍（49） 💬（4）<div>这张SSL握手的图，真的棒！</div>2018-06-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/THkFNC52F0kYs2XI1fwxOvCck0Pibwnia4z6fzCPMRg2qYQLlt57qW4caJZ6uj9lWROc7t1OHFmIdKmiaEIP2GXpg/132" width="30px"><span>isaac</span> 👍（32） 💬（2）<div>单向认证中的三个随机数可能是为了保证完全随机吧，毕竟所有的机器都是伪随机的</div>2019-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/15/f85c0121.jpg" width="30px"><span>飞龙在天</span> 👍（21） 💬（1）<div>老师你好：
https协议中，客户端和服务端信息传输使用了对称加密，疑惑的是服务器端是怎样识别多个客户端的公钥呢？项目中并没有对此做特殊的处理，希望老师解惑o(^o^)o。</div>2018-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9e/ef/a74049d9.jpg" width="30px"><span>森码</span> 👍（13） 💬（7）<div>客户端和服务端为什么要分别传输一个随机数呢？通过公钥加密Pre-master不是就可以用吗？</div>2018-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/a9/cb/a431bde5.jpg" width="30px"><span>木头发芽</span> 👍（12） 💬（1）<div>@monkay:证书里还带了域名，如果浏览器联的是外卖网站的域名，被黑客拦截发回了黑客的ca证书，校验证书的时候会发现域名不对从而证书认证失败</div>2019-05-12</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTL1kXMgeyk9hcCTDWbrwuAW2OiaJmHLTN3ZppVzKJXIXicia8D9a38Nb8vjfCEepFJyJJUqAknib2UQ/132" width="30px"><span>酷哥居士</span> 👍（10） 💬（2）<div>想请教老师一下，上面的HTTPS请求，客户端和服务端之间发送证书，验证证书，传输秘钥等等这些操作，是在HTTPS的TCP连接建立成功后做的吗？</div>2019-01-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（7） 💬（1）<div>老师，可以补充一下https双向认证的流程图吗？</div>2018-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/41/be/4893497a.jpg" width="30px"><span>野猪佩奇</span> 👍（5） 💬（2）<div>老师你好，我之前听说获取CA证书都是需要给钱的，这边怎么一条命令就能获取一个证书啊？望解惑，谢谢</div>2018-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/43/ef/f4e600e5.jpg" width="30px"><span>烧饼</span> 👍（4） 💬（1）<div>这里两个 hello 信息都是用明文传输的，包括里面的随机数，真正加密传输的是 Pre-master 。就是说外界完全可以抓取这两个随机数，真正影响外界窃取对称密钥的是 Pre-master ，那是不是意味着其实这两个随机数作用不大，可以去掉？</div>2018-06-29</li><br/><li><img src="" width="30px"><span>唐唐</span> 👍（4） 💬（1）<div>老师好，有个问题很疑惑，想请教一下。这个https是浏览器和服务器端的交互吧。那么这个证书对应安装到用户的浏览器了吗？服务器端怎么能知道用户安装的是什么证书，拿到该证书对应的公钥或私钥呢？浏览器是安装一个证书，还是对应不同服务器安装多个不同证书。</div>2018-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/6b/bb/10aaf123.jpg" width="30px"><span>王世林</span> 👍（3） 💬（1）<div>1.浏览器遍历操作系统列表中证书发布机构ca列表，如果与服务器端发来的证书机构ca一致， 则会用操作系统中的ca证书的公钥解密服务端证书的签名，浏览器使用相同的hash算法计算出服务器发来的证书的hash值，将这个计算的hash值与证书中签名做对比，对比结果一致，则证明服务器发来的证书合法，没有被冒充， 是这样的吗？ 2. 这个pre-master 是浏览器发给服务端， 最后生成相同的对称回话密钥， 我看网上还有的评论可以生成2个不同的回话密钥， 分别对应浏览器发给服务端信息和服务端发给浏览器信息</div>2019-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/63/14/06eff9a4.jpg" width="30px"><span>Jerry银银</span> 👍（2） 💬（3）<div>有几个疑问，希望老师帮忙解答：
1. 为什么需要三个随机数，我隐隐觉得是为了提高随机性，从而保证安全性，不知道理解对不对？
2. 为什么最后一个随机数叫pre-master？
3. 客户端可以连接代理服务器，代理服务器可以生成自签名证书，这样就可以抓包了，这种情况如何解决呢？</div>2019-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1c/4b/2e5df06f.jpg" width="30px"><span>三件事</span> 👍（2） 💬（1）<div>一个证书可以有多个域名吗？</div>2019-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1c/4b/2e5df06f.jpg" width="30px"><span>三件事</span> 👍（2） 💬（1）<div>“没错，有了加密和解密，黑客截获了包也打不开了，但是它可以发送 N 次。这个往往通过 Timestamp 和 Nonce 随机数联合起来，然后做一个不可逆的签名来保证。”

这句没理解，为什么拿到了包也打不开？如果做了证书校验，黑客是拿不到包的吧？发现证书不对不会中止请求吗？</div>2019-05-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTL1kXMgeyk9hcCTDWbrwuAW2OiaJmHLTN3ZppVzKJXIXicia8D9a38Nb8vjfCEepFJyJJUqAknib2UQ/132" width="30px"><span>酷哥居士</span> 👍（2） 💬（1）<div>老师你好，有个疑惑，https的加密解密、验证证书、传输密钥等属于tcp的三次握手吗？http基于tcp要先进行三次握手我能理解，那https的三次握手是怎么样的，上面传输密钥的过程属不属于三次握手？不属于的话，那什么时候进行三次握手</div>2019-01-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg" width="30px"><span>无名</span> 👍（2） 💬（1）<div>https与ssl有什么关系吗？</div>2018-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ee/23/b8d6546e.jpg" width="30px"><span>nice</span> 👍（2） 💬（1）<div>老是你好，我今天刚买的，就看了一个HTTPS，受益匪浅，想问下您，在最后您留下的问题，我在下一期没有发现问题的讲解，这问题是不是不会进行讲解，让自己进行学习呢？</div>2018-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/41/5a/b273689e.jpg" width="30px"><span>洪宇舟</span> 👍（2） 💬（1）<div>刘老师，请问文章里面证书请求的命令行里面为什么是私钥呢？CA应该是对公钥做签名吧</div>2018-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/87/dd/4f53f95d.jpg" width="30px"><span>进阶的码农</span> 👍（2） 💬（4）<div>为啥私钥加密 互联网上人人都可以把它打开？</div>2018-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/b3/97945ef8.jpg" width="30px"><span>Hansen</span> 👍（1） 💬（1）<div>老师说https在用非所称加密后连接时，两端会协商用对称加密来传输数据。那以后每次的https都会这样操作一遍吗？还是这个公钥会被记录在各自的某些地方，比如session或者cookie什么的</div>2019-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg" width="30px"><span>hola</span> 👍（1） 💬（1）<div>每一次https的连接握手，都需要这么复杂的过程吧？</div>2019-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/9f/64/a0a0904d.jpg" width="30px"><span>cheetah</span> 👍（1） 💬（2）<div>最近在接入监控系统到公司后台，在研究相关协议，rtsp、rtmp、hls</div>2019-06-04</li><br/><li><img src="" width="30px"><span>起风了001</span> 👍（1） 💬（1）<div>请教一下, 有一个问题是, 为什么需要三个随机数呢? 直接在最后一步客户端用网站公钥加密一个&quot;私钥&quot;, 然后大家都可以用这个私钥做以后的数据传输就可以了.</div>2019-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/37/57/b21a1c39.jpg" width="30px"><span>伍阿哥</span> 👍（0） 💬（1）<div>老师请教您一个问题，中间人能不能够截取到证书然后拿到里面的公钥，再冒充客户端对请求参数做公钥加密向服务器发出请求。</div>2020-06-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/37/57/b21a1c39.jpg" width="30px"><span>伍阿哥</span> 👍（0） 💬（1）<div>老师关于重放问题还是不理解，当我是黑客用抓包工具抓到了https的数据，电脑设置信任抓包工具的证书就能获得https的数据，那么同样可以修改时间戳去发送数据。望老师解答，谢谢</div>2020-06-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/b6/54/8d6a2736.jpg" width="30px"><span>你是天才i</span> 👍（0） 💬（2）<div>先别太乐观，这里还是有问题的。回复的这句话，是外卖网站拿私钥加密的，互联网上人人都可以把它打开，当然包括黑客。那外卖网站可以拿公钥加密吗？当然不能，因为它自己的私钥只有它自己知道，谁也解不开。

请问这段话到底什么意思？</div>2019-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/b6/54/8d6a2736.jpg" width="30px"><span>你是天才i</span> 👍（0） 💬（1）<div>每个人的私钥都是不一样的吗？</div>2019-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/62/2f/6fe8ee9e.jpg" width="30px"><span>李靖峰</span> 👍（0） 💬（1）<div>同样的包发送n次这个，如果对称加密采用带有iv的aes算法的话同样的内容每次加密后都是不一样的，所以黑客发送n次对端也无法解密成相同的结果</div>2019-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/cb/80/410a7387.jpg" width="30px"><span>TryCatch🎈</span> 👍（0） 💬（1）<div>有双向认证的流程图吗？</div>2019-06-02</li><br/>
</ul>