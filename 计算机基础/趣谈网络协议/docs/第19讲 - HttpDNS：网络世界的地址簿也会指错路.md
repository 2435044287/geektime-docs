上一节我们知道了DNS的两项功能，第一是根据名称查到具体的地址，另外一个是可以针对多个地址做负载均衡，而且可以在多个地址中选择一个距离你近的地方访问。

然而有时候这个地址簿也经常给你指错路，明明距离你500米就有个吃饭的地方，非要把你推荐到5公里外。为什么会出现这样的情况呢？

还记得吗？当我们发出请求解析DNS的时候，首先，会先连接到运营商本地的DNS服务器，由这个服务器帮我们去整棵DNS树上进行解析，然后将解析的结果返回给客户端。但是本地的DNS服务器，作为一个本地导游，往往有自己的“小心思”。

## 传统DNS存在哪些问题？

### 1.域名缓存问题

它可以在本地做一个缓存，也就是说，不是每一个请求，它都会去访问权威DNS服务器，而是访问过一次就把结果缓存到自己本地，当其他人来问的时候，直接就返回这个缓存数据。

这就相当于导游去过一个饭店，自己脑子记住了地址，当有一个游客问的时候，他就凭记忆回答了，不用再去查地址簿。这样经常存在的一个问题是，人家那个饭店明明都已经搬了，结果作为导游，他并没有刷新这个缓存，结果你辛辛苦苦到了这个地点，发现饭店已经变成了服装店，你是不是会非常失望？

另外，有的运营商会把一些静态页面，缓存到本运营商的服务器内，这样用户请求的时候，就不用跨运营商进行访问，这样既加快了速度，也减少了运营商之间流量计算的成本。在域名解析的时候，不会将用户导向真正的网站，而是指向这个缓存的服务器。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIu1n1DhUGGKS1obrPQicEHlhC7A5zuu6fCQVR4PNx06LNEgfITQqic9fRGYicI0TkFMQUfDAnR7YVLA/132" width="30px"><span>quanbove</span> 👍（22） 💬（1）<div>HTTPNDS 其实就是，不走传统的 DNS 解析，而是自己搭建基于 HTTP 协议的 DNS 服务器集群，分布在多个地点和多个运营商。
发现一个笔误的地方，HTTPDNS，而不是HTTPNDS，我是又多无聊[捂脸]</div>2018-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/a8/ee414a25.jpg" width="30px"><span>公告-SRE运维实践</span> 👍（8） 💬（3）<div>这个文章看起来感觉httpdns能解决传统的dns问题，但是前提是有自己的客户端，这种要对业务进行全部改造。那么如果就是浏览器访问，有没有什么方案，在不使用cdn的情况下</div>2018-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg" width="30px"><span>蚂蚁内推+v</span> 👍（5） 💬（1）<div>HTTPDNS能支持HTTPS 不
</div>2019-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg" width="30px"><span>追风筝的人</span> 👍（4） 💬（1）<div>非计算机专业同学，老师能送我一份网络协议知识图谱吗？
</div>2019-06-05</li><br/><li><img src="" width="30px"><span>哈哈哈</span> 👍（4） 💬（2）<div>请问老师：文中的在不同运营商或地区部署httpdns服务，根据客户端位置返回最优应用地址，httpdns服务端部署方式是如何的？如何达到不同运营商或地区效果？httpdns适用场景只有哪些呢？谢谢</div>2019-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/b6/43/c23a38b2.jpg" width="30px"><span>whats your name</span> 👍（3） 💬（1）<div>老师，有一个疑惑点：HTTPDNS的域名&#47;ip地址簿是从哪里来的呢？</div>2019-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/53/0c/b4907516.jpg" width="30px"><span>Marco</span> 👍（3） 💬（2）<div>那httpdns不需要考虑负载均衡么?</div>2019-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/94/2c22bd4e.jpg" width="30px"><span>克里斯</span> 👍（3） 💬（1）<div>权威DNS服务器的ip地址不会变吗？</div>2019-02-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/yy4cUibeUfPHPkXXZQnQwjXY7m5rXY5ib6a7pC1vkupj1icibF305N4pJSdqw0fO1ibvyfKCQ7HWggLhwiaNbbRPBsKg/132" width="30px"><span>桃子妈妈</span> 👍（3） 💬（3）<div>老师好，很想了解HTTPDNS服务端仍然会使用递归的方式依次通过根域名、顶级域名、权威域名去递归查询吗？</div>2019-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg" width="30px"><span>supermouse</span> 👍（2） 💬（1）<div>想问一下老师，HTTPDNS服务器集群是谁来搭建的？</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg" width="30px"><span>J.M.Liu</span> 👍（1） 💬（1）<div>老师，那httpdns服务器自己的地址簿，他怎么更新呢？</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0e/e9/98b6ea61.jpg" width="30px"><span>程序员大天地</span> 👍（1） 💬（1）<div>第一次听说HTTPDNS，没有听懂。HTTPDNS服务器是如何部署的，服务器是如何知道域名的对应ip，难度它不用递归向权威DNS服务器查询吗？</div>2019-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg" width="30px"><span>云学</span> 👍（1） 💬（3）<div>httpdns和反向代理有什么区别呢？</div>2018-07-02</li><br/><li><img src="" width="30px"><span>起风了001</span> 👍（0） 💬（2）<div>httpdns的ip地址列表是真的可以直接写死在客户端的, 比特币的原始节点服务器的ip就是写死的代码里的, 人家还是玩得好好的.</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/48/ad/8be724da.jpg" width="30px"><span>陈泽坛</span> 👍（0） 💬（1）<div>httpdns自己的dns服务器  成本好高吧？</div>2019-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/78/ac/e5e6e7f3.jpg" width="30px"><span>古夜</span> 👍（0） 💬（1）<div>有人知道网页劫持是咋回事吗</div>2019-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg" width="30px"><span>亮点</span> 👍（140） 💬（4）<div>老师能不能写个专题介绍一下国内几大运营商网络状况和互联关系😬 </div>2018-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（95） 💬（1）<div>1.httpdns服务器的地址一般不变 可以使用dns的方式获取httpdns服务器的ip地址 也可以直接把httpdns服务器的ip地址写死在客户端中。

2.让用户获取离用户最近的资源 一般是静态资源 这使用的是cdn技术</div>2018-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/80/fb/ffa57759.jpg" width="30px"><span>xyz</span> 👍（48） 💬（0）<div>1. HTTPDNS 服务器的地址或者域名（和网站域名类似）一般不变，所以可以写死在SDK里；

2..为方便用户近源访问，使用CDN技术（content distribution network，内容分发网络）。


一点题外话：作者的每一期讲解都有好好学习，讲的都挺通俗易懂的，不过如果能加入一些相关的经典的参考链接，应该会更好，授人以鱼的同时也授人以渔。</div>2018-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4b/b2/7f600f9e.jpg" width="30px"><span>silence</span> 👍（35） 💬（0）<div>之前在软件公司干活，有个大客户，有很多站点，但是他们原先的系统不支持调度。希望我们给他出个方案，做到智能调度。当时我出的方案是给他们搞一个类似 HTTPDNS 的系统。根据运营商、地理位置、站点负载进行调度。一次返回多个服务列表。让客户端进行缓存，定期更新。今天看了这个文章，在回想起当时我给他们做的方案，当时只做了服务器上的调度，客户端因为无法控制，当时没考虑进行改造，添加反馈。看了文章，看到还是有可以再优化的点的。</div>2018-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/43/c1/576c01a1.jpg" width="30px"><span>upstream</span> 👍（16） 💬（1）<div>3.出口nat问题这段个人认为说的不准确。客户端的dns服务器指向一般都是一个运营商的localdns，不考虑edns的情况下，权威服务器拿到的是localdns地址。
如果递归dns支持edns，权威服务器能看到客户端出口nat地址。
只有像长城宽带这类流氓二道贩子，会把用户出口nat地址全国飘</div>2018-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（11） 💬（3）<div>我想问的是:HttpDns服务器的域名地址簿，也是通过递归根域名，顶级域名，权威域名服务器获取的吗？</div>2018-08-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/60/c7/a147b71b.jpg" width="30px"><span>Fisher</span> 👍（6） 💬（0）<div>最近几篇文章都很赞啊，这一篇讲清楚了为什么跨运营商速度会慢的原因，之前知道这个问题但是不知道答案，其次httpdns这个新技术第一次听说，赞一个</div>2018-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a0/a7/db7a7c50.jpg" width="30px"><span>送普选</span> 👍（4） 💬（1）<div>咨询一下httpdns如何获取权威dns上的IP地址？每次有客户端httpdns请求来了就查一下，还是每1秒定期轮询后缓存？谢谢</div>2019-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/8e/0a546871.jpg" width="30px"><span>凡凡</span> 👍（4） 💬（1）<div>1、可以是通过域名解析，也可以是直接配置所有httpdns服务器节点。阿里云采用的是配置ip列表的方式。2、cdn内容分发网络</div>2018-07-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9f/d6/f66133b4.jpg" width="30px"><span>吴贤龙</span> 👍（2） 💬（0）<div>老师，要实现httpDNS，除了手机端，PC端怎么办呢？</div>2020-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9e/c3/c321541c.jpg" width="30px"><span>Nicole</span> 👍（2） 💬（0）<div>1.写死在SDK中，支持DNS over HTTPS方案
2.CDN内容分发服务</div>2018-08-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/6d/8b417c84.jpg" width="30px"><span>Wheat Liu</span> 👍（1） 💬（1）<div>为什么A运营商会偷懒，将请求转发给B运营商，有什么历史案例吗</div>2021-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/37/56/f57c24f1.jpg" width="30px"><span>倡印</span> 👍（1） 💬（1）<div>问个问题。移动端使用流量的时候使用HTTPDNS这好理解，但是移动端也可以接入家庭网络Wi-Fi家庭网络又是传统的DNS解析，这种情况下移动端还是会使用HTTPDNS来解析吗？？？？？？</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/38/2d/9c971119.jpg" width="30px"><span>若丶相依</span> 👍（1） 💬（0）<div>HTTPDNS 服务器的地址或者域名由传统DNS做第一次的解析，获取到HTTPDNS服务器地址后由HTTPDNS重新解析自己的地址为最优节点 ?</div>2018-12-08</li><br/>
</ul>