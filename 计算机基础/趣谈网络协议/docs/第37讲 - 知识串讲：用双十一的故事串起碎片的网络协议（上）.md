基本的网络知识我们都讲完了，还记得最初举的那个“双十一”下单的例子吗？这一节开始，我们详细地讲解这个过程，用这个过程串起我们讲过的网络协议。

我把这个过程分为十个阶段，从云平台中搭建一个电商开始，到BGP路由广播，再到DNS域名解析，从客户看商品图片，到最终下单的整个过程，每一步我都会详细讲解。这节我们先来看前三个阶段。

## 1.部署一个高可用高并发的电商平台

首先，咱们**要有个电商平台**。假设我们已经有了一个特别大的电商平台，这个平台应该部署在哪里呢？假设我们用公有云，一般公有云会有多个位置，比如在华东、华北、华南都有。毕竟咱们的电商是要服务全国的，当然到处都要部署了。我们把主站点放在华东。

![](https://static001.geekbang.org/resource/image/ed/20/eddde5929de2a72b197321e5ad87e120.jpg?wh=1659%2A1170)

为了每个点都能“雨露均沾”，也为了高可用性，往往需要有多个机房，形成多个可用区（Available Zone）。由于咱们的应用是分布在两个可用区的，所以假如任何一个可用区挂了，都不会受影响。

我们来回想[数据中心](https://time.geekbang.org/column/article/10098)那一节，每个可用区里有一片一片的机柜，每个机柜上有一排一排的服务器，每个机柜都有一个接入交换机，有一个汇聚交换机将多个机柜连在一起。

这些服务器里面部署的都是计算节点，每台上面都有Open vSwitch创建的虚拟交换机，将来在这台机器上创建的虚拟机，都会连到Open vSwitch上。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/50/39/14adb0f0.jpg" width="30px"><span>trllllllll</span> 👍（23） 💬（1）<div>极客时间学过的5个专栏里最好的一个了，赞</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/72/67/aa52812a.jpg" width="30px"><span>stark</span> 👍（7） 💬（1）<div>看了第二遍了，看的终于有点懂了些，而且觉得网络协议还挺有趣</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/14/65/c602a30d.jpg" width="30px"><span>西斯</span> 👍（4） 💬（1）<div>请教个问题 不同机房里的数据库存储的是自己机房的数据 还是包括其他所有机房的数据 如果是全量 跨机房间的数据同步是怎么做的?</div>2018-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/cb/4e/3e337008.jpg" width="30px"><span>叶</span> 👍（1） 💬（3）<div>老师，我买你前面的课了，那个趣谈协议，我买了，没看到你总结的协议图，不过你讲的生动易懂</div>2018-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/eb/f6/ec7971f4.jpg" width="30px"><span>固态U盘</span> 👍（30） 💬（0）<div>意犹未尽！老师再开个其他专栏吧。</div>2018-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/45/be/494010aa.jpg" width="30px"><span>zcpromising</span> 👍（23） 💬（0）<div>讲的太精彩了，老师还能不能来个kubernetes相关的专栏</div>2018-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/44/f3d0017c.jpg" width="30px"><span>程启</span> 👍（9） 💬（0）<div>请教，全球或者国内加海外双十一，调度和数据库层会否有大的变动。

这个系列这么快结束了，真是依依不舍。再开个续集吧 😃</div>2018-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（5） 💬（0）<div>老师，看不懂有网络的书推荐么?</div>2019-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg" width="30px"><span>大坏狐狸</span> 👍（5） 💬（0）<div>撑到现在 给自己鼓鼓掌</div>2019-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/45/11/51aaa953.jpg" width="30px"><span>Geek_wadehao</span> 👍（3） 💬（0）<div>棒。打通了云计算、移动通信、计算机网络等多门科目。</div>2020-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg" width="30px"><span>夜空中最亮的星</span> 👍（3） 💬（0）<div>精彩</div>2018-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ee/2f/aecf69a5.jpg" width="30px"><span>凌天</span> 👍（2） 💬（0）<div>老师太博学了</div>2018-09-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/6d/89/14031273.jpg" width="30px"><span>Direction</span> 👍（1） 💬（0）<div>我们目前得架构就是这样的，所以理解起来还挺好。用的阿里云华北2，多个高可用区，用vpc打通多个高可用区。</div>2020-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0e/e9/98b6ea61.jpg" width="30px"><span>程序员大天地</span> 👍（1） 💬（0）<div>厉害厉害，精彩！</div>2019-09-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg" width="30px"><span>Enterprize</span> 👍（1） 💬（0）<div>云中网络看的我像在云里，终于到能看懂的东西了</div>2018-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/57/04/07eb8cbb.jpg" width="30px"><span>hhq</span> 👍（1） 💬（0）<div>把vxlan，vpn和bgp的使用场景都串联起来了，期待下一期的串讲</div>2018-08-12</li><br/><li><img src="" width="30px"><span>horsechestnut</span> 👍（1） 💬（0）<div>这一章开始看不懂了~不过还没工作，等工作了应该在实践中可以得出真知</div>2018-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/5d/52/21275675.jpg" width="30px"><span>隆哥</span> 👍（0） 💬（0）<div>按老师说的都是买云服务，还没开始引流就破产了</div>2023-02-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/59/dc9bbb21.jpg" width="30px"><span>Join</span> 👍（0） 💬（0）<div>谢谢刘老师，这个专栏真的太值了，不光教网络，还有公有云的应用部署结构（特别是这节，太通透了），连最近很火的Envoy和Istio都带了点，格局打开</div>2021-10-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/48/33/4663928e.jpg" width="30px"><span>W҈T҈H҈</span> 👍（0） 💬（0）<div>不错，知识都串起来了，很爽！</div>2021-05-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/6d/8b417c84.jpg" width="30px"><span>Wheat Liu</span> 👍（0） 💬（0）<div>只是串讲非常清晰，多亏更完了才看的，不然跟追剧一样想看想得心痒</div>2021-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/de/c7/26485903.jpg" width="30px"><span>Yolo七夜</span> 👍（0） 💬（0）<div>今天刚好双十一，哈哈哈</div>2020-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/39/f9/b2fe7b63.jpg" width="30px"><span>King-ZJ</span> 👍（0） 💬（0）<div>从搭建电商平台，到对外提供服务，最后用户来申请服务。这样一个流程，一步一步地还原生活中具体的场景，知识点很多，也很有趣。</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f4/f7/871ff71d.jpg" width="30px"><span>Geek_David</span> 👍（0） 💬（0）<div>棒</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/dc/21/34c72e67.jpg" width="30px"><span>cyz</span> 👍（0） 💬（0）<div>很过瘾啊</div>2019-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/80/ac/37afe559.jpg" width="30px"><span>小毅(Eric)</span> 👍（0） 💬（0）<div>老师真的很厉害,这一看就是有相当的经验才能写的出来的</div>2019-08-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/65/03/973b24ec.jpg" width="30px"><span>谢晋</span> 👍（0） 💬（0）<div>喜欢老师文章的通俗、易懂、有趣，表达非常有激情</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/fd/80/52763d62.jpg" width="30px"><span>周平</span> 👍（0） 💬（0）<div>信息量巨大，老师赞</div>2019-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg" width="30px"><span>Hurt</span> 👍（0） 💬（0）<div>老师太赞了 学学学100遍</div>2018-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg" width="30px"><span>空档滑行</span> 👍（0） 💬（0）<div>有个问题请请教下，我是可以每个虚拟机都绑定一个外网ip的。但是图上一个物理机只分配了一个，如果要多个是怎么实现的</div>2018-08-10</li><br/>
</ul>