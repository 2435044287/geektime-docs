到目前为止，咱们讲了四种RPC，分别是ONC RPC、基于XML的SOAP、基于JSON的RESTful和Hessian2。

通过学习，我们知道，二进制的传输性能好，文本类的传输性能差一些；二进制的难以跨语言，文本类的可以跨语言；要写协议文件的严谨一些，不写协议文件的灵活一些。虽然都有服务发现机制，有的可以进行服务治理，有的则没有。

我们也看到了RPC从最初的客户端服务器模式，最终演进到微服务。对于RPC框架的要求越来越多了，具体有哪些要求呢？

- 首先，传输性能很重要。因为服务之间的调用如此频繁了，还是二进制的越快越好。
- 其次，跨语言很重要。因为服务多了，什么语言写成的都有，而且不同的场景适宜用不同的语言，不能一个语言走到底。
- 最好既严谨又灵活，添加个字段不用重新编译和发布程序。
- 最好既有服务发现，也有服务治理，就像Dubbo和Spring Cloud一样。

## Protocol Buffers

这是要多快好省地建设社会主义啊。理想还是要有的嘛，这里我就来介绍一个向“理想”迈进的GRPC。

GRPC首先满足二进制和跨语言这两条，二进制说明压缩效率高，跨语言说明更灵活。但是又是二进制，又是跨语言，这就相当于两个人沟通，你不但说方言，还说缩略语，人家怎么听懂呢？所以，最好双方弄一个协议约定文件，里面规定好双方沟通的专业术语，这样沟通就顺畅多了。
<div><strong>精选留言（20）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/d7/39/6698b6a9.jpg" width="30px"><span>Hector</span> 👍（24） 💬（1）<div>Envoy就是lstio的核心支持，越来越觉得kubernetes真的是集大成者，服务治理，面向未来的声明式API架构，资源调度与编排，网络的多种优秀方案。怪不得可以在极端的时间里力压docker</div>2019-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ae/e0/3e636955.jpg" width="30px"><span>李博越</span> 👍（1） 💬（2）<div>想问一下老师，GRPC是否支持client通过代理服务器访问到server端？官网上找了半天没有找到相关答案，我这边现在的场景需要经典网络的管控节点访问到vpc中的服务节点，由于vpc中服务节点太多，不可能打太多的洞，所以想在vpc中部署nginx服务作为代理服务器，转发经典网络发来的所有请求到server端</div>2019-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/60/f8/3f0ba76d.jpg" width="30px"><span>sam</span> 👍（93） 💬（0）<div>我觉得是极客目前最好的专栏</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/20/5d/69170b96.jpg" width="30px"><span>灰灰</span> 👍（43） 💬（0）<div>讲的太棒了，绝对是大师级人物。快结束了，意犹未尽，重新看一遍。</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg" width="30px"><span>悟空聊架构</span> 👍（37） 💬（0）<div>题目：在讲述 Service Mesh 的时候，我们说了，希望 Envoy 能够在服务不感知的情况下，将服务之间的调用全部代理了，你知道怎么做到这一点吗？
答：在Service Mesh模式中，每个服务都配备了一个代理sidecar（Envoy代理），用于服务之间的通信。这些代理通常与应用程序一起部署，代理不会被应用程序感知。这些代理组织起来形成服务网格。
Envoy是Service Mesh中一个非常优秀的sidecar的来源实现。</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c2/e0/7188aa0a.jpg" width="30px"><span>blackpiglet</span> 👍（6） 💬（0）<div>对思考题的解答
容器系统中，是通过 sidecar 模式来解决的，服务容器都是直接和 envoy sidecar 互通，envoy 的配置变化，网络拓扑的改变对服务容器都是不可感知的。service mesh 还更进一步的发展，istio 和 conduit，他们都是在 sidecar 基础上，又加了一个总的数据控制平面，来加强 service mesh 的掌控能力。</div>2018-08-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（6） 💬（0）<div>通过使用iptables程序配置内核中的netfilter，实现流量劫持转发，把指定入口流量都转发到envoy，出口流量也可以使用两样的方法实现</div>2018-08-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNxMqDoNODfL1aFpkJboxlZPyFANAt9ovzksYtMUIGo3KbHr4Qy8j20Txrpiau6iaJGgAr1nCfpy9w/132" width="30px"><span>爱学习的老吴</span> 👍（5） 💬（2）<div>老师，我有点搞不懂了，grpc用的是http2.0协议来传输的话，那它和普通的http服务有什么区别了吗？</div>2020-02-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/65/03/973b24ec.jpg" width="30px"><span>谢晋</span> 👍（5） 💬（0）<div>我觉得是极客目前最好的专栏
</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/07/40/04bee70c.jpg" width="30px"><span>jedi knight</span> 👍（5） 💬（2）<div>学java的应该可以跳过spring cloud了，感觉envoy + grpc + kubernetes是趋势</div>2018-08-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/12/b3/9e8f4b4f.jpg" width="30px"><span>MoFanDon</span> 👍（1） 💬（0）<div>已经完结这么久了，我才终于看到了这里。收获很多。感谢。</div>2018-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg" width="30px"><span>空档滑行</span> 👍（1） 💬（0）<div>其实也不是完全无感知，服务还是需要知道service mesh的存在，只是一般是sidebar方式的部署，每个服务只需要知道自己的enovy在哪里就可以了，所有网络交互通过它来转发</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/01/87/c45e7044.jpg" width="30px"><span>崔朝普🐳📡</span> 👍（1） 💬（0）<div>赞，干货满满</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg" width="30px"><span>LH</span> 👍（0） 💬（0）<div>envoy需要拦截所有进出服务的流量，可以通过配置iptable转发规则实现</div>2020-04-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg" width="30px"><span>大土豆</span> 👍（0） 💬（1）<div>dubbo没法跨语言，是因为内置了netty吗？Hessian2协议本身是语言无关的。所以grpc选择了http2.0，就是为了跨语言吗？</div>2020-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/de/3c/b1fe1f52.jpg" width="30px"><span>wsjx</span> 👍（0） 💬（0）<div>慢慢学</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg" width="30px"><span>DFighting</span> 👍（0） 💬（0）<div>问题中描述的“希望 Envoy 能够在服务不感知的情况下，将服务之间的调用全部代理了”不禁让我想起了网络中的路由器发现相关算法，参照Jay的评论，我想为每个服务配置一个代理(路由器)，组成服务网格(AS)，将RPC的相关操作独立成一层，让应用如TCP调用IP层般进行夸服务、语言的调用，以达到对应用层的透明。</div>2020-01-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg" width="30px"><span>skull</span> 👍（0） 💬（0）<div>刘超老师，问个问题，如果一个服务在容器中，一个服务在物理机上，怎么进行rpc通信，此时容器是可以调用物理机的，但是物理机是无法调用容器中的服务了，例如dubbo，获取到的是容器中的ip，物理机调用的时候，通过容器中的ip是无法调用到容器中的，这个有什么解决办法么</div>2018-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/57/04/07eb8cbb.jpg" width="30px"><span>hhq</span> 👍（0） 💬（0）<div>对grpc有了基本的认识，包括协议定义，传输封装等。</div>2018-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/17/f94e987f.jpg" width="30px"><span>Shawn.C</span> 👍（0） 💬（0）<div>服务的注册不感知是因为使用了容器平台的发现能力。服务自身不感知，是因为envoy 作为sidecar 的方式劫持了网络流量。</div>2018-08-09</li><br/>
</ul>