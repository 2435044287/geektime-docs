上一讲，我们讲解了时钟信号是怎么实现的，以及怎么利用这个时钟信号，来控制数据的读写，可以使得我们能把需要的数据“存储”下来。那么，这一讲，我们要让计算机“自动”跑起来。

通过一个时钟信号，我们可以实现计数器，这个会成为我们的PC寄存器。然后，我们还需要一个能够帮我们在内存里面寻找指定数据地址的译码器，以及解析读取到的机器指令的译码器。这样，我们就能把所有学习到的硬件组件串联起来，变成一个CPU，实现我们在计算机指令的执行部分的运行步骤。

## PC寄存器所需要的计数器

我们常说的PC寄存器，还有个名字叫程序计数器。下面我们就来看看，它为什么叫作程序计数器。

有了时钟信号，我们可以提供定时的输入；有了D型触发器，我们可以在时钟信号控制的时间点写入数据。我们把这两个功能组合起来，就可以实现一个自动的计数器了。

加法器的两个输入，一个始终设置成1，另外一个来自于一个D型触发器A。我们把加法器的输出结果，写到这个D型触发器A里面。于是，D型触发器里面的数据就会在固定的时钟信号为1的时候更新一次。

![](https://static001.geekbang.org/resource/image/1e/4c/1ed21092022057ed192a7d9aff76144c.jpg?wh=2242%2A1560)

这样，我们就有了一个每过一个时钟周期，就能固定自增1的自动计数器了。这个自动计数器，可以拿来当我们的PC寄存器。事实上，PC寄存器的这个PC，英文就是Program Counter，也就是**程序计数器**的意思。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/ab/98/6f29f4f2.jpg" width="30px"><span>小海海</span> 👍（32） 💬（1）<div>(手滑点了保存，接上条)无条件跳转意味着没有计算的逻辑，应该是可以不经过ALU的，但是要控制器把PC设置成跳转后的指令地址，不知我理解的对不对🤣</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ab/98/6f29f4f2.jpg" width="30px"><span>小海海</span> 👍（8） 💬（1）<div>@陈华应 我的理解无条件跳转就是goto，是没有比较结果的</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ba/01/5ce8ce0b.jpg" width="30px"><span>Leoorz</span> 👍（3） 💬（1）<div>老师，对于图1的PC计数器，有个疑问，如果图中的D触发器，是电平触发的，那CLK置1的时间段内，
触发器输出-&gt;加法器+1-&gt;触发器输出......    应该一直进行该循环计算并自增，只有当D触发器是 沿触发的，才会在时钟上升沿只加1次，不知道理解是否有误</div>2020-01-21</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/IPdZZXuHVMibwfZWmm7NiawzeEFGsaRoWjhuN99iaoj5amcRkiaOePo6rH1KJ3jictmNlic4OibkF4I20vOGfwDqcBxfA/132" width="30px"><span>鱼向北游</span> 👍（3） 💬（1）<div>应该是无条件跳转没有cmp吧</div>2019-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（2） 💬（3）<div>一个指令的执行想用多少个时钟周期都可以吗？</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg" width="30px"><span>南山</span> 👍（2） 💬（1）<div>无条件跳转不需要依赖于比较结果吗？</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/65/2b/446ef7b6.jpg" width="30px"><span>许先森</span> 👍（0） 💬（1）<div>老是您好有个问题：
文章说：cmp 指令的执行结果放到了条件码寄存器里面，我们的条件跳转指令也是在 ALU 层面执行的，而不是在控制器里面执行的。这样的实现方式在电路层面非常直观，我们不需要一个非常复杂的电路，就能实现 if…else 的功能。
但是else中是jmp指令，也就是无条件跳转，实际是不经过ALU的，而是控制器直接执行的。上文中所说是否有问题？</div>2020-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f6/04/def49489.jpg" width="30px"><span>姜海天</span> 👍（49） 💬（0）<div>强烈推荐一本书《自己动手写CPU》，使用这本书，再结合老师的课程，可以自己实现一个简单的CPU！这本书比较友好，是入门级书籍，理论+实战，能够更好地掌握计算机组成原理的理论知识~~</div>2020-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（20） 💬（0）<div>《编码：隐匿在计算机软硬件背后的语言》这本书这几天看完了，写得真是很不错。希望老师再多推荐一些好看的书。</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/28/2a/173ea0e1.jpg" width="30px"><span>张立昊Leon</span> 👍（8） 💬（4）<div>还记得当年数电考试分还挺高的，不知道有啥用。后面就直接学c++，嵌入式系统之类的课程，跳过了中间的计算机组成，操作系统之类的东西，万恶的电气系学科体系...嵌入式系统当时学得完全不知所云，也极大的损害了我对这些东西的兴趣，今天在这里总算补学了一些重要的东西啊</div>2019-07-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/0e/f5/c4a26e84.jpg" width="30px"><span>Im Robin</span> 👍（5） 💬（1）<div>老师你好，有一个问题很困惑，PC寄存器自动加1，我怎么感觉应该是自动加指令字节数啊，这样寄存器里才能存下一个指令的起始地址，如果PC寄存器里只是数值，那么程序如何从PC寄存器中取出指令地址呢，麻烦老师给予解答，谢谢</div>2019-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/cf/10/9fa2e5ba.jpg" width="30px"><span>进击的巨人</span> 👍（2） 💬（1）<div>表示看的云里雾里，一脸茫然</div>2020-11-29</li><br/><li><img src="" width="30px"><span>wei</span> 👍（2） 💬（0）<div>老师好，“加法器的两个输入，一个始终设置成 1，另外一个来自于一个 D 型触发器 A。我们把加法器的输出结果，写到这个 D 型触发器 A 里面。于是，D 型触发器里面的数据就会在固定的时钟信号为 1 的时候更新一次。” 这里我明白，为什么时钟信号为 1 的时候只会更新一次，而不是两次或更多次？</div>2019-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（2） 💬（0）<div>“怎样通过连接不同功能的电路，实现出一个完整的CPU” 讲的真好
day19 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11431367.html</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（2） 💬（1）<div>老师好，读取数据的那个寄存器就是。当前指令地址+指令长度。每次就能取到下一条指令了是吧?这里的内存地址都是虚存地址么?物理内存很容易就不连续吧。特别是那种动态申请内存的。还是说Java这样的编程语言，编译后的机器码就是在物理内存里顺序存储的?</div>2019-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f5/73/f7d3a996.jpg" width="30px"><span>！null</span> 👍（1） 💬（2）<div>没看懂2-1选择器的只有我一个吗？</div>2022-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg" width="30px"><span>慎独明强</span> 👍（1） 💬（0）<div>总结:我们的程序计数器pc寄存器，随着时钟周期的自增会去内存中通过地址译码器去拿到指令，指令会写入到指令寄存器，指令寄存器会通过译码器去解析opcode和操作数据，连接逻辑运算单元alu进行计算，alu会把计算结果最后写入内存，这样完成了一个指令周期。这一整个时钟周期太长，内存与cpu的速度相差太大，就把整个指令周期进行细分，再通过流水线和分支预测来操作指令的运行顺序性和提高性能。</div>2021-04-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f8/83/008b7b58.jpg" width="30px"><span>梨还羽</span> 👍（1） 💬（0）<div>请问有条件跳转是经过ALU读取条件寄存器发现满足条件后，由ALU去修改PC寄存器里的下一条指令地址吗？</div>2020-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/a0/a3/8da99bb0.jpg" width="30px"><span>业余爱好者</span> 👍（1） 💬（0）<div>流水线让我想起了大学时的一门选修课———项目管理</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg" width="30px"><span>djfhchdh</span> 👍（1） 💬（0）<div>因为无条件跳转不需要访问条件码寄存器，而且地址跳转就是一个直接寻址的过程，因此不需要通过运算器和ALU</div>2019-06-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>无条件跳转指令的本质是修改程序计数器（Program Counter, PC）的值，使其指向新的指令地址。这个过程不涉及算术或逻辑运算，因此不需要ALU的参与。</div>2024-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/96/a7/a9bfe8d3.jpg" width="30px"><span>漂泊者</span> 👍（0） 💬（0）<div>每次自增之后，我们可以去对应的 D 型触发器里面取值，这也是我们下一条需要运行指令的地址。
自增之后的获取的地址是连续的么，内存里一个程序的地址不是会按照4k对齐的方式分散么，随便读一个地址怎么保证是当前运行的程序</div>2024-01-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/96/a7/a9bfe8d3.jpg" width="30px"><span>漂泊者</span> 👍（0） 💬（0）<div>d触发器不是只能输出1和0么，怎么一直加</div>2024-01-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/96/a7/a9bfe8d3.jpg" width="30px"><span>漂泊者</span> 👍（0） 💬（0）<div>我们取出一条指令，然后执行它，至少需要两个 CPU 周期。一个 CPU 周期的时间，就是这几个 Clock Cycle 的总和。
一个时钟周期怎么执行完复杂指令，不是一条指令需要好多个时钟周期么</div>2024-01-22</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>控制器里面的指令译码器应该有个特殊的电路，如果是无条件跳转指令，直接将操作数写入PC计数器</div>2023-10-31</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ert8WynVde6etxoVLry5cKiaiaV5TkNv3fE9Xe33AvwULZJsIoZFzica2LiccfDB4ic4vfibWax14wfB7lA/132" width="30px"><span>woodie</span> 👍（0） 💬（0）<div>这3节内容有点难理解，特别是数字电路不熟悉的我，翻阅了一些其他的资料，了解了一些关于RS触发器、D触发器的构成。但对于我来说，学习这门课程的目的是了解计算机的工作原理，只需要知道时钟周期，CPU周期，指令周期，复合逻辑电路，时序逻辑电路，存储数据通过大量的D触发器构成，知道这些概念就可以了。</div>2022-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/d8/f8/a775cde7.jpg" width="30px"><span>太阳与冰</span> 👍（0） 💬（0）<div>各个过程中如果不使用单指令时钟周期的话，因为是在同一个流水线，会存在等待的问题么？比如计数器运行很快，但是内存fetch指令相对较慢，那这个时候计数器是不是要等待？</div>2022-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/3d/8b/47bcc851.jpg" width="30px"><span>何同一</span> 👍（0） 💬（0）<div>无条件跳转不需要进行计算，将数据地址信号输入地址译码器后可直接获得下一条指令。这一讲解决了我多年的疑惑，写的很好。</div>2022-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/50/01/5bc28ed8.jpg" width="30px"><span>black</span> 👍（0） 💬（1）<div>老师您好，有一点疑问：自动计数器加一要等当前指令执行完成，所以自动计时器的时钟信号周期要和指令周期保存一致，这样理解对吗？</div>2021-02-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg" width="30px"><span>骨汤鸡蛋面</span> 👍（0） 💬（0）<div>老师，问个小白问题哈：ALU中应该有很多组件，比如加法器、乘法器等，ALU是如何根据opcode触发&#47;选择加法器或乘法器来处理数据呢？</div>2021-02-05</li><br/>
</ul>