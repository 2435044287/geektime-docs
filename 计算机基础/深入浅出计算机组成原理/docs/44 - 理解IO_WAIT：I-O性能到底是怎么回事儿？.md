在专栏一开始的时候，我和你说过，在计算机组成原理这门课里面，很多设计的核心思路，都来源于性能。在前面讲解CPU的时候，相信你已经有了切身的感受了。

大部分程序员开发的都是应用系统。在开发应用系统的时候，我们遇到的性能瓶颈大部分都在I/O上。在[第36讲](https://time.geekbang.org/column/article/107447)讲解局部性原理的时候，我们一起看了通过把内存当作是缓存，来提升系统的整体性能。在[第37讲](https://time.geekbang.org/column/article/107477)讲解CPU Cache的时候，我们一起看了CPU Cache和主内存之间性能的巨大差异。

然而，我们知道，并不是所有问题都能靠利用内存或者CPU Cache做一层缓存来解决。特别是在这个“大数据”的时代。我们在硬盘上存储了越来越多的数据，一个MySQL数据库的单表有个几千万条记录，早已经不算是什么罕见现象了。这也就意味着，用内存当缓存，存储空间是不够用的。大部分时间，我们的请求还是要打到硬盘上。那么，这一讲我们就来看看硬盘I/O性能的事儿。

## IO性能、顺序访问和随机访问

如果去看硬盘厂商的性能报告，通常你会看到两个指标。一个是**响应时间**（Response Time），另一个叫作**数据传输率**（Data Transfer Rate）。没错，这个和我们在专栏的一开始讲的CPU的性能一样，前面那个就是响应时间，后面那个就是吞吐率了。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg" width="30px"><span>Joe Black</span> 👍（10） 💬（1）<div>请问下顺序IO在开发上是怎么实现的？比如对于C开发，就是以append only的方式打开一个文件直接写就行了？还是说有什么特别的控制指令？
我看挺多数据库软件写日志的时候用的都是所谓的AOF文件，说顺序写完日志再应用到库里，是不是也是同样的方式？</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg" width="30px"><span>88591</span> 👍（3） 💬（1）<div>老师，怎么能控制磁盘的顺序读写和随机读写，操作系统有什么api 吗。一直没有找到</div>2019-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（3） 💬（6）<div>pci-e 的ssd 磁盘iops 才20000。那云平台的云磁盘是不是更低了。</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（2） 💬（4）<div>老师你好，我在CENTOS下用Stress命令，IO_WAIT并没有上去，是什么原因？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（1） 💬（2）<div>老师你好，我有一台云主机，怎么样才能测出硬盘的性能，比如最大的IOPS？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/2a/54/c9990105.jpg" width="30px"><span>bro.</span> 👍（54） 💬（0）<div>4K-64Thrd是随机64队列深度测试，软件则会生成64个16MB大小的测试文件（共计1GB），然后同时以4KB的单位尺寸，同时在这64个文件中进行写入和读取测试，最后依然以平均成绩为结果!</div>2019-08-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132" width="30px"><span>有铭</span> 👍（23） 💬（5）<div>才注意到，硬盘的随机读的性能是不如随机写的。我以前一直以为是反过来的，但是为什么呢？按这个现象，原来硬盘类设备是“写多读少”的设计思路？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（7） 💬（4）<div>工作经常遇到IO_WAIT的案例 老师讲的正好可以用上
day44 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11363137.html</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（5） 💬（2）<div>top 中 %CPU的wa是实时CPU等待io占用百分比。若是要收集一段时间内的io耗时占比呢？比如一周</div>2020-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/63/85/9ccf1b19.jpg" width="30px"><span>草帽路飞</span> 👍（3） 💬（0）<div>您好，老师程序中如果直接写文件是顺序读写么？</div>2020-03-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a0/da/4f50f1b2.jpg" width="30px"><span>Knight²º¹⁸</span> 👍（2） 💬（3）<div>一直有个问题，在Linux的IO模型中无论是BIO、NIO、IO多路复用实际上在等待IO响应的时候用户线程基本上都是没干啥事的，要么是空跑要么是阻塞。这些个IO模型对应用程序来讲实际并没有提升单个线程的执行效率，那么些IO模型要解决的问题点在哪里，提升的是哪部分的性能？提升应用程序的吞吐量？</div>2019-08-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/gmP4Yh00MZPwNvr4UQdLeXaX3TVyZEEp195S3vD3Sfl1xz5jBr1474Mt6w5OPr0KsrnQObfLRy5PkKNFjSBiasA/132" width="30px"><span>大头爸爸</span> 👍（1） 💬（0）<div>&quot;我们在实际的应用开发当中，对于数据的访问，更多的是随机读写，而不是顺序读写。我们平时所说的服务器承受的“并发”&quot;
这个要看具体应用。对于视频，复制&#47;备份这样的应用主要就是顺序读写。对于数据库访问则主要是随机读写。</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/af/a6/3f15ba2f.jpg" width="30px"><span>czh</span> 👍（1） 💬（0）<div>重点：iostat iotop top三个命令 判断io等待原因</div>2019-11-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（1） 💬（0）<div>A server orientated measure of a drives ability to write 64 files in parallel.

4K 64 thread write speed is a measure of how well a device can write random 4K blocks of data at a queue depth of 64. General consumer computer disks rarely need to service more than one or two requests at a time making this measure particularly well suited to servers.

https:&#47;&#47;ssd.userbenchmark.com&#47;Faq&#47;What-is-4K-64-thread-write-speed&#47;59</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（1） 💬（1）<div>我实验的结果也是sy高，但是wa是0.0。不知道为什么</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>4K-Thrd（4K Thread）通常是指在执行I&#47;O操作时，使用多个线程同时对4K大小的数据进行读写操作的测试指标。这里的&quot;4K&quot;指的是数据块大小，通常是4KB（千字节），而&quot;Thrd&quot;是线程（Thread）的缩写。</div>2024-09-09</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>大数据文件系统通常都有WAL机制，而WAL是append方式，所以写入可以很快。而读取的话需要先找索引，再根据索引找到实际的数据，如果没有索引还需要全局扫描，所以反而慢</div>2024-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg" width="30px"><span>天王</span> 👍（0） 💬（0）<div>总结:后续 iops是根据传输速率除以数据块大小，计算得来</div>2022-08-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg" width="30px"><span>天王</span> 👍（0） 💬（0）<div>总结:硬盘的设计考虑两点，一个是吞吐量，一个是响应时间，围绕这两个指标，硬盘分hdd机械硬盘和ssd固态硬盘，hdd的最大速度是700多兆，支持c接口，而支持pci express接口的hdd最大能到2g&#47;s，这是顺序读写，随机读写的性能会差好多，有一个核心指标iops，也就是每秒写入和读取磁盘的次数。使用一些命令top，iostat可以看等待io时长和占用io的线程，做定位</div>2022-08-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ce/96/a0132d15.jpg" width="30px"><span>范超</span> 👍（0） 💬（0）<div>老师，IOPS中的请求次数，是读写请求都包括吗，还是只包括某一种请求的次数呢，我看您计算的时候是用的读请求的DTR来计算的</div>2022-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/89/50/aee9fdab.jpg" width="30px"><span>小杰</span> 👍（0） 💬（0）<div>64个文件，同时已4k的单位进行读写，计算平均结果</div>2022-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/3f/98/fbcd02e4.jpg" width="30px"><span>Tank</span> 👍（0） 💬（0）<div>CPU空闲并且等待I&#47;O操作完成的时间比例。</div>2021-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0f/ab/9748f40b.jpg" width="30px"><span>微秒</span> 👍（0） 💬（0）<div>现在的I&#47;O设备与CPU总线间是通过接口连接起来的，那两者必须都有接口电路吗？还是总的只要求一个接口就好了。</div>2020-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/76/95/86a5c281.jpg" width="30px"><span>re</span> 👍（0） 💬（0）<div>我想问下 这个iowait也就是wa占比 算不算在cpu真实占用率里面
</div>2020-04-06</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJwQvLGE4dMsF4JU0svW3DtGbodpjskbY65FdwF13JdtBYZfgL2IXHlHrdejWzHdjT0RibEIfib4QYA/132" width="30px"><span>知行合一</span> 👍（0） 💬（0）<div>牛逼</div>2020-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg" width="30px"><span>prader26</span> 👍（0） 💬（0）<div>计算机的cpu主频很好，所以很快。硬盘的吞吐率和响应时间比较小，所以性能主要卡在这里。
lunix 下 可以用，top  iostat  iotop  快速定位计算机的性能卡在哪个io进程。</div>2019-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（0） 💬（0）<div>那么 4K-Thrd 这个指标又是什么意思呢？测试这个指标对应的应用场景又是怎么样的呢？
这个指标是同时读写64个文件时的吞吐量，应用场景主要是服务器端需要处理大量并发请求。</div>2019-08-07</li><br/><li><img src="" width="30px"><span>haer</span> 👍（0） 💬（0）<div>关于 stress -i 2 命令
在VMware虚拟机中测试，99 sy，0.0 wa
在vps中测试，24.3 sy，73.1 wa
为什么会这样呢?</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（0）<div>我在本地虚拟机里面测试，iowait 没有升高。而是平均负载与sy 特别高。</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（1）<div>老师，stress 命令在centos 下有三个类似的包。是哪个呢？ stress-ng,http ress,</div>2019-08-07</li><br/>
</ul>