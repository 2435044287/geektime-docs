2012年的时候，我第一次在工作中，遇到一个因为硬件的不可靠性引发的Bug。正是因为这个Bug，让我开始逐步花很多的时间，去复习回顾整个计算机系统里面的底层知识。

当时，我正在MediaV带领一个20多人的团队，负责公司的广告数据和机器学习算法。其中有一部分工作，就是用Hadoop集群处理所有的数据和报表业务。当时我们的业务增长很快，所以会频繁地往Hadoop集群里面添置机器。2012年的时候，国内的云计算平台还不太成熟，所以我们都是自己采购硬件，放在托管的数据中心里面。

那个时候，我们的Hadoop集群服务器，在从100台服务器往1000台服务器走。我们觉得，像Dell这样品牌厂商的服务器太贵了，而且能够提供的硬件配置和我们的期望也有差异。于是，运维的同学开始和OEM厂商合作，自己定制服务器，批量采购硬盘、内存。

那个时候，大家都听过Google早期发展时，为了降低成本买了很多二手的硬件来降低成本，通过分布式的方式来保障系统的可靠性的办法。虽然我们还没有抠门到去买二手硬件，不过当时，我们选择购买了普通的机械硬盘，而不是企业级的、用在数据中心的机械硬盘；采购了普通的内存条，而不是带ECC纠错的服务器内存条，想着能省一点儿是一点儿。
<div><strong>精选留言（24）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132" width="30px"><span>有铭</span> 👍（49） 💬（4）<div>从老师的描述看单比特翻转问题的概率不低啊，但是大部分PC机都没有用ECC，为什么PC机很少听说有出现这个问题带来的bug？</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（21） 💬（1）<div>老师，发生单比特翻转，只是内存质量与外部射线的原因吗？那买内存的时候，能不能检测到这样的问题的内存。
ECC 目前只能在物理内存里实现吗，</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c6/f9/caf27bd3.jpg" width="30px"><span>大王叫我来巡山</span> 👍（17） 💬（1）<div>曾经一个批次的服务器上线后都就频繁出现这个问题，最终猜测是内存的问题，然后统一换了内存以后没有出现过。</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cf/96/251c0cee.jpg" width="30px"><span>xindoo</span> 👍（12） 💬（2）<div>之前好像看到过google大神jeff dean也处理过单bit翻转的故障</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（11） 💬（1）<div>为什么只会发生单比特翻转不会发生多个比特位的翻转呢</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg" width="30px"><span>阿卡牛</span> 👍（6） 💬（1）<div>最近在学网络分层方面的知识，看到检错码和纠错码的方法，没想到在这里也用上了</div>2019-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/44/0e/ce14b7d3.jpg" width="30px"><span>-_-|||</span> 👍（2） 💬（3）<div>&quot;定制的硬件没有使用 ECC 内存，在大量的数据中，内存中出现了单比特翻转（Single-Bit Flip）这个传说中的硬件错误&quot;,出现这个问题硬件厂商负责吗？还是后果都自负。</div>2020-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg" width="30px"><span>明翼</span> 👍（27） 💬（1）<div>这个bug牛逼了</div>2019-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg" width="30px"><span>88591</span> 👍（6） 💬（0）<div>计算机领域有太多的未知的未知知识。</div>2019-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（4） 💬（0）<div>不管多慢、都要坚持打卡、坚持写博文
day49天 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11498124.html</div>2019-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ce/96/a0132d15.jpg" width="30px"><span>范超</span> 👍（3） 💬（0）<div>奇偶校验这种方式，如果“校验码位”发生了翻转怎么办呢</div>2022-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/85/ed/905b052f.jpg" width="30px"><span>超超</span> 👍（2） 💬（0）<div>这一节讲述的服务器故障的内容与RAS特性密切相关，RAS的全称为 Reliability, Availability，Serviceability。
Reliability（可靠性）指的是系统必须尽可能的可靠，不会意外的崩溃，重启甚至导致系统物理损坏，这意味着一个具有可靠性的系统必须能够对于某些小的错误能够做到自修复，对于无法自修复的错误也尽可能进行隔离，保障系统其余部分正常运转。
Availability（可用性）指的是系统必须能够确保尽可能长时间工作而不下线，即使系统出现一些小的问题也不会影响整个系统的正常运行，在某些情况下甚至可以进行 Hot Plug 的操作，替换有问题的组件，从而严格的确保系统的宕机时间在一定范围内。
Serviceability 指的是系统能够提供便利的诊断功能，如系统日志，动态检测等手段方便管理人员进行系统诊断和维护操作，从而及早的发现错误并且修复错误。
RAS 作为一个整体，其作用在于确保整个系统尽可能长期可靠的运行而不下线，并且具备足够强大的容错机制。这对于像大型的数据中心，网络中心如股票证券交易所，电信机房，银行的数据库中心等应用环境是不可或缺的一部分。调研机构经过行业调查发现，不同的行业的关键业务中断会带来巨额的经济损失，下图是最新一期的调研报告，88%的企业每小时的服务器宕机会带来超过30万刀的损失，由此可见RAS的重要性以及对于可靠性需求的增长非常迅速。
服务器的每个部件都有着不同的RAS特性，CPU RAS，内存RAS和PCIe RAS。有兴趣的可以再查些资料。
参考资料：
https:&#47;&#47;zhuanlan.zhihu.com&#47;p&#47;340605298</div>2021-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/71/22/b8c596b6.jpg" width="30px"><span>风</span> 👍（2） 💬（0）<div>第一次听说单比特反转这个问题，果然还是见识少哈，如果我遇到了，估计挠破脑袋也想不到去查计算机组成原理的知识</div>2020-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg" width="30px"><span>西门吹牛</span> 👍（2） 💬（0）<div>通信里面信号传输的时候，也是这种处理方法，也有奇偶校验，基本方式都一样。数字电路信号传输，传输的就是bit。</div>2020-07-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg" width="30px"><span>prader26</span> 👍（2） 💬（0）<div>没想到内存里的数据在受到射线等外部数据的影响还会出错。幸好有ecc，期待下节课</div>2019-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/ec/09/2a4dce1a.jpg" width="30px"><span>我爱天上的云朵</span> 👍（1） 💬（0）<div>想起了被408支配的恐惧</div>2021-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/3d/a0/acf6b165.jpg" width="30px"><span>奋斗</span> 👍（1） 💬（0）<div>当时面试阿里时候，面试官问你写的网络库在进行数据传输时，某个bit位由于外界的影响，由0变成1，这种问题怎么去规避，没回答上来。最后发现传输层也有类似的CRC校验功能。</div>2021-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/d2/0f/8f14c85b.jpg" width="30px"><span>红薯板栗</span> 👍（1） 💬（0）<div>串口传输的时候奇偶校验位原来这么重要，以前很信任硬件，学了课程之后，硬件一样会出现BUG</div>2021-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（1） 💬（0）<div>期待老师下一讲的内容。</div>2019-08-21</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>ECC在可靠性技术里面属于空间冗余，即通过增加数据占用的空间来保障可靠性。还有一种叫时间冗余，即通过重试等措施来保障成功访问数据。这两个可靠性设计思想就如同性能优化的不二定律：时间换空间，空间换时间</div>2024-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/6d/8b417c84.jpg" width="30px"><span>Wheat Liu</span> 👍（0） 💬（0）<div>老师的专栏可以当作科普，趣味性十足非常有意思，很愿意看</div>2021-01-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/15/9c/575cca94.jpg" width="30px"><span>LearnAndTry</span> 👍（0） 💬（0）<div>这才是多么痛的领悟，老师一定记得刻骨铭心</div>2020-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a2/b5/4dc0c109.jpg" width="30px"><span>Cyril</span> 👍（0） 💬（0）<div>打卡，坚持学习。</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（0） 💬（0）<div>学习了：打卡，坚持学习。</div>2019-08-21</li><br/>
</ul>