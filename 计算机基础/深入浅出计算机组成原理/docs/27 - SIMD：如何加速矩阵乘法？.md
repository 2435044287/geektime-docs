上一讲里呢，我进一步为你讲解了CPU里的“黑科技”，分别是超标量（Superscalar）技术和超长指令字（VLIW）技术。

超标量（Superscalar）技术能够让取指令以及指令译码也并行进行；在编译的过程，超长指令字（VLIW）技术可以搞定指令先后的依赖关系，使得一次可以取一个指令包。

不过，CPU里的各种神奇的优化我们还远远没有说完。这一讲里，我就带你一起来看看，专栏里最后两个提升CPU性能的架构设计。它们分别是，你应该常常听说过的**超线程**（Hyper-Threading）技术，以及可能没有那么熟悉的**单指令多数据流**（SIMD）技术。

## 超线程：Intel多卖给你的那一倍CPU

不知道你是不是还记得，在[第21讲](https://time.geekbang.org/column/article/100554)，我给你介绍了Intel是怎么在Pentium 4处理器上遭遇重大失败的。如果不太记得的话，你可以回过头去回顾一下。

那时我和你说过，Pentium 4失败的一个重要原因，就是它的CPU的流水线级数太深了。早期的Pentium 4的流水线深度高达20级，而后期的代号为Prescott的Pentium 4的流水线级数，更是到了31级。超长的流水线，使得之前我们讲的很多解决“冒险”、提升并发的方案都用不上。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg" width="30px"><span>任鹏斌</span> 👍（10） 💬（2）<div>java有办法使用到SIMD指令集吗？</div>2019-12-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9b/2e/7c749c3f.jpg" width="30px"><span>Jason</span> 👍（8） 💬（1）<div>前几天研究AVX指令集，发现gcc和icc都是可以自动进行向量化优化的，自己编写向量化程序获得的性能提升远不如编译器的自动优化</div>2020-02-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/19/ee/e395a35e.jpg" width="30px"><span>小先生</span> 👍（3） 💬（1）<div>我的理解是分别从线程和代码角度来避免冒险的可能，从而提高效率，不知道这样的理解是否正确</div>2019-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ec/2a/b11d5ad8.jpg" width="30px"><span>曾经瘦过</span> 👍（31） 💬（1）<div>超线程技术是伪装成2个核心，在期中一个“线程”需要等待的时候去执行另一个“线程”，因此比较适合并发大量IO的操作</div>2019-10-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/ea/05/9976b871.jpg" width="30px"><span>westfall</span> 👍（24） 💬（2）<div>那我们平时写的程序怎么直接使用SIMD指令呢？</div>2019-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg" width="30px"><span>拯救地球好累</span> 👍（18） 💬（0）<div>---总结---
为了提高没有依赖关系的指令间的并行性，引入了超线程技术。
超线程技术：在硬件层面为每个线程设立单独的PC寄存器、指令寄存器、条件码寄存器等线程相关硬件，从而让一个CPU物理核心中有多个逻辑核心的目的。这样当一个线程在流水线中停顿时，另一个线程就可以去执行指令。
从超线程技术中可以看到，软件层面概念的提出也会影响到硬件层面的设计，而结合硬件条件也能更好地指导软件设计。
为了针对可向量化的计算提供进一步的优化，引入了SIMD。
SIMD：利用单个指令读取并操作多个数据流的方式加大并行化程度。</div>2019-10-27</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132" width="30px"><span>易儿易</span> 👍（8） 💬（1）<div>终于知道为什么挖矿烧显卡啦～</div>2019-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（5） 💬（0）<div>原来假cpu核就是用超线程技术实现的，假核数会是真核数的2倍，为什么不是3倍呢，原来它的造假的目的是为了填补流水线暂停的浪费，本来需要替补的地方就很少，容不下太多的线程空间，况且超线程只适合那种频繁访问磁盘，或经常待机的等待输入的程序，只有这些要比较长时间等待的指令才能发挥超线程的效果。

使用simd的前提是cpu支持mmx指令集，它的工作原理是cpu里有一组多个bit位的寄存器来存放一次读到的多条数据，然后对它们进行并行。</div>2020-07-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXNhbTULKiakib8lYXrvGF2zPwfedooBzC2EtSv1nt1MwV1KUvTkcJrvCBFvcdwJicnr3OEXnk9GUCg/132" width="30px"><span>WENMURAN</span> 👍（4） 💬（0）<div>加速矩阵乘法:
超线程:超线程CPU其实就是把一个月物理层面的CPU核心，伪装成两个逻辑层面的CPU核心。在硬件层面增加一部分指令，在内部维持两个指令的状态信息。比如有两个PC寄存器，指令寄存器和条件吗寄存器，这样就可以维护两条并行的指令。但事实上并不是真的运行两条指令，只是在一条指令停顿的时候运行另一条指令。
SIMD单指令多数据流:区别于单指令单数据流（简单的一步一步执行）和多指令多数据流（多核运行）。而SIMD为什么快，是因为他在取指令和执行指令的阶段都做到了并行</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg" width="30px"><span>prader26</span> 👍（4） 💬（0）<div>1 超线程技术是在cpu中添加逻辑电路，使一个cpu核心伪装成2个或者多个cpu核心，在这个线程，需要等待的时候，cpu去计算别的线程需要计算的部分，这两个线程都在执行过程中，都没有停下。
2 SIMD（单线程多数据流）技术，是一种指令级的并行计算。一次从寄存器中取多个数据，如果这些数据的计算没有依赖关系可以同时并发计算，应用场景较多的是向量运算，也就是音频、视频技术，还有深度学习的计算等。</div>2019-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg" width="30px"><span>TKbook</span> 👍（3） 💬（3）<div>老师超线程，是不是有点像python的协程？</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/98/45/318ba48a.jpg" width="30px"><span>pebble</span> 👍（3） 💬（1）<div>MMX指令是多媒体扩展指令吧，最早是为多媒体引入的</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（2） 💬（4）<div>在量化交易分析NumPy是用到过、只知道它快、但确不知道NumPy为什么这么快？今天终于知道底层的实现原理了

day27 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11442013.html</div>2019-09-01</li><br/><li><img src="" width="30px"><span>Geek_29981e</span> 👍（2） 💬（0）<div>数据库应用，io读写应用，多线程应用的生产者和消费者主动挂起和唤醒的应用</div>2019-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/a4/9c/b32ed9e9.jpg" width="30px"><span>陆离</span> 👍（2） 💬（2）<div>老师这个从超线程技术是不是可以和各种语言中的多线程概念联系起来？
看起来像是多个线程在运行，其实这是当流水线停顿的时候执行另一个线程的指令，这个是经常说的时间片是什么关系？
那线程的阻塞，唤醒操作又是如何实现的呢？</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/45/e4314bc6.jpg" width="30px"><span>magicnum</span> 👍（2） 💬（0）<div>I&#47;O密集型单不是CPU密集型的场景下超线程效率高。数据库连接池、定制线程池处理I&#47;O读写</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/bd/27/e653a220.jpg" width="30px"><span>Xiaosong</span> 👍（1） 💬（0）<div> 所以AMD用的是不同的指令集吗</div>2022-04-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/fd/08/c039f840.jpg" width="30px"><span>小鳄鱼</span> 👍（1） 💬（1）<div>超线程技术不会发生线程饥渴吗？一个一直占用着CPU，另一个一直得不到执行？这怎么解决？</div>2022-03-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/19/dc/9d3ed421.jpg" width="30px"><span>monchickey</span> 👍（1） 💬（0）<div>现在终于明白了在多个逻辑核心上并行使用指令集为什么不能提高性能了，因为ALU不够用，流水线还是需要等待，在每个物理核心上是可以的，基础太重要了，感谢老师~</div>2021-03-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ZHw73tgCqGKhvticUWGRz4icgicu4hFWfKtacoFJeItH7maNuNUmjnEgDTJvOibwUWgGV0p6guNPibMVWDV4BUmEmlA/132" width="30px"><span>Ethan</span> 👍（1） 💬（0）<div>”为什么 SIMD 指令能快那么多呢？这是因为，SIMD 在获取数据和执行指令的时候，都做到了并行。一方面，在从内存里面读取数据的时候，SIMD 是一次性读取多个数据。“ 老师，这句话越看怎么越想超标量或者超长指令字设计啊？现在有点梦了，希望老师解答一下这SIMD跟上一讲的两个技术有什么区别</div>2020-08-04</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL1BLgfPicBbSkV2qH7pBTjeIQBtBrTyhPrDRIh79YKRiccC8ibdeMn4L9JHnf2HUzgUWg3r6udHJlMg/132" width="30px"><span>GeekVoyager</span> 👍（1） 💬（0）<div>这讲质量狠可以啊 现在从事GPU行业 不知道系统框架需要看哪些内容啊？</div>2019-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>超线程（Hyper-Threading）技术，也称为同时多线程（Simultaneous Multi-Threading, SMT），在以下应用场景下通常能够发挥最高效的作用：

多任务处理：当运行多个任务或应用程序时，超线程可以提高多任务处理的效率。在这种情况下，CPU可以同时处理来自不同任务或应用程序的线程，从而提高整体系统的响应性和吞吐量。
桌面和服务器操作系统：在桌面和服务器操作系统中，超线程可以提升用户体验和系统性能，尤其是在运行多个并发应用程序和服务时。
虚拟化环境：在虚拟化环境中，超线程可以提升虚拟机的性能。每个虚拟机可以运行多个线程，超线程技术可以帮助虚拟化层更有效地利用物理CPU资源。
多线程应用程序：对于设计良好的多线程应用程序，超线程可以显著提高性能。这些应用程序通常是并行化的，能够有效地利用多个线程来执行任务。
科学和工程计算：在科学和工程计算领域，许多应用程序都是高度并行化的。超线程可以加速这些应用程序的执行，尤其是在进行大量数值计算和模拟时。
数据库服务器：数据库服务器在处理多个并发查询时，超线程可以帮助提高查询处理速度和系统吞吐量。</div>2024-08-27</li><br/><li><img src="" width="30px"><span>！巴甫洛夫的狗</span> 👍（0） 💬（0）<div>SIMD技术是一种利用单指令多数据流的并行计算方案，能够显著提高CPU的计算效率。本文首先介绍了超线程技术，讲一个物理CPU核心伪装成两个逻辑CPU核心，实现指令的并行运算。然后详细解释了SIMD技术的原理和应用，通过对比循环计算和向量化计算的性能差异，阐述了SIMD技术的优势。</div>2024-03-22</li><br/><li><img src="" width="30px"><span>！巴甫洛夫的狗</span> 👍（0） 💬（0）<div>超线程技术在多线程应用场景下最高效，例如在服务器上运行多个应用程序，或者在客户端上同时运行多个应用程序，可以提高系统的并发性能和响应速度。在以下应用场景下，超线程技术可以发挥最大的优势:1.服务器应用程序: 服务器通常需要同时运行多个应用程序，例如 Web 服务器、数据库服务器、邮件服务器等，超线程技术可以提高系统的并发性能，使服务器能够更快地处理多个应用程序的请求。2.网络应用程序: 网络应用程序通常需要同时处理多个网络请求，例如 Web 浏览器、网络游戏等，超线程技术可以提高系统的并发性能，使应用程序能够更快地响应用户的请求。3.数据库应用程序: 数据库应用程序通常需要同时处理多个查询和更新，超线程技术可以提高系统的并发性能，使应用程序能够更快地处理多个查询和更新。4.游戏应用程序: 游戏应用程序通常需要同时处理多个游戏画面和游戏逻辑，超线程技术可以提高系统的并发性能，使应用程序能够更快地处理多个游戏画面和游戏逻辑。总之，超线程技术在多线程应用场景下最高效，可以提高系统的并发性能和响应速度，使应用程序能够更快地处理多个任务。</div>2024-03-22</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>1.超线程的 CPU，其实是把一个物理层面 CPU 核心，“伪装”成两个逻辑层面的 CPU 核心。这个 CPU，会在硬件层面增加很多电路，使得我们可以在一个 CPU 核心内部，维护两个不同线程的指令的状态信息。
    2.CPU的性能优化措施有:流水线，解决数据冒险、结构冒险、控制冒险的措施，超标量与多发射，超线程，SIMD</div>2023-11-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/75/35/a0c15ca8.jpg" width="30px"><span>一頭蠻牛</span> 👍（0） 💬（0）<div>老师 SIMD在电路层面上是怎么处理的</div>2022-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/39/72d81605.jpg" width="30px"><span>大尾巴老猫</span> 👍（0） 💬（0）<div>声霸卡，影霸卡...暴露年龄了</div>2021-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/75/f0/2c65887d.jpg" width="30px"><span>活着即是修行</span> 👍（0） 💬（0）<div>图像吧。我之前在做计算机视觉，图像都以矩阵的方式存储，所以这种并行计算的方式可以快速计算，也就是gpu的用处了</div>2021-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/d3/a9/2b84cc97.jpg" width="30px"><span>乡村爱情代言人-刘能</span> 👍（0） 💬（2）<div>26章 如何让CPU的吞吐率超过1 介绍了多个译码器 在这章的超线程中为啥每个cpu只有一个译码器</div>2021-08-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f9/5f/b0a125a9.jpg" width="30px"><span>chp</span> 👍（0） 💬（0）<div>这讲很不错，学到了很多。</div>2021-07-06</li><br/>
</ul>