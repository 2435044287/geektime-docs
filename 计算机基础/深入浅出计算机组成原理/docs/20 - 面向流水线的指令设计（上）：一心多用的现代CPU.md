前面我们用了三讲，用一个个的电路组合，制作出了一个完整功能的CPU。这里面一下子给你引入了三个“周期”的概念，分别是指令周期、机器周期（或者CPU周期）以及时钟周期。

你可能会有点摸不着头脑了，为什么小小一个CPU，有那么多的周期（Cycle）呢？我们在专栏一开始，不是把CPU的性能定义得非常清楚了吗？我们说程序的性能，是由三个因素相乘来衡量的，我们还专门说过“指令数×CPI×时钟周期”这个公式。这里面和周期相关的只有一个时钟周期，也就是我们CPU的主频倒数。当时讲的时候我们说，一个CPU的时钟周期可以认为是可以完成一条最简单的计算机指令的时间。

那么，为什么我们在构造CPU的时候，一下子出来了那么多个周期呢？这一讲，我就来为你说道说道，带你更深入地看看现代CPU是怎么一回事儿。

## 愿得一心人，白首不相离：单指令周期处理器

学过前面三讲，你现在应该知道，一条CPU指令的执行，是由“取得指令（Fetch）-指令译码（Decode）-执行指令（Execute） ”这样三个步骤组成的。这个执行过程，至少需要花费一个时钟周期。因为在取指令的时候，我们需要通过时钟周期的信号，来决定计数器的自增。

那么，很自然地，我们希望能确保让这样一整条指令的执行，在一个时钟周期内完成。这样，我们一个时钟周期可以执行一条指令，CPI也就是1，看起来就比执行一条指令需要多个时钟周期性能要好。采用这种设计思路的处理器，就叫作单指令周期处理器（Single Cycle Processor），也就是在一个时钟周期内，处理器正好能处理一条指令。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLcWH3mSPmhjrs1aGL4b3TqI7xDqWWibM4nYFrRlp0z7FNSWaJz0mqovrgIA7ibmrPt8zRScSfRaqQ/132" width="30px"><span>易儿易</span> 👍（63） 💬（1）<div>一个 CPU 的时钟周期，可以认为是完成一条简单指令的时间。
两个错误：
1简单：不是简单是复杂（耗时最长）
2指令：不是指令时间，而是指令拆分后线级执行时间
简单线级需要等待以补齐时间然后与上下流水线一起牵手步入下一线级
线级分的多的话，这个时钟周期应该就可以固定是IF取指令的时间了
如果把IF取指令看做是最简单的指令的话，这句话就没毛病了
但一般说指令应该是指令集的一个命令吧？
但是指令集是提供给开发者视角的，在CPU内部IF取指令才是一个原子化操作，从CPU视角来看又觉得这句话是靠谱的……
</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/eb/19/19e706a5.jpg" width="30px"><span>cc</span> 👍（48） 💬（1）<div>随着流水线设计的引入，一个指令被拆分为14个子流程。一个CPU的时钟时间，应该是14个子流程中最长的那条的耗时时间</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/22/d7/db041954.jpg" width="30px"><span>haoly1989</span> 👍（24） 💬（3）<div>如果从单条指令的执行来看，这句话显然是错的，因为即使最简单的无条件跳转指令都至少需要3个时钟周期；
在了解CPU的流水线设计之后，这句话从吞吐率的角度来讲，是正确的：以5级流水线为例，当过了5个时钟周期后，可以保证每个时钟周期都有一条指令执行完成，即实现了一个CPU的时钟周期；由于取指阶段肯定是所有5个阶段里耗时最长的，即一个CPU的时钟周期可以设置为取指阶段的花费时间；

注意，这里的5个时钟周期后，才有这种现象，意味着即使引入了流水线操作，这5个时钟周期的开销也是不可避免的，突然想到了之前讲到的Amdahl定律</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/cb/9d/2bc85843.jpg" width="30px"><span>　　　　　　　鸟人</span> 👍（14） 💬（1）<div>这个不知道跟多线程 多进程是否有关系？</div>2019-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/13/9d/d91dc762.jpg" width="30px"><span>喜欢吃鱼</span> 👍（6） 💬（1）<div>每个流水线级的执行时间应该不一定相同吧，所以一个CPU执行周期是不是执行时间最久的流水线级所需要的时间？</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg" width="30px"><span>Only now</span> 👍（5） 💬（1）<div>一个 CPU 的时钟周期，可以认为是完成一条简单指令的时间。 这个应该是依据于吞吐量来理解的吧。
实际指令不能在一个时钟周期完成, 但是流水线的引入使吞吐量更高。</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg" width="30px"><span>斐波那契</span> 👍（4） 💬（1）<div>这句话不正确
哪怕再简单的指令都要经过划分好的阶段。首先我们要明确那几个周期的概念 所谓时钟周期(或叫做震荡周期)是指cpu一次晶体震动的时间 是计算机最小的时间单位 就拿我们补码来说 取反加1 这实际上就至少需要2个脉冲也就是两个时钟周期了 对于一条指令来说我们把执行过程划分成好几个阶段(具体几个由厂商工艺设计决定) 每个阶段的时间就是一个机器周期 所以一般情况下执行一条指令的时间是由多个机器周期决定的而一个机器周期又由多个时钟周期决定的 这样一条流水线就是由最多时钟周期的机器周期时间决定的 显然一个时钟周期执行不完一条指令</div>2019-06-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKiaqmp1PKvQCpDSK7953IEUHZ13uLgos97FwcYCqGrxMKs4arCZmZibSBoBrw6ibHp53jZ19haqw3fA/132" width="30px"><span>softpower2018</span> 👍（3） 💬（1）<div>引入了流水线技术，一个时钟周期执行一条简单指令应该完全没问题吧！期待多指令并行执行带来的问题及其解决！</div>2019-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg" width="30px"><span>南山</span> 👍（1） 💬（1）<div>     无条件跳转这样的简单指令三个流水级应该可以在一个时钟周期完成，换句话说就是一个指令在一个时钟周期完成。但是稍微复杂的指令往往是超过一个时钟周期的。
    这里有一点疑惑:在流水线设计的CPU中，一个时钟周期只会执行一个流水级吗？对于很简单的流水级，可能执行时间只占时钟周期的一半，那另一半就是什么也不干吗？</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（0） 💬（1）<div>老师的比喻使我们理解起来非常容易、给老师点赞
day20 笔记：https:&#47;&#47;www.cnblogs.com&#47;luoahong&#47;p&#47;11434290.html</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（40） 💬（2）<div>1.高度的专业化分工，可以极大的提高生产效率。
《国富论》中亚当斯密提到一个扣针工场的例子：一个工人无论如何努力，一天也生产不了20枚扣针，但有了分工之后，经过前后十几道工序，每人每天平均可以生产48000枚扣针。
这可以从经济学上，解释为什么会有流水线
2.边际效益递减 
新增一个单位的商品或服务，它对商品或服务的收益增加的效用，经济学通常认为，随着商品或服务的量增加，边际效用将会逐步减少。
这可以从经济学上，解释为什么流水线级数不可以无限增加，而有个界限。
</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/cd/2c513481.jpg" width="30px"><span>瀚海星尘</span> 👍（9） 💬（0）<div>各种工程都充满了权衡~</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/0c/a5/0bbfd5e7.jpg" width="30px"><span>Tiger</span> 👍（2） 💬（1）<div>老师，请问为什么访存会在执行阶段之后，不应该是先访存取出数据，再进行ALU运算，最后再将数据写回吗？</div>2021-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（2） 💬（0）<div>老师好!我又两个问题。
指令分级以后同样会存在一个问题啊，每一级执行时间不一样。这样一个指令周期需要时最长的那个级的时间么?还有就是每条指令的级数一样么?如果一个时钟周期就是一级的时间，那么执行时间长的指令的级数就多了吧。再就是指令分级这个需要考虑原子性这种么?还是随便分分?</div>2019-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg" width="30px"><span>Ronnyz</span> 👍（1） 💬（0）<div>一个CPU时钟周期在指令流水中取决于指令拆分后最长的子阶段时间长度</div>2019-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg" width="30px"><span>曾轼麟</span> 👍（1） 💬（0）<div>刚刚老师提到为什么流水线级数不能太高，其实在if else有一个分支预测的技术，如果级数太高预测错误，导致清空后续的流水线重新拉取指令的代价也是很高的</div>2019-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>一个 CPU 的时钟周期，最合理应当是一个最复杂的流水线级的操作所需耗时</div>2024-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/96/a7/a9bfe8d3.jpg" width="30px"><span>漂泊者</span> 👍（0） 💬（0）<div>如果我们有一个开发团队，我们不会让后端工程师开发完 API 之后，就歇着等待前台 App 的开发、测试乃至发布，而是会在客户端 App 开发的同时，着手下一个需求的后端 API 开发。那么，同样的思路我们可以一样应用在 CPU 执行指令的过程中。
等着不行么，休息休息</div>2024-01-26</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>将一个复杂的流程拆分成不同的阶段，不同的阶段就可以并行执行形成流水线，提升吞吐量</div>2023-11-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/17/f3/5768c0ec.jpg" width="30px"><span>大凡人</span> 👍（0） 💬（0）<div>一个指令没处理完，就会交给下一个流水线去处理,直到完成，流水线的深度需要确保最复杂的指令可以完成</div>2023-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9a/ab/fd201314.jpg" width="30px"><span>小耿</span> 👍（0） 💬（0）<div>老师有一个问题：有没有可能下一条指令需要上一条指令的执行结果？如果像现在这样多条流水线并行执行，不也会出现前一条指令结果未写入，下一条指令已经开始读取的错误么？</div>2022-07-19</li><br/><li><img src="" width="30px"><span>15314496295</span> 👍（0） 💬（0）<div>这个就是微指令吧</div>2022-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/75/f0/2c65887d.jpg" width="30px"><span>活着即是修行</span> 👍（0） 💬（0）<div>一个CPU的时钟周期，应该是流水线中多个过程的最长部分的执行过程。
因为我们在cpu改进的过程中，原来是一个时钟周期执行一条指令。后来我们为了高效利用cpu的多线程，同时避免一条指令过于复杂的情况，我们采取了流水线。流水线中的每个部分使用一个时钟周期，所以时钟周期应该是流水线中耗时最长的部分的时间（因为要保证所有部分都能在时钟周期内完成。否则，若读的时钟周期还没有执行完，就切换到写的时钟周期，就发生错误了）</div>2021-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/4b/50/fae00aff.jpg" width="30px"><span>HollyWong</span> 👍（0） 💬（0）<div>改成指令操作更合适些。</div>2021-11-06</li><br/><li><img src="" width="30px"><span>K菌无惨</span> 👍（0） 💬（0）<div>话说这个级数和cpu的并发度有关系吗？</div>2021-10-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/c9/55/0e627a31.jpg" width="30px"><span>菽绣</span> 👍（0） 💬（0）<div>一个流水线级为什么必须得在一个时钟周期内完成</div>2021-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/ea/a9/0a917f2c.jpg" width="30px"><span>Sunny</span> 👍（0） 💬（0）<div>“单条指令执行的延时”是啥意思？</div>2020-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/62/1f/cd1cbdb1.jpg" width="30px"><span>晓冰</span> 👍（0） 💬（0）<div>一个 CPU 的时钟周期，可以认为是完成一条简单指令的时间，我觉得这样说问题也不大，对于单指令处理器来说，首先是简单指令，那么一个时钟周期能执行完，那么复杂指令就要区别对待，他耗时肯定会长，所以这也是cpu最大是多少GHz的原因吧。流水线式的应该是完成一个指令的一个阶段花费的时间，这是我的理解。</div>2020-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ff/3f/bbb8a88c.jpg" width="30px"><span>徐凯</span> 👍（0） 💬（0）<div>你好  我想问下 在业务上用了流水线的方式去对一条消息进行了三步处理  当整个流水线处于流动状态时，每过&quot;一段时间&quot;会有一条消息被处理完成，而这段时间指的是三步处理中最耗时的那一步所花费的时间对吧</div>2020-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（0） 💬（0）<div>Cpu处理一条指令，包括读指令，指令译码和执行指令这三步操作，读指令阶段需要时钟信号来完成PC寄存器的自增，以及在译码和执行阶段完成写寄存器操作，这就需要每条指令的指令周期要足够长，让每条指令都能执行完，否则，后一条指令开始了前一条指令还没结束，会破坏寄存器数据。这就要求指令周期以最长一条指令为基准，但这样会导致很多的浪费，有些指令如无条件跳转指令在译码器就已经退出了，然后就是一段时间的等待，而且加法指令的处理速度比浮点数乘法指令要快的多。

为此，cpu引入流水线的概念，把一条指令拆分成多个阶段，每个阶段对应一个流水线级，这样一来，只要保证一个流水线的指令能在一个时钟周期下完成即可。</div>2020-06-27</li><br/>
</ul>