今天是原理篇的最后一篇。过去50讲，我们一起看了抽象概念上的计算机指令，看了这些指令怎么拆解成一个个简单的电路，以及CPU是怎么通过一个一个的电路组成的。我们还一起看了高速缓存、内存、SSD硬盘和机械硬盘，以及这些组件又是怎么通过总线和CPU连在一起相互通信的。

把计算机这一系列组件组合起来，我们就拿到了一台完整的计算机。现在我们每天在用的个人PC、智能手机，乃至云上的服务器，都是这样一台计算机。

但是，一台计算机在数据中心里是不够的。因为如果只有一台计算机，我们会遇到三个核心问题。第一个核心问题，叫作**垂直扩展和水平扩展的选择问题**，第二问题叫作**如何保持高可用性**（High Availability），第三个问题叫作**一致性问题**（Consistency）。

围绕这三个问题，其实就是我们今天要讲的主题，分布式计算。当然，短短的一讲肯定讲不完这么大一个主题。分布式计算拿出来单开一门专栏也绰绰有余。我们今天这一讲的目标，是让你能理解水平扩展、高可用性这两个核心问题。对于分布式系统带来的一致性问题，我们会留在我们的实战篇里面，再用案例来为大家分析。

## 从硬件升级到水平扩展

从技术开发的角度来讲，想要在2019年创业真的很幸福。只要在AWS或者阿里云这样的云服务上注册一个账号，一个月花上一两百块钱，你就可以有一台在数据中心里面的服务器了。而且这台服务器，可以直接提供给世界各国人民访问。如果你想要做海外市场，你可以把这个服务器放在美国、欧洲、东南亚，任何一个你想要去的市场的数据中心里，然后把自己的网站部署在这台服务器里面就可以了。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（39） 💬（3）<div>这一讲讲的东西都是我工作中用得，但是让我给比人讲我无法达到老师这样的清晰，下面分享一下关于负载均衡的形象比喻“
、什么是负载均衡？

　　你上班的时候有经理、经理自己不干活，一有活就分给下面的人

2、什么是负载？

　　就是每个干活的职员

3、什么是均衡？

　　他们不能让：有的人太忙有的太闲

4、什么是最小连接数？

　　有的活：5个5分钟干完，有的活1个活需要1天才能干完
　　别看人家，那活干了一天，人家拿活就是需要干一天。

5、什么是加权轮询？

　　年轻：干活干的快那的工资高
　　岁数大的：干活干的少，工资也低
　　男的和女的按照不同的权重分配

6、哈希的算法的原理？

　　你在超市的干活洗发水都是你干
　　每次来活经理就会把活分配给你因为你有经验
　　摆干货的就摆不了洗发水

7、负载均衡算法的分类？

　　静态算法：不需要看你干什么
　　动态算法：不停的看每个人都在干什么

8、负载均衡是一个什么样的设备？

　　经理就是单点故障，经理生病了？经理休假了咋办,这些活咋办?
　　要是静态算法谁都能分活
　　要是动态就需要再招一个副经理
”</div>2019-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1a/8a/ae50ecbb.jpg" width="30px"><span>幻月剑</span> 👍（18） 💬（1）<div>原来还有保持可用性的原因，以前一直只觉得分布式是用来增加性能的</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（10） 💬（2）<div>	今天的课程提到一块东西是我一直在思考的：分布式系统的消息队列；系统当下用了大量的云服务器，各大云厂商其实都做了各种HA；
至于云厂商的HA相信老师应当非常了解这块策略，我就不多做分享；谈一下自己对于这节课的收获和理解供探讨吧。
	关于负载均衡和消息队列：其实是我目前一直困惑的两块知识
	1）负载均衡：之前许老师的架构课里面有从架构层解释过，可是我觉得老师换了角度去讲解-从硬件层和硬件实现模式补充了许老师的课程；两位老师的课程其实结合起来就完全解释清楚了这块；
	2）消息队列：其实牵涉的知识众多：现实工作中的MQ用的不太合适，因为数据库压力这块分担的不太好；
	通过对数据库性能做了一系列优化短期内暂无明显压力，获得了一段缓冲时间；故而学习了《消息队列高手》这门课，学习中发现了部分问题其实源自操作系统为此还特意在刘老师提及消息队列的课程咨询了，但是总觉得有些地方还是不太明白，今天老师的课程中刚好有分布式系统的消息队列-对于系统层的问题又做了补充，结合今天老师的课大致上可以消息队列的问题。可能就像刘老师的课程所说：&quot;操作系统和计算机组成相辅相成&quot;相互理解和明白才能真正把握好。
      谢谢老师的分享和传授：相辅相成的换个角度去学习感悟才能明白和理解课程。</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg" width="30px"><span>88591</span> 👍（6） 💬（1）<div>以前看过coursera 上面的《组成原理》，觉得讲的很好了。没想到老师用结合实践的一些案例来讲解，让知识理解更深刻了。这个专栏定的非常值。</div>2019-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/98/45/318ba48a.jpg" width="30px"><span>pebble</span> 👍（6） 💬（5）<div>有个问题一直不明白，云上的cpu，是多线程后的，还是一个物理u</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e7/2e/1522a7d6.jpg" width="30px"><span>活的潇洒</span> 👍（6） 💬（1）<div>终于讲到了和我工作中一样的场景
1、首先是Nginx反向代理的高可用集群
2、MySQL的一主多从，主从复制
3、openstak再创建虚拟机时会把相同服务的虚拟机分散到不同的宿主机上
4、微服务的注册中心集群
5、微服务水平扩展的多个节点
</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg" width="30px"><span>南山</span> 👍（2） 💬（1）<div>以前上一个h5，软件服务都是独立的并且都是部署到几台机器，数据库是ha，就觉得实现了高可用。
现在软件是微服务化，部署是docker＋k8s，数据中心是异地。一致性只能根据业务场景case by case</div>2019-08-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（1） 💬（1）<div>我们的系统就是最简单的LEMP架构，能过nginx将流量分发到不同的PHP服务器，PHP通过连接读写分离的MYSQL完成服务。后期准备迁入Kubernetes,利用云原生的便利性和高扩展性，更好的提升可用性，与分页式计算。</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/93/35/20b249bc.jpg" width="30px"><span>Ming</span> 👍（2） 💬（1）<div>分布式计算讲的挺容易理解的，但是跟标题【如果所有人的大脑都联网会怎样？】为啥对应不上了</div>2021-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg" width="30px"><span>秋天</span> 👍（1） 💬（0）<div>而通过水平扩展保障高可用性，则需要我们做三件事情。第一个是理...
</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>高可用性的硬件层面设计：
冗余电源：使用多个电源供应器，确保一个电源故障时，系统仍能正常运行。
磁盘冗余阵列（RAID）：通过RAID技术，如RAID 1（镜像）、RAID 5（分布式奇偶校验）或RAID 6（双分布式奇偶校验），来提高数据存储的可靠性和性能。
网络冗余：采用多个网络接口和多个网络路径，以避免单点网络故障。
服务器集群：通过多台服务器组成集群，实现负载均衡和故障转移。
热插拔组件：使用可以不中断系统运行即可更换的硬件组件。
双活数据中心：在不同地理位置设置两个或多个数据中心，互为备份，同时对外提供服务。</div>2024-09-22</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>说到高可用系统离不开CAP理论，通常P是必须的，其它系统的设计往往根据具体场景在C和A之间权衡。</div>2024-02-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/3d/a0/acf6b165.jpg" width="30px"><span>奋斗</span> 👍（0） 💬（0）<div>感觉高可用才是衡量一个系统最重要的指标</div>2021-05-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/CqF8eiaanNteyu2U7FibYicjnw99VXZST61vvMpQKSd5iaLNW6EicLeFYyDOKJmg9rNx6KW90DwpPMKNxiben6fQeZjA/132" width="30px"><span>Geek_24abc6</span> 👍（0） 💬（0）<div>说得挺好</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg" width="30px"><span>88591</span> 👍（0） 💬（0）<div>原来可用性也是很复杂。</div>2019-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/9c/25/2d97b0a7.jpg" width="30px"><span>周涛</span> 👍（0） 💬（0）<div>这章讲的实在太好了，用浅显的道理讲复杂的原理，非常希望在这里不断提高。最终达到实际操作的境界。</div>2019-10-05</li><br/>
</ul>