上世纪60年代，计算机还是异常昂贵的设备，实际的计算机使用需求要面临两个挑战。第一，计算机特别昂贵，我们要尽可能地让计算机忙起来，一直不断地去处理一些计算任务。第二，很多工程师想要用上计算机，但是没有能力自己花钱买一台，所以呢，我们要让很多人可以共用一台计算机。

## 缘起分时系统

为了应对这两个问题，[分时系统](https://en.wikipedia.org/wiki/Time-sharing)的计算机就应运而生了。

无论是个人用户，还是一个小公司或者小机构，你都不需要花大价钱自己去买一台电脑。你只需要买一个输入输出的终端，就好像一套鼠标、键盘、显示器这样的设备，然后通过电话线，连到放在大公司机房里面的计算机就好了。这台计算机，会自动给程序或任务分配计算时间。你只需要为你花费的“计算时间”和使用的电话线路付费就可以了。比方说，比尔·盖茨中学时候用的学校的计算机，就是GE的分时系统。

![](https://static001.geekbang.org/resource/image/d1/9d/d107e645e1f849ebcafab0e4d4b73a9d.png?wh=1280%2A864)

[图片来源](https://commons.wikimedia.org/wiki/File:Unix_Timesharing_UW-Madison_1978.jpeg)图片里面的“计算机”其实只是一个终端而已，并没有计算能力，要通过电话线连接到实际的计算机上，才能完成运算

## 从“黑色星期五”到公有云

现代公有云上的系统级虚拟机能够快速发展，其实和分时系统的设计思路是一脉相承的，这其实就是来自于电商巨头亚马逊大量富余的计算能力。

和国内有“双十一”一样，美国会有感恩节的“[黑色星期五](https://en.wikipedia.org/wiki/Black_Friday_%28shopping%29)（Black Friday）”和“[网络星期一](https://en.wikipedia.org/wiki/Cyber_Monday)（Cyber Monday）”，这样一年一度的大型电商促销活动。几天的活动期间，会有大量的用户进入亚马逊这样的网站，看商品、下订单、买东西。这个时候，整个亚马逊需要的服务器计算资源可能是平时的数十倍。
<div><strong>精选留言（27）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/15/f7/744720a2.jpg" width="30px"><span>DriveMan_邱佳源</span> 👍（35） 💬（2）<div>JVM的优化手段主要就是为了减少指令数，从而减少cpu计算时间</div>2019-09-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/df/63/b7296340.jpg" width="30px"><span>anginiit</span> 👍（18） 💬（2）<div>之前困惑我许久的问题 学到这里 基本都解开了  很开心</div>2019-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/69/bf/58f70a2a.jpg" width="30px"><span>程序员花卷</span> 👍（4） 💬（1）<div>JVM是为了解决Java跨平台操作的问题，减少指令操作的次数！最终减少cpu的计算时间！</div>2019-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg" width="30px"><span>明翼</span> 👍（47） 💬（2）<div>老师我有个疑问？像亚马逊公司平日机器没多忙的所以可以租出去，但是像黑色星期五这种情况，其他租机器的公司也要用资源，亚马逊也要算资源那不是资源要爆了吗？</div>2019-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/28/2a/173ea0e1.jpg" width="30px"><span>张立昊Leon</span> 👍（20） 💬（0）<div>JVM主要应该是解决跨平台问题，即一次编码，处处运行。同样的Java代码编译成字节码后通过各个平台jvm的翻译就可以运行。从优化的角度来说，就像课程中讲到的，解释执行会损耗效率，可以通过jit编译成本地机器码运行</div>2019-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（12） 💬（0）<div>虚拟化技术满足了人们在不同场景下的不同算力需求，对算力进行了量化，让租用服务器的生意不仅停留在toB，还能toC。对企业来说，要想减少维护成本，就需要把虚拟机做成一个应用程序，甚至一个函数，随删随建。
一个完整的计算机系统包括硬件、操作系统、程序库、应用程序这四个模块，其中后三个模块可以封装成一个虚拟机程序，然后在宿主机操作系统中增加对虚拟机程序的支持，让它可以直接使用硬件接收硬件信号。这种设计模式就是type1。
同一台服务器上跑的虚拟机往往都是同一种操作系统，比如都是linux，只是发行套件不同，那么每个虚拟机程序都运行一个操作系统就太浪费了，它们可以共用同一个kernel，每个虚拟机程序只要不同维护发行套件的程序库、配置文件即可。这种虚拟机就是docker。</div>2020-07-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg" width="30px"><span>西门吹牛</span> 👍（4） 💬（0）<div>先确定一个问题，JVM的解释器把class文件，解释成机器码，这个机器码是作用在jvm上，与底层硬件不相关，还是这个经过解释器最终解释成的机器码是直接作用在底层硬件上。
如果是直接作用在jvm上，经过jvm转换后在作用到底层硬件，那就可以理解为，这个机器码本身是平台无关的，那还要class文件干啥，就没必要保留class文件了。而关于Java的介绍，这个class文件才是实现跨平台的关键。所以，这种理解是不正确的，解释器解释的机器码，直接是作用在底层硬件上的；这个机器码不是平台无关的，和操作系统和硬件有关；
如果说是直接作用在操作系统和硬件上，那直接丢给操作系统就行，为什么在jvm内存中还有程序计数器这个区域，这个完全可以有底层操作系统和硬件代替，完全没jvm的事；主要原因还是和java 边解释边执行有关，就像老师说的，jvm简化了class文件和机器码转换的难度，class是个中间代码，是跨平台的，直接把这个class文件，在jvm解释器的作用下，转换为对应的操作系统指令相对其他语言来说，难度不大。所以java最主要的目的，也就是和别的语言最大的不同，就是这个class文件的存在，这个文件的存在就是为了跨平台；
可以把class文件，当做其他语言经过编译器编译后的混编代码。而jvm当做是其他语言运行的物理运行环境。c这种语言，编译后的混编代码是不能跨平台的，跨平台必须重新编译，而class文件没必要，因为它作用在jvm上。
而jvm内存中的程序计数器，可以说是在解释执行的时候，指的是class文件对应的行号，这里类似混编代码对应的cpu指令地址，根据程序计数器记录的行号，将class文件，进行边解释，边执行，这种解释执行，其实就是为了，启动时不会慢，不是一次加载，有点内存分页的意思，而如果碰到百分之二十的代码，执行时间在百分八十左右，那就认为这段代码是重复执行的，因为不同行的代码，运行差距不会太大，这里占了百分八十，说明这段代码是重复执行了，就是热点代码，这时候就采用JIT，直接将这段代码编译成合操作系统和硬件相关的机器码。提升性能。
所以，jvm存在的意义，我感觉，更主要的就是为了跨平台，这是它存在的最大特性，也可以理解为，面对对象的思想，用在了编译执行阶段，把不同平台上的指令集，都封装到jvm规范上，开发人员，只需要关系你写的程序，完全不用关系，编译，解释执行等步骤，换句话说，就是关系你的class文件，不需要管不同平台是怎么解释执行的，这个解释执行的步骤封装在了jvm中。
如果不是这样，jvm的存在与否，相对别的编程语言，除了以上分析的优势，他还能有什么优势呢？</div>2020-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg" width="30px"><span>张三</span> 👍（3） 💬（0）<div>在2019年12月的第一天，看到这篇文章，让我对之前一知半解对虚拟机和Docker知识有了更全面对了解，太好了！</div>2019-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4f/3f/6f62f982.jpg" width="30px"><span>wangkx</span> 👍（2） 💬（0）<div>JVM主要应该是解决跨平台问题，即一次编码，处处运行。

从优化的角度，解释执行会损耗效率，可以通过jit编译成本地机器码运行提高执行效率。
Java程序最初是通过解释器（Interpreter）进行解释执行的，这样java程序启动时不会感觉太慢；启动并运行后，当虚拟机发现某个方法或代码块的运行特别频繁时，就会把这些代码认定为“热点代码”。为了提高热点代码的执行效率，在运行时，虚拟机将会把这些代码编译成与本地平台相关的机器码，并进行各种层次的优化，完成这个任务的编译器称为即时编译器（Just In Time Compiler，JIT编译器）。
</div>2020-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fd/be/079c78c7.jpg" width="30px"><span>焰火</span> 👍（2） 💬（4）<div>浩哥~~，同一台机器上的docker如何解决不同客户对不同linux版本的需求呢？</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cf/96/251c0cee.jpg" width="30px"><span>xindoo</span> 👍（2） 💬（0）<div>我的理解，jvm虚拟机主要是为了解决java语言跨平台的问题，这和服务器虚拟化的出发点发点完全不一样。java多租户技术，感觉有点类似docker的方式，但不知道为什么这个技术已经出现好多年了，就是没多少大规模的实践，难道是因为docker？</div>2019-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg" width="30px"><span>阿卡牛</span> 👍（1） 💬（3）<div>那现在阿里云、谷歌云对外卖的云主机采用的都是docker吗</div>2019-07-12</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132" width="30px"><span>有铭</span> 👍（1） 💬（3）<div>老师，请教一下，有一种概念叫“裸金属架构虚拟机”，这种算type-1型虚拟机吗？但是它本身好像可以不依赖操作系统——它似乎可以直接安装在硬件上（自带操作系统？）</div>2019-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f9/78/b35d8915.jpg" width="30px"><span>twodog</span> 👍（1） 💬（0）<div>你好，分布式计算那一篇不讲了吗，还想看呢</div>2019-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>Java虚拟机（JVM）是为了解决特定的问题而设计的，以下是它出现的主要原因：

平台无关性：JVM的最主要目的是实现“一次编写，到处运行”（Write Once, Run Anywhere）。Java语言编写程序可以在任何安装了JVM的平台上运行，无需修改源代码，这样就解决了不同操作系统和硬件平台之间的兼容性问题。
内存管理：JVM提供了自动内存管理功能，包括垃圾回收（Garbage Collection），这样可以减少程序员在内存分配和回收上的工作量，避免内存泄露等问题。
以下是JVM与系统级虚拟机（如VMware, VirtualBox等）的一些通用优化手段：

即时编译（JIT）：JVM使用即时编译技术，将Java字节码转换成本地机器码执行，这样可以提高程序的运行效率。系统级虚拟机也有类似的技术，将虚拟机的指令转换成宿主机的机器码。
内存管理优化：JVM和系统级虚拟机都会对内存进行管理，包括内存分配策略、垃圾回收机制等，以提高内存使用效率和性能。
缓存机制：两者都会使用缓存来存储频繁访问的数据和指令，减少对磁盘或网络的访问，提高访问速度。
线程管理：JVM和系统级虚拟机都需要处理多线程执行，包括线程调度、同步等，以保证并发执行的正确性和效率。
资源调度：系统级虚拟机和JVM都需要对CPU、内存、I&#47;O等资源进行调度，以保证资源的合理分配和高效利用。</div>2024-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/81/e9/d131dd81.jpg" width="30px"><span>Mamba</span> 👍（0） 💬（0）<div>之前总是听闻云平台，云服务器，也看过学校服务器使用虚拟机，还有什么docker软件，但一直不太明白，现在终于有点悟了</div>2024-09-02</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>1.虚拟机核心要解决的是资源灵活发放已经使用效率的问题。
    2.容器主要解决的问题是软件发布依赖的问题，软件发布是将运行环境一起打包了</div>2023-12-08</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/icHMBoxO5zDicEgIOkFsZCsbicMAeaW3zd7e6YjJJKfvwu7Q8E3wtpXojfdClOeCGrPicJ16FBpEMicfpuDiariajibDSg/132" width="30px"><span>Jack_1024</span> 👍（0） 💬（0）<div>醍醐灌顶</div>2022-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3a/39/72d81605.jpg" width="30px"><span>大尾巴老猫</span> 👍（0） 💬（1）<div>KVM算是type1还是type2呢？</div>2021-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg" width="30px"><span>惘 闻</span> 👍（0） 💬（0）<div>老师，你最后的思考题说的系统级虚拟机是说的其实是资源隔离的docker吗？还是说的就是type-1的虚拟机呢？</div>2021-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/e1/7a/b206cded.jpg" width="30px"><span>人在江湖龙在江湖</span> 👍（0） 💬（0）<div>这一章些的真的很好</div>2020-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/9a/89/babe8b52.jpg" width="30px"><span>A君</span> 👍（0） 💬（0）<div>JVM我认为主要是为了让java程序夸平台服务的。虚拟机管理程序如果做到操作系统里，也是可以提高程序运行效率的。</div>2020-07-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg" width="30px"><span>西门吹牛</span> 👍（0） 💬（0）<div>jvm。解释执行，把class文件，经过解释器后解释的机器码，是直接作用与jvm，还是直接作用与硬件cpu，如果直接作用与虚拟机，那还要class文件干嘛，直接机器码和jvm就可以跨平台，所以jvm经过解释器解释出来的机器码是直接作用与底层硬件上</div>2020-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg" width="30px"><span>ack</span> 👍（0） 💬（0）<div>可结合此篇享用：https:&#47;&#47;www.freecodecamp.org&#47;news&#47;a-beginner-friendly-introduction-to-containers-vms-and-docker-79a9e3e119b&#47;</div>2020-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/fe/2d/e23fc6ee.jpg" width="30px"><span>深水蓝</span> 👍（0） 💬（1）<div>请问一下老师，那平常听说的CPU虚拟化有是怎么实现的呢？</div>2020-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d8/71/d6f79534.jpg" width="30px"><span>一个工匠</span> 👍（0） 💬（0）<div>谢谢老师，学习到了非常多的知识。</div>2019-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/74/60/0403b575.jpg" width="30px"><span>林三杠</span> 👍（0） 💬（0）<div>jvm为了解决跨平台开发的问题。减少一次指令的翻译也可以用在jvm的优化上，jit就是这个原理</div>2019-07-14</li><br/>
</ul>