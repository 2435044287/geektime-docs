> 本课程为精品小课，不标配音频

你好，我是文强。

上节课我们完成了 Server 模块的开发，接下来我们来实现元数据存储服务中的单机存储层。首先，我们需要来看一下单机存储层的技术方案如何选型。

## 存储层实现设计考量

如下图所示，我们知道了元数据存储服务的核心是 KV 模型数据的存储。

![图片](https://static001.geekbang.org/resource/image/6c/6e/6c452105ff951bc5d1860bb21272b06e.png?wh=1139x641)  
那如何来实现这个存储层呢？从技术上来看，一般有三个思路：

1. 基于文件系统从头实现数据存储。
2. 基于现有成熟的分布式存储引擎完成数据的存储，比如 ZooKeeper、etcd等。
3. 基于现有成熟的嵌入式键值数据库实现，比如 RocksDB、LevelDB 等。

第一种方案很直观，可能也是我们在选型时首先想到的思路，但是**这种方案是最不推荐的**。因为从零开始写一个生产级别的存储层是非常困难的，周期很长，稳定性差。比如需要处理硬件和操作系统随时都有可能丢失或损坏数据的情况，另外写入性能优化需要大量时间投入，还得处理代码 Bug 等情况。

第二种方案是常用的方案，依赖成熟的分布式存储引擎存储数据，是比较快速且稳定的方案。但是这种方案的缺点是需要依赖外部系统，会导致架构复杂，长期运维成本高，另外外部依赖组件的稳定性也会影响主系统的稳定。因为我们要实现的消息队列其中一个设计目标就是：**高内聚和弱外部依赖**。如果选择这种方案，就破坏了这个目标，长期来看，不太合理。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg" width="30px"><span>Joe Black</span> 👍（0） 💬（2）<div>读写rocksdb不需要mutex保护吗？只用了Arc</div>2024-10-10</li><br/>
</ul>