你好，我是李智慧。

我们在讨论高性能架构之前，需要先聊聊什么叫高性能，以及如何量化地测试系统的性能。在[02讲](https://time.geekbang.org/column/article/487665)中，我们讨论了一些和并发相关的指标。事实上，并发数正是系统性能的核心指标之一，因为高并发会引起系统资源短缺，来不及处理用户请求，就会导致系统性能下降。

除了系统并发数，一般说来，和系统性能相关的量化指标还有响应时间和吞吐量。在前面的案例分析中，我们也多次估算过响应时间和吞吐量。我们再重新回顾下这几个指标的定义。

![图片](https://static001.geekbang.org/resource/image/27/79/27d99f00cd21f9bf5155a9a1fff08679.jpg?wh=1920x683)

吞吐量、响应时间和并发数三者之间是有关联性的。$\\small 吞吐量 = 并发数\\div响应时间$。并发数不变，响应时间足够快，那么单位时间的吞吐量就会相应地提高。

以上这些性能指标，我们可以在系统运行期通过监控系统获取，也可以在系统上线前通过性能测试来获取，以此来了解我们系统的性能特性，以及判断系统能否承受预期的高并发压力。

## 性能测试

性能测试就是使用性能测试工具，通过多线程模拟用户请求，对系统施加高并发的访问压力，得到以上这些性能指标。事实上，随着请求线程数，即并发数逐渐增加，系统的吞吐量和响应时间会呈现出不同的性能特性。具体说来，整个测试过程又可细分为性能测试、负载测试、压力测试三个阶段。
<div><strong>精选留言（10）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（9） 💬（1）<div>请教老师几个问题啊：
Q1：高并发标准是什么？多大的并发量算高并发？
Q2：负载均衡器单点问题怎么解决？
如果负载均衡器也需要多个服务器，那么就需要在其前面加负载均衡器，如此递归，则为死循环，好像这个方法不行。那么，是采用两个机器互为主备吗？或者干脆就是一台，宕机后重启吗？
Q3：F5、LVS是几层负载均衡？
买过老师的那本关于架构的书，几年前啦，现在不知道放哪里了。记得书中提过F5和LVS。那这两个是几层的负载均衡？好像记得书上说F5是硬件负载均衡；“硬件”负载的话，就不能说是某一层的负载均衡了，对吗？
Q4：多大规模的互联网公司（或用户数）需要CDN？
什么级别的用户数需要用CDN？（也许是别的判断标准，不是“用户数”，而是“流量”等，就是说对是否需要采用CDN的标准不清楚）。更具体一点，像极客时间这样的公司需要用CDN吗？
Q5：针对应用服务器，tomcat性能是不是不如Jetty？ 比如tomcat处理速度比jetty慢、并发数比jetty低等（这两个方面只是举例，我并不清楚两者的区别）
Q6：假设并发数五千，采用tomcat的话，需要几台服务器？（不考虑备份）。（是不是一台tomcat只能处理五百左右并发？记不清从哪里看到这个数字了）

Q7：大型互联网公司的最前面入口是什么？
在讲互联网架构的书籍和专栏中，会提到用户请求到达的第一个设备，比如Nginx、F5等等。即便快如F5，其处理能力也是有限的，根本无力承担阿里这样的流量。那么，最前面的入口是怎么解决大流量的？ 难道说有多个入口？如果是多个入口，这多个入门之前难道不需要一个“转发器”？如果需要一个“转发器”，那这个“转发器”也顶不住阿里这样的大流量啊，这不成了死循环了？</div>2022-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg" width="30px"><span>👽</span> 👍（7） 💬（2）<div>这篇，可能是最近几节以来，学习压力最小的一节。。。

说来惭愧，工作过程中其实还没有遇到过真正意义上的性能问题。主要提升还是提升请求性能。

首先考量，肯定还是代码层面。这是作为一个开发工程师最直接能做的。优化SQL性能，尝试接口拆分，优化代码结构等。

其次，如果中间会涉及外部请求。就考虑把这份外部请求的数据缓存起来。曾经有一个业务场景是用户调我们的接口查行情，然后我们再调第三方的接口再拼上我们的数据把行情返回给用户。其中调用第三方接口的这部分性能比较差（而且第三方接口是收费的）。我使用的方式就是把用户的请求缓存起来。比如，某用户查询了美刀的行情，我们就把这部分数据存几分钟，未来几分钟内所有的用户都拿这份数据。其实只有第一个用户体验较差，但是整体用户体验还是比较不错的。再加上是移动端的应用，偶尔请求慢了，用户也可以理解为运营商网络波动。

当然，还可以有其他的解决方案。比如，后台跑定时任务，后台更新行情。可以吗？当然是可以的，但是现实情况是，我们的用户访问时间段也不是24小时。这样轮询第三方接口，反而会增加第三方服务的费用开支。并且当时的开发人员只有我一个。所以我选择了一个，开发成本最低，但是能解决大多数用户体验的方法。

我的感悟是，其实很多时候，提升性能提升用户体验都是要成本的。 不考虑研发时间和金钱开支，很多问题可以很粗暴的解决。多地部署，就近访问，拉专线。凡是花钱，花时间解决的问题，解决起来都是比较轻松的。然而问题就是，很多时候，就给你这么多钱，这么多时间。还要把事干好，这就需要好好权衡了。</div>2022-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/8a/1c/f8ea6063.jpg" width="30px"><span>春风百里</span> 👍（3） 💬（2）<div>请问老师，对实时性要求很高的并发量也很高写操作，消息队列的延迟无法接受，有哪些可能的技术方案可以推荐，比如是写MySQL，业界一般怎么处理？</div>2022-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2c/6b/6c/3e80afaf.jpg" width="30px"><span>HappyHasson</span> 👍（0） 💬（3）<div>二层负载均衡，返回消息给请求端是直接返回的，是需要后端服务器和请求端主动创建链接？这样会不会有直连风险？</div>2022-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/30/ec/849b6b91.jpg" width="30px"><span>启程</span> 👍（0） 💬（1）<div>分布式对象缓存就涉及到数据一致性的问题，这一方面老师能详细加一下吗？特别是大数据量对数据实时性还有一定的要求的场景</div>2022-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/2c/b8/fcaca637.jpg" width="30px"><span>郭硕</span> 👍（9） 💬（3）<div>老师的每篇文章都收益匪浅，了解了一种特定的架构方案，但是又感觉每篇点到为止，很多细节都没有探讨，而且感觉距离实际落地还有很大的距离，不知道老师有没有一些建议或者资料，能够让我们顺着老师的每节课更深入的学习每种架构方案？</div>2022-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg" width="30px"><span>雪碧心拔凉</span> 👍（1） 💬（0）<div>负载均衡还分多种类型的负载。
应用层负载，响应内容要过负载，占带宽。
ip层负载，通过修改ip层的ip来达到负载的功能，效率更高，依然占带宽。
链路层负载，通过修改mac地址来达到负载的功能，响应内容直接从下游响应给用户，不过负载。
Dns负载，入口流量负载，通过解析域名返回不同ip地址。

缓存加速读操作，mq流量削峰，缓解写操作</div>2022-05-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/9f/b7/8b1c1b3b.jpg" width="30px"><span>姜兵</span> 👍（0） 💬（0）<div>李老师好，请问硬件负载均衡F5属于哪一类的负载均衡，谢谢老师。</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg" width="30px"><span>test</span> 👍（0） 💬（0）<div>吞吐量=并发数÷响应时间
</div>2022-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/a1/6b/f5f94a6f.jpg" width="30px"><span>唐国强</span> 👍（0） 💬（0）<div>老师这里可以加上前提，垂直伸缩</div>2022-03-17</li><br/>
</ul>