你好，我是李智慧。

在一个应用系统运行过程中，需要记录、传输很多数据，这些数据有的是非常敏感的，比如用户姓名、手机号码、密码、甚至信用卡号等等。这些数据如果直接存储在数据库，记录在日志中，或者在公网上传输的话，一旦发生数据泄露，不但可能会产生重大的经济损失，还可能会使公司陷入重大的公关与法律危机。公司上下辛苦十几年，一夜回到解放前。

所以，敏感信息必须进行加密处理，也就是把敏感数据以密文的形式存储、传输。这样即使被黑客攻击，发生数据泄露，被窃取的数据也是密文，获取数据的人无法得到真实的明文内容，敏感数据依然被保护着。而当应用程序需要访问这些密文的时候，只需要进行数据解密，即可还原得到原始明文数据。加解密处理既保证了数据的安全，又保证了数据的正常访问。

但是，这一切的前提是**加密和解密过程的安全**。加密、解密过程由加密算法、加密密钥、解密算法、解密密钥组成。下图是一个对称加密、解密过程。对称加密密钥和解密密钥是同一个密钥，调用加密算法可将明文加密为密文，调用解密算法可将密文还原为明文。

![图片](https://static001.geekbang.org/resource/image/77/68/77f666f32fb506a4a73cd41a0d51dc68.jpg?wh=1920x423)

所以，如果窃取数据的人知道了解密算法和密钥，即使数据是加密的，也可以轻松对密文进行还原，得到原始的明文数据。而很多时候，解密算法和密钥都以源代码的方式保存在代码仓库里，黑客如果窃取了源代码，或者内部人泄露了源代码，那么所有的秘密就都不是秘密了。
<div><strong>精选留言（10）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（3） 💬（1）<div>请教老师几个问题啊：
Q1：在客户端有缓存的情况下，服务端修改密码和算法以后，客户端怎么同步？
Q2：客户端的缓存只存于内存中吗？还是会存到硬盘上？
Q3：密码一般分几片？</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg" width="30px"><span>Realm</span> 👍（2） 💬（3）<div>老师，有没有可能遇到切换版本，造成解密的密钥和加密密钥不一致的情况？</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg" width="30px"><span>ABC</span> 👍（1） 💬（1）<div>老师，有个疑问，如果密钥缓存在本地。会不会被JVM分析工具解析出来</div>2022-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg" width="30px"><span>👽</span> 👍（1） 💬（1）<div>现在工作中，其实主要是两个，一个是摘要算法，也就是MD5这种。众所周知，安全性不是很高，容易被破解。不过，对于安全系数要求不是特别高的业务场景，也足够用了。（不涉及钱的场景）
另一种是，可逆的加密。主要用于处理敏感信息。比如手机号。手机号，通过盐，在数据库存储密文。然后，配置文件里存盐。取出来的时候，逆运算一波即可。

其实，我的理解，加密的核心无非就是防止数据泄漏的风险。这个很好理解，就好像，一个宝箱存着你的所有财产，如果只有一把钥匙，那这把钥匙丢了或者被人复制了，那你的财产就全丢了。所以，可以多上几把锁。每把钥匙放在你不同的亲信那里，必须要集齐所有的钥匙才能打开你的宝箱。比如，如果数据库明文，数据库泄漏了那用户密码就泄漏了。如果加上密钥，就需要同时获取数据库和密钥，如果再加上分片，就需要同时搜集多个分片。大幅度降低了泄漏的几率。毕竟，那么多数据同时泄漏还是太离谱了。

优化的点的话，我认为，我们系统的盐存配置文件也不是很安全。我在想，盐是不是可以做成动态的。通过用户部分不会改变的摘要信息去换取盐。

</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/21/14/423a821f.jpg" width="30px"><span>Steven</span> 👍（1） 💬（1）<div>加解密用过：AES、RSA
单向加密用过：MD5, SHA1

有个疑问：“SDK 加解密服务接口取得加解密密钥，并缓存在本地”，这样会不会有安全风险？</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/23/be/81bd6a7b.jpg" width="30px"><span>knife</span> 👍（0） 💬（1）<div>请问老师，在获取密匙服务的时候 需要一次远程调用，这时候如果被拦截，有可能泄露密匙，是否只能通过不断升级版本进行解决</div>2022-05-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/12/d5/38764102.jpg" width="30px"><span>无名</span> 👍（0） 💬（2）<div>老师，如果数据加密存储的话，如果要以这些字段做查询条件有没比较高效的搞法？</div>2022-04-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/61/d22371da.jpg" width="30px"><span>闪耀之星</span> 👍（2） 💬（0）<div>老师，您好，请教个问题： 如果像敏感字段都以加密的方式存储在数据库中，那么像一些复杂的脚本包含加密字段做函数处理的情况或者加密字段作为查询条件进行部分匹配检索、模糊匹配的情况是否有比较搞效的解决方案呢？ </div>2022-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> 👍（1） 💬（0）<div>可以优化的点：
1、多数据中心需要做异地双活；而且密钥绝对不能丢失；
2、可以增加机构和APP的概念，机构下有多个APP，APP可以绑定一到多个KeyBox，便于权限管理，也可以防止一些误操作；
3、在确认密钥及加密算法规则时，可以让安全团队全程参与评审的；后续按需选择算法，密钥自动生成即可，可以减少后续安全评审工作量；
4、金融行业还会用到密码机，否则可能无法达到合规性要求；

几个可能痛苦的过程：
1、系统先上线，加密后上线，历史数据加密+去除明文数据会痛苦；
2、系统模糊查询灵活性下降，无法做like类似查询。但可以预先将前缀或后缀进行hash，用前缀或后缀做一些匹配；
3、DB加密后，基于ETL或DB日志的部分任务就无法进行了，需要做调整；
4、密钥版本功能挺好的，换密钥很痛苦；</div>2022-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/91/51/234f9a73.jpg" width="30px"><span>王肖武</span> 👍（0） 💬（0）<div>2个小问题帮忙解答一下：
1.我们公司在做密评，直接用老师的这个设计能通过不呢？
2.听说RSA1024、MD5、SHA-1等不是安全的加密算法，老师推荐哪些对应的算法呢？</div>2022-05-12</li><br/>
</ul>