你好，我是姚琪琳。

前面我们用四节课的篇幅，学习了架构现代化中，新老城区建设的种种模式。今天我们就来看看如何拆分数据，这个场景在建设新老城区，甚至与其他城市（外部系统）交互时都非常重要。

作为开发人员，你理想中的业务数据存储方式是什么样呢？当然是负责一个业务的数据都在一张或几张名称相关的表中，这样通过名称我们就可以一目了然，查找起来很方便。

不过很遗憾，现实有时候总是事与愿违，遗留系统中负责处理一个业务的数据，有的放在这张表，有的放在那张表，总是不在一起，名称甚至都没关系；而一张表中也有可能存放几种业务的数据。要想治理遗留系统的数据，就需要对这些数据加以拆分、重组，今天我们就来聊聊拆分、重组涉及到的各种模式。

## 共享数据库

如果你问我，拆分数据的第一个模式是什么？我的回答就是：不要拆分。

不拆分真的可行么？这需要先分析一下拆分的必要性。遗留系统的数据拆分是个认知负载非常高的工作，不同的数据混杂在一起，具有不同业务含义的数据也往往存放于一张表中，要想彻底拆分干净十分不容易。

如果你不需要不停机更新（大多数企业的业务系统其实都不需要）、没有严苛的可用性和弹性需求，或者数据量没有大到无法接受的程度，就没有必要拆分数据库。
<div><strong>精选留言（6）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（4） 💬（1）<div>一次只做一件事这个原则非常实用，是一个解决遗留系统的神器！

当初接到了优化赠送礼物接口的任务（四种不同的场景，功能各有千秋，就像火锅的四种不同锅底，没人关心底料的配方，好吃就行）：
1. 第一次（一年前）信心满满的尝试分析所有场景，准备抽取公共部分。结果只提取了一小段，没有功能测试做保障，改不动；
2. 第二次（现在）由于业务量增加，频出问题，简单粗暴的选择了出问题最多的那个场景进行改造，虽然仍旧复杂，但看的到希望，不像第一次被众多的功能压垮
3. 今天学习了老师的文章才明白：这就是一次只做一件事的威力！</div>2022-05-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4f/7d/dd852b04.jpg" width="30px"><span>chon</span> 👍（0） 💬（1）<div>老师请教一下，数据拆分有一个场景就是由于数据量大了，需要分库分表。貌似如何拆分数据这章节没提到怎么做。是不是也是和异构数据库的套路一样？如果讨论是一样的话，有没有什么和异构数据库不一样，需要特别注意的地方？</div>2022-05-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/bf/3e/cdc36608.jpg" width="30px"><span>子夜枯灯</span> 👍（0） 💬（1）<div>报到，报道。老师拆分数据库后的事物问题，如何处理？拆分Schema，基于原有数据表上横向拆分和纵向拆分有哪些优缺点需要提前规划呢？</div>2022-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/85/a0/59213754.jpg" width="30px"><span>实习工程师</span> 👍（1） 💬（0）<div>第三步，同时写入新旧两个库，但只从新库中读数据。当我们对新库的基础设施有了信心之后，就可以把读操作也转移到新库中。这时我们仍然双写数据，因此出现任何问题都可以回退。</div>2022-10-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/85/a0/59213754.jpg" width="30px"><span>实习工程师</span> 👍（0） 💬（0）<div>第三步，同时写入新旧两个库，但只从新库中读数据。当我们对新库的基础设施有了信心之后，就可以把读操作也转移到新库中。这时我们仍然双写数据，因此出现任何问题都可以回退。

老师， 这里好像有点不通畅， 应该是先读旧库，对新库有信心了再切换读新库？</div>2022-10-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/6b/e9/7620ae7e.jpg" width="30px"><span>雨落～紫竹</span> 👍（0） 💬（0）<div>当需求量上来后 这些都只能是技术债了</div>2022-07-04</li><br/>
</ul>