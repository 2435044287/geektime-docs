你好，我是姚琪琳。

上节课，我们学习了微服务拆分之初，需要搭建好的两个基础设施，一个是基于开关的反向代理，另一个是数据同步机制。有了这两个设施做保障，接下来就可以大刀阔斧地一一拆解了。

除此之外，我们还讲了如何用API来取代代码依赖。你可能已经发现了，这个实践与其说是解决了对于单体代码的依赖，不如说是解决了对于单体数据库的依赖。

诚然，对于保险系统以及大多数这种数据密集型系统来说，所有的操作最终都将体现到数据库上。在这类系统的改造过程中，最不好解决的问题莫过于数据库表的解耦了。

这种面向数据库编程在21世纪初的国内是十分流行的，像Delphi、VB等都提供了很方便的数据库连接组件，而PowerBuilder更是推出了可以直连数据库的DataWindow，将数据的访问和展示耦合在了一起。

在这样的大背景下，将所有逻辑都放在客户端组件的Smart UI模式，以及将业务逻辑和数据访问逻辑混杂的“事务脚本模式”为什么如此流行，也就不难理解了。然而随着业务的发展，这种模式的弊病也越来越明显，很多团队都意识到了这个问题并着手解决。但在遗留系统中，这样的代码还是随处可见。

在微服务拆分的过程中，如何界定数据库表的所有权，进而拆分给不同的服务，就成了最为棘手的工作。这节课我们一起继续探索遗留系统的改造实践，按照从易到难的顺序，分别学习三种行之有效的方法，帮你搞定数据库表的解耦。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erD8CwHKGGIia1HwRBxy5GxMLTfGGzOeLjrmZ6ich9Ng7bbPia89iaSibbldnV4uiaKNXFcO2vQ3ztibCrDw/132" width="30px"><span>Williamleelol</span> 👍（8） 💬（1）<div>姚老师你好：
咱们本个专栏主要讲遗留系统现代化，传统意义上基本都是一个大泥球式的单体服务开始。最近我接手却正好相反，服务分的很碎很细，并且有很多坏味道比如一个需求需要修改很多服务，典型的分布式单体。在众多问题中我有一点没想清楚，因为用到了非常多的faas，每个faas有薄（比如只做消息体转换）有厚（做业务流程处理）。个人风格是非常不建议这么做的因为会导致认知负载太高，几十个faas最终没人说的全，不知道一个流程是从哪里开始的，有问题排查成本也升高。但是话说回来faas真正解决的问题是什么呢？强调function的话最终我想不管如何管理也一定会变得数量特别多直到难以管理，最佳实践是什么样的？
辛苦～</div>2022-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（1）<div>文中以图片表示的复杂查询令人吃惊，没见过这么长的查询。
Q1  这么长的查询，一般需要多长时间？ 比如100ms？
Q2  除了时间，从实际应用的角度，这种复杂查询还有哪些问题？</div>2022-05-31</li><br/>
</ul>