你好，我是姚琪琳。

上节课，我们学习了什么是遗留系统，对于老旧、过时，但又十分重要、不可替代的遗留系统，听之任之只会埋下隐患，真正出现问题就为时已晚了。

不过在动手改造遗留系统之前，我们先要找准方向。其实相比遗留系统“治理”、“改造”，我们更强调的是“现代化（Modernization）”，也就是把遗留系统变为现代化的系统。这也是国际上更通用的提法。用“Legacy System Modernization”这个关键词，在Google上能搜到1380万条结果。

很多团队在对遗留系统进行“改造”或者“现代化”的时候，往往会陷入一个误区，就是盲目引入各种时髦的新技术，仿佛“新”就代表着“好”，就代表着方向正确。

比如我们耳熟能详、近年来愈发流行的微服务架构，有些团队也不管自己的项目适不适合，上来就把一个“大泥球”式的遗留系统肢解成了几十个微服务。更有甚者，一个遗留系统拆成了几百个微服务，有些甚至一张表的“增、删、查、改”居然被拆成了四个服务。架构似乎“现代化”了，运维人员却“哭”了。

那遗留系统现代化的正确方向到底是什么呢？结合上节课的分析，遗留系统在代码、架构、测试、DevOps方面存在诸多问题，我们在此基础上，将代码和测试合并（因为它们说的都是代码的质量），并引入开发团队这个维度，就得到了遗留系统现代化的四个方向：**代码现代化、架构现代化、DevOps现代化和团队结构现代化**。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1c/f6/27/c27599ae.jpg" width="30px"><span>术子米德</span> 👍（6） 💬（1）<div>🤔☕️🤔☕️🤔
* 📖：现代化（Modernization），把遗留系统变成现代化的系统（Legacy System Modernization）
    * 🤔：现代化，到底是一个目标，还是一个过程？为何代码不能在第一天就现代化？我们今天写的代码能持久保持现代化嘛？如果一份代码，从开始到现在，都是一个开发在维护，需要现代化嘛？如果一份代码，至始至终都是流动的状态，有可能现代化嘛？到底是怎样的发心，能够持久呼喊系统现代化，为何我身边没有这样极度追求者？这些困惑和现状，在我心里似乎还是乱序的状态。我得想办法找出一个关键词，能够随时召唤出来，点亮我对于重构遗留系统的核心要义。就像代码评审，我给自己设定的关键词就是“易读性”，代码字面意思易读、代码业务含义易读、代码验证思路易读。可是，遗留系统重构，我还在寻找这样点亮我的关键词。
* 📖：遗留系统现代化四方向：代码现代化、架构现代化、DevOps现代化、团队结构现代化。
    * 🤔：现代化代码和古董级代码的关键差异，在于代码本身是否具备可测性。而可测性的关键区别点，就在于改动后，能否在【独立可控条件下验证修改】是否符合预期。难以独立验证，只能整体测试，那是能力问题。如果具备独立可控验证，还选择整体测试，要么认知不到位，要么就是态度问题，不客气说就是职业底线偏低。这样的底线下沉，并非开始如此，每个小地方，稍微懒惰一点，积累起无可挽救的自己。说起来容易，认识起来也容易，如何能让自己真正做到，就像每次带上红领巾，都会撸正每个角，这是天赋异禀，还是刻意可习得的优质。这个困惑，在我心头从未消除。即使我知道要撸正红领巾，可是我就会出现不撸正的时候，至于如此嘛，何以如此呢？这是自己呆在遗留团队太久，还是仅凭自己，就是不可能爬不出遗留系统的坑，怎么能找到棒喝自己的时机？
* 遗留系统现代化三原则：降低认知为前提、假设驱动为指引、增量演进为手段。
    * 🤔：降低认知，就像走路要穿鞋，否则必定走不远。假设驱动，就像爬山要地图，否则迟早迷路。增量演进，就像游泳要有换气频率，否则不是憋伤就是憋傻。
</div>2022-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（3） 💬（3）<div>遗留系统现代化的三个原则：
1. 以降低认知负载为前提 
2. 以价值驱动为指引
3. 以增量演进为手段

关于团队结构现代化的一本书《Team Topologies》中文版《高效能团队模式》

我们的系统
微服务（SpringBoot）：20+ 
通信：Dubbo + RocketMQ
运维
- 使用 Jenkins 打包部署
- 测试环境：K8S
- 生产环境
  --业务线一：阿里云 serverless
  --业务线二：阿里云 K8S
  --业务线三：AWS K8S</div>2022-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（2） 💬（1）<div>我觉得三原则很棒，降低认知负载、价值驱动、增量演进，其实很多系统开发也应该遵循这样的原则。

另外就是遗留代码四个现代化里面，团队结构现代化是不是应该放在最前面？如果指望研发团队去做代码和架构现代化，感觉有点无从下手，我猜测平台团队和赋能团队应该可以做一些示范性的工作。

对于那个 InMemoryEmployeeDao 我也有点疑问，是不是可以考虑行为测试，使用 Mock 工具。

手头的项目是 C++ 开发的桌面应用，似乎对于单元测试的引入不那么友好。</div>2022-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a1/6d/a4ff33bb.jpg" width="30px"><span>Lee</span> 👍（0） 💬（1）<div>刚来这家公司，虽然有用阿里云，但是个人感觉基建还是有待提高，对于服务的划分在按照使用者，其次前端nodejs层承接过多业务含义，交互和体验上面前端关注度不太够，后端分层存在比较大的问题，因为存在中台，每次都参考中台的表设计之类，一问中台也是这样设计，对于圣经真的不是作为思想指导去灵活应用，而是必须把圣经定律搬进来，稍微有那么一点心累哈哈哈，如果我来重构，新起一个服务，在服务中按照不同领域进行分层，领域层之间步互相调用，如果需要聚合，单独一层来聚合或者处理，后面拆成微服务的话也很easy，之所以还是考虑新加一个服务还要审核，不一定能通过，这个也是组织结构的问题，也需考虑sre团队的成本</div>2022-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" width="30px"><span>拉欧</span> 👍（0） 💬（1）<div>认知负载改成认知成本比较好</div>2022-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/3f/91/458268f9.jpg" width="30px"><span>克劳斯</span> 👍（0） 💬（2）<div>请教老师，应该怎么定义现代化架构，衡量的标准是什么？先抛开遗留系统来讲，如果是一个全新搭建的系统，怎么判断系统上线后是不是遗留系统？文中提到的更多的是遗留系统现代化的原则，以及已有遗留系统架构现代化的模式和方法。</div>2022-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（2）<div>请教老师几个问题：
Q1：devOps就等于CI+CD吗？
Q2：InMemoryEmployeeDao只是测试用的，并不是业务代码，对吗？
Q3：上一课(01讲)，提到“付费软件从非官方渠道下载”，既然花钱买了，肯定会从官网下载啊，怎么会不从官网下载呢？
Q4：上一课(01讲)，提到“java开发的C&#47;S项目”。用java开发C&#47;S项目，这个决策本身就有问题吧。C&#47;S项目一般是桌面软件，桌面软件不是Java擅长的，而应该用微软那一套吧。</div>2022-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/06/8d/704e2596.jpg" width="30px"><span>Anita</span> 👍（0） 💬（1）<div>我所在的遗留系统已经由单体拆成了微服务。为了和老系统一致，需要很多人工验证的工作，投入产出不高。</div>2022-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/06/8d/704e2596.jpg" width="30px"><span>Anita</span> 👍（0） 💬（1）<div>老师，需求现代化能否再加上呢？了解了需求现代化开发人员可以给外部门提建议</div>2022-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/a7/fb383ef7.jpg" width="30px"><span>MaLu</span> 👍（1） 💬（0）<div>1. 以降低认知负载为前提  -- 其实就是清晰化的
2. 以假设驱动为指引 -- 就是演绎逻辑、就是提前做试验的方法
3. 以增量演进为手段 -- 一是兼顾前后新旧 一是避免冒进冒失</div>2023-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2a/5a/da723ac4.jpg" width="30px"><span>小菜鸟</span> 👍（1） 💬（0）<div>对于可测试的重构可以采用mockito等mock框架，可以减少一些不好测试而改变代码结构的方式</div>2022-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/97/23/9c9bd0d4.jpg" width="30px"><span>苜蓿°</span> 👍（0） 💬（0）<div>如果作者还有机会更新，还是想听一下需求现代化是什么样子的，这样才更完整。</div>2024-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d5/3e/7f3a9c2b.jpg" width="30px"><span>Jaising</span> 👍（0） 💬（0）<div>现有系统就是一个庞大的分布式系统，虽然架构团队设计了一套架构设计与交互规范，但是动辄上百的服务还是会牵扯众多的研发和运维同事参与。服务以组件形式提供，组件按照通信规范交互，有负责架构描述的、有负责基础组件的、有负责通用业务的、有面向应用的，并有一套较完备的定义、发布、维护机制。

问题在于这是基于私有云部署的架构，分布在各个项目的系统没法保证都拥有同样水准的运维人员，因此就会出现一类运维人员负责所有项目的一类组件，这就容易只看到组件而忽视系统，在系统不断升级的过程中依然是一个考验。</div>2024-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e8/52/931888d7.jpg" width="30px"><span>InvisibleDes</span> 👍（0） 💬（0）<div>看着感觉好抽象呀</div>2024-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/3e/89/77829168.jpg" width="30px"><span>fliyu</span> 👍（0） 💬（0）<div>改造老城区，建设新城区，任重道远</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/62/eb/3e319cad.jpg" width="30px"><span>西米</span> 👍（0） 💬（0）<div>我们今年就会请国内或国际上知名的咨询公司，进行单体应用的微服务拆分，会利用DDD的方式进行微服务划分，某个服务改造完后，会采用绞杀者(或其它)模式，进行上线，遗留系统会逐步按这个原创拆分成微服务。</div>2022-04-18</li><br/>
</ul>