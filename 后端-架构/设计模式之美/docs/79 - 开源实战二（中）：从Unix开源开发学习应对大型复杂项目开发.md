我们知道，项目越复杂、代码量越多、参与开发人员越多、开发维护时间越长，我们就越是要重视代码质量。代码质量下降会导致项目研发困难重重，比如：开发效率低，招了很多人，天天加班，出活却不多；线上bug频发，查找bug困难，领导发飙，中层束手无策，工程师抱怨不断。

导致代码质量不高的原因有很多，比如：代码无注释，无文档，命名差，层次结构不清晰，调用关系混乱，到处hardcode，充斥着各种临时解决方案等等。那怎么才能时刻保证代码质量呢？当然，首要的是团队技术素质要过硬，能够适当地利用设计原则、思想、模式编写高质量的代码。除此之外，还有一些外在的方法可循。

今天，我就从研发管理和开发技巧的角度来带你看下，面对大型复杂项目的开发，如何长期保证代码质量，让代码长期可维护。

话不多说，让我们正式开始今天的学习吧！

## 1. 吹毛求疵般地执行编码规范

严格执行代码规范，可以使一个项目乃至整个公司的代码具有完全统一的风格，就像同一个人编写的。而且，命名良好的变量、函数、类和注释，也可以提高代码的可读性。编码规范不难掌握，关键是要严格执行。在Code Review时，我们一定要严格要求，看到不符合规范的代码，一定要指出并要求修改。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（4） 💬（1）<div>codeReviewer 是否可以借助一些地方工具来进行是不是更好些呢？</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/86/56/509535da.jpg" width="30px"><span>守拙</span> 👍（177） 💬（12）<div>课堂讨论: 

保持代码质量的经验: 

1. svn&#47;git 少量多次提交, 写清晰的commit: 有助于版本管理&#47;bug追踪&#47;code review.

2. 前后端业务命名统一:  没啥说的, 前端头像叫avatar, 后端叫face_icon就很别扭.

3. 适当的工作节奏: 小团队难免遇到加急的任务, 每天大十几小时的实际编码工作让人无暇考虑什么规范, 优雅, 可读性可维护性...心里只想去tm的.(既然老板不想好好用我的技能, 那我就一路平A呗.) 

4. 良好的工作氛围: 技术&#47;产品&#47;设计&#47;运维&#47;市场都是无产阶级, 屁股要坐端正了, 要搞清楚谁是战友谁是阶级敌人, 非暴力沟通, 不要甩锅&#47;埋怨&#47;为难对方. 大家工作的开心才是硬道理, 开心的重要性远远高于规范&#47;流程&#47;制度等等. 当然不是说每天傻乐呵, 程序员作为无产阶级单兵作战单位, 要想清楚一件事: 吾辈为何而战? 相信有缘读到这里的各位都有自己的答案. 我的答案是: 为了更好的生活.</div>2020-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（21） 💬（8）<div>1.代码质量这个，目前真的只能落到个人追求。
2.中高级开发是开发主力。对于中高级开发，就升职加薪来看，技术的效益远高于编码设计能力。设计的好坏，在外行来看终究不也只是翻译了业务逻辑，所以希望他们认可买单挺难的。而烂代码对自己的影响还是比较有限的（自己写的，可读性再差也多少能读懂。扩展性不好导致难改，直接技术实现不了，历史原因，也就过去了）。
3.所以就两三年的工作来看，是加班重构承担风险。还是下班学习稳步提升呢？
4.存在既合理，该重视的会在该重视的时间被重视。</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg" width="30px"><span>👽</span> 👍（16） 💬（2）<div>其实现在很重要的一点是，写出规范代码的能力不值钱！我写代码写的很规范，能提升收入么？在我的了解里，大概率并不能。所以很难有人会重视。

比起代码规范，还不如去多背几道面试题来得直接。我曾经专门去考了阿里云的Java代码规范认证，不完全正式的认证，自认为自己的代码规范程度应该能排程序员前20%至少。但是结果呢？甚至没有一个公司仔细看过这个。

重视代码规范，代码质量，我觉得更大程度上应该通过公司管理层从上到下执行。说实话，对于一个初级程序员，问他Spring底层原理，倒真不如能写出优秀的代码来的性价比高。但是结果就是，Spring原理背几道题面试效果一下就上升了， 但是代码质量却无人问津，，，</div>2020-08-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/50/d7/f82ed283.jpg" width="30px"><span>辣么大</span> 👍（15） 💬（2）<div>之前在的项目组做的是银行的项目，十几人的团队，属于项目维护。项目不紧急，三个月一小版更新，半年一大版。拿到需求的时候首先是分析需求，然后是写开发文档，开发文档组长检查通过后才能开始写代码提交。组长负责merge代码，同时做了code review的工作，觉得小团队这样做还是挺有效的。</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/02/828938c9.jpg" width="30px"><span>Frank</span> 👍（13） 💬（1）<div>从开发技巧来看，我觉得除了文章中提到的哪些点，我们还可以尝试阅读优秀的开源框架，如Spring，Netty等，看看这些优秀的框架是怎么做的，我觉得是能够从中学习到一些东西的。</div>2020-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg" width="30px"><span>君哥聊技术</span> 👍（9） 💬（2）<div>1.待研发团队的leader很重要，如果他要只是一个做管理或者业务的leader，那保持代码质量很难的，甚至技术氛围都不会太好
2.团队的中高级开发有代码洁癖就好了，可以不断地重构代码，review其他人写的代码
3.团队成员开发过程中，不能随便提交代码。要建一个自己的分支，提交后做merger request，leader或高级开发在这个过程中进行review后做些修改的comment
4.不断改善团队的技术氛围，这个很重要
5.团队成员要熟悉业务，这个也非常重要。尤其是一些专业性强的业务，比如征信系统、信贷核心系统等。熟悉了业务，才能在开发过程中更好地使用设计模式和原则</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f7/eb/e7127bb8.jpg" width="30px"><span>，</span> 👍（6） 💬（0）<div>1.需要二次开发的项目,每个模块都应该包含必要的说明文档
     做过一个媒体项目的二次开发,当项目需要对接新模块时,项目经理会甩给我一个jar包,一套源码,然后我自己研究如何打通模块之间的通讯,沟通补充那些公司内部的依赖,打包模块,部署到某台机器上,这个过程中沟通成本特别大,找人要依赖,找人问业务流程,有的资料老大没给全,得靠自己去猜,劳心费神,有的模块代码实现里还有bug,有的模块的实现细节try-catch把异常吞掉,导致很难发现问题,对接的时候相当吃力,如果在一开始就能提供一个说明文档,简单描述一下模块的业务范围,对接方式,几句话的事就能帮忙解决大部分问题
2.不论是管理者还是工作者,工作中都不能携带情绪
    我刚工作的时候,什么代码规范都是一头雾水,工作难度又高,一犯错我老大就要开始批评我了,那一阵真是很难受,每天上班都是严阵以待,随时准备跟他打一架的感觉,现在想一想,其实只要大家都不要携带情绪,他以一个过来者的身份指导我,我以一个学习者的身份接受指导,他就能保时保量把项目交付给客户,我也能得到成长
3.对经典源码的阅读,有助于提升设计水平
     阅读源码的关键点在于掌握设计原则,设计模式的应用,以及某些特殊场景的解决方案.我在项目中遇到一个摄像头的管理模块,一个模块要管理多个摄像头,一个摄像头的方法有建立连接,停止连接,心跳校验等通用的方法,连接后回调方法的的行为各不相同,这让我想起了先前阅读过的tomcat源码,它用到了模板方法模式,用接口定义行为,用抽象类封装具体实现,然后在具体的每个摄像头的bean里实现了不同的回调方法.遵循这个方式,从我拿到需求,到完成这个设计,一共就用了一两个钟头
     在这个模块之后的扩展中,发现很多摄像头有共同的回调行为,而且摄像头的数量经常变动,最好通过配置文件来配置bean.然后我用在专栏学到的工厂模式的代码,不到半天就完成了这部分的重构</div>2020-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg" width="30px"><span>马以</span> 👍（6） 💬（0）<div>的确要看人，所以很多招聘还会写，希望招一些对代码有洁癖的人</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4c/b3/931dcd9e.jpg" width="30px"><span>J</span> 👍（5） 💬（0）<div>代码质量真的最应该负责的人就是开发人员自己，而不应该是质控人员。
质控人员应该变成另外一种的开发和运维人员，修建部门内的“耻辱墙”，将代码的测试覆盖率、CI的成功率、自动化的代码风格、缺陷扫描结果在部门内及时公开透明。只有知耻而后勇才能创造动力。

有效且全面的测试用例是重构的重要保障，王争老师提到的持续重构中，有些团队在代码腐朽后直接推倒重来，那是因为团队根本没有信息能够在祖传代码里面重构出来。如果祖传代码有高质量的测试用例，那就能够为持续重构提供安全网，能够使得重构可以持续和零散地进行。五分钟修改一个有坏味道的类才能变得可能，只要测试不通过，就可以马上回滚这5分钟内的修改。</div>2020-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg" width="30px"><span>忆水寒</span> 👍（5） 💬（0）<div>经验就是 写出来一堆垃圾代码的人，下次不和他合作了。</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg" width="30px"><span>javaadu</span> 👍（4） 💬（0）<div>我们今年就启动了一系列的措施来保障CR和单测的落地执行：
1. CR覆盖率
2. 测试用例注入攻击
3. CR代码攻击</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/92/7f/e531ea14.jpg" width="30px"><span>栗景树</span> 👍（2） 💬（0）<div>就我接触的大多工程师还是都比较注意规范和质量也有意愿改善提高代码质量。

然而，实际工作中今个一个紧急需求明个一个领导重要要求，还都是今个下午通知开发明天就要的那种，不少产品经理项目经理甚至领导说的最多的一句话是“写死先上”。等这个需求上了，就“写死先上，后面优化”的优化就没了，后面立马有其他需求又来了，哪里还有时间和机会优化。领导自己都不重视开发流程和规范，肆意践踏，甚至明确说“写代码不重要，谁都能写，找个年轻刚毕业的都能写，还能加班。所以写代码是最没价值的，让你怎么写你就怎么写就完了。就是要你们卷（加班）！”。

工程师要有规范流程质量意识，公司和领导也得能认识到且能在制度流程上给予保障和执行才行。

写代码不只是写代码，代码对应的是功能，功能对应的系统架构，系统架构对应的是业务架构，业务架构对应的是公司架构。这些都贯通了，工程师才能安心踏实的写出好代码，要不然光让工程师使劲，没用。</div>2022-01-11</li><br/><li><img src="" width="30px"><span>不能忍的地精</span> 👍（2） 💬（0）<div>公司组织统一的编程规范学习，并进行考试。每个人对代码进行评审，并找出不好的地方进行优化</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/02/6a16058a.jpg" width="30px"><span>liu_liu</span> 👍（2） 💬（1）<div>在业务开发中，对已有的基础组件或基础设施不要重复造轮子，防止在工程中出现多套类似的代码。尤其是当项目越来越大时，经常会发生这样的情况。

造成这种问题的原因可能是：

1. 对基础设施功能不熟悉，不知道已经有这种功能。这就需要基础组维护一份功能文档，并保持更新。并且业务同学也要尽量快速去熟悉项目代码。

2. 业务同学觉得代码写的很烂或者不能满足需求，想自己重写一套。这时应提需求给基础组进行改造，或者提 pr 给他们，实在不行才考虑自己另写一套。这也是防止工程代码冗余的一种手段。</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/18/fc/4f92ee4e.jpg" width="30px"><span>江南一笑</span> 👍（1） 💬（1）<div>技术上问题往往是显而易见、容易纠正的。但很多时候都是出在团队管理上，比如闲的闲死，忙的忙死，绩效考评，协作、分工等等。即便程序员都有良好的编码意识，也很难在一个烂团队中发挥技术。
所以有时候要看看根本问题在哪里。</div>2021-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg" width="30px"><span>程序员小跃</span> 👍（1） 💬（0）<div>在菊厂写代码的时候，code review是必不可少的一环，项目再紧急都不能忽略。都是同事之间互相在做这个事情，而且都是很自觉的，一方面是锻炼自己阅读代码的能力；一方面就是能更好的排查一些大问题（小问题也许review的时候看不出来）；还有一方面也是有质量标准，万一提交的代码通过自动化执行出错了，可以追溯到代码提交人以及review的同事，做到质量层层把关，大家也不敢松懈。

优秀的团队还是需要一些严格执行的策略，想打造好的产品，这篇文章里的内容还是得细细品味。我现在在小的team，代码什么的都很随意，更不用说文档了，都是自己用md写一份简短的在用，与人方便自己方便吧。

所以我感觉，良好的自律也挺重要的。不能为了交付而写代码，需要做的更好，给自己多一层砝码，哪怕不能升职加薪，至少对于未来肯定利大于弊</div>2020-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg" width="30px"><span>Heaven</span> 👍（1） 💬（0）<div>最近就是因为一些新需求的出现,导致接手了一个很久没有人维护的项目,虽然运行起来比较稳定,但是内部充斥着大量的临时解决方案,代码冗余过高,而且没有开发文档,实在是难以维护,只能花费大量的时间去读懂当时的实现思路,然后进行重写一遍,开发效率实在上不去,如果当时的开发人员能够进行一些代码的优化和重构,那么现在相比容易的多了,对于提高代码质量---我个人认为使用多分支管理最为重要</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0b/5f/2cc4060c.jpg" width="30px"><span>子豪sirius</span> 👍（1） 💬（0）<div>code review一开始能正常开展，但往往随着项目进行下去，需求不断变化，工期赶就坚持不下来了</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3b/47/f6c772a1.jpg" width="30px"><span>Jackey</span> 👍（1） 💬（0）<div>用一些lint工具来保证codeStyle，在做code review的时候就可以把更多的精力放到代码逻辑和代码设计上了</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg" width="30px"><span>Rayjun</span> 👍（1） 💬（0）<div>讲大道理谁都会，但是落实到细节上其实就很难了，所以代码规范方面不能够依赖人的主动性，否则肯定无法推行下去。最好的方式就是适用工具来执行，比如适用代码规范插件，没有检测过的代码就无法提交。

这样依赖，做代码 review 就会轻松很多，只需要关注代码的整体逻辑和实现方式是不是有问题，而不用去关注代码规范。 </div>2020-05-04</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqZIqY4cs6YKNx0OqeMrbjLIicqiafLNtLYJTN2zTtVPlwXZ7qlJ7xrGQictk1xCq5pEsIyqnkiaCib4zQ/132" width="30px"><span>全炸攻城狮</span> 👍（1） 💬（0）<div>我们项目的codereview就是虎头蛇尾了。一开始确实是有计划，做成常态化，可是随着项目压力变大，对于这个事情就慢慢忽视了</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/02/65/ddb6460e.jpg" width="30px"><span>柯里</span> 👍（0） 💬（0）<div>主要是要有一个好的氛围，以及一个重视的领导去驱动，所以待在一个好公司就很重要</div>2023-11-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/9f/62/960eecc3.jpg" width="30px"><span>夏天</span> 👍（0） 💬（0）<div>有些规范的执行 不能靠人的自觉性保证，必须有强制性的限制措施。比如合并代码 必须经过检查代码的工具检查通过后合并，否则拒绝合并。</div>2022-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/95/dd73022c.jpg" width="30px"><span>我是曾经那个少年</span> 👍（0） 💬（0）<div>1：一些基础例如参数签名校验，权限校验等需要提前处理，后续维护会有大量的重复代码。
2：三方接口对接请求和响应打印可视化的上下文日志。
3:  文档也要按模块分层，也需要持续维护。</div>2021-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c4/a5/ec346ee6.jpg" width="30px"><span>明才</span> 👍（0） 💬（0）<div>这里面除了一些原则，Unix的案例呢？难道一个简单的case都没有吗？</div>2021-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（0） 💬（0）<div>单元测试, code review, 代码规范, 文档等等这些都知道, 也都整天在说, 唯一差的就是行动</div>2021-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f4/8c/0866b228.jpg" width="30px"><span>子房</span> 👍（0） 💬（0）<div>代码的可读性和易维护性最重要</div>2021-01-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f9/aa/3e80212e.jpg" width="30px"><span>龙猫</span> 👍（0） 💬（0）<div>可以借助一些开发工具如code  style在git提交的时候强制检查。
对于开发组长来说，merge代码时一定要严格，当然前提是自己的技术素质过硬。</div>2020-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/60/a1/45ffdca3.jpg" width="30px"><span>静心</span> 👍（0） 💬（1）<div>公司喜欢招应届毕业生，我觉得主要是基于一下几个方面的考量：
1、成本低，招一个老江湖可能要几倍应届生的薪资待遇；
2、身体素质好，有活力，有干劲，爱拼才会赢；
3、可塑性比较强，容易融入企业氛围；
4、往往啥也不知道的才更容易创新，所以有利创新；
5、无家庭拖累，996更容易实施；
6、学习能力强，容易快速上手并接受新鲜事物。

但不好的地方也有：
1、基础差，需要培养，而培养还是要靠“老人”；
2、代码书写规范性一般较差，需要锻炼；
3、知识面比较窄，很难考虑全面；
4、至于分析问题和解决问题方面，我觉得未必赶上老人。

而“老不死”的大多靠的是卖经验和阅历。当然也有其好处，此处不多言。</div>2020-08-10</li><br/>
</ul>