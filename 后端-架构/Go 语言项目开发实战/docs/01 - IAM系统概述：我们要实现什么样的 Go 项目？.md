你好，我是孔令飞。从今天开始我们进入课前准备阶段，我会用3讲的时间给你讲清楚，我们要实现的实战项目 IAM 应用长啥样、它能干什么，以及怎么把它部署到 Linux 服务器上。先和我一起扫除基础的障碍，你就能够更轻松地学习后面的课程了。

今天这一讲，我先来说说为什么选择 IAM 应用，它能实现什么功能，以及它的架构和使用流程。

## 项目背景：为什么选择 IAM 系统作为实战项目？

我们在做 Go 项目开发时，绕不开的一个话题是安全，如何保证 Go 应用的安全，是每个开发者都要解决的问题。虽然 Go 应用的安全包含很多方面，但大体可分为如下 2 类：

- **服务自身的安全**：为了保证服务的安全，需要禁止非法用户访问服务。这可以通过服务器层面和软件层面来解决。服务器层面可以通过物理隔离、网络隔离、防火墙等技术从底层保证服务的安全性，软件层面可以通过 HTTPS、用户认证等手段来加强服务的安全性。服务器层面一般由运维团队来保障，软件层面则需要开发者来保障。
- **服务资源的安全**：服务内有很多资源，为了避免非法访问，开发者要避免 UserA 访问到 UserB 的资源，也即需要对资源进行授权。通常，我们可以通过资源授权系统来对资源进行授权。

**总的来说，为了保障Go应用的安全，我们需要对访问进行认证，对资源进行授权**。那么，我们要如何实现访问认证和资源授权呢？
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/17/f2/56/131b4173.jpg" width="30px"><span>素衣绾绾</span> 👍（53） 💬（6）<div>就是说，项目的源码已经完成，然后作者会在专栏中带着我们一起搭建一个web项目框架的雏形，也就是专栏中说的一些目录规范，api设计规范，错误包设计等，具体的功能代码，就是照着已经写好的代码挑选其中核心的功能进行讲解，是吗？</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/e4/1b/e8f5f5e4.jpg" width="30px"><span>大菠萝</span> 👍（23） 💬（1）<div>authz，这个名字有啥含义么？主要是这个z</div>2021-07-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/7d/0cfc0752.jpg" width="30px"><span>小屎丸</span> 👍（18） 💬（1）<div>为啥选择 MongoDB 作为日志数据分析展示库，怎么考虑的？谢谢</div>2021-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/89/71/03a99e56.jpg" width="30px"><span>、荒唐_戏_</span> 👍（14） 💬（4）<div>完蛋了，上来一个iam系统就没理解😓</div>2021-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg" width="30px"><span>helloworld</span> 👍（12） 💬（1）<div>是不是可以理解为每一个使用iam系统作为认证和资源授权的业务应用，该业务应用的用户每次访问该业务应用的接口都要先经过iam系统，认证和资源鉴权通过后，才能继续访问该业务应用接口呢，也就是iam是业务应用的网关代理？</div>2021-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/1f/17/f2a69e62.jpg" width="30px"><span>Fis.</span> 👍（9） 💬（5）<div>我理解authz是面向用户的借口，apiserver是核心处理模块，sdk不直接对接apiserver吗？authz和api server分离设计的优点是什么？另外authz从redis获取数据，那不是有可能读到过期数据？（比如当时写入请求还在写入mysql过程中，还没同步到redis）</div>2021-07-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg" width="30px"><span>Sch0ng</span> 👍（8） 💬（1）<div>目标是go工程，IAM只是一个支点。对IAM暂且理解个大概，能跟得上后面的学习即可。学完整个专栏，go工程能力更完善即可，顺带理解IAM更多细节，岂不是美滋滋。</div>2021-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/b7/0e/20ed751b.jpg" width="30px"><span>姚智慧</span> 👍（8） 💬（3）<div>老师，您好，正好讲到iam系统有几个问题想请教你一下，在项目中使用认证授权，遇到几个疑惑的问题一直困扰着我？
假如APP是内部应用的场景，流程是用户通过登录API直接获取token，然后每次携带token进行请求，网关拦截进行token的认证。
（1）这里面token是保存在客户端的，是否安全？
（2）token是有有效期的，网上一般说失败了通过刷新token去刷新，（客户端模式）客户端定时请求去触发，如果客户端多的话，频繁地刷新token的请求，显然带来很大的网络开销？为了解决这个问题，我们通过请求然后判断token时间是否到了阈值，然后续签（服务端实现）。但是这个也有问题，如果长时间没有请求会导致token过期，就不能续签了。如果是像淘宝这种，感觉永远都不会退出的，是不是就是延长token的有效时间+服务端刷新。那么永久有效，需要刷新token吗？
（3）oauth2中有客户端概念，我认为客户端就是app，那么appId和秘钥是不是保存到了app应用端，这样会有安全问题吗？如果密码都保存在了app端，服务端还需要对秘钥验证吗？</div>2021-06-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg" width="30px"><span>helloworld</span> 👍（7） 💬（2）<div>iam这个认证与资源授权系统和网关的认证与鉴权功能有何本质区别呢</div>2021-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg" width="30px"><span>helloworld</span> 👍（6） 💬（3）<div>IAM能和网关结合使用吗，还是必须二选一呢</div>2021-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/76/93/2e9bf8ab.jpg" width="30px"><span>arch</span> 👍（6） 💬（1）<div>令飞老师，腾讯云的CAM和IAM系统有什么区别吗？</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/57/2a/cb7e3c20.jpg" width="30px"><span>Nio</span> 👍（6） 💬（1）<div>IAM只是我们学习这个专栏的小工具，主要还是借助这个项目学习go语言项目的设计及思想以及具体实现，其中这些理论能力会体现在项目的各个实现细节中，是这个意思吧</div>2021-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/4b/11/d7e08b5b.jpg" width="30px"><span>dll</span> 👍（5） 💬（2）<div>不太明白，怎么同意这个用户创建并给密钥对，并给到对应的权限策略，这个步骤不需要人来同意吗？如果谁都能注册自己选择权限，那不是很危险？这个aim和jwt有什么关系</div>2021-06-04</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132" width="30px"><span>types</span> 👍（4） 💬（1）<div>关于秘钥对有几个问题不太明白
按照文中所讲，密钥对是在控制平面中创建
1. 根据后面的文章，数据流中（authz）是基于JWT认证的
请问秘钥对如何进行用于JWT，jwt token是谁负责创建的APP还是authz server
2. 秘钥对包含secretId，secretKey
请问APP包含密钥对的什么信息，是如何提供给APP的？</div>2021-09-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/29/39/59f9d41c.jpg" width="30px"><span>乳酸菌</span> 👍（4） 💬（1）<div>始终没有理解MVC 和三层架构的区别，老师有例子能加深理解吗？</div>2021-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/0d/00/d07ea760.jpg" width="30px"><span>qiaocc</span> 👍（4） 💬（1）<div>异步消费没有用过。 python里面有用过celery， go里面有类似的第三方包吗</div>2021-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/50/02/cce1cf67.jpg" width="30px"><span>awmthink</span> 👍（3） 💬（1）<div>老师，初步接触Web业务开发，对这一节中 IAM 系统的资源授权的流程图有2个疑问：
1) 步骤2中的创建密钥对，我理解其实就是JWT吧，只是一个token，和用户名一起构成了密钥对吗？
2) 图片步骤4，用密钥对去访问授权接口，这个不是用户直接访问吧，应该是用户用密钥对去访问资源时，由资源实时控制服务去调用authzServer来验证用户是否有权限来访问该资源？</div>2021-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg" width="30px"><span>helloworld</span> 👍（3） 💬（1）<div>iam可以用于微服务吗，就是n多个应用使用同一套iam为各自应用内的资源对用户授权</div>2021-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/0d/00/d07ea760.jpg" width="30px"><span>qiaocc</span> 👍（3） 💬（1）<div>1. 授权策略 2. 对资源的授权， 这两个有什么区别呀，能举个例子吗？</div>2021-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg" width="30px"><span>Vackine</span> 👍（3） 💬（1）<div>iam 存储的密钥是创建了之后就是静态的一直存在mysql的么？会不会有密钥截获的风险？还是每个密钥有超时时间？</div>2021-05-28</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcGxibqN07pL6hibEd7hn0orvr6JibNVYMHR1MCU05hGXMDtViaW7UVewnuRsw5PlbM9hf871rTJIDFw/132" width="30px"><span>六神丸</span> 👍（2） 💬（1）<div>老师，我浏览了您的回答：
其中说到iam是对资源鉴权，网关是对api鉴权；那么，如果我们的项目既要做api鉴权，又要做资源鉴权，这时需要怎么做？ 
我想到的做法：
①前端登录两个系统，两个系统相互独立，使用两个jwt；②把api网关做在iam系统中，使用过一套jwt；
那种更合理？或者都不合理，大致需要怎么做？</div>2022-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9a/0f/da7ed75a.jpg" width="30px"><span>芒果少侠</span> 👍（2） 💬（1）<div>有一个介绍mvc和三层架构区别的文章：mvc和三层架构应该是维度上的差别，一个是设计模式，一个是软件架构。https:&#47;&#47;blog.csdn.net&#47;weixin_42153410&#47;article&#47;details&#47;90753696</div>2021-10-09</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3C6aiaBgp29xyRr0cqdf6EDDlIukyTT5w9JxJeY4Vgouzr0o47wp4ibTutS0h8R8g4IC25FZ3icicDw/132" width="30px"><span>随缘</span> 👍（2） 💬（3）<div>有一点不懂, 求教老师
既然 iam-authz-server 已经把策略缓存在了内存中, 为什么还需要去订阅redis的变动, iam-apiserver 还需要把变动发送到redis中, 这两步分别是干嘛的?</div>2021-09-22</li><br/><li><img src="" width="30px"><span>会飞的牛</span> 👍（2） 💬（2）<div>问题2: 使用Laravel框架开发后台管理系统的时候典型的MVC模式，在实际项目中会加一层Service，框架实现在里面,Control只做调用，业务逻辑封闭在Service里面。
开发前端应用的时候，这时使用的是前后端分离模式。前端专注于页面效果与交互，后端负责提供RESTful API。</div>2021-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/cb/12/16b3eb06.jpg" width="30px"><span>🍼👯不理不理</span> 👍（1） 💬（1）<div>我是不是可以理解为 IAM就是一种权限认证</div>2022-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/e5/e3/06aa87b5.jpg" width="30px"><span>强者之风</span> 👍（1） 💬（1）<div>我问一下，按照图1，用户第二步创建密钥对，然后再密钥对下面创建策略，我看了我们的iam系统，直接使用user的token创建策略，好像和密钥对没有什么关系。</div>2022-12-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/7b/c5/35f92dad.jpg" width="30px"><span>Jone_乔泓恺</span> 👍（1） 💬（1）<div>老师，有个问题请教下：比如，现在要做一个电商 app，其中有用户管理（iam），商品管理和订单管理等功能，那么 ，我的项目要怎么规范服务呢？是在一个项目中创建不同的服务（cmd）？还是分成一个 iam 项目和其他功能的项目？</div>2022-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2a/14/e2/f6f1627c.jpg" width="30px"><span>顺势而为</span> 👍（1） 💬（1）<div>1.这样的架构，容易扩展，但是如果是小项目来说，链路是否过长。</div>2022-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2a/14/e2/f6f1627c.jpg" width="30px"><span>顺势而为</span> 👍（1） 💬（1）<div>1.日志消费为什么没有kafka，MQ这些队列？
2.除了MVC之外的，M层是否要分数据库事务层client和逻辑处理层service？
</div>2022-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5e/64/1becc599.jpg" width="30px"><span>drawping</span> 👍（1） 💬（2）<div>1.ima-apiserver和ops-apiserver是两个不同组件吗？ops-apiserver是否只服务于ops-webconsole？
2. 假如ops-webconsole有创建用户的功能，是调用ima-apiserver的接口，还是调用ops-apiserver，再由ops-apiserver通过RPC调用ima-apiserver创建？</div>2022-01-21</li><br/>
</ul>