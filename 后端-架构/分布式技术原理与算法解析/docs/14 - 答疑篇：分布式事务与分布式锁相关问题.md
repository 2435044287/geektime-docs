你好，我是聂鹏程。

到目前为止，“分布式技术原理与算法解析”专栏已经更新13篇文章了，主要与你介绍了“分布式起源”“分布式协调与同步”和“分布式资源管理与负载调度”。

在这里，我首先要感谢你们在评论区留下的一条条精彩留言。这让我感觉到，你们对分布式技术的浓厚兴趣，以及对我和对这个专栏的支持。这不但活跃了整个专栏的氛围、丰富了专栏的内容，也让我备受鼓舞，干劲儿十足地去交付更高质量的文章。

比如，@xfan、@Jackey等同学积极思考问题，并对文中有疑惑的地方结合其他资料给出了自己的思考和建议；再比如，@zhaozp 、@静水流深等同学，每次更新后都在坚持打卡学习；再比如，@约书亚等同学针对分布式事务提出了非常好的问题，@每天晒白牙等同学对文中内容进行了非常好的总结。

这些同学有很多，我就不再一一点名了。感谢你们的同时，我也相信，积极参与并留言也会帮助你更深入地理解每一个知识点。所以我希望，你接下来可以多多留言给我，让我们一起学习，共同进步。

留言涉及的问题有很多，但我经过进一步地分析和总结后，发现针对分布式事务和分布式锁的问题比较多，同学们的疑惑也比较多。

确实，这两大问题属于分布式技术的关键问题。因此，今天的这篇答疑文章，我就围绕这两大问题来进行一次集中的分析和回答吧。
<div><strong>精选留言（24）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg" width="30px"><span>piboye</span> 👍（11） 💬（4）<div>完全看不懂3pc存在的意义，完全没解决2pc的问题，消息更多，失败概率不是更高，而且还会出现不一致的情况</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/c1/66/e8dfeef4.jpg" width="30px"><span>王涛</span> 👍（4） 💬（1）<div>本节课程，让我明白了之前好多没主意到点，开扩了思维。</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/c1/66/e8dfeef4.jpg" width="30px"><span>王涛</span> 👍（1） 💬（1）<div>学习完这节课程，了解到了很多分布式中细节的内容。给作者点赞。</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg" width="30px"><span>xfan</span> 👍（8） 💬（1）<div>要动手实际将现有的系统改造为分布式系统，才能明白很多细节</div>2019-10-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（6） 💬（1）<div>我觉得关于redis实现分布式锁的那段，可以类比着Java里面原子类和AQS来理解，一个是不断尝试CAS直到成功，一个是多线程访问共享锁，拿不到就放到链表中排队。</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f2/66/b16f9ca9.jpg" width="30px"><span>南国</span> 👍（1） 💬（0）<div>为什么在setnx的源码中没有找到队列相关的实现呢?</div>2020-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（1） 💬（0）<div>      其实单独去提redis我觉得可能有点片面：不同的中间件干不同的事情；单独去用单一数据库个人认为有点窄了，这回造成；分布式就是传统CS或BS的简单升级。我们在谈论它的优点时忘了去忽略了它只是系统中的一部分而已。
     老师的文章跟到现在：由于在极客时间有其它学习压力非常大的课程，基本上有些东西仅仅只能暂时保持学习了。不过关于分布式调度其实个人觉得是这块的核心：调度的核心其实就是算法，可是算法都做不到完美，其实都是优劣互补中使用中间件存储。
    其实我现在有个不恰当的比喻，但又可能又某些状态下合适；分布式其实一定程度上就是Kubernets，而Google再它的下一代这个里面有用了mvcc去解决锁的问题。其实分布式和传统的CS&#47;BS是相互依存的关系：优势互补才能真正发挥系统的优势。</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（1） 💬（1）<div>关于redis 实现分布式锁，我觉得可以类比Java里面原子类和AQS，一个不断尝试cas直到成功，一个多线程尝试获取共享锁，拿不到就排队。</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg" width="30px"><span>Hurt</span> 👍（1） 💬（0）<div>打卡 打卡 </div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg" width="30px"><span>Allan</span> 👍（0） 💬（0）<div>其实每一节有对应案例代码会更好，也就是讲师可以自己实现一个分布式系统。每一节讲什么内容，然后就用这系统代码一步一步去实现，等到课程讲完整个系统也就搭建起来了，也可以用开源项目代码来讲解。这样课程讲完，我想大家都会明白分布式架构怎么去做，自己也能写一个简单的分布式项目。这样一直讲理论，光是表面听懂了，但实际操作起来去实现代码还是无从下手。</div>2024-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/25/48/f7cf2505.jpg" width="30px"><span>ky</span> 👍（0） 💬（0）<div>既然2PC和3PC都存在性能问题和数据不一致的隐患，那现在还有应用在生产环境的例子吗？</div>2021-10-26</li><br/><li><img src="" width="30px"><span>Geek_383ffd</span> 👍（0） 💬（0）<div>老师你好，redis基于队列实现分布式锁，这个过程的伪代码是怎样的？有具体例子参考吗？</div>2021-10-12</li><br/><li><img src="" width="30px"><span>Geek_791a0d</span> 👍（0） 💬（0）<div>那请问现在基于redis实现分布式锁 有没有队列</div>2021-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg" width="30px"><span>第一装甲集群司令克莱斯特</span> 👍（0） 💬（0）<div>不学不知道，一学发现不知道的更多。知识体系千疮百孔！</div>2021-06-02</li><br/><li><img src="" width="30px"><span>董月</span> 👍（0） 💬（0）<div>Redis 通过队列来维持进程访问共享资源的先后顺序，这个队列是redis提供的呢？还是要应用实现呢？</div>2021-02-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIm5rlbJ4HdXLbxmflvW0FW4rTyLcDzHLGDJUJic9W3f1KibWY7mAj9dxUIEVlxDyjwRXEX54KXEn5g/132" width="30px"><span>sea520</span> 👍（0） 💬（0）<div>一个事务跑sever多进程发给client造成乱序，引发bug。这在分布式知识中叫什么术语？如何预防和解决这种bug问题呢?</div>2020-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/20/26/d27a2331.jpg" width="30px"><span>EverGreen</span> 👍（0） 💬（0）<div>1、基于redis实现的分布式锁，现在肯定不用setnx实现了；很多原子性问题解决不了
2、关于2pc，
很多文章说：“
a.单点故障：在2PC中由协调者进行协调，一旦协调者发生故障，参与者会阻塞。尤其在第二阶段commit阶段，协调者发生故障，那么所有的参与者还都处于锁定事务资源的状态中，而无法继续完成事务操作
b.二阶段无法解决的问题：协调者发出commit消息，并且只有部分参与者收到消息，此时协调者和收到消息的参与者发生宕机。那么即使协调者通过选举协议产生了新的协调者，这条事务的状态也是不确定的，集群中不能判断出事务是否被已经提交”
这两点我不太认同：我觉得主要取决于实现，重新选举协调者的会拥有之前事务执行的日志，不太会有单点故障；2pc无法解决的问题也是同样的，否则现在应用层分布式事务saga框架怎么解决呢</div>2020-03-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（0）<div>阅过留痕
分布式事务和分布式锁无论面试还是实际工作中都是高频技术，我认为分布式锁是分布式事务的基础。
分布式锁的本质就是某台机器或某个集群中的一个被标记的共享变量而已，分布式系统的其他机器通过网络访问这个标记变量，判断是加锁还是未加锁以便进行下一步的操作。
分布式事务的核心是控制好分布在多台机器上的子事务，要么全部执行，要么全部不执行。其中控制阶段的，等待就需要锁的加持。</div>2020-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/71/4c/2cefec07.jpg" width="30px"><span>静水流深</span> 👍（0） 💬（0）<div>谢谢老师分享。</div>2020-01-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg" width="30px"><span>安排</span> 👍（0） 💬（0）<div>redis分布式锁那一个，如果请求锁的进程被放到了redis队列里，那这个进程会休眠吗？会一直等着redis返回获取锁成功的消息吗？</div>2019-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/17/a0/528af017.jpg" width="30px"><span>星空</span> 👍（0） 💬（0）<div>打卡完成，感觉又明白了一点</div>2019-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/20/b7/bdb3bcf0.jpg" width="30px"><span>Eternal</span> 👍（0） 💬（0）<div>还差三节赶上进度</div>2019-10-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3b/47/f6c772a1.jpg" width="30px"><span>Jackey</span> 👍（0） 💬（0）<div>感谢老师答疑，打算回去再刷一遍分布式事务和分布式锁😃</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg" width="30px"><span>忆水寒</span> 👍（0） 💬（0）<div>收获很多</div>2019-10-23</li><br/>
</ul>