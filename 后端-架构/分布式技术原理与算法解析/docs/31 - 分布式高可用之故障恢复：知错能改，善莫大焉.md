你好，我是聂鹏程。今天，我来继续带你打卡分布式核心技术。

在上一篇文章，我带你学习了故障隔离。故障隔离的目的是，对故障组件进行隔离，以避免其影响系统中的其他组件，尽可能保证分布式系统的可用性。

在分布式系统中，故障在所难免，发生故障后仅仅进行隔离还远远不够，还需要进行故障恢复。比如，现在集群中有3个节点，节点1故障后，对节点1进行隔离，如果节点2、节点3紧接着故障了，又隔离了这两个节点。那么，整个集群就无法继续提供服务了，何谈分布式系统的高可用呢？

为了解决这种问题，分布式领域还有一个关键技术来保证系统的高可用，即故障恢复。

接下来，我们就一起打卡分布式系统的故障恢复技术吧。

## 分布式故障基础知识

在介绍故障恢复之前，我先与你说说分布式系统中会有哪些故障类型。

### 故障类型

在任何一个分布式系统中，故障都是不可避免的。这里的故障，通常包括两类：

- 一类是物理故障，比如硬盘损坏、断电断网、硬件升级等；
- 另一类是软件层故障，比如系统存在Bug导致系统崩溃、系统负载过高导致系统崩溃等。

在讨论分布式系统故障时，我们通常还会从是否是网络导致的故障的角度来进行故障划分，包括节点故障和网络故障，而这两类故障可能同时包括物理故障和软件层故障。由于软件层故障和具体的程序实现等相关，因此主要由开发者根据自己的实现去解决；而物理故障通常具有很多共同特征，因此**今天我主要针对物理故障导致软件不可用的情况进行讲解**。
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg" width="30px"><span>阿卡牛</span> 👍（4） 💬（1）<div>个人理解，网络分区故障一般是针对不同集群来说的，单个集群一般在同一个网络中，集群内的单点故障并不会出现网络分区。当整个集群的网络出故障时。才会有分区的说话。能想到检测办法是单独有机器对不同集群的主节点进行心跳检测来判断</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/22/e3/510b69f9.jpg" width="30px"><span>benny</span> 👍（2） 💬（0）<div>收集每个节点返回的主节点信息，如果出现两个主节点，就是分区了</div>2020-02-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（1） 💬（0）<div>哈哈😄，看到那一堆公式，一下感受到了自己和大牛的差距，如果让我思考，除了心跳检测+TCP连接，貌似不知道还有什么，不过心跳检测也不是那么简单的，之前只认为心跳检测就是固定心跳检测，还是知道的少，有许多学问的。</div>2020-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3b/47/f6c772a1.jpg" width="30px"><span>Jackey</span> 👍（1） 💬（1）<div>心跳检测原来有这么多学问。个人认为可以使用一个独立于系统之外的机器来对集群的各个机器进行检测。如果发生网络分区时，可以摘掉机器数量少的分区，将流量都分到机器数量较多的集群上。</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/14/c4/e354d8ba.jpg" width="30px"><span>魏颖琪</span> 👍（0） 💬（0）<div>老师，我想问一下“第二步：通过样本计算出心跳到达时间间隔的分布。”中， Plater(t) 我应为应该表示接收到上一次心跳之后 t 个时间片还没能收到下一次心跳的概率，而不是接收到的概率。因为t-&gt;+∞。而且tnow-Tlast，last既然是上一次，也就是这段时间内没有收到新的。</div>2020-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/1e/8c/d9330d2b.jpg" width="30px"><span>花儿少年</span> 👍（0） 💬（0）<div>通过不同层面的心跳机制，来监控系统中是否发生了网络分区</div>2019-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" width="30px"><span>QQ怪</span> 👍（0） 💬（0）<div>没想到一个心跳策略就可以有那么多知识，学到了</div>2019-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（0） 💬（1）<div>老师讲得好，故障恢复确实是保证高可用很重要的一环，如何能够快递检测出故障，就显得很关键了，我们一般都是使用心跳检测，另外自动的故障恢复也显示很重要。
问个问题，系统在故障的这个期间，系统还没有恢复，那这个期间用户肯定能感受到服务异常，那系统还能叫高可用吗？</div>2019-12-09</li><br/>
</ul>