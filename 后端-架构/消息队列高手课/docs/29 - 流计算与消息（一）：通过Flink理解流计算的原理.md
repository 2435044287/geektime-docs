你好，我是李玥。

在上节课中，我简单地介绍了消息队列和流计算的相关性。在生产中，消息队列和流计算往往是相互配合，一起来使用的。而流计算也是后端程序员技术栈中非常重要的一项技术。在接下来的两节课中，我们一起通过两个例子来实际演练一下，如何使用消息队列配合流计算框架实现一些常用的流计算任务。

这节课，我们一起来基于Flink实现一个流计算任务，通过这个例子来感受一下流计算的好处，同时我还会给你讲解流计算框架的实现原理。下一节课中，我们会把本节课中的例子升级改造，使用Kafka配合Flink来实现Exactly Once语义，确保数据在计算过程中不重不丢。

无论你之前是否接触过像Storm、Flink或是Spark这些流计算框架都没有关系，因为我们已经学习了消息队列的实现原理，以及实现消息队列必备的像异步网络传输、序列化这些知识。在掌握了这些知识和底层的原理之后，再来学习和理解流计算框架的实现原理，你会发现，事情就变得非常简单了。

为什么这么说，一个原因是，对于很多中间件或者说基础框架这类软件来说，它们用到很多底层的技术都是一样；另外一个原因是，流计算和消息队列处理的都实时的、流动的数据，很多处理流数据的方法也是一样的。
<div><strong>精选留言（13）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/8b/ec/dc03f5ad.jpg" width="30px"><span>张天屹</span> 👍（33） 💬（2）<div>老师你好，请教个概念，虽然处理统计的程序叫做“流”计算，但是比如每5秒或者1分钟这样的时间间隔统计一次，那么对于有向无环图的每个节点，其实还是按照“批处理的”吗，即必须等这一分钟的结果汇集为一批处理完了，才传输到协议个Task节点。</div>2019-10-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg" width="30px"><span>姑射仙人</span> 👍（10） 💬（1）<div>老师您好，采用时序数据库比如prometheus，然后用grafana去做展示监控指标信息。感觉从表现形式上和流计算有些类似，时序数据库也支持统计功能。这两种形式的架构和使用场景，老师有什么看法呢？（除了并行计算这个点）</div>2019-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg" width="30px"><span>DFighting</span> 👍（6） 💬（1）<div>上一篇留言无意提交了，文章具体内容可以谷歌搜索Streaming 101,Streaming 102</div>2019-10-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c7/e6/11f21cb4.jpg" width="30px"><span>川杰</span> 👍（5） 💬（1）<div>老师，请问网上说的ACK机制，在消息队列中到底什么场景下要使用呢？
我理解，异步线程发送消息后，虽然主线程没法捕获异常，但子线程也可以判断出是否发送成功。那么为什么还要等待接收方返回一个数据处理完的结果呢？</div>2019-10-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/87/6b/0b6cd39a.jpg" width="30px"><span>朱月俊</span> 👍（4） 💬（2）<div>flink框架是如何根据逻辑代码进行子task拆解的哈?</div>2020-06-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c7/e6/11f21cb4.jpg" width="30px"><span>川杰</span> 👍（1） 💬（1）<div>如果服务端在处理过程是失败了呢？所以，需要客户端收到服务端明确的告知：”数据我收到并且处理成功了“，才能保证数据不会丢失。
老师您好，对于上一问题，我还有疑问。
对于服务端处理过程中的失败，假设场景: 业务A处理完毕后，数据需要落地，结果数据保存时出现异常，无法正常落地。
对于这种场景，应该是业务处理完毕后就发送确认给消息产生者吧？
我想表达的意思是，对于服务端这种业务场景，是否使用ACK，应该还是要具体问题具体分析的吧？</div>2019-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a4/2b/3ba9f64b.jpg" width="30px"><span>Devin</span> 👍（9） 💬（0）<div>思考题：槽数和并行度的关系
“槽数 Task Slot”代表的是每个 Task Manager 可以同时执行的子任务 Sub Task 数
“并行度 Parallelism”代表的是执行该任务的线程数，每个线程对应的就是一个 Sub Task，这些Sub Task可能在同一个 Task Manager 中，也可能分布在多个 Task Manager中</div>2020-01-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/03/c5/600fd645.jpg" width="30px"><span>tianbingJ</span> 👍（3） 💬（0）<div>感觉还是没有说Exactly Once是怎么实现的</div>2022-03-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/aa/24/01162b6c.jpg" width="30px"><span>UncleNo2</span> 👍（2） 💬（0）<div>那，计算代码是jobmanager生成的，还是由执行它的taskmanager生成的？</div>2021-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/87/6b/0b6cd39a.jpg" width="30px"><span>朱月俊</span> 👍（2） 💬（0）<div>slot是槽位的意思，每个槽位可以运行一个sub task。因此，TaskManager中的槽位有两个含义：（1）最多容纳sub task的个数；（2）最高并发数；</div>2020-07-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg" width="30px"><span>趁早</span> 👍（0） 💬（0）<div>Flink</div>2020-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/80/61/ae3bb67c.jpg" width="30px"><span>毛毛虫大帝</span> 👍（0） 💬（0）<div>ck是可以通过配置定时触发的，主要是由jobmanager负责管理与存储，每隔这个配置时间就会产生一个checkpoint barrier放到数据流中，并且在jobmanager里生成该pending状态的ck，那么等到所有的task在完成这个barrier前所有的数据处理后，便会提交该ck为completed。那么从现在开始，可以用这个ck来故障恢复了。</div>2020-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg" width="30px"><span>DFighting</span> 👍（0） 💬（0）<div>taskmanager.numberOfTaskSlots表示TaskManager可以支配的CPU内核数，和并行度并不是一个层次的概念，一个基础配置，一个是运行时可以从集群中分配到多少资源。
ps:关于流计算的相关知识有两篇文章可以学习下，我觉得他们是最好的Flink入门papper了</div>2019-10-28</li><br/>
</ul>