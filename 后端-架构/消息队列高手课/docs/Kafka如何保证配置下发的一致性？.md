你好，我是李玥。

我们这个课程讲解消息队列实现原理的内容，大多集中在数据面上，控制面的相关知识涉及较少。在这次加餐中，我会把这部分内容补充完整。

这节课中，我会带你一起分析 Kafka 的源代码，看一下 Kafka 是如何实现主题创建的。更重要的是，通过学习 Kafka 的实现方法，提炼并总结出在分布式系统中，保证配置下发一致性的方法。

## 分布式系统的控制面与数据面

任何一个分布式系统都可以按照功能划分为控制面与数据面。

数据面，可以理解为“业务数据流经的部分”，负责数据流入流出、执行业务逻辑处理数据和存储数据。控制面，顾名思义，管理控制集群的功能都被划分到控制平面，业务数据不会流经到控制面。控制面的主要功能包括：存储集群元数据、指导数据面路由、下发配置和策略以及实现集群高可用等。

以消息中间件为例说明。数据面包括生产者、Broker 和消费者。这些都是消息数据流经的组件，都属于数据面。

- 生产者：负责发消息。
- Broker：负责接收、存储和分发消息。
- 消费者：负责接收消息。

控制面的功能包括：元数据存储、消息路由、集群管理、高可用、选举、认证等功能。

- 元数据存储：负责保存集群主题、分区和副本以及集群配置等元数据。
- 消息路由：指导生产者将消息发送给特定的 Broker 节点，指导消费者从特定的 Broker 节点获取消息。
- 集群管理：负责主题创建、修改和删除，管理集群中的生产者、消费者和 Broker 节点。
- 高可用：监控集群节点的健康情况，必要时执行主从切换。
- 选举：负责集群内各种主节点选举，比如主副本选举等。
- 认证：负责管理用户的认证和权限控制，确保只有授权的用户才能访问特定的资源。