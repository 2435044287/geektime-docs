你好，我是郑建勋。

上节课，我们说分布式系统总是需要在可用性和数据一致性之间找到平衡，也就是既要确保当少部分节点发生故障时，程序仍然能够正确且正常地运行，又要保证分布式节点之间对某一事件达成共识。其实这并不是一件容易的事情，好在许多容错共识算法为我们提供了经过检验的解决方案。

可用性衡量了系统面对网络延迟、网络分区、系统故障时的容错能力。显然，如果我们遇到了极端的事件，例如地球毁灭了，我们是无法保证系统可用的。因此，大多数容错共识算法都会有一个前提，也就是至少需要大部分节点是正常的，这样系统才可以正常运行。

此外，大多数容错共识算法还有第二个前提，就像我在上节课提到的，不考虑节点中可能混入了攻击者，这样才能保证系统不会出现拜占庭问题。

而要保证数据一致性，当前比较有名的算法是：Paxos、Raft和Zab。我将其称为分布式容错共识算法，容错代表了在异常情况下仍然具有可用性和正确性，而共识代表的是数据的一致性，它意味着即便是在并发、异常等情况下也能达成共识。

Raft在现代分布式系统中有着重要的地位，K8s和课程中用到的etcd组件底层都采用了Raft算法。这节课，我就以Raft算法为例讲解容错共识算法是如何实现数据的一致性与可用性的。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg" width="30px"><span>Realm</span> 👍（3） 💬（0）<div>1 猜测一下，在结果返回给请求方之前，查下自己有没有收到新leader的心跳包，有的话，重新向新leader请求最新数据；没有的话，就把结果返回给请求者，这可能也还是有概率拿不到最新数据；

2 要成为 Leader 必须要包含过去所有的 Committed Entry；</div>2022-11-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/42/66/1c87bcfa.jpg" width="30px"><span>志豪</span> 👍（2） 💬（0）<div>raft算法实践中都是采用单数节点，当网络出现分区，某区域内节点数不过半则区域内的node无法通过选举产生leader，客户端也就无法读取数据；网络恢复后，节点交少的分区域term会小于其他分区域，作为follower加入到集群中，并且复制leader的日志，保持数据一致性</div>2022-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（0） 💬（0）<div>我记得 如果读请求到达 follow 节点，follow会请求 leader 节点 来判断 commit index 是否是最新的， 如果不是就会进行同步，在进行响应</div>2022-11-17</li><br/>
</ul>