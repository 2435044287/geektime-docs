你好，我是郑建勋。

程序的快速运行离不开内存这个重要的资源，存储在内存里的数据可以比磁盘等介质更快地被CPU访问。但是内存是有限的，当多个进程共用内存空间时更是如此。因此，合理安排、组织、管理、释放内存是构建高效程序的基础。

现代高级语言一般都为我们屏蔽了内存分配的细节，但是程序内存分配过大、内存泄露以及垃圾回收导致的性能下降却是非常常见的。了解Go内存管理的细节也有助于我们排查艰难的系统问题，指导我们写出高性能程序。

Go 语言运行时依靠细微的对象切割、极致的多级缓存、精准的位图管理实现了对内存的精细化管理。下面我们就来看一看具体是如何实现的。

## **内存**

在计算机中，内存又叫做主存，通常指的是可寻址的半导体存储器（硅基MOS晶体管组成的集成电路）。内存可分为非易失性内存和易失性内存两种，非易失性内存主要用于存储特殊的程序（例如BIOS），易失性内存通常指的是RAM（Random Access Memory，随机存储器）。主要用于存储当前正在使用的数据和机器码。

不管数据在物理内存的哪里，RAM几乎都允许在相同的时间内读取或写入数据。我们可以将物理内存视为下面这样的单元阵列，每一个单元可容纳8位的信息。每个内存单元都有一个地址，CPU可以通过寻址读取或者写入特定地址的数据。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg" width="30px"><span>Realm</span> 👍（1） 💬（0）<div>1. Golang的内存碎片问题，在用户态进行管理，操作系统层面觉得没有碎片；
2. Golang将内存分成了大大小小 67 个级别的 span，每次按需申请接近大小的span，并且也是按span进行GC，内部碎片带来的浪费影响相对较小；
3. 可能有些较小的外部碎片;

可能总体觉得必要性不大。</div>2023-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/37/b4/df897320.jpg" width="30px"><span>vooc</span> 👍（0） 💬（1）<div>原文：“pallocSum 是一个简单的 uint64，分为开头（start）、中间（max）、末尾（end）三部分，pallocSum 的开头与末尾部分各占 21bit，中间部分占 22bit，它们分别包含了这个区域中连续空闲内存页的信息。对于最顶层的节点，由于其 max 位为 22bit”

我阅读代码发现，中间部分其实也只占 22bit，只有一种情况：max == maxPackedValue 时，设置第64位来表示的。请问老师是否是这样呢？</div>2023-04-21</li><br/>
</ul>