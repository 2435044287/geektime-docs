你好，我是刘超。

开始今天的学习之前，我想先请你思考一个问题。假设现在有这样一个需求，让你设计一个装修功能，用户可以动态选择不同的装修功能来装饰自己的房子。例如，水电装修、天花板以及粉刷墙等属于基本功能，而设计窗帘装饰窗户、设计吊顶装饰房顶等未必是所有用户都需要的，这些功能则需要实现动态添加。还有就是一旦有新的装修功能，我们也可以实现动态添加。如果要你来负责，你会怎么设计呢？

此时你可能会想了，通常给一个对象添加功能，要么直接修改代码，在对象中添加相应的功能，要么派生对应的子类来扩展。然而，前者每次都需要修改对象的代码，这显然不是理想的面向对象设计，即便后者是通过派生对应的子类来扩展，也很难满足复杂的随意组合功能需求。

面对这种情况，使用装饰器模式应该再合适不过了。它的优势我想你多少知道一点，我在这里总结一下。

装饰器模式能够实现为对象动态添加装修功能，它是从一个对象的外部来给对象添加功能，所以有非常灵活的扩展性，我们可以在对原来的代码毫无修改的前提下，为对象添加新功能。除此之外，装饰器模式还能够实现对象的动态组合，借此我们可以很灵活地给动态组合的对象，匹配所需要的功能。

下面我们就通过实践，具体看看该模式的优势。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg" width="30px"><span>密码123456</span> 👍（50） 💬（2）<div>责任链。最常见到的就是接收http请求了。帮我们转码，转化成实体类，等等。策略模式。最常简单和用到的就是集合排序，自定义排序规则。装饰器，最常见到的就是各种流，比如字符流，字节流等</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg" width="30px"><span>nightmare</span> 👍（23） 💬（1）<div>netty中的pipeline，tomcat中的filter，属于责任链，   springmvc中对参数解析的就是 策略模式，每一个参数类型一个实现类，用for循环解析参数     java. io就是经典的装饰器模式</div>2019-08-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（8） 💬（1）<div>老师，为什么java io是装饰器模式</div>2019-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> 👍（4） 💬（1）<div>老师您好，想请教一下，在实际做优惠活动时，很多活动策略之间是相互排斥的，用了优惠1就不能用优惠2，用了优惠2就不能用红包。这种自动选择最优优惠策略，在哪里实现比较合理呢？多谢！</div>2019-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg" width="30px"><span>峰</span> 👍（3） 💬（1）<div>感觉老师在红包这个例子里面，其实最重要的解耦是装饰器实现的各种基本的优惠打折手段与工厂的各种优惠规则比如红包抵用券可叠加等等。
</div>2019-08-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/f8/bb/8b2ba45d.jpg" width="30px"><span>冯传博</span> 👍（3） 💬（4）<div>希望能有个类图，这样就能一目了然的看清楚各个类之间的关系了</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg" width="30px"><span>Liam</span> 👍（2） 💬（1）<div>请问老师，装饰器和代理有什么区别呢，代理也可以实现被代理的接口，并注入被代理对象实现功能扩展，最后可以委托被代理对象完成基础功能</div>2019-08-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（2） 💬（1）<div>public BigDecimal countPayMoney(OrderDetail orderDetail) {
		BigDecimal payTotalMoney = new BigDecimal(0);
		payTotalMoney = super.countPayMoney(orderDetail);
		payTotalMoney = countCouponPayMoney(orderDetail);
		return payTotalMoney;
	}
老师好!这里为啥要调用父类的countPayMoney()方法啊?
责任链模式:感觉责任连模式比较固定不怎么会变一层往一层调用，解耦，某一层变了不影响别的层。
策略模式:策略模式，虽然也是封装了很多不同的策略，但是使用时一般一次只选一个实现类使用，不会有嵌套。
装饰者模式:责任链有的优点他都有，装饰者还能动态组合。
谢谢老师，希望给出详细答案谢谢</div>2019-08-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/icHicAP9M4M4DIjAvlj5FDdFxIeA0pR3J15QdvVjXQXbznwunDN8OvrYqnsFchtBTNrZCCfGTE2RpPzIxjkvFAKg/132" width="30px"><span>奋斗的小白鼠</span> 👍（1） 💬（1）<div>老师，问一个小白问题，产品Map&lt;PromotionType, SupportPromotions&gt; supportPromotions; &#47;&#47;支持促销类型  怎么存入数据库了？</div>2019-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fe/36/df26de4a.jpg" width="30px"><span>依然亦晨</span> 👍（1） 💬（1）<div>老师，有个疑问，促销类型类里看到用了clone方法，原型模式，为什么后边都没用调用clone方法的地方呢？</div>2019-09-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>风轻扬</span> 👍（1） 💬（1）<div>老师，装修功能里面的BaseDecorator为什么要用abstract修饰呢？也没有抽象方法呢</div>2019-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（1） 💬（1）<div>😀老师，装饰器模式的性能优化点在哪里？是不是加速了研发调整代码扩展代码的速度!</div>2019-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/04/71/853b2292.jpg" width="30px"><span>Gred</span> 👍（1） 💬（1）<div>老师，您在SupportPromotions重写 clone 方法，只对类进行拷贝，但是成员变量只是浅拷贝，如果要实际应用业务场景，是不是应该改用深拷贝，避免其他订单的优化券等信息影响到了。</div>2019-08-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJwQvLGE4dMsF4JU0svW3DtGbodpjskbY65FdwF13JdtBYZfgL2IXHlHrdejWzHdjT0RibEIfib4QYA/132" width="30px"><span>知行合一</span> 👍（1） 💬（1）<div>BigDecimal payTotalMoney = new BigDecimal(0);
payTotalMoney = super.countPayMoney(orderDetail);
payTotalMoney = countCouponPayMoney(orderDetail);
payTotalMoney不就被覆盖了吗？</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg" width="30px"><span>天天向上</span> 👍（0） 💬（1）<div>有个问题，对于业务系统，都是对数据库的增删改查，这种的，很难用到设计模式吧。</div>2020-05-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/06/3b/456d0a2a.jpg" width="30px"><span>wuyin</span> 👍（0） 💬（4）<div>public static BigDecimal getPayMoney(OrderDetail orderDetail) { &#47;&#47;获取给商品设定的促销类型 Map supportPromotionslist = orderDetail.getMerchandise().getSupportPromotions(); &#47;&#47;初始化计算类 IBaseCount baseCount = new BaseCount(); if(supportPromotionslist!=null &amp;&amp; supportPromotionslist.size()&gt;0) { for(PromotionType promotionType: supportPromotionslist.keySet()) {&#47;&#47;遍历设置的促销类型，通过装饰器组合促销类型 baseCount = protmotion(supportPromotionslist.get(promotionType), baseCount); } } return baseCount.countPayMoney(orderDetail); } 
baseCount只会有一种优惠类型吧，怎么进行组合计算呢</div>2019-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>风轻扬</span> 👍（0） 💬（1）<div>老师，知行合一同学提的问题。
BigDecimal payTotalMoney = new BigDecimal(0);
payTotalMoney = super.countPayMoney(orderDetail);
payTotalMoney = countCouponPayMoney(orderDetail);
payTotalMoney不就被覆盖了吗？
这里的super.countPayMoney()是不能去掉的。去掉就报空指针
RedPacketDecorator中的super代表的是BaseCount，super.countPayMoney()承担着计算总额的任务。
CouponDecorator中的super代表的是RedPacketDecorator，这里的super.countPayMoney()承担着计算计算红包优惠额的任务。
两个super.countPayMoney都不可以省略的。
望老师明示</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" width="30px"><span>QQ怪</span> 👍（27） 💬（0）<div>老师这个案例来的太及时了，正想重构公司订单优惠劵红包扣除这方面的代码，真的是及时雨啊？厉害厉害👍🏻</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg" width="30px"><span>李英权</span> 👍（12） 💬（0）<div>每次看到有人这样做装饰器或者策略模式的初始化，都觉得很可惜，因为这徒增了很多麻烦，其实完全可以把装饰器或策略实现作为枚举值的成员变量 初始化到枚举类型中。无论是以后扩展还是平时使用 都非常简单自然。</div>2020-02-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/39/26/61e46afe.jpg" width="30px"><span>CCC</span> 👍（8） 💬（0）<div>有几个今年秋招的！举个手！老师的课程真的收获很多！</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d1/5c/ff82e7d2.jpg" width="30px"><span>飞鸽</span> 👍（2） 💬（0）<div>促销、红包这种情况复杂多变。基于规则配置处理更好。</div>2019-09-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/6e/3bd860d3.jpg" width="30px"><span>.</span> 👍（1） 💬（0）<div>装饰模式优化商品价格策略例子举的很实际挺好</div>2020-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/37/bd/d0ac0061.jpg" width="30px"><span>Jake</span> 👍（0） 💬（0）<div>工厂类getPayMoney方法中，for循环遍历获取到IbaseCount对象，而执行在for循环外执行&quot;baseCount.countPayMoney(orderDetail);&quot;那么执行使用优惠券和红包优惠只能执行一个，为啥结果确实又优惠券金额：3红包优惠金额：10，这里看不懂，哈哈哈请大佬们指点指点</div>2023-01-31</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132" width="30px"><span>walle斌</span> 👍（0） 💬（1）<div>一开始也是这么。。后来抽自己的组件模块写引擎。。再后来开始构建portal配置各种分支逻辑，以引擎的方式解释portal。。基本实现了固有功能的配置化。。需求只要不超过之前以及我们的预期。。基本由产品在页面配置即可。。</div>2022-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/06/a2/350c4af0.jpg" width="30px"><span>知易</span> 👍（0） 💬（0）<div>for(PromotionType promotionType: supportPromotionslist.keySet()) {&#47;&#47;遍历设置的促销类型，通过装饰器组合促销类型
				baseCount = protmotion(supportPromotionslist.get(promotionType), baseCount);
			}
循环这里，后面的baseCount不是覆盖了前面的baseCount么，，这里咋运作的没搞懂呢</div>2021-05-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg" width="30px"><span>Java垒墙工程师</span> 👍（0） 💬（0）<div>CouponDecorator 和RedPacketDecorator一模一样的逻辑代码重复</div>2020-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg" width="30px"><span>Java垒墙工程师</span> 👍（0） 💬（0）<div>这个是个杂糅模式，贴合实际，不是标准的装饰器</div>2020-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bc/a3/abb7bfe3.jpg" width="30px"><span>wisboy</span> 👍（0） 💬（0）<div>BigDecimal payTotalMoney = new BigDecimal(0);
		payTotalMoney = super.countPayMoney(orderDetail);
		payTotalMoney = countCouponPayMoney(orderDetail);
		return payTotalMoney;
挺困惑的，可读性，也不太好，有没有更好的实现方式。</div>2020-07-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/cc/0d/89435926.jpg" width="30px"><span>10年以后</span> 👍（0） 💬（0）<div>设计模式</div>2020-03-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（0） 💬（0）<div>老师你讲的太好了，要加餐加餐</div>2019-09-01</li><br/>
</ul>