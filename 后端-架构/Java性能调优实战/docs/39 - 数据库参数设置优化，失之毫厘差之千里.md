你好，我是刘超。

MySQL是一个灵活性比较强的数据库系统，提供了很多可配置参数，便于我们根据应用和服务器硬件来做定制化数据库服务。如果现在让你回想，你可能觉得在开发的过程中很少去调整MySQL的配置参数，但我今天想说的是我们很有必要去深入了解它们。

我们知道，数据库主要是用来存取数据的，而存取数据涉及到了磁盘I/O的读写操作，所以数据库系统主要的性能瓶颈就是I/O读写的瓶颈了。MySQL数据库为了减少磁盘I/O的读写操作，应用了大量内存管理来优化数据库操作，包括内存优化查询、排序以及写入操作。

也许你会想，我们把内存设置得越大越好，数据刷新到磁盘越快越好，不就对了吗？其实不然，内存设置过大，同样会带来新的问题。例如，InnoDB中的数据和索引缓存，如果设置过大，就会引发SWAP页交换。还有数据写入到磁盘也不是越快越好，我们期望的是在高并发时，数据能均匀地写入到磁盘中，从而避免I/O性能瓶颈。

> SWAP页交换：SWAP分区在系统的物理内存不够用的时候，就会把物理内存中的一部分空间释放出来，以供当前运行的程序使用。被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间的数据被临时保存到SWAP分区中，等到那些程序要运行时，再从SWAP分区中恢复保存的数据到内存中。
<div><strong>精选留言（21）</strong></div><ul>
<li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eotSSnZic41tGkbflx0ogIg3ia6g2muFY1hCgosL2t3icZm7I8Ax1hcv1jNgr6vrZ53dpBuGhaoc6DKg/132" width="30px"><span>张学磊</span> 👍（44） 💬（4）<div>通过在内存中维护一个链表，并使用LRU(最近最少使用)算法淘汰非热点数据</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg" width="30px"><span>晓杰</span> 👍（23） 💬（1）<div>mysql的缓冲池（buffer_pool）使用改进版的lru算法来缓存数据，如果使用传统的lru算法，会存在预读失效和缓冲池污染的问题，为了解决预读失效问题，mysql将lru分为新生代和老生代，为了解决缓冲池污染的问题，引入老生代停留时间窗口，只有大于设置的值，才能加入新生代头部</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/b0/65/90387745.jpg" width="30px"><span>Mr.wang</span> 👍（16） 💬（1）<div>刘老师，您可以详细讲一下redolog和binlog吗，以后他们的使用场景吗？</div>2020-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（14） 💬（2）<div>我来回答一下思考题：
InnoDB 的缓存淘汰策略是分代的，分为老年代和新生代，大致是7：3，新数据总是先加入到新生代，如果在一定时间内有被再次查询，才会进入到老年代。老年代和新生代内部都是LRU算法来淘汰缓存页的。</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg" width="30px"><span>晓杰</span> 👍（6） 💬（2）<div>mysql8.0已经没有用查询缓存了</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/38/f1/996a070d.jpg" width="30px"><span>LW</span> 👍（5） 💬（1）<div>IBP通过LRU链表管理热点数据和淘汰非热点数据，LRU本身分为两大区域，young区域和old区域，热点数据在young区，非热点数据在old区。其实LRU的划分还更细致，young区还划分成几个不同的区域。</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（3） 💬（2）<div>老师好!问个问题，这些IO操作，是同步阻塞，还是同步非阻塞啊?</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/43/3e/960d12cb.jpg" width="30px"><span>DY</span> 👍（0） 💬（3）<div>老师，你好。有个问题请教下。select id from order_detail where order_id between 5000 and 10000；这种sql根据索引查询，为什么当条件是=时不回表，是区间段时就回表。非聚簇索引的叶子结点存放的不是主键吗？怎么索引查询区间段时就回表了</div>2019-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg" width="30px"><span>张德</span> 👍（0） 💬（1）<div>记得好像是lru算法  新旧比例好像是5比3</div>2019-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg" width="30px"><span>晓杰</span> 👍（0） 💬（1）<div>老师，redo log和bin log好像不是在更新语句提交事务成功就刷新到磁盘的。</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/b3/96847546.jpg" width="30px"><span>lik</span> 👍（32） 💬（5）<div>这个专栏的综合质量真的很高， 不懂为什么订阅量这么少。</div>2019-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/04/51/da465a93.jpg" width="30px"><span>超威丶</span> 👍（5） 💬（0）<div>其实内存分配也是分了新老区，防止大量的历史数据数据的查询占用整个内存，热点数据缓存命中率降低，不止是LRU淘汰这么简单</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/57/4e/791d0f5e.jpg" width="30px"><span>贺爷</span> 👍（0） 💬（0）<div>说实话老师这个专栏的质量确实很高，干货满满，这是我看第二遍，每次看都有收获</div>2022-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/07/d2/0d7ee298.jpg" width="30px"><span>惘 闻</span> 👍（0） 💬（1）<div>innodb_flush_log_at_trx_commit
当设置该参数为  2  时，每次事务的 redo log 都会直接写入到文件中，再将文件刷新到磁盘。
而在一些可以容忍数据库崩溃时丢失 1s 数据的场景中，我们可以将该值设置为 0 或 2，这样可以明显地减少日志同步到磁盘的 I&#47;O 操作。
老师这里设置为二是先写入缓存文件中,然后过段时间再刷入磁盘吗?


</div>2020-12-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4d/66/28742ad4.jpg" width="30px"><span>水浴清风</span> 👍（0） 💬（0）<div>在更新操作时，既然已经记录了binlog，为什么还需要redo日志，binlog为什么不能保证crash-safe</div>2020-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg" width="30px"><span>Better me</span> 👍（0） 💬（1）<div>老师我想问下当innodb_flush_log_at_trx_commit=2，MySQL异常宕机是会发生丢数据的情况吗</div>2020-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（0）<div>老师，通常，建议 innodb_buffer_pool_instances 的大小不超过 innodb_read_io_threads + innodb_write_io_threads 之和，建议实例和线程数量比例为 1:1。  

这个建议具体是根据什么来做的判断呢？</div>2020-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（0）<div>老师innodb_buffer_pool_instances 的值是指 缓冲池划分后的区域实例的数量吧。而单个区域实例的大小怎么确定哦？ 是innodb_buffer_pool_size &#47; innodb_buffer_pool_instances  的值吗？</div>2020-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg" width="30px"><span>美妙的代码</span> 👍（0） 💬（0）<div>老师，当Linux系统没有配置SWAP 分区的情况下，mysql应该不会产生SWAP 页交换吧。</div>2020-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg" width="30px"><span>达达队长</span> 👍（0） 💬（1）<div>老师：日志文件脏页的缓存数据刷新到磁盘中，脏页数据指的是什么呀？</div>2020-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（0）<div>尴尬 MySQL 一直用不过自己到没怎么调整过他的配置参数，本地库没什么问题就是开发使用，生产库基本属于看不见摸不着的状态有专门的DBA来维护，OK，打卡，自己在本地也可以玩一把!</div>2019-09-15</li><br/>
</ul>