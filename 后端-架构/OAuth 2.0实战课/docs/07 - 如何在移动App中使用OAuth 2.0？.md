你好，我是王新栋。

在前面几讲中，我都是基于Web应用的场景来讲解的OAuth 2.0。除了Web应用外，现实环境中还有非常多的移动App。那么，在移动App中，能不能使用OAuth 2.0 ，又该如何使用OAuth 2.0呢？

没错，OAuth 2.0最初的应用场景确实是Web应用，但是它的伟大之处就在于，它把自己的核心协议定位成了一个框架而不是单个的协议。这样做的好处是，我们可以基于这个基本的框架协议，在一些特定的领域进行扩展。

因此，到了桌面或者移动的场景下，OAuth 2.0的协议一样适用。考虑到授权码许可是最完备、最安全的许可类型，所以我在讲移动App如何使用OAuth 2.0的时候，依然会用授权码许可来讲解，毕竟“要用就用最好的”。

当我们开发一款移动App的时候，可以选择没有Server端的 “纯App” 架构，比如这款App不需要跟自己的Server端通信，或者可以调用其它开放的HTTP接口；当然也可以选择有服务端的架构，比如这款App还想把用户的操作日志记录下来并保存到Server端的数据库中。

那总结下来呢，移动App可以分为两类，一类是没有Server端的App应用，一类是有Server端的App应用。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/8d/9f/776d9b2e.jpg" width="30px"><span>青峰</span> 👍（19） 💬（1）<div>请问老师，如果采用第一种办法生成code_verifier，code_challenge_method=plain，那么code_verifier 的值就是 code_challenge 的值。
这时候，不是获得了code_challenge 就可以推出 code_verifier 的值了吗？</div>2020-07-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/22/e0/6295a753.jpg" width="30px"><span>Harvey</span> 👍（11） 💬（1）<div>用code_verifier验证code_challenge通过只能证明后一次请求和前一次是从同一个客户端发起的吧？怎么能起到app_secret证明客户端是谁是否合法的作用呢？</div>2020-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/96/0f/d9d878f8.jpg" width="30px"><span>leros</span> 👍（6） 💬（1）<div>在PKCE协议下，第三方应用掌握了太多的秘密（verifier, challenge)，考虑到移动终端千差万别，保证第三方应用的安全并不容易</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" width="30px"><span>往事随风，顺其自然</span> 👍（3） 💬（2）<div>“迷你”的 Web 服务器嵌入到 App 里面去，这个不大理解。
 App 通过监听运行在 localhost 上的 Web 服务器 URI 这个是怎么实现的？</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/fa/dd/f640711f.jpg" width="30px"><span>哈德韦</span> 👍（3） 💬（2）<div>如果 Web 端也采用 PKCE 协议，是不是也不需要服务器端了（既纯Web前端也可以对接 OAuth 服务）？</div>2020-07-14</li><br/><li><img src="" width="30px"><span>Geek_7b3867</span> 👍（1） 💬（1）<div>老师，在有服务器的情况下，详细的那个图中是会拉起微信进行用户授权，这样到了微信开放平台是可以验证是谁授权的；但是无服务器的情况下，生成code_verifier和code_challenge过程并未看到用户授权，这两个值传到微信后台如何判断是谁授权的？如何校验？</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/97/1a/389eab84.jpg" width="30px"><span>而立斋</span> 👍（1） 💬（1）<div>code_verifier是不是就可以理解为一个随机字符串</div>2020-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/f9/15/584103d6.jpg" width="30px"><span>Ryan Pan</span> 👍（1） 💬（1）<div>请问如果移动App是自家的，用资源拥有者授权的话，app secret建议存哪里呢？</div>2020-07-14</li><br/><li><img src="" width="30px"><span>Geek_9ae2b9</span> 👍（0） 💬（1）<div>对比了PKCE 协议和隐式许可，两种都是适用于没有Server端的场景。但PKCE 协议感觉更安全，既然如此为什么还需要隐式许可呢？</div>2020-07-20</li><br/><li><img src="" width="30px"><span>suhuijie</span> 👍（0） 💬（1）<div>微信自己登陆用的什么机制，也是OAuth还是？</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（0） 💬（1）<div>如果拿到 app_id 是不是就可以冒充该客户端短了？ 还是授权服务还必须要验证 app_id 和 redirect_uri 
绑定关系的？</div>2020-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f9/6f/32268611.jpg" width="30px"><span>Mr.Robot</span> 👍（8） 💬（0）<div>PKCE 应该是防止code 返回的时候被hacker 截获 然后直接用code 去获取授权（在没有后台的情况下）。
但是如果 获取code 发送请求时。code_verifier 也被截获。 hacker 也是可以通过这两个参数去后台获取token的把？</div>2020-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg" width="30px"><span>曙光</span> 👍（3） 💬（1）<div>“而恰恰在第二步换取访问令牌的时候，授权服务需要的就是 code_verifier 的值。因此，这也就避免了访问令牌被恶意换取的安全问题。”  如果截获的是访问令牌，那PKCE是不是就起不到作用了？目前我的理解，PKCE增强了code被截获的安全性，但对访问令牌被截获，无能为力。</div>2020-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/03/77/3f6a76a9.jpg" width="30px"><span>极客</span> 👍（1） 💬（1）<div>想问一下，不用oauth直接用rsa加密传输会不会更好，交互少，没有重定向。1.第三方客户端请求第三方的服务端，拿到我们公钥加密的数据，带上第三方对指定数据的签名，青叔音我们平台，2.我们平台解密验证签名，成功后用第三方的公钥加密正确的token。3第三方去自己的后台解密。只有3个流程还不用担心安全。这个会不会比oauth更好呢？不懂为啥不用这种，各个平台还搞oauth？</div>2021-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/69/f0/edecdc5d.jpg" width="30px"><span>邓文斌</span> 👍（1） 💬（0）<div>请教老师，假如我现在有三个自家的APP，以后可能也有第三方的，这三个APP分别是A,B,C，然后A,B,C有各自的sever端，但是用户资源在A的server端，所以得通过A的sever做登录验证，目前有个需求要做一个统一授权服务器，去给B和C颁发令牌做授权，让B和C通过A授权登录获取用户信息，用Oauth2的哪种模式合适？目前看了你的文章觉得授权码模式合适，感激！现在就是不了解这个授权服务器怎么去落地。</div>2021-03-30</li><br/><li><img src="" width="30px"><span>Geek_7c4953</span> 👍（1） 💬（1）<div>像微信APP请求自家服务端code的流程，OAuth2.0是否有提供规范呢？我个人是比较支持前后端分离的架构，但OAuth2.0的授权服务似乎都是前后端一体的。像是code模式，都是由后端重定向传递。是否有一种前后端分离的，前端调用code接口，后端返回code后再由前端传递给第三方应用的规范框架呢？就像微信那样。</div>2020-11-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg" width="30px"><span>曙光</span> 👍（1） 💬（0）<div>思考题，参考PKCE，增加多一层的随机码，发给服务器校验，就能提升安全性。例如微信云服务器的MFA码，阿里云的手机验证码。
就像一道安全门如果觉得不够安全，那就再加一道门。实际上，没有绝对的安全，这只是在增加小偷开门对成本。如果增加小偷的开门成本，其实也增加了用户的开门成本。</div>2020-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg" width="30px"><span>我行我素</span> 👍（1） 💬（0）<div>请问：code_verifier在app端随机生成，服务端也不知道结果，那么怎么验证是否是合法的呢？</div>2020-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（0） 💬（0）<div>作个笔记：PKCE发布的目的是为了缓解针对公开客户端的攻击，主要是解决授权码窃听的攻击。</div>2024-03-01</li><br/><li><img src="" width="30px"><span>Grayson</span> 👍（0） 💬（0）<div>老師您好，請問根據 RFC8252 這份協議中，跟 oauth 有什麼樣的差異嗎？</div>2024-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/34/cf/0a316b48.jpg" width="30px"><span>蝴蝶</span> 👍（0） 💬（0）<div>我有一个疑问，在使用微信App 给目标 App 授权时，目标 App 是不是也要有提供自己的app_id？和它配套的后端服务器使用的同样的 app_id吗？或者说第三方 App 什么都不需要准备？只需要后端服务器在微信开放平台申请了 app_id和 app_secret?</div>2023-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/69/bf/58f70a2a.jpg" width="30px"><span>程序员花卷</span> 👍（0） 💬（0）<div>微信小程序登录后获取access_token时使用的是 &quot;客户端模式&quot;，没有用到code</div>2023-02-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/69/a3/025fef27.jpg" width="30px"><span>eggsy</span> 👍（0） 💬（0）<div>请问，如果没有server的app，那么使用资源拥有者凭据这种方式不行吗？</div>2022-12-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/22/b0/050676f5.jpg" width="30px"><span>樱花</span> 👍（0） 💬（0）<div>这种只有在用户输入的callback_url是http的时候, 才有被截获的风险, 然后这套流程才算增加了安全性</div>2022-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/b8/21/f692bdb0.jpg" width="30px"><span>路在哪</span> 👍（0） 💬（1）<div>既然 code和 code_challenge ，那么code_verifier不也能截获吗.然后就能又获取token了..</div>2022-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e0/09/eb3da11d.jpg" width="30px"><span>孟令超</span> 👍（0） 💬（0）<div>请问老师能给讲讲app_secret的作用吗，app_secret是起到获取token时候验签的作用</div>2021-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/17/b6/ac21f221.jpg" width="30px"><span>Edison鹏</span> 👍（0） 💬（0）<div>是否所有支持OAuth2.0协议的平台也都支持PKCE协议呢?</div>2020-09-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/30/5e/c42bc33f.jpg" width="30px"><span>Younger Ku</span> 👍（0） 💬（0）<div>老师好，第一步使用code_challenge获取授权码，第二步使用code_verifier获取访问令牌；这两步中的请求和响应数据都应该是加密的吧？如果是的话那么之前讲四种授权许可类型时所列举代码示例中的请求和响应数据也都应该是加密的吧。</div>2020-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/4b/e9/bbccf643.jpg" width="30px"><span>sanmao</span> 👍（0） 💬（0）<div>有一个这样的场景, 我在负责公司的开放平台, 现在公司有一款小程序需要使用这个开放平台. 现在有两个问题困扰了我. 1: 这样要对接多个开放平台的小程序认证流程该如何设计. 2: 已经在微信公众平台认证过的小程序, 再接入公司的开放平台的这个认证过程怎么设计比较合理.</div>2020-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/36/73/ac688ddf.jpg" width="30px"><span>微风</span> 👍（0） 💬（1）<div>没有 Server 端的 App用例中，如果授权码 code 被截获，再加上 code_challenge 也同时被截获了。那就可以伪造回去token了。怎么保证安全的？</div>2020-07-19</li><br/>
</ul>