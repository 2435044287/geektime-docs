你好，我是王新栋。

在咱们这门课中，我提到了很多次“开放平台”，不难理解，它的作用就是企业把自己的业务能力主要以开放API的形式，赋能给外部开发者。而作为第三方开发者或者ISV（独立软件供应商）在接入这些开放平台的时候，我们最应该关心的就是它们的官方文档，关注接入的流程是怎样的、对应的API是什么、每个API都传递哪些参数，也就差不多够了。

到这里，你会发现“开放平台的官方文档”会是一个关键点。不过呢，当你去各大开放平台上面看这些文档的时候，就会发现这些文档非常分散。

其中的原因也很简单，那就是开放平台为了让已经具备OAuth 2.0知识的研发人员去快速地对接平台上面的业务，把各类对接流程做了分类归档。比如，你会发现微信开放平台上有使用授权码获取授权信息的文档，也有获取令牌的文档，但并没有一份整体的、能够串起来的文档说明。从我的角度来看，这其实也就间接提高了使用门槛，因为如果你不懂OAuth 2.0，基本是没办法理解那些分类的。

那么，今天我就借着这个点，和你说说以京东、微信、支付宝、美团为代表的各大开放平台是如何使用OAuth 2.0的。理解了这个问题，你以后再对接一个开放平台、再阅读一份官方对接文档时，就更能明白它们的底层逻辑了。
<div><strong>精选留言（24）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（17） 💬（2）<div>访问令牌 access_token 的有效性在API GATEWAY 层 已经验证过了，所以不需要向受保护资源服务传递， 只需要把 token 的有效用户信息提取出来向后传递就可以了</div>2020-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/af/f2/69fa8b77.jpg" width="30px"><span>她的男孩</span> 👍（5） 💬（1）<div>受保护的资源服务部做任何的安全相关的设计吗？</div>2020-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg" width="30px"><span>Hurt</span> 👍（2） 💬（1）<div>老师 接入支付和OAuth2.0有什么异同呢</div>2020-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f9/6d/b623562a.jpg" width="30px"><span>霹雳大仙pp</span> 👍（1） 💬（1）<div>jwt或者显式传递用户数据</div>2020-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/7f/24/719ce9d4.jpg" width="30px"><span>AgCl</span> 👍（0） 💬（4）<div>正惆怅这一层该如何弄，看上一篇介绍用JWT的，这一层信息敏感度应该会弱一些，之前还想这一层直接传用户ID下去就好了，还望老师解答，谢谢</div>2020-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/d6/68/3855df56.jpg" width="30px"><span>胖大蟲</span> 👍（6） 💬（2）<div>关于redirect_uri我不太明白，既然在注册的时候已经填了，为什么请求授权码时还要再传一遍这个参数？</div>2020-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/60/51/e21d740f.jpg" width="30px"><span>林绵程</span> 👍（2） 💬（0）<div>老师， 用户第一次第三方授权后如果access_token不给到客户端，客户端下次登录的时候拿什么凭证来跟小兔授权？是实现登录的过程中小兔需要跟自己的客户端去有个凭证交互的过程么？</div>2021-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e9/a6/69907ec1.jpg" width="30px"><span>尔霍</span> 👍（1） 💬（0）<div>想咨询一下，关于开发者的权限这块如何设计，通过scope如何与系统的真实权限结合起来呢？</div>2021-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/53/33/379456b7.jpg" width="30px"><span>醇氧</span> 👍（1） 💬（0）<div>老师你好，除了spring Security 自己的4个模式。那我们自己定义一个模式，也是可以的吧，我自己写这个定义的模式会影响到其他的模式不可用。 比如会 org.springframework.security.authentication.ProviderNotFoundException: No AuthenticationProvider found for org.springframework.security.authentication.UsernamePasswordAuthenticationToken 这样的异常。有相关学习的案例吗，我们学习一下。谢谢老师</div>2021-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg" width="30px"><span>Alex</span> 👍（1） 💬（0）<div>看内部安全要求，不考虑内部攻击的话可以直接用户标识。如果考虑内部安全就在网关转成jwt降低认证服务压力</div>2020-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/03/e2/5768d26e.jpg" width="30px"><span>inrtyx</span> 👍（1） 💬（0）<div>token转成jwt?</div>2020-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/32/c4/03/511aa353.jpg" width="30px"><span>H</span> 👍（0） 💬（0）<div>请问api网关会负责做水平越权的处理么</div>2023-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/38/4a/bd/f7f1b3b2.jpg" width="30px"><span>好好生活</span> 👍（0） 💬（0）<div>还有一个问题，网关是专门为开放平台用的，还是受保护的资源也通过网关调用</div>2023-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/38/4a/bd/f7f1b3b2.jpg" width="30px"><span>好好生活</span> 👍（0） 💬（0）<div>老师有个问题，就是网关层对access_token检验之后，请求资源服务时，资源服务肯定有身份验证，这个时候是怎么通过验证的</div>2023-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg" width="30px"><span>花花大脸猫</span> 👍（0） 💬（0）<div>老师，请教一个问题，类似一个门户的系统，需要对接很多第三方的web，在登陆门户后，会看到很多第三方软件，这种场景下，还适合使用OAuth2的授权码流程么？</div>2022-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg" width="30px"><span>coconut</span> 👍（0） 💬（0）<div>* &quot;client&quot;(应用)可以用&quot;access token&quot;访问&quot;受保护资源&quot;
* &quot;受保护资源&quot;可以是api网关暴露出的服务</div>2022-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/84/2c/1b0926b4.jpg" width="30px"><span>Even</span> 👍（0） 💬（0）<div>Jwt，解析用户信息往后传递就行</div>2022-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/f0/58/87104eab.jpg" width="30px"><span>Apologize</span> 👍（0） 💬（0）<div>API网关是否继续向后端传递access token取决于业务场景，如果网关能够完成所有的认证动作则不需要继续传递token，如果网关无法完成全部认证动作则需要继续传递token。</div>2022-01-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e0/09/eb3da11d.jpg" width="30px"><span>孟令超</span> 👍（0） 💬（0）<div>老师，第三方软件开发者中心服务设计都需要考虑什么</div>2021-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/33/73/40c662b6.jpg" width="30px"><span>caowei</span> 👍（0） 💬（0）<div>老师，服务直接需不需要使用客户端模式鉴权了，如果使用客户端鉴权是不是会带来性能损耗，如果不鉴权会不会直接访问端口的风险，大厂一般怎么搞了？</div>2020-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg" width="30px"><span>JianXu</span> 👍（0） 💬（0）<div>“当有了 API 网关这一层的时候，这些校验工作就会都落到了 API 网关的身上，因为我们不能让很多个受保护资源服务做同样的事情” — 为什么不能让受保护资源做同样的事情呢？这样更安全啊</div>2020-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg" width="30px"><span>曙光</span> 👍（0） 💬（0）<div>思考题，不需要传递access_token,而是access_token绑定的用户id信息和权限信息（查询当天数据，还是历史数据）</div>2020-09-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK4ibibOsboHycltqqicSIkm9eibSBu86BRNc0LQnTRTMEPGDvJXYpBicWOW4srMt7c9iaUT7b5mTmicgkjw/132" width="30px"><span>Geek_6a58c7</span> 👍（0） 💬（2）<div>老师你好，请问一下，如果网关认证通过，下一毫秒就过期，内部访问是可以继续吗，或者要怎么处理好</div>2020-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8a/a3/aee7ded7.jpg" width="30px"><span>在路上</span> 👍（0） 💬（0）<div>api 网关向后台传递的是jwt，包括用户信息和权限信息等。</div>2020-07-28</li><br/>
</ul>