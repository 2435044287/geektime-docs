你好，我是谢友鹏。

在当今互联网应用中，流量的激增往往是不可预见的，无论是因为短期促销活动的推动，还是因为某些突发事件的影响。

例如，一场热门商品的限时促销，可能会瞬间吸引大量用户涌入，服务器瞬间负荷过重，导致应用崩溃，甚至影响到正常业务的运营。而在云存储服务等应用中，针对不同等级的会员，流量需求差异较大，基础服务往往需要防止高频次调用的用户占用过多资源，影响整体性能。

更严重的是，网络攻击手段也在不断升级，恶意流量也可能以惊人的速度涌入，试图击垮整个系统。在这种背景下，限流作为一种有效的流量控制手段，显得尤为重要。它不仅能有效防止单个请求过载系统，还能够保障不同流量来源的公平性，保护系统免受攻击或异常流量的影响，确保用户体验不受破坏。

今天我们就来学习一下限流的方案。

## 常用限流算法

限流的实现离不开算法，我们看看常用的算法有哪些。

### 计数器

最简单的算法是“计数器”法。每分钟统计一次请求数量，超过设定的阈值就拒绝请求，这听起来很简单对吧？

但是，这种简单粗暴的统计方法可能会导致“漏限”产生“尖峰流量”的问题，导致流量暴涨时系统依然无法承受。我们可以通过一个示意图来说明这个问题：

![](https://static001.geekbang.org/resource/image/a0/dc/a07102c105d38a278413ca0e71a15ddc.jpg?wh=4000x1196)

假设一个系统每10分钟只能处理8个请求，如果按10分钟为单位进行统计，请求超过8就拒绝，10分钟过后计数清零。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/24/7e/73/a5d76036.jpg" width="30px"><span>DoHer4S</span> 👍（0） 💬（0）<div>1. 单纯缩短直接计数法的时间窗口会导致应对突发且持续的流量监控不足；窗口太小也会导致整个系统对于流量变化会非常敏感，造成频繁的限流动作影响正常业务；此外频繁进行算法比较会影响系统性能；
2. 没有意义。 在令牌桶算法中，如果令牌桶已经满了（即桶中的令牌数量达到了最大容量），则继续往里面放令牌是没有意义的，因为桶已经达到了它的容量上限。令牌桶算法的核心思想是控制单位时间内的请求流量，桶满时不再新增令牌可以保证不会超出设定的流量限制，应该进行程序优化，设置超时机制。</div>2025-02-21</li><br/>
</ul>