你好，我是李玥。

非常开心在结课近两年后的今天，我又有机会和你分享这段时间，我对存储技术一点新的思考。

最近我的工作重心有了一些变化，更加关注高可用架构在大规模系统落地工程实践方法。在存储技术领域，对平衡存储系统的一致性和可用性的设计方法，也有了一些新的认知，在这里分享给你。

**无论技术如何发展，保证系统高可用最基础也是最本质的方法从没有改变过。相信你已经猜到这种方法是什么了，是的，就是冗余。**简单地说，冗余就是为你的系统准备多个副本，或者说是多个实例，它们提供同样的服务，共同工作。这样即使其中一个副本或者实例出现了故障，其它的实例仍然可以替这个故障实例承担工作，保证你的系统持续可用。

对于数据库、KV存储等存储系统来说，同样是通过冗余，或者说多副本的方法来实现其高可用架构的。但相比于无状态的系统，有状态的存储系统使用这种冗余的方法时，需要额外维护多个副本上的数据一致性。[第13讲](https://time.geekbang.org/column/article/215383)中，我们讲的MySQL主从同步，以及在这一讲末尾给你总结的复制状态机理论，就是MySQL维护主库和从库数据一致性的方法。

在分布式存储系统中，让系统中多个实例的状态保持一致，是一个比较难处理的问题。尤其是当系统出现故障时，系统能否始终保持一致性，很大程度上影响了系统的可用性和数据的可靠性。
<div><strong>精选留言（10）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/26/bf/52/59304c42.jpg" width="30px"><span>默默且听风</span> 👍（6） 💬（0）<div>我以为消息队列高手课给我的启发就够多了，万万没想到，这门课更厉害</div>2022-05-05</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/rvQxUmekECjyZu1RwbUguBWpBcQuKywQPtiaxNVFJSib07QMZnNUr8MnRF3RYEsn6MhgGFJibwlrVomibEicYMiaia7ZQ/132" width="30px"><span>Geek_a8ce05</span> 👍（4） 💬（0）<div>我觉得是必要的。系统可能出现各种问题导致数据不一致，有了这层防御性设计，可以更早的发现系统不一致 的问题，避免错误进一步扩大。</div>2022-04-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/bb/56/05459f43.jpg" width="30px"><span>Geek_h6mwnx</span> 👍（4） 💬（0）<div>思考题: 个人认为不是必要的，1. 数据不一致是因为系统设计或者代码有问题才会出现  2. 大量数据的比对修复速度也很慢。只有在上线新代码可能影响数据一致性时，防御性的设计才会派上用场，用于发现并修复问题。</div>2022-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/db/e5/26c2f7de.jpg" width="30px"><span>奔跑的小黄牛</span> 👍（3） 💬（0）<div>感谢老师的分享！</div>2022-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/8b/c3/bf036d99.jpg" width="30px"><span>砥砺奋进</span> 👍（1） 💬（0）<div>通过定期比对各副本状态数据的一致性，可以及时发现和修复数据不一致的问题，从而避免数据损失或系统崩溃。可以提高系统的可靠性和健壮性，从而确保系统能够在各种情况下都能够正常运行。因此，我认为这种防御性设计是非常必要的。</div>2023-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/33/9a/f295dea5.jpg" width="30px"><span>李正g</span> 👍（1） 💬（0）<div>我认为有必要，项目执行过程中没有办法100%避免因为人为因素(bug)导致的数据不一致， 通过防御报警机制及时发现问题，人工介入处理是有必要的。 这个防御机制只应该是一个报警机制， 不应该自动修复数据之类的。</div>2022-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ff/51/9d5cfadd.jpg" width="30px"><span>好运来</span> 👍（1） 💬（0）<div>在系统上线的初期可以引入防御式设计自动发现、提醒并修复数据状态不一致的数据，一方面用于修复Bug，另一方面可以提前发现，避免业务逻辑错乱。然后在系统稳定运行期可以逐渐下限这个模块。</div>2022-04-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Cib5umA0W17N9pichI08pnrXAExdbyh7AVzH4nEhD6KN3FXuELk4LJJuqUPPD7xmIy9nq5Hjbgnzic7sVZG5BKiaUQ/132" width="30px"><span>被过去推开</span> 👍（0） 💬（0）<div>个人认为是有必要的。前段时间公司给甲方做数据双轨同步，数据同步过来后，发现很多问题，比如数据不一致，数据丢失等情况。有些数据需要人工对比，人工对比的效率很低。</div>2023-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>点赞</div>2022-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg" width="30px"><span>piboye</span> 👍（0） 💬（0）<div>是不是可以从成本来看,  比如  不可用的损失 &gt; 不一致性的损失 , 就要保可用性;  我们多数业务其实更在意的是可用性;  事后数据恢复的方法, 我们好像讨论都很少, 是因为通用性不够?</div>2022-09-19</li><br/>
</ul>