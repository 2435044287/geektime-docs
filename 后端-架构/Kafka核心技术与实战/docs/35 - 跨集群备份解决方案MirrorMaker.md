你好，我是胡夕。今天我要和你分享的主题是：Kafka的跨集群数据镜像工具MirrorMaker。

一般情况下，我们会使用一套Kafka集群来完成业务，但有些场景确实会需要多套Kafka集群同时工作，比如为了便于实现灾难恢复，你可以在两个机房分别部署单独的Kafka集群。如果其中一个机房出现故障，你就能很容易地把流量打到另一个正常运转的机房下。再比如，你想为地理相近的客户提供低延时的消息服务，而你的主机房又离客户很远，这时你就可以在靠近客户的地方部署一套Kafka集群，让这套集群服务你的客户，从而提供低延时的服务。

如果要实现这些需求，除了部署多套Kafka集群之外，你还需要某种工具或框架，来帮助你实现数据在集群间的拷贝或镜像。

值得注意的是，**通常我们把数据在单个集群下不同节点之间的拷贝称为备份，而把数据在集群间的拷贝称为镜像**（Mirroring）。

今天，我来重点介绍一下Apache Kafka社区提供的MirrorMaker工具，它可以帮我们实现消息或数据从一个集群到另一个集群的拷贝。

## 什么是MirrorMaker？

从本质上说，MirrorMaker就是一个消费者+生产者的程序。消费者负责从源集群（Source Cluster）消费数据，生产者负责向目标集群（Target Cluster）发送消息。整个镜像流程如下图所示：
<div><strong>精选留言（21）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/cd/2a/bdbed6ed.jpg" width="30px"><span>无菇朋友</span> 👍（11） 💬（1）<div>老师您好，问一下怎么在本地搭建两个kafka集群</div>2019-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/1b/4a/f9df2d06.jpg" width="30px"><span>蒙开强</span> 👍（7） 💬（2）<div>老师，你好，你提的这几款工具，MirrorMaker是免费的，其它的也是免费可以用的么</div>2019-08-22</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl9nj9b6RydKADq82ZwOad0fQcvXWyQKk5U5RFC2kzHGI4GjIQsIZvHsEm7mFELgMiaGx3lGq9vag/132" width="30px"><span>咸淡一首诗</span> 👍（4） 💬（2）<div>胡老师，想问一下，MirrorMaker 工具能保证同步前后分区序号，以及分区位移是一样的吗？</div>2020-03-15</li><br/><li><img src="" width="30px"><span>wgcris</span> 👍（3） 💬（1）<div>老师，您好，请教个问题，如果使用mirrormaker做集群数据同步，是不是内部topic数据也一起进行同步？另外在主备场景下，如果主集群挂了，如何保证备集群能正常提供服务，客户端消费数据是正确的</div>2019-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/71/4d3d2a62.jpg" width="30px"><span>猪哥灰</span> 👍（1） 💬（1）<div>老师好，想请教一下mirrormaker是否支持两个分别支持不同认证方式的kafka集群，或者两个不同kerberos认证的集群</div>2020-05-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg" width="30px"><span>大坏狐狸</span> 👍（1） 💬（1）<div>完了 我咋感觉 用不到这东西。我又怕以后用到了。</div>2020-03-20</li><br/><li><img src="" width="30px"><span>wgcris</span> 👍（1） 💬（2）<div>老师，您好，再请教个问题最近我们生产环境发现，broker进程意外挂掉之后，重启broker时间会很长，当数据量很大的时候，浏览了一下社区，KIP-263提了一个解决方案，而且已经合入到2.3版本，但测试发现并没有什么效果，不知道您有了解这方面的优化吗？</div>2019-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/20/d0/ad12060d.jpg" width="30px"><span>蓝色海洋</span> 👍（1） 💬（2）<div>老师，我想问问，低版本的集群消息可以同步到高版本集群吗，目前版本是0.8想同步到2.0集群</div>2019-10-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a7/5c/977d714c.jpg" width="30px"><span>RJZ</span> 👍（1） 💬（1）<div>用kafka connector实现可以不</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/26/23/e8356436.jpg" width="30px"><span>夏末?秋初</span> 👍（0） 💬（1）<div>老师，如果用mirrormaker作为集群间数据迁移工具，迁移后能否保证消费位移一致，前提是源端目的端所有配置、主题、分区数这些都一致，mirrormaker能否达到这种场景下的迁移啊?</div>2020-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg" width="30px"><span>James</span> 👍（0） 💬（1）<div>--message.handler 执行生产者雷修改消息体吗</div>2020-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg" width="30px"><span>外星人</span> 👍（3） 💬（0）<div>您好，我们最近也在调研brooklin和uReplicator，能否比较下二者的优缺点啊？</div>2019-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（2） 💬（0）<div>kafka集群间数据同步工具，MirrorMaker——本质上就是一个消费者+一个生产者程序，利用这一取一放将数据在两个kafka集群中到一道手。不过这个工具性能差一些，也存在其他一些问题，所以，牛一点的公司都在她的基础上开发了自己的集群间数据同步工具。</div>2019-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（2） 💬（0）<div>跟着老师一起精进。</div>2019-08-22</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0" width="30px"><span>图·美克尔</span> 👍（1） 💬（1）<div>老师，Uber的链接已失效…</div>2023-07-20</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/u3L60uE6cv47ettBgibrR9SI2xicUicibcFfTfVFNtGwAr5jggCEicWfaojCugw1wspIqm1qvVbTh32SXftwXqm0GibQ/132" width="30px"><span>冷四两</span> 👍（0） 💬（0）<div>MirrorMaker2怎么在kafka实例之外独立机器部署呢</div>2024-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg" width="30px"><span>亚林</span> 👍（0） 💬（0）<div>我怎么感觉有点kafka劝退专栏的味道了😭</div>2023-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/16/b9/a8a7a6af.jpg" width="30px"><span>Geek_ea21df</span> 👍（0） 💬（1）<div>如果集群使用了认证，MirrorMaker怎么指定用户名和密码？</div>2022-03-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/51/bc/c7514a30.jpg" width="30px"><span>Dev.lu</span> 👍（0） 💬（0）<div>如果是用confluent replicator 可以自己build SMT 插件, cstomize transformation</div>2020-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a7/5c/977d714c.jpg" width="30px"><span>RJZ</span> 👍（0） 💬（0）<div>接上条，只是感觉connect就是来做数据对接场景的😂，另外confluent的复制工具出现在confluent hub里，一度怀疑他们是开发了个connector</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4d/5e/c5c62933.jpg" width="30px"><span>lmtoo</span> 👍（0） 💬（1）<div>是不是通过MirrorMaker拷贝，只要是目标集群的主题分区数量和源主题分区数量一致，拷贝的主题分区数据就是一一对应的？</div>2019-08-22</li><br/>
</ul>