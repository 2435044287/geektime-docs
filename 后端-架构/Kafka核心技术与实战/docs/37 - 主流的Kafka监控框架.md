你好，我是胡夕。今天我要和你分享的主题是：那些主流的Kafka监控框架。

在上一讲中，我们重点讨论了如何监控Kafka集群，主要是侧重于讨论监控原理和监控方法。今天，我们来聊聊具体的监控工具或监控框架。

令人有些遗憾的是，Kafka社区似乎一直没有在监控框架方面投入太多的精力。目前，Kafka的新功能提议已超过500个，但没有一个提议是有关监控框架的。当然，Kafka的确提供了超多的JMX指标，只是，单独查看这些JMX指标往往不是很方便，我们还是要依赖于框架统一地提供性能监控。

也许，正是由于社区的这种“不作为”，很多公司和个人都自行着手开发Kafka监控框架，其中并不乏佼佼者。今天我们就来全面地梳理一下主流的监控框架。

## JMXTool工具

首先，我向你推荐JMXTool工具。严格来说，它并不是一个框架，只是社区自带的一个工具罢了。JMXTool工具能够实时查看Kafka JMX指标。倘若你一时找不到合适的框架来做监控，JMXTool可以帮你“临时救急”一下。

Kafka官网没有JMXTool的任何介绍，你需要运行下面的命令，来获取它的使用方法的完整介绍。

```
bin/kafka-run-class.sh kafka.tools.JmxTool
```

JMXTool工具提供了很多参数，但你不必完全了解所有的参数。我把主要的参数说明列在了下面的表格里，你至少要了解一下这些参数的含义。
<div><strong>精选留言（27）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/62/30/a8df1a4e.jpg" width="30px"><span>张亮</span> 👍（15） 💬（3）<div>https:&#47;&#47;github.com&#47;didi&#47;Logi-KafkaManager   一站式Apache Kafka集群指标监控与运维管控平台，1600+Star，650+ 用户的选择，绝对的好用的Kafka监控利器！</div>2021-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e9/f0/7c8ea410.jpg" width="30px"><span>李沁</span> 👍（7） 💬（3）<div>搜了一下kafka manager，已经找不到了，最后发现已经改名叫CMAK(Cluster Manager for Apache Kafka)</div>2020-10-30</li><br/><li><img src="" width="30px"><span>张瑞松</span> 👍（3） 💬（1）<div>老师你好，我们最近在做kafka数据层面的监控，就是消息情况的监控，包括状态，生产消费时差，消息趋势等，这一方面的工具，老师这边有好的建议吗？</div>2020-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/8f/76/1d8be696.jpg" width="30px"><span>kennyji</span> 👍（2） 💬（1）<div>有个地方不太准确 BytesInPerSec是leader副本的入流量 并不等于网卡流量 要关注带宽指标还是需要具体看网卡的流量指标</div>2019-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg" width="30px"><span>外星人</span> 👍（2） 💬（1）<div>请求积压，监控两个idle就好吧？但是具体哪些请求积压和哪些ip的请求，这块还不清楚，求指教。</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4e/29/1be3dd40.jpg" width="30px"><span>ykkk88</span> 👍（2） 💬（1）<div>老师 生产环境建议用confluent免费版本的kafka么 比如5.3版本基于apache kafka 2.3的？我们想自己搭kafka 在confluent和apache里面选一个，都是免费的</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>风轻扬</span> 👍（1） 💬（1）<div>老师，您说的去kafka官网搜索--object-names，这个参数在官网怎么搜索啊？官网左侧的tab都点开搜了，没有看到。☹️</div>2020-05-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/fb/49/e14b1c54.jpg" width="30px"><span>稳健的少年</span> 👍（1） 💬（3）<div>老师，Kafka Manager貌似不支持Kafka 2.x版本吧</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg" width="30px"><span>James</span> 👍（0） 💬（1）<div>broker存在请求积压是指客户端发送的请求没及时处理吗.</div>2020-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/9a/54/5d51fda4.jpg" width="30px"><span>婷</span> 👍（0） 💬（1）<div>我用kafka-manager链接集群后，topics显示为0。请教老师，该如何去排查问题。</div>2019-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e6/8d/f3e024e2.jpg" width="30px"><span>瞿中华</span> 👍（0） 💬（1）<div>你好，请问kafka Consume 进度的监控工具有哪些？我的版本是kafka_2.11-1.1.0，我使用kafkaOffsetMonitor拿不到consumer数据，查了资料好像kafkaOffsetMonitor不支持0.9以上版本
</div>2019-11-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132" width="30px"><span>昀溪</span> 👍（0） 💬（2）<div>老师，Kafka集群如果重启的，3台机器，每个主题3个副本，假设A主题的 ISR是 0 1 2 ，如果我同时重启2台broker，那么此时主题A的ISR就剩下一个，这种情况下，集群还可用么？</div>2019-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/3a/70/a874d69c.jpg" width="30px"><span>Mick</span> 👍（0） 💬（1）<div>老师，请问下为什么我的kafka manager 里面的Latest Offset 为空？如图https:&#47;&#47;www.processon.com&#47;view&#47;link&#47;5d9ffd05e4b0893e992642c3</div>2019-10-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/49/3d/4ac37cc2.jpg" width="30px"><span>外星人</span> 👍（0） 💬（2）<div>你好，我们生产request handle idle过低的原因找到了，是由于磁盘坏道导致的？能否加些关于kafkaApi的监控？看下请求的分布情况及哪些请求占用requesthandler过多吗？</div>2019-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（14） 💬（2）<div>感觉Grafana+InfluxDB这一套，可以用于任何语言，还可以自定义接口出来加入监控。</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（7） 💬（1）<div>kafka集群监控工具，免费的功能少，功能强大的收费。看自己的情况选择了，作为技术关注点还在于这些工具的实现原理。
不过任何监控工具，估计都类似，以下是猜测的：
1：获取监控数据，通常是日志信息，加埋点或者利用OS的功能获取
2：存储监控数据，未经清洗的数据
3：清洗数据，格式化数据，聚合数据，汇总数据
4：展示监控信息
5：功能需求没问题后就是各种优化了，比如：UI展示优化&#47;获取数据不丢消息的优化&#47;展示数据的性能优化&#47;功能优化，可以加各种报警设置，给出问题产生的主要场景和解决思路。</div>2019-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ee/d6/a9b34bd3.jpg" width="30px"><span>Panda</span> 👍（3） 💬（0）<div>Grafana监控，kafka manager运维管理</div>2020-03-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/s3l1cvljHFoibnZEHaLl4IJ1ryRFI0zYePAVdYfhfcoyr20uEaf1ibZhMHb5aze8Fuib8FnoYbsC0mnggIeYIjVzg/132" width="30px"><span>午月十三</span> 👍（2） 💬（1）<div>新发现的一款管理工具kafka-console-ui，感觉对初学者使用特别友好，用着挺简单的：https:&#47;&#47;github.com&#47;xxd763795151&#47;kafka-console-ui</div>2022-01-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/6b/0f/293b999c.jpg" width="30px"><span>旋风</span> 👍（2） 💬（0）<div>老师，JMXTrans + InfluxDB + Grafana 的监控方案的grafana的模板可以提供一下吗</div>2021-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e8/a0/c2daafdb.jpg" width="30px"><span>A_阿海</span> 👍（2） 💬（0）<div>滴滴新开源了一个，可以参考(https:&#47;&#47;github.com&#47;didi&#47;Logi-KafkaManager)</div>2021-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（2） 💬（0）<div>监控records-lag-max 和 records-lead-min，它们分别表示此消费者在测试窗口时间内曾经达到的最大的 Lag 值和最小的 Lead 值。</div>2019-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg" width="30px"><span>贝影</span> 👍（1） 💬（0）<div>Burrow主要就是用于动态监控lag的，个人感觉其实很不错，也学了其监控算法迁移到自己监控平台上</div>2022-01-10</li><br/><li><img src="" width="30px"><span>一眼万年</span> 👍（1） 💬（1）<div>Kafka Eagle会导致zookeeper连接占满不释放</div>2019-08-27</li><br/><li><img src="" width="30px"><span>Geek6238</span> 👍（0） 💬（0）<div>
bin&#47;kafka-run-class.sh kafka.tools.JmxTool --object-name kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec --jmx-url service:jmx:rmi:&#47;&#47;&#47;jndi&#47;rmi:&#47;&#47;:9997&#47;jmxrmi --date-format &quot;YYYY-MM-dd HH:mm:ss&quot; --attributes OneMinuteRate --reporting-interval 1000</div>2023-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg" width="30px"><span>追风筝的人</span> 👍（0） 💬（0）<div>Grafana可以监控K8S ,中间件集群redis   kafka  zk, mysql , es, etcd, minio, maogodb的 CPU  内存  磁盘 等数据指标  挺好的</div>2021-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg" width="30px"><span>Allan</span> 👍（0） 💬（2）<div>尝试了一把kafka eagle</div>2021-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f3/dc/e7e5c159.jpg" width="30px"><span>落霞与孤鹜</span> 👍（0） 💬（0）<div>前公司携程grafana用的就很好</div>2019-08-27</li><br/>
</ul>