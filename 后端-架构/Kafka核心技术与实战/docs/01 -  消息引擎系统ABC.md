你好，我是胡夕。欢迎你来到“Kafka核心技术与实战”专栏。如果你对Kafka及其背后的消息引擎、流处理感兴趣，很高兴我们可以在此相聚，并在未来的一段日子里一同学习有关Kafka的方方面面。

毫无疑问，你现在对Apache Kafka一定充满了各种好奇，那么今天就允许我先来尝试回答下Kafka是什么这个问题。对了，先卖个关子，在下一期我还将继续回答这个问题，而且答案是不同的。那么，Kafka是什么呢？用一句话概括一下：**Apache Kafka是一款开源的消息引擎系统**。

倘若“消息引擎系统”这个词对你来说有点陌生的话，那么“消息队列”“消息中间件”的提法想必你一定是有所耳闻的。不过说实话我更愿意使用消息引擎系统这个称谓，因为消息队列给出了一个很不明确的暗示，仿佛Kafka是利用队列的方式构建的；而消息中间件的提法有过度夸张“中间件”之嫌，让人搞不清楚这个中间件到底是做什么的。

像Kafka这一类的系统国外有专属的名字叫Messaging System，国内很多文献将其简单翻译成消息系统。我个人认为并不是很恰当，因为它片面强调了消息主体的作用，而忽视了这类系统引以为豪的消息传递属性，就像引擎一样，具备某种能量转换传输的能力，所以我觉得翻译成消息引擎反倒更加贴切。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/3b/ad/31193b83.jpg" width="30px"><span>孙志强</span> 👍（71） 💬（6）<div>讲讲怎么把50完行源代码读下来的? 嘿嘿</div>2019-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/08/3f/820ae54e.jpg" width="30px"><span>开发无止境，BUG随身行</span> 👍（61） 💬（2）<div>有个问题请教下老师:
之前也用过kafka，怎么解决实时结果响应问题呢？比如秒杀商品，生产者产生订单，消费者处理订单结果，那这结果如何实时返回给用户呢？</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cb/05/64d3b05a.jpg" width="30px"><span>Lei Yang</span> 👍（52） 💬（2）<div>老师可以讲一讲Kafka和别的mq的区别和最佳选择方法么？例如什么时候选择RabbitMQ什么时候选择Kafka等等</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg" width="30px"><span>Dovelol</span> 👍（51） 💬（5）<div>老师好，想问下有些业务用mq来做异步处理，为了削峰填谷，是不是上游发送消息成功就认为业务成功了，可能下游过很久去消费，那实时性要求很高的业务怎么办呢，比如生成了订单但是一直不处理也不好吧。另外想请教下老师的角度来讲下mq和rpc调用的区别是什么呢？</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg" width="30px"><span>Shane</span> 👍（39） 💬（4）<div>老师，今天才学习到这篇文章，还是老师能够在百忙之中抽出时间来解答我的困惑。
这篇文章提到了消息的协议，老师这里介绍了两种模式一种是点对点，一种是订阅，发布模式。但是，为什么我一开始想到消息的协议是http之类的传输协议？这两个有什么区别和联系？</div>2019-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg" width="30px"><span>jeffery</span> 👍（27） 💬（2）<div>pulsar高吞吐低延迟和kafka谁会主宰未来？夕哥、能不能拓展下flink+kafka的耦合！谢谢</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/66/bd/bd5d503e.jpg" width="30px"><span>杨鹏程baci</span> 👍（23） 💬（3）<div>胡夕老师好，我是第一次在这提问，这门课程我应该是0基础了，有一些疑问希望老师帮忙解答一下，用消息引擎的这种数据流数据方式，上游是不是就无法得知处理结果了，甚至是无法将返回值传回上游了？谢谢！</div>2019-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/f9/bf/bcf0fdf9.jpg" width="30px"><span>gnayuh</span> 👍（22） 💬（1）<div>老师讲的很好，我是之前那种听过kafaka等消息引擎大名的初学者，听完第一节课，联想到这个发布订阅模型跟之前学过java设计模式之观察者，总感觉它们之间有那么点类似，想知道它们之间的某种关系。还有就是学操作系统时候的生产者消费者也很像</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d3/db/5ce5bb26.jpg" width="30px"><span>燕子上</span> 👍（21） 💬（2）<div>我司直接把kafka当mq来使用，高吞吐、低延迟、松耦合。对！我司看上了松耦合，哪哪都要用kafka解耦，真正的面向kafka编程🤣</div>2019-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/cf/76/9e413c61.jpg" width="30px"><span>Bin滨</span> 👍（17） 💬（1）<div>谢谢知识分享。
在Martin Kleppmann 的书中把kafka 定义成 log-based message brocker， 这个基本上是对kafka最简单的定义了。append-only， partition， totally ordered 是比较需要理解的概念。 </div>2019-06-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg" width="30px"><span>吃饭饭</span> 👍（14） 💬（2）<div>胡老师好，我想请教一个学习方法，我在做Kafka测试的时候遇到一个问题，我记得以前老版本的时候使用命令行进行Demo测试时，消费消息到控制台使用：bin&#47;kafka-console-consumer.sh --zookeeper localhost:2181&#47;kafka --topic test 就可以，但是今天我换了高版本发现不对了，以前的 --zookeeper 新版本不支持了。知道这点后我希望能够从官网找到具体是哪个版本开始删除这个指令的以及删除的原因，但是我这种为题我不会查询官网，只能从百度等搜索引擎上看其他人的一些总结，希望老师能给示例一番，感谢。</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/67/49/da88c745.jpg" width="30px"><span>小虞</span> 👍（13） 💬（2）<div>Kafka官网的描述是“Apache Kafka® is a distributed streaming platform.”，我觉得这里的重点在于分布式和流式处理，而且我认为消息引擎也可以看做是流式处理的一种，不知道老师怎么看？</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ac/46/7e24bad6.jpg" width="30px"><span>杨俊</span> 👍（12） 💬（3）<div>希望后面能说下要是kafka突然宕机或者临时停止服务进行更新，上游服务的消息该怎么正确更好处理呢？怎么保证消息的能够在kafka恢复工作的时候正确传递，谢谢</div>2019-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f6/96/cc4d553e.jpg" width="30px"><span>安不安生</span> 👍（9） 💬（1）<div>我们公司用来传输视频切片，然后使用集群进行视频分析，之前曾经用过kafka ，因为没有人熟悉，不会维护，导致放弃，现在使用aws kinesis 服务，怎么才能说服领导引进kafka 呢？
</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/c8/10/36f36b42.jpg" width="30px"><span>tracy</span> 👍（9） 💬（1）<div>现在消息中间件很多，想要了解kafka和其他消息中间件的优劣点，系统选型时需要考虑什么？</div>2019-06-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/16/38/88eb9377.jpg" width="30px"><span>周谦</span> 👍（8） 💬（2）<div>请教下 kafka说的写磁盘高性能是由于是顺序写，但是多个进程写多个文件时候这种顺序写的高性能还存在不？</div>2020-03-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4a/3f/25db3a2d.jpg" width="30px"><span>丁满和彭彭</span> 👍（8） 💬（1）<div>老师，卡夫卡的消息超过了log.retention.bytes以后可以拒绝生产者的消息么，现在默认好像直接删除</div>2019-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/13/45/16c60da2.jpg" width="30px"><span>蔫巴的小白菜</span> 👍（8） 💬（1）<div>现在在做商城业务，我们使用的mysql+es存储数据，开始时，用的双写模式，即先写mysql，在刷es，这样tps上不去，后来改成异步消费，借助大数据，他们监听binlog文件，监听订单的变化，然后放入kafka，我们监听kafka，异步刷新es，但是延迟有点高，最后发展成，自己开发了一套canel，监听mysql主库，刷新es，对于要求实时性比较高的查询，先走数据库搂一把，，，之后再去搂es，我一直没搞清楚，为什么kafka的消息有时候会延迟那么大，期待老师后面的内容有所涉及，，，以便真正理解原理，，，不至于出了问题一脸懵逼。。。。</div>2019-06-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/be/b9/f2481c2c.jpg" width="30px"><span>诗泽</span> 👍（8） 💬（1）<div>看到有位同学留言说用kafka 传输视频切片做视频分析的。这种场景的msg大小应该比较大吧，想请教一下老师，kafka 是否适用于传输图片或视频切片等大msg场景，如果适用的话应对kafka 做出什么配置调整呢，谢谢！P.S. 极客时间要是支持读者间相互交流就好了🤣</div>2019-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" width="30px"><span>QQ怪</span> 👍（8） 💬（2）<div>我指的数据不一致可能会容许消息丢失，麻烦老师解惑😂</div>2019-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/cc/23/6b17fe26.jpg" width="30px"><span>Nicko</span> 👍（7） 💬（1）<div>请教一下流量太高压垮下游系统，是指什么意思，比如是内存溢出吗，为什么会导致下游系统的内存溢出等等。</div>2020-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg" width="30px"><span>小晏子</span> 👍（7） 💬（1）<div>我们的系统中大量使用消息引擎系统做异步化控制，比如订单状态流转，支付什么的，如果有任何失败都会进入失败队列，然后人工干预。</div>2020-04-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f5/59/f1a04e5e.jpg" width="30px"><span>Savage.M</span> 👍（6） 💬（1）<div>老师，您好！感觉kafka和rocketmq的设计有很多相似之处，能否列举一下他们之间的区别呢？如果要选型，哪些场景适合用kafka，哪些场景适合用rocketmq呢？谢谢！</div>2019-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg" width="30px"><span>dream</span> 👍（5） 💬（2）<div>老师能不能分享一下，kafka作为消息引擎（不考虑流式处理），对比其他消息引擎的优势，什么时候用kafka，什么时候用Active MQ等消息引擎？</div>2019-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/24/be/19c9d3e1.jpg" width="30px"><span>ChenJZ</span> 👍（5） 💬（1）<div>有个问题想请教一下老师：
（1）需要接收一个2000多个站的实时数据流，kafka是否适用于这样的场景？
（2）如果适合的使用kafka，采用什么方式进行解析，然后分站存储？谢谢
</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/12/73/2183839d.jpg" width="30px"><span>huaweichen</span> 👍（5） 💬（1）<div>请问老师，Kafka对CQRS的架构，有没有什么帮助呢？
之前我们公司使用的是RabbitMQ，后来发现ActiveMQ更快，就采用了ActiveMQ。
现在又有同事想换Kafka，说Kafka更scalable，更利于CQRS的架构风格（Replay all events history）等等。

总的来说，想请教一下老师：
1. Kafka和其它MQ，各自之间，有什么决定性的优势。
2. Kafka对CQRS event sourcing架构有什么强有力的帮助吗？（其它MQ系统呢？）

谢谢老师。学习了。</div>2019-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/92/51/0505254d.jpg" width="30px"><span>Fighter</span> 👍（4） 💬（1）<div>老师能不能读kafka源码的一些心得或是方法分享下 我们后来者能站在巨人肩膀上 少走弯路</div>2020-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg" width="30px"><span>你好旅行者</span> 👍（4） 💬（1）<div>有个问题想请教老师：

为什么业务生产上都会用rabbitmq或者rocketmq，但一到日志的问题上kafka就是不二选择？根据老师之前的回答，是因为Kafka相比于其他的mq在吞吐量上更有优势，可以详细解释一下为什么Kafka可以提供高吞吐量吗？</div>2019-06-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c3/fc/791d0f5e.jpg" width="30px"><span>杨寅冬</span> 👍（4） 💬（1）<div>老师，Kafka和ZooKeeper是什么关系。以及整个架构，可以整体介绍一下吗。</div>2019-06-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/77/88/965e9951.jpg" width="30px"><span>shi.yunlai</span> 👍（3） 💬（1）<div>除了看课程，最帅气的就是看评论里面大家的各种问题和精彩解答，个个都在下笨功夫</div>2020-04-15</li><br/>
</ul>