今天我会对NIO进行一些补充，在[专栏第11讲](http://time.geekbang.org/column/article/8369)中，我们初步接触了Java提供的几种IO机制，作为语言基础类库，Java自身的NIO设计更偏底层，这本无可厚非，但是对于一线的应用开发者，其复杂性、扩展性等方面，就存在一定的局限了。在基础NIO之上，Netty构建了更加易用、高性能的网络框架，广泛应用于互联网、游戏、电信等各种领域。

今天我要问你的问题是，对比Java标准NIO类库，你知道Netty是如何实现更高性能的吗？

## 典型回答

单独从性能角度，Netty在基础的NIO等类库之上进行了很多改进，例如：

- 更加优雅的Reactor模式实现、灵活的线程模型、利用EventLoop等创新性的机制，可以非常高效地管理成百上千的Channel。
- 充分利用了Java的Zero-Copy机制，并且从多种角度，“斤斤计较”般的降低内存分配和回收的开销。例如，使用池化的Direct Buffer等技术，在提高IO性能的同时，减少了对象的创建和销毁；利用反射等技术直接操纵SelectionKey，使用数组而不是Java容器等。
- 使用更多本地代码。例如，直接利用JNI调用Open SSL等方式，获得比Java内建SSL引擎更好的性能。
- 在通信协议、序列化等其他角度的优化。
<div><strong>精选留言（15）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg" width="30px"><span>忆水寒</span> 👍（59） 💬（2）<div>Netty采用Reactor线程模型。这里面主要有三种Reactor线程模型。分别是单线程模式、主从Reactor模式、多Reactor线程模式。其都可以通过初试和EventLoopGroup进行设置。其主要区别在于，单Reactor模式就是一个线程，既进程处理连接，也处理IO。类似于我们传统的OIO编程。主从Reactor模式，其实就是将监听连接和处理IO的分开在不同的线程完成。最后，主从Reactor线程模型，为了解决多Reactor模型下单一线程性能不足的问题。改为了一组线程池进行处理。官方默认的是采用这种主从Reactor模型。其线程数默认为CPU内核的2倍。杨老师，不知道我说的对不对？</div>2018-08-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/76/9d/6dab9e0e.jpg" width="30px"><span>Levy</span> 👍（13） 💬（1）<div>netty线程模型一般分为监听线程和I&#47;O处理线程，也即bossGroup和workerGroup，属于多Reactor模型</div>2018-08-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/44/03/460fda52.jpg" width="30px"><span>bills</span> 👍（1） 💬（3）<div>老师，能给说下mina和netty的相同和不同吗？</div>2018-08-06</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/cEXn4ZLiccC6jIePvS0RbKI8wUCSibUhh0WiaIq3ib9kRv5icnaopn7kgckIR317onpX3wdyubgAukemdJCakXDuChw/132" width="30px"><span>青鸟飞鱼</span> 👍（31） 💬（2）<div>个人觉得关于Netty这块知识讲的还是太表面化了，如果能深入点，肯定更好</div>2019-02-21</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/nUB9lOWn8HMSCoyywLbqicVVUkIBgcgnPZlHUU9psKBN36R6f4CP3dsia8FRZKb6FAZMiaAibC3q4eBFwSeeh63rMw/132" width="30px"><span>小恩</span> 👍（6） 💬（9）<div>杨老师您好，我有5年左右的Java开发经验，也不断的尝试学习netty，但还是找不到真正能够使用到的地方，最多看一些源码，学习一下简单的线程模型，netty离我最近的应该是spring boot 2.0里面的了，想请教一下在我们实际业务开发中，什么样的业务场景会用到netty，谢谢！</div>2018-12-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/bc/43/11acdc02.jpg" width="30px"><span>Allen</span> 👍（6） 💬（0）<div>有三种模型。1-1。1-n  n-n. 并且可以根据实际情况自动进行调整，可谓是线程模型的终极版本，简直是太酷了</div>2018-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9a/e6/e8439f9a.jpg" width="30px"><span>ttxser</span> 👍（4） 💬（0）<div>服务器的多reactor貌似不支持吧，boss虽然能设置多线程，但最后只能绑定一个线程到serversocket来accept？</div>2018-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d7/df/fc0a6709.jpg" width="30px"><span>WolvesLeader</span> 👍（2） 💬（0）<div>一直不明白，n_n的使用场景</div>2018-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/5a/08/2bef230f.jpg" width="30px"><span>慎独</span> 👍（1） 💬（1）<div>Reactor 模式和 Netty 线程模型这块，老师能详细讲解下吗？</div>2019-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（1） 💬（0）<div>想深入还得自己结合实例，针对性地读读源码，之前囫囵吞枣似的读完了netty实战，并没有太理解本质。RTFSC，追根溯源，适可而止，确实太需要了</div>2019-09-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/3c/61/d4145bb6.jpg" width="30px"><span>shern</span> 👍（1） 💬（3）<div>为啥默认的线程数是cpu核数的两倍？</div>2019-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d1/15/7d47de48.jpg" width="30px"><span>咖啡猫口里的咖啡猫🐱</span> 👍（1） 💬（0）<div>为什么我看着开源项目把netty做网络层，模型都是1-N ,为什么N-N会浪费资源</div>2018-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/bc/43/11acdc02.jpg" width="30px"><span>Allen</span> 👍（1） 💬（2）<div>请问为啥不推荐netty权威指南？😋</div>2018-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/e4/0f/221aac6a.jpg" width="30px"><span>韩姝冰</span> 👍（0） 💬（0）<div>厉害</div>2022-01-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/24/53/76dd2efc.jpg" width="30px"><span>L</span> 👍（0） 💬（1）<div>杨老师，可以的话麻烦推荐几个能获取到最新Java开发资料，或者编程领域相关的外文网站，博客等，就是想关注一些最新的技术信息</div>2018-08-05</li><br/>
</ul>