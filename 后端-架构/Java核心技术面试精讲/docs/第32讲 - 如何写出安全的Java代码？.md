在上一讲中，我们已经初步接触了Java安全，今天我们将一起探讨更多Java开发中可能影响到安全的场合。很多安全问题，在特定的上下文，存在着不同的定义，尽管本质是相似或一致的，这是由于Java平台自身的特性所带来特有的问题。今天这一讲我将侧重于Java开发者的角度谈代码安全，而不是讲广义的安全风险。

今天我要问你的问题是，如何写出安全的Java代码？

## 典型回答

这个问题可能有点宽泛，我们可以用特定类型的安全风险为例，如拒绝服务（DoS）攻击，分析Java开发者需要重点考虑的点。

DoS是一种常见的网络攻击，有人也称其为“洪水攻击”。最常见的表现是，利用大量机器发送请求，将目标网站的带宽或者其他资源耗尽，导致其无法响应正常用户的请求。

我认为，从Java语言的角度，更加需要重视的是程序级别的攻击，也就是利用Java、JVM或应用程序的瑕疵，进行低成本的DoS攻击，这也是想要写出安全的Java代码所必须考虑的。例如：

- 如果使用的是早期的JDK和Applet等技术，攻击者构建合法但恶劣的程序就相对容易，例如，将其线程优先级设置为最高，做一些看起来无害但空耗资源的事情。幸运的是类似技术已经逐步退出历史舞台，在JDK 9以后，相关模块就已经被移除。
- 上一讲中提到的哈希碰撞攻击，就是个典型的例子，对方可以轻易消耗系统有限的CPU和线程资源。从这个角度思考，类似加密、解密、图形处理等计算密集型任务，都要防范被恶意滥用，以免攻击者通过直接调用或者间接触发方式，消耗系统资源。
- 利用Java构建类似上传文件或者其他接受输入的服务，需要对消耗系统内存或存储的上限有所控制，因为我们不能将系统安全依赖于用户的合理使用。其中特别注意的是涉及解压缩功能时，就需要防范[Zip bomb](https://en.wikipedia.org/wiki/Zip_bomb)等特定攻击。
- 另外，Java程序中需要明确释放的资源有很多种，比如文件描述符、数据库连接，甚至是再入锁，任何情况下都应该保证资源释放成功，否则即使平时能够正常运行，也可能被攻击者利用而耗尽某类资源，这也算是可能的DoS攻击来源。
<div><strong>精选留言（19）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/2f/b7a3625e.jpg" width="30px"><span>Len</span> 👍（107） 💬（5）<div>在密码使用的场景中，比如用户注册&#47;登录。
我使用 char[] 数组存储和验证密码，并在使用结束后，通过随机的字符覆盖掉 char[]。
如果使用 string 存储密码，由于它的不可变性，它的缺陷是会一直驻留在堆中，直到未来被垃圾回收。</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg" width="30px"><span>李二木</span> 👍（27） 💬（2）<div>
 最近项目在改安全问题，主要遇到的有：SQL注入，IO流没有关闭，使用不安全Random，重定向Url合法性没做检验，上传文件前后端没做文件大小类型校验。通过反射方式访问私有方法。日志包含敏感信息，没有禁止除GET,POST以外的HTTP请求等等</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/65/69/efb57b83.jpg" width="30px"><span>Leiy</span> 👍（22） 💬（2）<div>老师，你好，那个c是负数，b是正数，c-b也可能溢出吧？</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b5/63/b66f3d37.jpg" width="30px"><span>郭俊杰</span> 👍（3） 💬（1）<div>老师，你好，多线程访问共享数据会有线程安全问题，是不是在方法内部new的对象也一样存在线程安全问题呢？</div>2018-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/22/ed/73cea0b9.jpg" width="30px"><span>老韩</span> 👍（3） 💬（1）<div>hook有直接可用的或者简单修改就能用的推荐吗</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/f9/7e/3c71fa3d.jpg" width="30px"><span>王大为</span> 👍（1） 💬（1）<div>老师，您好，我编译了openjdk，导入到netbeans中，怎么打不了断点调试jdk模块，请您指导下</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg" width="30px"><span>程序员小跃</span> 👍（8） 💬（0）<div>这节课让我想去以前在菊厂做的各种红线检查，就是针对各种安全来应对的。通过findbugs，pclint，fortify等静待代码检查；安全扫描；Sql注入；Android还有Monkey测试等手段进行安全攻防</div>2019-04-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLS0FDycDR2RlONhAX782uZxesnyrojEabVH7lJY20RexENpvdcNwgy4Jn4QSPzNeFjAew65Fkl7A/132" width="30px"><span>birdzxc</span> 👍（4） 💬（0）<div>老师，能否就spring 源码 解读一下呢？非常期待</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0a/af/b6fc4f8d.jpg" width="30px"><span>我滴头好大呀</span> 👍（4） 💬（0）<div>期待</div>2018-07-19</li><br/><li><img src="" width="30px"><span>羊羊羊</span> 👍（3） 💬（1）<div>安全倾向于 “明显没有漏洞”，而不是“没有明显漏洞”。这段话很喜欢，老师能不能在详细的剖析下这句话。</div>2018-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg" width="30px"><span>随心而至</span> 👍（1） 💬（0）<div>基本功扎实，正确规范地写代码，知道哪里可能出问题。关注安全问题，一旦爆出，及时跟进解决。</div>2021-01-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg" width="30px"><span>亚林</span> 👍（1） 💬（0）<div>旧的系统在进行安全检查的过程中，遇到XSS安全问题。最后用OWASP Enterprise Security API提供的Java安全库，通过Spring的拦截机制解决的。</div>2020-06-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er1iaMWWwbibUvPiaYXMPKUQDDgynPwU7n4fkRtuekqhYiaKUibgqEBzmygWmWjIhiaiblbAjrUSTkTOhgtw/132" width="30px"><span>Santo</span> 👍（1） 💬（0）<div>错过了老师的live课，好可惜，不知道后面还有没有？</div>2018-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3e/3c/fc3ad983.jpg" width="30px"><span>佳伦</span> 👍（0） 💬（0）<div>升级到最新版本jdk可以保证安全，但是jdk用得最多的是jdk8，不是最新的，这样会有隐患吗</div>2024-04-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/76/48/5ab89daa.jpg" width="30px"><span>护爽使者</span> 👍（0） 💬（0）<div>单线程可以使用非线程安全的代码；
并发情况下使用cas 等锁技术</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/61/c2/1da88a93.jpg" width="30px"><span>今天</span> 👍（0） 💬（0）<div>不能放过任何一个错误</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/53/9b/d0a21378.jpg" width="30px"><span>时代先锋</span> 👍（0） 💬（0）<div>java安全是慎之又慎的问题。</div>2020-03-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/75/50/a9f93142.jpg" width="30px"><span>小粉蒸</span> 👍（0） 💬（0）<div>请问没赶上直播的怎么办，有录音之类的吗？</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/f9/7e/3c71fa3d.jpg" width="30px"><span>王大为</span> 👍（0） 💬（0）<div>谢谢老师的回复，我编译的openjdk8,netbeans7.4,按照周志明老师的jvm书籍上说的编译的。请问oracle jdk也可以编译下来断点调试吗,您那边用的什么IDE调试的愣?</div>2018-07-20</li><br/>
</ul>