假设你的系统中存储有几十亿上百亿的商品，而每天有千万级的商品被上亿的用户访问，那么肯定有一部分被大量用户访问的热卖商品，这就是我们常说的“热点商品”。

这些热点商品中最极端的例子就是秒杀商品，它们在很短时间内被大量用户执行访问、添加购物车、下单等操作，这些操作我们就称为“热点操作”。那么问题来了：这些热点对系统有啥影响，我们非要关注这些热点吗？

## 为什么要关注热点

我们一定要关注热点，因为热点会对系统产生一系列的影响。

首先，热点请求会大量占用服务器处理资源，虽然这个热点可能只占请求总量的亿分之一，然而却可能抢占90%的服务器资源，如果这个热点请求还是没有价值的无效请求，那么对系统资源来说完全是浪费。

其次，即使这些热点是有效的请求，我们也要识别出来做针对性的优化，从而用更低的代价来支撑这些热点请求。

既然热点对系统来说这么重要，那么热点到底包含哪些内容呢？

## 什么是“热点”

热点分为**热点操作**和**热点数据**。所谓“热点操作”，例如大量的刷新页面、大量的添加购物车、双十一零点大量的下单等都属于此类操作。对系统来说，这些操作可以抽象为“读请求”和“写请求”，这两种热点请求的处理方式大相径庭，读请求的优化空间要大一些，而写请求的瓶颈一般都在存储层，优化的思路就是根据CAP理论做平衡，这个内容我在“减库存”一文再详细介绍。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/fd/f7/8c78c31d.jpg" width="30px"><span>放羊大王</span> 👍（19） 💬（1）<div>思路大概是通过日志和数据分析判断，某商品是热点，即将有大量请求到来。把商品请求移交给另外的秒杀系统，秒杀系统动静分离出html页面，和ajax请求。</div>2018-10-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f3/be/d8ba00d5.jpg" width="30px"><span>A星空之夜</span> 👍（15） 💬（8）<div>如果是微博的热点数据，应该怎么优化读操作呢</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/12/fd/b94cd881.jpg" width="30px"><span>qingbusheng</span> 👍（10） 💬（1）<div>解决快速发现热点数据的另一个思路：1.在前端nginx 通过商品、下单、购物车URI 做数据镜像 2 通过nginx+lua+redis 根据不同的业务key 做计数，如果超过设定阈值则采用redis 发布订阅机制或消息中间件 通知下游Cache  模块缓存数据。感谢老师点评</div>2018-11-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/be/5e/796c9dd0.jpg" width="30px"><span>爱我曲</span> 👍（8） 💬（3）<div>例如对被访问商品的 ID 做一致性 Hash，然后根据 Hash 做分桶，每个分桶设置一个处理队列，这样可以把热点商品限制在一个请求队列里
-----------------------
作者，您好，这个分桶设置处理队列是怎么实现的？可以讲下实现过程吗？</div>2018-10-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/be/b9/f2481c2c.jpg" width="30px"><span>诗泽</span> 👍（5） 💬（1）<div>但是，缓存热点数据更多的是“临时”缓存，即不管是静态数据还是动态数据，都用一个队列短暂地缓存数秒钟，由于队列长度有限，可以采用 LRU 淘汰算法替换。

为什么选择用队列来缓存数据呢，队列如何做到快速读取缓存数据的呢？</div>2018-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/93/28/692a12f9.jpg" width="30px"><span>rango</span> 👍（4） 💬（1）<div>你好，想问一下通过异步采集日志的形式获取热点数据这方面的话，我想知道日志如何存储，是不是加一些特定字符串以便收集，采集的方法等技术，有没有思路或者推荐的文章等。</div>2018-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/12/93/3470fc43.jpg" width="30px"><span>Mr.钧👻</span> 👍（4） 💬（1）<div>虽然这个热点可能只占请求总量的亿分之一，但是可能占用服务器90%的资源

这句话是什么意思呢？可以详细解释一下吗？</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（3） 💬（1）<div>这节的重点感觉是加深对二八原理的认识，这个原理不知为何好像具有普适的感觉，各个领域都有它的用武之地。</div>2018-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/94/5e/abb7bfe3.jpg" width="30px"><span>重案组之虎</span> 👍（3） 💬（2）<div>关于隔离层次的一个小问题：想了下数据隔离好像不太好实现吧？如果都是只读的，那么还好办一些，开一些只读实例专用就好，但是这样的场景肯定会有写请求，但是写的记录要和其他数据互通，最后不还得打到数据库集群里么？这好像和“启用单独的 MySQL”相悖了......请老师具体指教下，多谢！</div>2018-10-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（1） 💬（1）<div>热点数据-我们之前做过一个系统也用到热点数据，我们的思路比较简单，对于仓库生产，仓库的范围是有限的，具体到仓，从业务的角度出发北上广的仓库基本属于比较热的数据，于是就有了定时和手动往缓存中刷新热点数据的处理方式了。</div>2018-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b5/39/1ff75b02.jpg" width="30px"><span>halo</span> 👍（1） 💬（1）<div>图1 热点发现系统: 中间件nginx cache rpc 为什么不是后台服务的一部分呢 ？ 还是说中间件构成的异步监控系统用来日志记录？</div>2018-10-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（1） 💬（2）<div>发现动态热点中的第二点，建立一个热点上报。。
怎么判断数据是不是热点呢？是一个具体的算法没有写出来吗?这个地方看了好几遍都看不明白，请指点。</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f0/68/afb36ef6.jpg" width="30px"><span>iWill</span> 👍（1） 💬（1）<div>缓存数据，LRU淘汰算法，那么缓存的这些数据会不会频繁的移动、删除，并发比较大的时候会不会成为性能的瓶颈，想了解下。</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg" width="30px"><span>WL</span> 👍（0） 💬（1）<div>请问下老师缓存数据，LRU淘汰算法的实现可不可以用redis加一个过期时间，如果可以的话是否需要动态的判断过期时间，如果不可以的话是什么原因不可以？</div>2019-04-20</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTA5BZT4zapBbpHctcDGs2M9NFIkwEWXoicUwBsmCZSRlNzGI7NYXicZAOibLKVyE2u7ib8PuibXibel9g/132" width="30px"><span>威猛小茂然</span> 👍（0） 💬（1）<div>写的挺好的</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/72/d8/9eedbc5e.jpg" width="30px"><span>FreeMason</span> 👍（0） 💬（1）<div>DB 层，如何对热点数据进行优化呢？比如：a 表的某一行的库存，是热点更新？除了把数据拦在 DB 层之外的，进入 DB 层的热点更新请求，要如何给 DB 减压呢？想到给热点行的库存分成多个减压，当缺点太多，而且对于动态热点没用。其它方案都还有那几种？</div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ac/96/46b13896.jpg" width="30px"><span>williamcai</span> 👍（0） 💬（1）<div>热点发现系统，通过日志分析出热点数据，有没有判断标准说明该数据是热点，比如搜索次数达到多少，能不能给出具体的指标</div>2019-01-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c4/af/d4dda252.jpg" width="30px"><span>Andy_Claire</span> 👍（0） 💬（1）<div>你好, 看到你处理热点数据的思路, 其中限制和隔离让我有点混淆, 感觉区别不大. 你给出限制的做法是根据id做hash, 然后用单独的队列处理.  我理解这也是一种维度(请求)的隔离. </div>2019-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/fa/a1/0f90dd32.jpg" width="30px"><span>扬夫图拉杨夫斯基</span> 👍（0） 💬（1）<div>大佬我从你的这一节得到灵感，文中提到一个热数据收集和处理的一个反馈系统，前边的步骤对数据打标，最终有些数据会成为热数据，然后推到redis，我觉得这个系统反应一定要快，我打算去实现这个东西，那这样就会大体有三个模块，队列数据生产方，消费方，还有一个热数据收集分析模块，我叫它A模块，A会独立出来，如果我用netty去做合适吗？或者说楼主对这个系统有什么要说的嘛？</div>2018-10-29</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIduoLOkCVsJzvbc1yX3FYI2icgic61EfRJ9fdatR22vOrMMBLYDY5KliaWNEbqeib1DxOMNnKeW7qENg/132" width="30px"><span>afeng</span> 👍（0） 💬（1）<div>根据现有的cache机制，在热点数据被发现，加入cache前，该热点数据会不会就已经在cache中了？</div>2018-10-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/56/88/7fd0e7d8.jpg" width="30px"><span>cici</span> 👍（0） 💬（2）<div>慕-小坏：
但是，缓存热点数据更多的是“临时”缓存，即不管是静态数据还是动态数据，都用一个队列短暂地缓存数秒钟，由于队列长度有限，可以采用 LRU 淘汰算法替换。
为什么选择用队列来缓存数据呢，队列如何做到快速读取缓存数据的呢？
2018-10-08
 作者回复
不一定非要用队列，也可以用其他内存集合如hashmap都行
缓存数据，一般静态数据可以提前加载到内存，如通过配置系统推送的方式。动态数据可以在远程调用时零时缓存在本机中。
cici询问：如果使用hashmap不是会存在线程不安全的问题吗？ 特别还是高并发的情况下，还是说只是一个方向，但是方向上需要考虑本场景下所引起的问题。</div>2018-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/49/8b/3596a3e2.jpg" width="30px"><span>403</span> 👍（0） 💬（1）<div>数据层给数据打标怎么做和具体应用可以说说么</div>2018-10-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/0e/c77ad9b1.jpg" width="30px"><span>eason2017</span> 👍（0） 💬（1）<div>赞，学习ing。</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c8/2d/3dd499a9.jpg" width="30px"><span>成都福哥</span> 👍（0） 💬（1）<div>动态发现的热点数据如何隔离？</div>2018-10-03</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/sTmCOXh19off3uvUDIsDic4SYJGulgl1v6o3R4E32OZCkZAVzZw751jg9Tya8jLicxKzQWHC4Bu6o08J55YJib9oQ/132" width="30px"><span>wsyzwddsg111</span> 👍（15） 💬（2）<div>文字超多，概念超多，例子超少，你应该想象一下，买课的大多数相当于阿里p5 p6级别，怎么让这些人能听懂才是最重要的</div>2021-05-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmql1FP9mYRmcIg8eGibU7ibhQ1Hph3LZerO90b2ibFNtIc20laZqnfCyrrGxfPeh9WmVdKdAz6bhng/132" width="30px"><span>Geek_b9e729</span> 👍（7） 💬（0）<div>这个课程干货太少了，建议极客教育出一个对课程评分的功能</div>2021-03-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5e/67/abb7bfe3.jpg" width="30px"><span>Geek_1njxto</span> 👍（3） 💬（0）<div>挺好的，推荐一篇前公司的简单实现：
https:&#47;&#47;tech.youzan.com&#47;tmc&#47;

自动发现热点 并 将热点缓存访问请求前置在应用层本地缓存 的解决方案，这就是 TMC 产生的原因。</div>2021-09-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/e7/37/0a7a27cb.jpg" width="30px"><span>Jefung</span> 👍（1） 💬（1）<div>分桶限制还是无法理解, 这么处理才能把热点请求和正常请求区分开</div>2019-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7e/fb/f6152110.jpg" width="30px"><span>叮咚叮咚</span> 👍（0） 💬（0）<div>如果是Hash后把请求放到一个队列，那这个热卖商品的并发处理起来，是不是就很慢了？用请求队列来存相当于把请求串行化了</div>2023-11-29</li><br/><li><img src="" width="30px"><span>知行</span> 👍（0） 💬（0）<div>其实 处理动态热点数据时 用缓存短暂存储，可能有问题吧。如果这份数据不适合缓存，因为它需要强一致性，可咋弄</div>2023-02-06</li><br/>
</ul>