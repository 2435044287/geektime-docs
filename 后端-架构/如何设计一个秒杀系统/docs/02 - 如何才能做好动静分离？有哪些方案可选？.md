上一篇文章中，我介绍了秒杀系统在架构上要考虑的几个原则，我估计你很快就会问：“知易行难，这些原则应该怎么应用到系统中呢？”别急，从这篇文章开始，我就会逐一介绍秒杀系统的各个关键环节中涉及的关键技术。

今天我们就先来讨论第一个关键点：数据的动静分离。不知道你之前听过这个解决方案吗？不管你有没有听过，我都建议你先停下来思考动静分离的价值。如果你的系统还没有开始应用动静分离的方案，那你也可以想想为什么没有，是之前没有想到，还是说业务体量根本用不着？

不过我可以确信地说，如果你在一个业务飞速发展的公司里，并且你在深度参与公司内类秒杀类系统的架构或者开发工作，那么你迟早会想到动静分离的方案。为什么？很简单，**秒杀的场景中，对于系统的要求其实就三个字：快、准、稳**。

那怎么才能“快”起来呢？我觉得抽象起来讲，就只有两点，一点是提高单次请求的效率，一点是减少没必要的请求。今天我们聊到的“动静分离”其实就是瞄着这个大方向去的。

不知道你是否还记得，最早的秒杀系统其实是要刷新整体页面的，但后来秒杀的时候，你只要点击“刷新抢宝”按钮就够了，这种变化的本质就是动静分离，分离之后，客户端大幅度减少了请求的数据量。这不自然就“快”了吗？
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg" width="30px"><span>J.M.Liu</span> 👍（29） 💬（8）<div>Hash 分组越少，缓存的命中率肯定就会越高，但短板是也会使单个商品集中在一个分组中，容易导致 Cache 被击穿，所以我们应该适当增加多个相同的分组，来平衡访问热点和命中率的问题。

老师，我也不是很明白hash分组的多少和命中率之间的关系。命中率不是只和热点数据是否被缓存有关吗，为什么和分组的多少也有关系啊？还有您说的cache分散是什么概念啊？这个问题好像很多人都问到了，看来很多人都不明白，希望老师可以比较详细地解答一下，谢谢老师。</div>2018-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（22） 💬（2）<div>动静分离的思想暗含着，分而治之和重点把控变化的思维。
分而治之-几乎所有不能直接解决的问题，都会分割开来，直到比较容易解决为止，学习也类似，把不能理解的知识作分割，直到比较容易理解
把控变化-管理或者研究事物发展的趋势，就需要重点关注和把控变化的情况，静态的容易处理，所以，变化的就对整体起到了决定性的作用

对于编程缓存是提高性能的杀手锏，静态资源自然是越靠前越好，动态资源也是越靠前越好，但是需要注意处理好变化的一致性问题</div>2018-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a3/0a/0f681189.jpg" width="30px"><span>阿毛</span> 👍（18） 💬（1）<div>分离时间因素。服务端输出的时间也通过动态请求获取。

这里的时间为什么也要动态请求呢?</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg" width="30px"><span>落叶飞逝的恋</span> 👍（17） 💬（3）<div>老师对于目前而言，你讲的架构方面，比如CDN、Nginx这些对于目前我的工作内容而言，涉及不到，哪怕上个新项目，我只要向运维申请机器，其他的不管，也没机会管，那么我如何快速的补充的这些东西，因为上面的讲的内容，可能对于我而言太空洞，应该如何避免？</div>2018-11-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/88/2c/87861bb1.jpg" width="30px"><span>嚴脂红.*</span> 👍（15） 💬（1）<div>我想知道老师用的配图都是用什么软件做的呢？</div>2018-10-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/37/2d/822fed5b.jpg" width="30px"><span>Rosso</span> 👍（13） 💬（1）<div>CDN二级cache缓存是一个什么概念？是一个CDN上的术语么？百度了一下没怎么查到</div>2018-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/69/07239d3c.jpg" width="30px"><span>Hana</span> 👍（9） 💬（2）<div>对于浏览器端的动静分离，疑问
问题一：动静数据在服务器端合成的话，是用什么怎么合成的？

而对于app原生开发的话
问题二：商品详情返回动静数据都是json格式的，那么在服务端如何合成呢？还是只能前段来分开请求合成？</div>2018-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f3/be/d8ba00d5.jpg" width="30px"><span>A星空之夜</span> 👍（6） 💬（1）<div>方案一和方案二中静态页面和动态资源的组装完整页面是在服务端吗？</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/74/36a86f4b.jpg" width="30px"><span>他城之途</span> 👍（4） 💬（3）<div>看评论，很多人被老师的“缓存命中率”整懵了，我觉得老师把“命中率”改成“利用率”可能会更好避免误解，老师的意思是分组多了，单个分组的“利用率”就低了。但在很多人的概念里，“命中率”是指缓存打中率，跟第一次和失效有关。</div>2018-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（4） 💬（1）<div>缓存失效了怎么办呢？文中没有给出答案，请指导一下。</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/1b/93/e3b44969.jpg" width="30px"><span>sgl</span> 👍（4） 💬（1）<div>想问一下，方案一和方案二里的cahe层，还有一个缓存，缓存是什么？</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/45/e7/df079023.jpg" width="30px"><span>🐻两脚兽จุ๊บ。</span> 👍（3） 💬（3）<div>许大大你好. 今天看了您这篇动静分离的干货, 受益匪浅. 想请教个问题. 方案1里面提到的把通常只需要虚拟机或者容器运行的 Java 应用换成实体机, 并且列出了实体机的几个优点. 这里面还是不大懂实体机相对于虚拟机为什么会存在这些差异. 我认为的是: 虚拟机只不过是实体机通过vps软件虚拟化出来的服务器而已, 同等配置的虚拟机跟实体机本质上没什么差别, 为什么会有网络瓶颈, 甚至大内存差别??? 希望得到徐老师的回复.谢谢</div>2019-01-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e7/56/c72997f3.jpg" width="30px"><span>缪文</span> 👍（3） 💬（1）<div>统一cache层，就是类似于redis或者阿里的tair这样的中间件吧？缓存单点怎么解决的？同一个商品的缓存再怎么hash都是落到同一个tair节点的</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/10/9a/1e69d930.jpg" width="30px"><span>小野</span> 👍（2） 💬（3）<div>Cache分组越多，命中率越低能理解。为什么分组越少越容易Cache被击穿呢。按我个人理解，Cache击穿就是同一个Key同一时间大量并发请求因为Cache中没有，都请求到后端系统去了。分组越多还是一样都击穿到后端系统去了啊</div>2019-01-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg" width="30px"><span>func</span> 👍（2） 💬（1）<div>许老师，架构图中的cache 是通过Varnish缓存的精通数据吗？nginx 也可以实现  为什么要单独加一层这个呢？</div>2018-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg" width="30px"><span>func</span> 👍（2） 💬（1）<div>没明白老师数的这个意思指的是？Cache层是web缓存可以直接缓存http请求，例如varnish？web缓存，缓存http请求？缓存的是请求后返回的数据？如果是同一个http请求就不会走到 redis cache了？</div>2018-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f9/18/653a2daa.jpg" width="30px"><span>~~</span> 👍（1） 💬（1）<div>老师您好,我想请问统一Cache中所说到的: 不同系统之间的内存可以动态切换,具体是指什么情况呢?</div>2019-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg" width="30px"><span>不似旧日</span> 👍（1） 💬（1）<div>最近面试经常问道如何设计一个秒杀系统,感觉这个专栏不适合面试,适合实操</div>2019-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/0a/c8/dae4a360.jpg" width="30px"><span>Do</span> 👍（1） 💬（1）<div>你好，请问下，以淘宝的商品详情页面为例，那么详情页的sku部分算是动态数据还是静态数据呢？淘宝这边是否允许改变商品的sku呢，允许的话是不是改变后会重新静态化然后页面url不会改变，还是页面会新生成个url?</div>2019-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/de/04/60620ce7.jpg" width="30px"><span>黄欢</span> 👍（1） 💬（1）<div>请问一致性Hash和提高命中率有什么关系？</div>2019-01-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg" width="30px"><span>张三丰</span> 👍（1） 💬（1）<div>要解决上面这些问题，可以再对 Cache 做 Hash 分组，即一组 Cache 缓存的内容相同，这样能够避免热点数据过度集中导致新的瓶颈产生。


不太理解  如果使用了redis  cluster  利用它自带的hash分组策略可以吧    还需要自己实现hash分组策略？</div>2018-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/5d/33/378c0740.jpg" width="30px"><span>rice</span> 👍（1） 💬（1）<div>关于商品详情页缓存在cdn，为何cdn二级缓存的节点少呢？为何不是cdn一级缓存？</div>2018-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/69/07239d3c.jpg" width="30px"><span>Hana</span> 👍（1） 💬（1）<div>老师，您从一开始的假设都是客户端是浏览器端 即web端，但是现在很多情况都是开发原生app端，那么这些内容里的有些静态数据缓存在客户端上这个也成立么？以及一些相关的假设</div>2018-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg" width="30px"><span>秋天</span> 👍（1） 💬（1）<div>说的缓存分组是在nginx中对于缓存节点的分组吗1或者叫机器？？？</div>2018-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3a/3b/3a6efa8f.jpg" width="30px"><span>GrubbyLu</span> 👍（1） 💬（1）<div>许老师问下，方案一和方案二中nginx的7层代理，是只用来做负载均衡，而不进行数据缓存嘛？如果缓存数据，是缓存什么数据呢？  还是只有分布式Cache层才进行真正的静态数据缓存？望解答多谢</div>2018-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f3/be/d8ba00d5.jpg" width="30px"><span>A星空之夜</span> 👍（1） 💬（1）<div>在方案二中，提到的“ 对 Cache 做 Hash 分组，即一组 Cache 缓存的内容相同” 这个hash分组是在根据什么hash的以及是在nginx层分析的吗？</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a3/da/dffe997b.jpg" width="30px"><span>cyflhn</span> 👍（1） 💬（1）<div>列表页的缓存一直是我们一个比较头疼的问题，比如商品列表页很难缓存，因为失效的问题很难处理，记得之前你建议使用esi,但是个人觉得对目前的项目改动较大，要对现有的动态页面进行动静分离，而且如果动态部分不能缓存，其实静态化意义也不大了，因为还是有大量请求回源</div>2018-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/6f/63/abb7bfe3.jpg" width="30px"><span>扬～</span> 👍（0） 💬（1）<div>在访问cache不是通过hash来找分片吗？为什么说分片分散，命中率下降呢？在cache路由时，不是就能确定数据属于这个分片，至于命中不命中则跟缓存失效时间有关。希望老师能够解答一下命中率这块，谢谢</div>2019-03-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg" width="30px"><span>jacy</span> 👍（0） 💬（1）<div>老师您好，我有个疑问，图中的线是cache直连的jboss，是不是指每次的动态化资源获取都要经过静态缓存层，为何要做这种操作？</div>2019-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/58/3a/98d6ee8d.jpg" width="30px"><span>oTo123</span> 👍（0） 💬（1）<div>请问你们有用到openresty吗?</div>2019-01-16</li><br/>
</ul>