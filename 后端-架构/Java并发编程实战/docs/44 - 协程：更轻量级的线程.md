Java语言里解决并发问题靠的是多线程，但线程是个重量级的对象，不能频繁创建、销毁，而且线程切换的成本也很高，为了解决这些问题，Java SDK提供了线程池。然而用好线程池并不容易，Java围绕线程池提供了很多工具类，这些工具类学起来也不容易。那有没有更好的解决方案呢？Java语言里目前还没有，但是其他语言里有，这个方案就是**协程**（Coroutine）。

我们可以把**协程**简单地理解**为一种轻量级的线程**。从操作系统的角度来看，线程是在内核态中调度的，而协程是在用户态调度的，所以相对于线程来说，协程切换的成本更低。协程虽然也有自己的栈，但是相比线程栈要小得多，典型的线程栈大小差不多有1M，而协程栈的大小往往只有几K或者几十K。所以，无论是从时间维度还是空间维度来看，协程都比线程轻量得多。

支持协程的语言还是挺多的，例如Golang、Python、Lua、Kotlin等都支持协程。下面我们就以Golang为代表，看看协程是如何在Golang中使用的。

## Golang中的协程

在Golang中创建协程非常简单，在下面的示例代码中，要让hello()方法在一个新的协程中执行，只需要`go hello("World")` 这一行代码就搞定了。你可以对比着想想在Java里是如何“辛勤”地创建线程和线程池的吧，我的感觉一直都是：每次写完Golang的代码，就再也不想写Java代码了。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg" width="30px"><span>高源</span> 👍（31） 💬（6）<div>王老师请教一下现在多数互联网公司后台都采用go语言开发了，学习go语言是不是也很有必要了，还是根据应用场景或者工作的实际情况来看啊。</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/2d/4c/983ce1b9.jpg" width="30px"><span>海水</span> 👍（17） 💬（3）<div>王老师好，有个问题请教下，公司支付接口调用的三方接口，这个三方接口秒级的耗时，如果想提高并发单单提高tomcat线程数或者该用异步sevlet是不是解决不了问题？我感觉这种情况应该是不是应该用协程比如go routine这样的才能解决这样的并发场景？毕竟三方接口的耗时省不了</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/49/2c/a2a948b6.jpg" width="30px"><span>艾斯曼</span> 👍（13） 💬（3）<div>”在 Java 里使用多线程并发地处理 I&#47;O，基本上用的都是异步非阻塞模型，这种模型的异步主要是靠注册回调函数实现的，那能否都使用同步处理呢？显然是不能的。因为同步意味着等待，而线程等待，本质上就是一种严重的浪费。“
老师您好，Java中Netty使用的是非阻塞+IO多路复用，这个应该属于同步IO还是异步IO？我的理解是这个属于同步IO，异步IO在windows上是IOCP，在linux其实AIO相关的API对socket不支持样，所以linux都是使用epoll+非阻塞的同步IO。不知道我这样理解是否正确？谢谢</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg" width="30px"><span>DFighting</span> 👍（9） 💬（1）<div>很赞同老师最后提到的软件产品开发，任何需要协作和迭代的事物都需要遵从基本的规范和规则，不然再牛叉的技术只能孤芳自赏，给产品带来的只有灾难。</div>2019-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/50/95/0af69cc1.jpg" width="30px"><span>windy</span> 👍（9） 💬（1）<div>关注老师专栏有一段时间了，老师讲解通俗易懂，涉猎的知识面很广。讲解某个知识点首先说明由来，背后理论，然后展开脉络进行剖析，如何应用到实践中，学以致用。在此送上感谢！</div>2019-06-10</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLz3icr3mGs5ib8FbSPQZ2ic3ib90mHkd1btQrmGacZjJxfYXrerIdaTxglKyCicFzLcEAb6deC2cWjE5Q/132" width="30px"><span>the geek</span> 👍（6） 💬（1）<div>哈哈，本来是上来复习一下，结果新冒出了一章46&#47;45</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（3） 💬（1）<div>我也把代码可读性排在第一位。我的目的是降低他人加入开发的成本。从长远看，这会让软件更具活力和可能性。毕竟虽然暂时来看为了可读性可能会损失一些性能和时间。但从长远来看，加入的人越多，节省别人的时间就越多，总会超过我的投入。而性能，随着业务的发展，后续可能能写出更贴合业务场景的优化方案。更何况，习惯后，写高可读性的代码并不会多花我时间。</div>2019-06-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b3/c5/7fc124e2.jpg" width="30px"><span>Liam</span> 👍（3） 💬（3）<div>cosocket的非阻塞体现在哪里呢，是说receive等方法是非阻塞方法吗？</div>2019-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/03/89/e1621a01.jpg" width="30px"><span>zhangtnty</span> 👍（3） 💬（1）<div>王老师好，很赞同总结中讲的代码质量的看法。我认为好的项目不仅功能强大, 代码结构清晰非常重要, 好的代码结构一定和业务如出一辙，而不是过多的花式代码，总给人一种练手的感觉。</div>2019-06-08</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/2bicqibaxw5xPMnY83tgBrXb2TzDjictClibJBYv6a83WOWSLN3CpZ9FARwLwwaJcX2De5f9AU2ILjO9bicqzKy7GIQ/132" width="30px"><span>Geek_b38ae5</span> 👍（2） 💬（1）<div>同步是针对几个线程，才会有协调。
而阻塞是针对单个线程把线程，放进线程阻塞队列里面吗？</div>2021-05-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ef/04/f2942f14.jpg" width="30px"><span>Boomkeeper</span> 👍（2） 💬（1）<div>老师好，请问协程也是不是有加锁的场景</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/9e/39/6cd103bf.jpg" width="30px"><span>JK-舒玉强</span> 👍（2） 💬（1）<div>很喜欢王老师的课程，怎么才能够变得跟老师一样厉害呢？</div>2019-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/81/d0/dd15b155.jpg" width="30px"><span>笨小孩</span> 👍（1） 💬（1）<div>老师您好，我想问一下就是内核他与用户态，为什么协程的用户态性能更加优越，能帮我讲解讲解吗？</div>2020-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg" width="30px"><span>业余草</span> 👍（1） 💬（1）<div>关于协程，整理了一些我个人的理解，https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;yN9z1bupZLjuK2crJKpIpg，请帮忙指正！</div>2019-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ef/04/f2942f14.jpg" width="30px"><span>Boomkeeper</span> 👍（1） 💬（1）<div>老师，请教一个问题：关于协程来优化io的场景，具体这个咋玩？</div>2019-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg" width="30px"><span>苏志辉</span> 👍（1） 💬（2）<div>cosocket为什么可以非阻塞，也需要等待有数据可读才行吧，没太理解</div>2019-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/7c/b5/4a7a2bd4.jpg" width="30px"><span>Sunqc</span> 👍（1） 💬（2）<div>同步和阻塞，异步和非阻塞，感觉好相似。同步不就是阻塞吗</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/f3/65c7e3ef.jpg" width="30px"><span>cricket1981</span> 👍（1） 💬（1）<div>Actor model中创建actor的代价也很小，可不可以认为actor model也属于协程？</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg" width="30px"><span>高源</span> 👍（1） 💬（1）<div>王老师，协程利用同步非阻塞来完成了高并发的处理吧，我查了下c语言c#语言的协程都有，但是我没明白go只是比其它语言语法简单容易实现吗</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/98/2e/0cbf9c96.jpg" width="30px"><span>程序饲养员</span> 👍（6） 💬（0）<div>操作系统层面的进程、线程、协程这些理论知识要深入的话 有什么书或者材料推荐吗</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/5f/2028aae5.jpg" width="30px"><span>搏未来</span> 👍（6） 💬（1）<div>能写出易于理解的代码也是一种能力😁</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/1e/8c/d9330d2b.jpg" width="30px"><span>花儿少年</span> 👍（3） 💬（0）<div>我公司的营销架构代码就异常难懂，神马注释都没有，不管是看还是排查问题都难度贼大</div>2019-06-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/06/51/1d24ead6.jpg" width="30px"><span>一个卖火柴的老男人</span> 👍（1） 💬（0）<div>jdk21已经推出了虚线程</div>2024-05-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/21/de/c935d3bd.jpg" width="30px"><span>文培</span> 👍（1） 💬（0）<div>阻塞是说线程要挂起来，是对线程来说的

同步是任务层面来说的
同步非阻塞，说的是任务之间要一个个的按顺序执行，但是在执行任务的这个线程不会被cpu执行阻塞，会一直循环执行得到想要的任务结果然后返回。
是这样的吗老师</div>2021-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/98/2e/0cbf9c96.jpg" width="30px"><span>程序饲养员</span> 👍（1） 💬（0）<div>进程，线程，协程在系统层面和语言层面分别有什么命令或者图形分析监控工具</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg" width="30px"><span>kimoti</span> 👍（1） 💬（0）<div>go语句够简单了,还批判？多线程的本质就是要并发执行,没办法汇聚啊</div>2020-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e1/5c/86606d9c.jpg" width="30px"><span>湮汐</span> 👍（1） 💬（0）<div>Java中已经有支持协程的类库，但是为啥这个并没有广泛使用，而且也没有纳入到官方jdk源码里面呢？是因为稳定性不够好吗？</div>2020-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/cf/d5382404.jpg" width="30px"><span>RRR</span> 👍（1） 💬（0）<div>看来 erlang 的 actor 才是解决并发最优雅的方式</div>2020-04-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4akcIyIOXB2OqibTe7FF90hwsBicxkjdicUNTMorGeIictdr3OoMxhc20yznmZWwAvQVThKPFWgOyMw/132" width="30px"><span>Chuan</span> 👍（1） 💬（0）<div>老师，请教下，不同协程间通信、访问共享变量时如何协调控制呢？</div>2020-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg" width="30px"><span>天草二十六</span> 👍（1） 💬（0）<div>java也有实现协程的框架了吧</div>2019-10-21</li><br/>
</ul>