前面我们用13篇文章的内容介绍了Java SDK提供的并发工具类，这些工具类都是久经考验的，所以学好用好它们对于解决并发问题非常重要。我们在介绍这些工具类的时候，重点介绍了这些工具类的产生背景、应用场景以及实现原理，目的就是让你在面对并发问题的时候，有思路，有办法。只有思路、办法有了，才谈得上开始动手解决问题。

当然了，只有思路和办法还不足以把问题解决，最终还是要动手实践的，我觉得在实践中有两方面的问题需要重点关注：**细节问题与最佳实践**。千里之堤毁于蚁穴，细节虽然不能保证成功，但是可以导致失败，所以我们一直都强调要关注细节。而最佳实践是前人的经验总结，可以帮助我们不要阴沟里翻船，所以没有十足的理由，一定要遵守。

为了让你学完即学即用，我在每篇文章的最后都给你留了道思考题。这13篇文章的13个思考题，基本上都是相关工具类在使用中需要特别注意的一些细节问题，工作中容易碰到且费神费力，所以咱们今天就来一一分析。

## 1. while(true) 总不让人省心

[《14 | Lock&amp;Condition（上）：隐藏在并发包中的管程》](https://time.geekbang.org/column/article/87779)的思考题，本意是通过破坏不可抢占条件来避免死锁问题，但是它的实现中有一个致命的问题，那就是： while(true) 没有break条件，从而导致了死循环。除此之外，这个实现虽然不存在死锁问题，但还是存在活锁问题的，解决活锁问题很简单，只需要随机等待一小段时间就可以了。
<div><strong>精选留言（22）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/7c/b5/4a7a2bd4.jpg" width="30px"><span>Sunqc</span> 👍（74） 💬（4）<div>听老师讲课是一种享受，很舒服，从文字叙述就感觉很和蔼可亲，不像有的老师，虽然技术也很牛，但是话里话外透漏着自己多牛多牛的感觉</div>2019-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg" width="30px"><span>DFighting</span> 👍（8） 💬（2）<div>关于线程协作那里为什么使用单线程线程池，特意回头重新看了下代码，终于明白了老师的做法，因为回调函数也会占据一个执行线程，如果不使用额外的线程，那么就会存在部分串行，就达不到完全分工并行，以提升吞吐的效果了</div>2019-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/07/bb/97ba4ccd.jpg" width="30px"><span>邱</span> 👍（7） 💬（1）<div>王老师你好，我想问您一个问题:在实际的项目中使用线程池并行执行任务的时候，是不是和数据库的交互都不要放在线程池当中</div>2019-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg" width="30px"><span>美美</span> 👍（5） 💬（2）<div>2. signalAll() 总让人省心
如果非常明确的知道 只有一个线程在阻塞等待，明确的唤醒一个线程，这样不更好吗？</div>2020-02-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg" width="30px"><span>kimoti</span> 👍（4） 💬（5）<div>想请教老师一个问题，为什么当一个线程遇到阻塞式IO的时候，其他线程都会阻塞呢？
其他线程并没有遇到阻塞式IO呀。</div>2020-05-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/37/8e/cf0b4575.jpg" width="30px"><span>郑晨Cc</span> 👍（4） 💬（1）<div>老师 第一个while(true)的例子 怎么在释放锁之前就 break退出循环了？难道break不该在释放锁之后吗？</div>2019-05-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg" width="30px"><span>ban</span> 👍（2） 💬（1）<div>老师，你好。
第五题的问题里面：通过源码你会发现 CyclicBarrier 是同步调用回调函数之后才唤醒等待的线程，如果我们在回调函数里直接调用 check() 方法，那就意味着在执行 check() 的时候，是不能同时执行 getPOrders() 和 getDOrders() 的。

意思是说如果回调函数直接执行chekc()方法，会让check()和（getPOrders() 和 getDOrders() ）变成串行的情况吗！</div>2019-05-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg" width="30px"><span>高志强</span> 👍（0） 💬（1）<div>老师，我想问一下您文章中的流程图，使用什么工具画的呢</div>2022-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/5e/81/82709d6e.jpg" width="30px"><span>码小呆</span> 👍（0） 💬（1）<div>看老师的课程,结合java并发编程实战结合,学习起来更加好呢~~</div>2022-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e2/58/8c8897c8.jpg" width="30px"><span>杨春鹏</span> 👍（0） 💬（2）<div>您好。我现在的业务需求：
只要有一个子线程失败，那么主线程以及其他子线程的事务也要进行回滚？
那怎么实现比较好一些。谢谢</div>2019-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg" width="30px"><span>苏志辉</span> 👍（0） 💬（1）<div>第五个问题，我觉得应该先同步取完前两个节点再异步调用check逻辑，否则极端情况，取到的两个节点不是匹配的</div>2019-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg" width="30px"><span>ipofss</span> 👍（14） 💬（3）<div>这一章的内容，我觉得等把整个专栏学完之后，还有必要再仔细回顾一遍，然后再加上其他的文章，自己动手写一下demo，才能记住的多一些，毕竟平时工作中用到多线程的地方不多</div>2019-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/5d/78/f011d586.jpg" width="30px"><span>遇见阳光</span> 👍（7） 💬（2）<div>老师，我有一个疑问，如果说每个不同的业务都需要不同的线程池去处理，那这样线程池不是越来越多，这种应该如何解决</div>2019-04-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg" width="30px"><span>张三</span> 👍（5） 💬（0）<div>打卡，虽然没有深入了解每个工具类，但确实了解更多了。</div>2019-04-30</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKiaPl8VlycfEgPmuGacSAAdf08Ect7rfAtRzW2jiaslsPSicIDwibG8yObgcI0ooTLDl0zH4M17ziazjg/132" width="30px"><span>李剑</span> 👍（2） 💬（0）<div>并发工具应该都涉及到aqs吧 但这一块没看讲到</div>2021-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0f/9f/f4b06bd5.jpg" width="30px"><span>见南山</span> 👍（1） 💬（0）<div>这章就是工具啊，只能理解每个工具的场景，才能熟练的应用，而具体的细节反倒不是非常重要了</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/0c/c2/bad34a50.jpg" width="30px"><span>张洋</span> 👍（0） 💬（0）<div>之前还对CyclicBarrier 那篇使用一个新的线程池有疑问，通过今天的解答，茅塞顿开，是自己之前的理解片面了。</div>2020-12-22</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLAK6F4BFT5ewhJEeZrjmRx5HxP8tvnNpJcpLlotHiadp0s6aL3d7LfMHEuQP6tibu80wUy8micVu4oQ/132" width="30px"><span>InfoQ_e077cb303519</span> 👍（0） 💬（0）<div>老师，在一个项目中线程池共享怎么实现比较好</div>2020-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/aa/ff/e2c331e0.jpg" width="30px"><span>bbbi</span> 👍（0） 💬（0）<div>工具类确实有点多，而且都是实践性很强的，这一遍看仅仅是走马观花而已</div>2020-03-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg" width="30px"><span>秋天</span> 👍（0） 💬（0）<div>并发编程还需要多踩坑，最近就因为这个导致系统出现异常，而导致线系统cpu占满</div>2019-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg" width="30px"><span>yang</span> 👍（0） 💬（1）<div>天呐，我一直以为执行check()的是 fixedPool中的的那唯一一个线程!</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg" width="30px"><span>捞鱼的搬砖奇</span> 👍（0） 💬（0）<div>老师能不能在上面提到的原文出错的代码边写上正确的做，并用注释说明</div>2019-05-01</li><br/>
</ul>