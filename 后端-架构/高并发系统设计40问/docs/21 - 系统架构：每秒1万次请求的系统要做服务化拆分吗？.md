你好，我是唐扬。

通过前面几个篇章的内容，你已经从数据库、缓存和消息队列的角度对自己的垂直电商系统在性能、可用性和扩展性上做了优化。

现在你的系统运行稳定好评不断，每天高峰期的流量已经达到了10000/s请求，DAU也涨到了几十万。CEO非常高兴，打算继续完善产品功能进行新一轮的运营推广，争取在下个双十一可以将DAU冲击过百万。这时你开始考虑怎么通过技术上的优化改造支撑更高的并发流量，比如支撑过百万的DAU。

于是你重新审视了自己的系统架构，分析系统中有哪些可以优化的点。

![](https://static001.geekbang.org/resource/image/61/e7/612173bc83b332bef201e4ad7056f5e7.jpg?wh=1142%2A661)

目前来看，工程的部署方式还是采用一体化架构。也就是说所有的功能模块，比如电商系统中的订单模块、用户模块、支付模块、物流模块等等都被打包到一个大的Web工程中，然后部署在应用服务器上。

你隐约觉得这样的部署方式可能存在问题，于是Google了一下后发现当系统发展到一定阶段都要做微服务化的拆分，你也看到淘宝的“五彩石”项目对于淘宝整体架构的扩展性带来的巨大影响。这一切让你心驰神往。

但是有一个问题一直萦绕在你的心里：究竟是什么促使我们将一体化架构拆分成微服务化架构？是不是说系统的整体QPS到了1万或者到了2万，就一定要做微服务化拆分呢？
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/78/db/825d3b7c.jpg" width="30px"><span>Alex Liu</span> 👍（12） 💬（2）<div>现在只要是个项目都恨不得用微服务，而且用的不彻底，反而集成了单体和微服务的缺点，简直就是人间炼狱啊</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/2c/40/d97909b0.jpg" width="30px"><span>沐紫剑</span> 👍（9） 💬（3）<div>如果一个系统微服务数比开发人数还要多，这样合理吗</div>2020-06-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Ir1EdhB29109UhH7SGnVLEfEcKcGPDViaTpbS7BYXngqFghThYc093oFCTwsTLjVR7nHPokXJIPm7rbmPAU7TdQ/132" width="30px"><span>Geek_33c134</span> 👍（7） 💬（4）<div>唐老师你好，关于高并发的系统人们都会问系统的qps是多少。但是如果一个系统经过服务化之后，我只会负责其中的一个小模块，所以我关注的只是这个模块的访问量多少。所以系统的qps我是无法关注的，也关注不出什么东西（因为其他的模块都不是我负责的）。想问下这时候人们所问的qps是指模块的qps还是只系统呢？如果是模块的话qps其实是比较小的，很难提到高并发；但是如果是系统的qps，而其他模块是其他部门负责的，与我又没有什么关系。这种情况下应该如何回答呢？</div>2019-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b9/98/69bf4f3a.jpg" width="30px"><span>张传美</span> 👍（5） 💬（2）<div>一个工程师负责几个服务是合理的？
我的思考：从服务活跃度，重要度，工程师水平三个角度来考虑
1. 活跃又重要的服务，一个高级开发工程师不超过3个？
2. 非活跃，非重要的服务在全部服务数中的占比应低于30%？
想问下：
1. 业界的最佳实践是？
2. 您认为一个工程师负责几个服务是合理的？</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/f1/0d/b4bd5b79.jpg" width="30px"><span>Thranduil</span> 👍（5） 💬（2）<div>公司刚开始就直接上中台可行吗？</div>2020-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（4） 💬（1）<div>请问老师，若把一个单体服务拆分成多个微服务后，原来客户端只需要一次http调用服务器，微服务化后客户端需要多次http调用服务器端，这就对客户端来说就增加了总的调用时间了，是不是存在这个问题呢？</div>2020-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0a/c0/401c240e.jpg" width="30px"><span>撒旦的堕落</span> 👍（4） 💬（2）<div>以前每次发版整个部门的人都要到凌晨  项目太大  导致开发时项目启动耗时太多  自己的代码会牵扯到别人的代码  提交时 代码冲突问题  因为所有人代码都在一块  一个人有功能要上线  其他人都得留下 一个很小的功能上线  测试都到对其他功能做回归测试   真的太难了</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg" width="30px"><span>阿卡牛</span> 👍（3） 💬（2）<div>之前主导过一个项目，那时正是微服务概念开始流行的时候，脑袋一热，很多东西还没搞懂，就心痒痒地弄起来了。
结果当然悲剧了，还好及时止损。
不过遇到一个大问题还是可以说说的：就是数据问题，至今没搞明白，多个微服务之间是否可以存在相同的数据。还是必须通过接口的方式获取</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg" width="30px"><span>空知</span> 👍（2） 💬（2）<div>走上微服务的原因是 
1、确实是代码量大 交互在一起复杂
2、部署、测试麻烦</div>2020-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg" width="30px"><span>longslee</span> 👍（2） 💬（1）<div>打卡。还是有收获的，以前理解微服务化，只知道业务细分和单独部署扩建容易，没想到数据库连接数这个地方也有讲究。  曾经的大项目是一体化的，开发过程比较崩溃的是八竿子打不着的类被远方的一个兄弟改了，我提交代码的时候被卡下来了。。。原因就是紧耦合，而我没有全量更新代码。</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/3a/28/cf707831.jpg" width="30px"><span>与狼共舞</span> 👍（1） 💬（1）<div>java还好像php遇到分布式事务头大。</div>2020-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/93/d6/040e4965.jpg" width="30px"><span>Omer</span> 👍（1） 💬（7）<div>老师你好 ，我想请教一下。
数据库那块我有点疑惑，你把用户的模块拆分出来成了单独的用户库访问，为什么就减少了用户库的瓶颈呢，那我拆分之前的所有用户库的请求不减少的情况下都丢给用户模块，那请求数量和建立连接的数量和 不拆分的时候不是都差不多吗，而且还增加了不同服务之间的IO，希望老师看到能点解一下</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/71/a3/b881f08c.jpg" width="30px"><span>L响</span> 👍（0） 💬（1）<div>我的系统使用的是leveled 只能在进程内读写 目前性能很高 试着拆分成微服务后 增加了网络调用 导致性能降低 这种情况老师遇到过吗</div>2020-01-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLVkCdrMz5YXFS6lL45d4KEJaFWyUTZprv2TLcTHjSLm5MiaNp9ZaibKyx6cgAkGHDP96Iec01c1x1g/132" width="30px"><span>Geek_bcfz2j</span> 👍（0） 💬（4）<div>微服务后，然后就是中台的构建了</div>2019-12-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/RNO4yZyBvic914hewmNNE8iblYDcfv5yGHZ9OnKuCuZXNmGR0F5qV3icKLT2xpMt66GyEpicZVvrmz8A6TIqt92MQg/132" width="30px"><span>啊啊啊哦哦</span> 👍（0） 💬（1）<div>用户池值得是用户连接池？</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg" width="30px"><span>旅途</span> 👍（0） 💬（3）<div>老师，业务池的作用什么，其他的业务池只访问用户池可以吗</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/f5/98/45374bb9.jpg" width="30px"><span>小小小丶盘子</span> 👍（0） 💬（2）<div>面试的时候，面试官问我，你们体量不大为什么要拆分呢？我从开发的角度回答的。项目维护或者单独优化，提取公共服务之类。老师，如果只是为了开发维护上做业务模块拆分，有必要吗？</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg" width="30px"><span>吃饭饭</span> 👍（0） 💬（1）<div>一句话：量变引起质变；现在不少人张嘴微服务闭嘴微服务，但是得去衡量自己的业务真的有必要吗？微服务看着优雅其实成本很大，就单纯这个问题每秒上完 QPS ，这业务量很大了，不细粒度怎么可以</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/df/e0/c7bb2a98.jpg" width="30px"><span>风再起时</span> 👍（0） 💬（2）<div>发个版 ，半小时</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/73/ce/23bd3997.jpg" width="30px"><span>Wiggins</span> 👍（26） 💬（4）<div>走上微服务化道路的主要原因还是微服务目前大热加上docker的兴起，出于可能降低成本的考虑。
但以前就是SOA的架构，按照模块分解服务，但是并没有微服务，不知道这样的模块分解服务然后通过DNS去访问的方式叫做什么呢？
而有个问题在于现在公司的确是将业务按照模块拆分了，但是这些模块还是访问的同一个库，这样微服务拆分是不是并没有性能上的提升，反而因为多了网络传输而更加慢了，只是逻辑分层清晰了？那这个时候还有必须微服务么？毕竟多开一个数据库实例就要有额外的支出。</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f9/5f/b0a125a9.jpg" width="30px"><span>chp</span> 👍（11） 💬（6）<div>现在公司，把业务按模块拆分，每个成员负责一个模块，但是这些模块依然连的同一个库。</div>2019-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（3） 💬（0）<div>😅核心还是钱，微服务化还挺复杂的尤其是基础设施不健全时搞，问题会更多。所以，能不搞就不搞，但是因为不搞耽误公司赚钱或者使公司多花钱钱时，自然会有人推着你搞，你不搞就搞你。</div>2020-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（2） 💬（0）<div>在对单体应用进行微服务改造的过程中，切入点可以从比较高频的业务逻辑入手，可以将这部分业务逻辑首先从单体应用中独立出来，通过微服务的形式进行部署，然后逐渐逐渐地过渡到将其他的逻辑单元</div>2020-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a4/2b/3ba9f64b.jpg" width="30px"><span>Devin</span> 👍（2） 💬（0）<div>系统QPS并不是微服务化的决定性因素或者说直接因素，主要还是看是否遇到问题了，比如资源问题、效率问题、成本问题等。</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg" width="30px"><span>亚林</span> 👍（1） 💬（0）<div>前几年，我身边一群人都在谈微服务，但没有人谈康威法则，😭</div>2021-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/c3/94/e89ebc50.jpg" width="30px"><span>神毓逍遥</span> 👍（1） 💬（0）<div>微服务的好处：
1  业务解耦  开发维护简单，构建快
2   多语言  多模块  可以提高开发进度</div>2020-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a8/e9/9b69a009.jpg" width="30px"><span>oneDream</span> 👍（1） 💬（1）<div>微服务最根本的应该是解决架构和可扩展的问题，像文章重说的1wqps 在微服务场景中也同样存在</div>2019-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/43/76/3477a91e.jpg" width="30px"><span>刘超</span> 👍（0） 💬（0）<div>您好，老师，有个问题反复思考没有答案，请教您下：
单体应用集群部署（数据库已经做数据分片+主从）的情况下为什么数据库连接会是瓶颈？

1、我理解两者没有必然联系，数据库层面可以做数据分片+主从，是可以解决数据库层面的并发能力问题和数据存储问题的。这跟应用层是单体or服务化是没关系的。
2、单体应用中对于垂直分库的数据库连接管理是通过多数据源的方式独立管理的，也就是说不同库的连接池是隔离的，同一个单体应用下不同业务的连接池不存在竞争关系。</div>2024-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg" width="30px"><span>ipofss</span> 👍（0） 💬（0）<div>什么时候开始拆分和拆分成多大粒度，是由技术+团队管理文化决定的。
技术leader有话语权，并且技术比较好，做的微服务拆分和粒度都会比较适合业务当前的情况；
技术leader没有话语权，或者项目是由职级上不懂技术的领导拍脑门，做的微服务拆分，那么无论怎么做，都会很拧巴。</div>2023-09-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg" width="30px"><span>剑八</span> 👍（0） 💬（0）<div>单体发布慢，影响其它模块，代码冲突多，
数据库连接受单体应用影响（比如交易流量大要扩容，影响到商品的数据库连接）</div>2022-04-06</li><br/>
</ul>