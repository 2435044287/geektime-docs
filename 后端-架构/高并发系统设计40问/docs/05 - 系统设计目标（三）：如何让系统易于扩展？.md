从架构设计上来说，高可扩展性是一个设计的指标，它表示可以通过增加机器的方式来线性提高系统的处理能力，从而承担更高的流量和并发。

你可能会问：“在架构设计之初，为什么不预先考虑好使用多少台机器，支持现有的并发呢？”这个问题我在“[03 | 系统设计目标（一）：如何提升系统性能？](https://time.geekbang.org/column/article/139474)”一课中提到过，答案是峰值的流量不可控。

一般来说，基于成本考虑，在业务平稳期，我们会预留30%～50%的冗余以应对运营活动或者推广可能带来的峰值流量，但是当有一个突发事件发生时，流量可能瞬间提升到2～3倍甚至更高，我们还是以微博为例。

鹿晗和关晓彤互圈公布恋情，大家会在两个人的微博下面，或围观，或互动，微博的流量短时间内增长迅速，微博信息流也短暂出现无法刷出新的消息的情况。

那我们要如何应对突发的流量呢？架构的改造已经来不及了，最快的方式就是堆机器。不过我们需要保证，扩容了三倍的机器之后，相应的我们的系统也能支撑三倍的流量。有的人可能会产生疑问：“这不是显而易见的吗？很简单啊。”真的是这样吗？我们来看看做这件事儿难在哪儿。

## 为什么提升扩展性会很复杂

在上一讲中，我提到可以在单机系统中通过增加处理核心的方式，来增加系统的并行处理能力，但这个方式并不总奏效。因为当并行的任务数较多时，系统会因为争抢资源而达到性能上的拐点，系统处理能力不升反降。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（58） 💬（5）<div>memcached 官方没有提供集群特性，一般第三方会使用一致性哈希算法来进行负载均衡实现集群扩展。
redis 官方的集群选择把数据根据key来哈希分配到固定数量的 slot 上，然后把 slot 再分配到具体的redis实例上来实现集群，当需要扩展时，只需要把 slot 分配一些到新加入的 redis 实例即可。这种多加一层来实现集群扩展的方式，类似于我们数据库分表时使用的索引表。</div>2019-09-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/vK7WwQG23CI29w0iamcgetTicMdQ8NsJsQWSXIia3aSUbVE6dqfTiaVtqTdibJu31f7k2BkOSkQianxOUaqojEYP6ic3w/132" width="30px"><span>coffee</span> 👍（30） 💬（1）<div>关系型数据库是强schema约束，并且支持事务，所以扩展性相对较差。
NOSQL一般都不是强schema约束的，所以可扩展性比关系型数据库要好。</div>2019-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/6f/59/21beefcb.jpg" width="30px"><span>YY</span> 👍（16） 💬（3）<div>数据库拆分后，但是各个库还是有相互依赖的，比如关系池，内容池都会依赖用户池，这种相互依赖的关系怎么解决？</div>2019-12-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKoTDBX4a5u3Oc0zDpKDp6UbcYDcwAJXfBSmicqQwoyxaoVLEWzjIoUqYBiaDJHAYkO8icLtXqk4ibqKg/132" width="30px"><span>xu晓晨</span> 👍（13） 💬（6）<div>redis扩展主要两方面。主备方案以及集群方案。
主备的话可以用redis的sentinel（哨兵）方案主要是解决redis主节点故障后的自动切换。它负责持续监控主从节点的健康，当主节点挂掉时，自动选择一个最优的从节点切换为主节点。
集群方案的话主流的是两种 一种是codis另一种是redis官方提供的cluster。</div>2019-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/36/d2/32d3545a.jpg" width="30px"><span>A.Windy</span> 👍（13） 💬（1）<div>这不就是微服务嘛😄</div>2019-09-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/de/80/dd4da55b.jpg" width="30px"><span>hailong</span> 👍（8） 💬（4）<div>为了一个服务就要一个库？ 本次课程举的例子一个数据库分不同的表就行了，没懂分库啥意思</div>2019-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg" width="30px"><span>吃饭饭</span> 👍（4） 💬（2）<div>两个问题：
1）尽量不适用事务，这里是不是需要使用分布式事务？类似于使用消息中间件等？
2）图示中的`池`指的是单个的微服务吗？我第一次听说这个概念，希望老师帮忙回答：）</div>2019-10-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（4） 💬（1）<div>系统的易扩展之从存储和业务拆分来考虑。业务拆分是容易理解的，专人专事；从存储角度来考虑我想是因为所有应用的功能的最终的结果都是把一些结果存储起来，于是存储就是重点，是重点就必然引起量大，量大了必然成瓶颈。打卡04。</div>2019-10-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/52/a0/d308434e.jpg" width="30px"><span>StarKing</span> 👍（4） 💬（1）<div>预测未来的数据库一定会综合ES+MONGODB的能力，直接选择库的模式就可以像NOSQL一样使用。</div>2019-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg" width="30px"><span>飞翔</span> 👍（4） 💬（6）<div>老师。不太理解什么是池？ 用户池 里是一台机器还是多台机器呀？</div>2019-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg" width="30px"><span>Sports</span> 👍（3） 💬（1）<div>看的是真过瘾，很有逻辑和条理性，不像一些课程要么都是曲高和寡的技术细节，要么都是泛泛白话</div>2020-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg" width="30px"><span>XD</span> 👍（3） 💬（5）<div>redis相关的书籍或者博客有推荐吗？前段时间刚看了一个分布式锁的文章，收获很大。</div>2019-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/65/7b/66b9befd.jpg" width="30px"><span>Hwan</span> 👍（2） 💬（1）<div>看评论说auto shard ，最近在看redis，redis通过哨兵做主从备份和主从迁移，通过集群做增加主节点和减少主节点的事情，基本可以做好自动扩容和缩容了，请问下关系型数据库里面有类似的吗，能够实现自动的扩容之类的，还是说必须需要人工来呢</div>2019-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/9e/10/3cb10bf7.jpg" width="30px"><span>醇梨子</span> 👍（2） 💬（1）<div>我们在实际生产环境中，线程池隔离及线程池设置大小的依据是什么？</div>2019-09-28</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKw8ictgYcqf6kicJ4RlmicgKvCAGLTQFmmvCWwGzGJeY5SJ8KxXNtNh12FI0IzJNYfUx1PbJcHriadbA/132" width="30px"><span>王三好</span> 👍（1） 💬（1）<div>一直都是这么做的，没有系统整理过，业务池子拆分还可以根据，业务是否经常变化，经常变化的抽取出来</div>2020-04-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132" width="30px"><span>null</span> 👍（1） 💬（1）<div>老师，您好！

原文“把相同业务的服务拆分成单独的业务池”
这里为啥取名为“池”，池子里的最小单位是服务实例，还是接口吖？

产生这样的疑问，是因为学习到按业务维度划分时，池子里都是相同业务的服务，如内容池都是一组内容服务。而按核心非核心划分时，是对接口划分。

谢谢老师！！</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/45/9c/5b06d143.jpg" width="30px"><span>芳菲菲兮满堂</span> 👍（1） 💬（1）<div>如果说it存在万金油 那么可能就是拆分和分层</div>2020-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/d5/0e/dae566c7.jpg" width="30px"><span>JOHN</span> 👍（1） 💬（4）<div>查阅了一些资料，我发现作者对于可扩展和网上大部分的解读不一样，网上的解读是架构上要封装变化，以此实现对扩展开放（开闭原则），我更加认同网上的解读，我觉得作者的这个解读更加适合 可扩容 这个词。概不过话说回来，可扩容也给我们读者提供了一个新的视角来看系统，也很棒的。</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/a2/fa41c8a8.jpg" width="30px"><span>书中迷梦</span> 👍（1） 💬（1）<div>存储层扩展的时候，是不是加个限定词比较好，对于数据不敏感的业务可以考虑不使用事物！而不是直接不使用事物！像支付和订单这些系统，数据肯定需要一致性</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg" width="30px"><span>longslee</span> 👍（1） 💬（1）<div>nosql数据库扩容缩容，都是涉及到数据的再分配，手段是减少节点变化带来的数据迁移代价，以及减少节点变化造成的缓存失效。 老师我有个问题，有没有哪款产品是基于一致性Hash理论来做的呢，比如Redis是用的Slot，而不是一致性Hash。</div>2019-10-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg" width="30px"><span>ub8</span> 👍（1） 💬（1）<div>坐等干货</div>2019-09-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/49/82/e34f9ce9.jpg" width="30px"><span>東</span> 👍（0） 💬（1）<div>当数据库按照业务和数据维度拆分之后，我们尽量不要使用事务。因为当一个事务中同时更新不同的数据库时，需要使用二阶段提交，来协调所有数据库要么全部更新成功，要么全部更新失败。这个协调的成本会随着资源的扩展不断升高，最终达到无法承受的程度。

这里所说的不使用事务，那如果需要更新多张表则怎么实现统一性呢？</div>2020-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/a1/cd/bc74741c.jpg" width="30px"><span>~patience</span> 👍（0） 💬（1）<div>数据库拆分的太细了，如果有多表联合查询，并且要分页怎么弄呢？有些统计也是</div>2020-08-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/e3/ff/51ea6737.jpg" width="30px"><span>辰砂</span> 👍（0） 💬（1）<div>条理清晰，非常感谢！</div>2020-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（1）<div>如何让系统易于扩展？老师，这里核心就是拆，服务拆分＋数据存储拆分，职责单一利于维护和扩展。不过我觉得是容器化技术的发展，使的这一切变得容易的，否则加机器减机器编译构建发布上线，很耗时费力和笨重。</div>2020-04-06</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2icbib62icXtibTkThtyRksbuJLoTLMts7zook2S30MiaBtbz0f5JskwYicwqXkhpYfvCpuYkcvPTibEaQ/132" width="30px"><span>xuanyuan</span> 👍（0） 💬（1）<div>这和隔壁《从0开始学微服务》的服务拆分思路一样，这里更详细一点，但是还不够全面。比如公共组件、性能等维度的考虑</div>2020-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f6/0e/2e07610e.jpg" width="30px"><span>polebug</span> 👍（0） 💬（1）<div>您说到mysql存储是有状态的，增加或减少机器需要数据迁移
那么使用数据库池，就没有这个问题了吗？数据库池里的数据是怎么存储的，没有一致性问题吗？</div>2020-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/e7/13/6f76ada6.jpg" width="30px"><span>大龄程序员在线治掉发</span> 👍（0） 💬（1）<div>按模块拆分,可以理解为业务分库吧,但是在一些关系型数据库的老系统,太多的关系查询,改起来也是个蛋疼得问题</div>2019-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg" width="30px"><span>雷霹雳的爸爸</span> 👍（0） 💬（1）<div>按文中描述，如果NoSQL有这种优势得话，应该主要体现在分片和自动数据迁移的能力上，这块儿还真不熟，一直觉得就是支持这两个功能，实现起来也挺难的，有很多的中间状态要考虑对外响应过程中的一致性问题，依然是一个巨大的挑战，先往后看...</div>2019-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1c/cd/8d552516.jpg" width="30px"><span>Gojustforfun</span> 👍（0） 💬（2）<div>老师文中的“可扩展”更侧重于“硬件”，其实还有“软件”方面的——更易于添加新的功能或模块。我看到有的书中将前者称为“可伸缩”，后者称为“可扩展”。另外，系统设计的目标中还可以加上安全性</div>2019-10-02</li><br/>
</ul>