你好，我是唐扬。

前面几节课，我带你了解了缓存的定义以及常用缓存的使用姿势，你应该对包括本地缓存、分布式缓存等缓存组件的适用场景和使用技巧有了一定了解了。结合在[14讲](https://shimo.im/docs/tqDK6cRX9yR8XJyt)中我提到的客户端高可用方案，你会将单个缓存节点扩展为高可用的缓存集群，现在，你的电商系统架构演变成了下面这样：

![](https://static001.geekbang.org/resource/image/1a/ba/1aa34cb9f368727399ba32e2891d48ba.jpg?wh=1142%2A611)

在这个架构中我们使用分布式缓存对动态请求数据的读取做了加速，但是在我们的系统中存在着大量的静态资源请求：

1. 对于移动APP来说，这些静态资源主要是图片、视频和流媒体信息；
2. 对于Web网站来说，则包括了JavaScript文件、CSS文件、静态HTML文件等等。

具体到你的电商系统来说，商品的图片、介绍商品使用方法的视频等等静态资源都放在了Nginx等Web服务器上，它们的读请求量极大并且对访问速度的要求很高还占据了很高的带宽，这时会出现访问速度慢带宽被占满影响动态请求的问题，**那么你就需要考虑如何针对这些静态资源进行读加速了。**

## 静态资源加速的考虑点

你可能会问：“我们是否也可以使用分布式缓存来解决这个问题呢？”答案是否定的。一般来说，图片和视频的大小会在几兆到几百兆之间不等，如果我们的应用服务器和分布式缓存都部署在北京的机房里，这时一个杭州的用户要访问缓存中的一个视频，那这个视频文件就需要从北京传输到杭州，期间会经过多个公网骨干网络，延迟很高，会让用户感觉视频打开很慢，严重影响到用户的使用体验。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（15） 💬（5）<div>1.cdn不是运维干的事情吗？作为程序员或架构师，只需要了解一下，没必要深入吧？
2.CDN命中率是厂商可以监控的到吗？</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a8/e2/f8e51df2.jpg" width="30px"><span>Li Shunduo</span> 👍（8） 💬（1）<div>CDN回源是由CDN触发的还是用户触发的？具体过程是什么</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/25/66/4835d92e.jpg" width="30px"><span>潘政宇</span> 👍（7） 💬（1）<div>配置CDN后，无论请求静态的还是动态的资源，都是流量先走CDN节点，然后动态资源，CDN再请求源站吗</div>2020-03-16</li><br/><li><img src="" width="30px"><span>Geek_e986e3</span> 👍（7） 💬（1）<div>自己保证可用的话 我的想法是多个厂商？ 或者自己做cdn节点管理 不可用的赶紧切到最近可用的cdn</div>2019-10-23</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132" width="30px"><span>饭团</span> 👍（5） 💬（8）<div>感谢老师：最近正好在用CDN。用的腾讯云的！我在公司访问某一个资源的时候，大部分情况能命中！但是有时候即使资源没有变化，但是有概率还是会发生回源！不知道这种现象发生的原因是什么？怎么排查！</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c6/1e/a1e29910.jpg" width="30px"><span>androus</span> 👍（4） 💬（1）<div>大神我想问下CDN缓存怎么更新呢？比如商品的图片在cdn上面，但是某个时候后台运营人员对商品修改了图片，如果没有更新cdn信息的话，那用户访问的还是老的图片</div>2019-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg" width="30px"><span>刘丹</span> 👍（4） 💬（6）<div>请问一个域名可以同时使用2个CDN厂家吗？</div>2019-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg" width="30px"><span>longslee</span> 👍（4） 💬（1）<div>打卡。中了你的甜品毒。。。 老师，问个问题，DNS对应多个IP地址的时候，这种情况APP该怎么缓存呢，该怎么保证它原来的轮训呢。</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/86/d05de870.jpg" width="30px"><span>Xiang</span> 👍（3） 💬（3）<div>高效的抢购秒杀场景是下在秒杀前(几分钟)在CDN放一个很小的脚本(这个需要跟CDN厂商谈)，逻辑是根据当前人数产生一个概率，只允许 x% 的人真正进入秒杀，其他的直接返回秒杀结束(当然对这部分人是不合理的)。这样到后端的流量是我们可以接受的流量。</div>2020-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg" width="30px"><span>宝仔</span> 👍（2） 💬（1）<div>老师在切cdn之前，要对网站的动态资源和静态资源做分离（动静分离），即动态的用动态的域名，静态资源用静态资源的域名</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（1） 💬（1）<div>对CDN有了更进一步的了解，缺少实战，老师写得再详细点就好了😁</div>2020-05-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg" width="30px"><span>趁早</span> 👍（1） 💬（1）<div>Cdn一般用第三方的就行了</div>2020-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/67/0e/2a51a2df.jpg" width="30px"><span>Eric</span> 👍（1） 💬（1）<div>第三方CDN厂商提供我们的是域名还是IP地址?</div>2019-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/99/c9/a7c77746.jpg" width="30px"><span>冰激凌的眼泪</span> 👍（1） 💬（2）<div>视频类这种非静态的，如何利用cdn呢？</div>2019-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（1）<div>CDN是广义上缓存的一种，不过假设你现在所用的CDN出现问题了，你能做什么？你自己无力自建只能使用他人的，除了配置配置监控一下，真出问题了，猜测也只能打电话过去，其他无能为力。
当然，关心还是需要的。</div>2020-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/64/5d/de0536e8.jpg" width="30px"><span>木木</span> 👍（0） 💬（1）<div>CDN分发呢？同步静态资源到所有CDN节点上的？</div>2020-03-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c8/34/fb871b2c.jpg" width="30px"><span>海罗沃德</span> 👍（9） 💬（0）<div>我們公司的靜態資源的域名是公司domain的sub域名，用traceroute命令查看，發現第一層是akamai的一個sub domain，正如老師課裡講的，公司用自己的自域名綁定了akamai的cname</div>2019-11-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg" width="30px"><span>蓝魔丶</span> 👍（9） 💬（0）<div>老师，还可以通过网络运营商来提高可用性，电信用户走电信网络，网通用户走网通网络</div>2019-10-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Cib5umA0W17N9pichI08pnrXAExdbyh7AVzH4nEhD6KN3FXuELk4LJJuqUPPD7xmIy9nq5Hjbgnzic7sVZG5BKiaUQ/132" width="30px"><span>被过去推开</span> 👍（5） 💬（0）<div>老师把cdn的访问原理讲的很清楚</div>2019-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6b/1b/4b397b80.jpg" width="30px"><span>蛮野</span> 👍（2） 💬（0）<div>之所以有cname的存在，是不是因为第三方的ip不归本公司所有和管理，所以只能通过第三方的域名去解析</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f2/f5/46c23dd0.jpg" width="30px"><span>leechanx</span> 👍（2） 💬（2）<div>最后一幅图，2、3步骤 CDN域名解析服务已经为cname返回CDN边缘节点ip了，这时候进行4、5交互还有用吗?
就近选ip应该是在CDN域名解析服务里做的吧，即2~3之间</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg" width="30px"><span>天草二十六</span> 👍（1） 💬（0）<div>老师，可以帮梳理下这期需要监控的关键指标么？ 域名解析成功率？CDN命中率？解析耗时？
我跟客户端同事说了不知道多少次，一年多了，也不知道他们做了预先解析和定时异步更新缓存与否。其实这个在httpDNS的无论阿里或腾讯的官网，都说得清清楚楚，明明白白了。
能够做的不做，我们如何去做指标监控发现问题？</div>2020-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg" width="30px"><span>文敦复</span> 👍（0） 💬（0）<div>DNS映射的时候CNAME这种方式和域名的区别，还是不太明白。。。</div>2023-11-20</li><br/><li><img src="" width="30px"><span>Geek_88e6b2</span> 👍（0） 💬（0）<div>CND域名解析出所有的cdn节点的IP地址吗，然后去访问GSLB吗
</div>2023-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg" width="30px"><span>剑八</span> 👍（0） 💬（0）<div>cdn集群可以用负载来做，做高可用
不过这里涉及集群大小，太大则集群内需要同步的数据过大
redis cluster思路也可以考虑下</div>2022-04-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoHgweicVlhxFOAh4V9Bv0MwamKuOV8IZiacTaYjO3ZMuvwQdYibzeUnQSMpiaSfRTHIhnnLBFLDEq7qA/132" width="30px"><span>kay</span> 👍（0） 💬（0）<div>cdn缓存的数据是存储在哪种存储介质的，cos，本地磁盘还是...?</div>2021-02-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b2/e0/d856f5a4.jpg" width="30px"><span>余松</span> 👍（0） 💬（0）<div>请问GSLB（Global Server Load Balance，全局负载均衡），是CDN服务商提供，还是需要我们自建服务呢?</div>2021-02-03</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqw0R25Bt0iahFhEHfnxmzr9iaZf0eLsDQtFUJzgGkYwHTqicU9TydMngrJ4yL7D50awD2VibHBAdqplQ/132" width="30px"><span>Geek_18dfaf</span> 👍（0） 💬（2）<div>域名是a记录还是cname这一步判断，是在哪里做的，localdns么</div>2020-09-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132" width="30px"><span>null</span> 👍（0） 💬（0）<div>老师，最后一张图，CDN 的 DNS 咋返回的地址是指向 GSLB 服务器，是在哪配置么？

另外，是谁提供 GSLB 这个服务，是CDN 厂商，还是需要自行搭建？？

谢谢老师！</div>2020-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/44/02/791d0f5e.jpg" width="30px"><span>飞翔</span> 👍（0） 💬（0）<div>怎么排查和解决使用cdn后， 部分区域访问特别慢的问题</div>2020-05-18</li><br/>
</ul>