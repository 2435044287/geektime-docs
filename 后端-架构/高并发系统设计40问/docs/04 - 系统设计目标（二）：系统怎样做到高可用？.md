你好，我是唐扬。

开课之后，有同学反馈说课程中偏理论知识的讲解比较多，希望看到实例。我一直关注这些声音，也感谢你提出的建议，在04讲的开篇，我想对此作出一些回应。

在课程设计时，我主要想用基础篇中的前五讲内容带你了解一些关于高并发系统设计的基本概念，期望能帮你建立一个整体的框架，这样方便在后面的演进篇和实战篇中对涉及的知识点做逐一的展开和延伸。比方说，本节课提到了降级，那我会在运维篇中以案例的方式详细介绍降级方案的种类以及适用的场景，之所以这么设计是期望通过前面少量的篇幅把课程先串起来，以点带面，逐步展开。

当然，不同的声音是我后续不断优化课程内容的动力，我会认真对待每一条建议，不断优化课程，与你一起努力、进步。

接下来，让我们正式进入课程。

本节课，我会继续带你了解高并发系统设计的第二个目标——高可用性。你需要在本节课对提升系统可用性的思路和方法有一个直观的了解，这样，当后续对点讲解这些内容时，你能马上反应过来，你的系统在遇到可用性的问题时，也能参考这些方法进行优化。

**高可用性（High Availability，HA）**是你在系统设计时经常会听到的一个名词，它指的是系统具备较高的无故障运行的能力。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg" width="30px"><span>jc9090kkk</span> 👍（151） 💬（16）<div>感谢老师的分享，对于文章中的心跳检测我个人认为其实是需要做区分的，心跳检测是区分内部检测和外部检测，外部检测伴随着随机性，有时候可能系统的响应时间或者IO已经出现拐点了，但是心跳机制还是有可能会收到响应包，从而被错误的当做系统是“正常”的，所以很多高可用的系统基本都是采用内部心跳机制，比如kafka中的通过zookeeper的watch机制来做检测来做broker中controller的failover，mysql里面是通过内部的performance_schema库中的file_summary_by_event_name表来做监控，都是为了避免外部监测的随机性所带来的影响，不过对于老师提出的可用性和高性能当中出取舍无比赞同，不同的解决方案总是伴随着优势和劣势，无非是优势所带来的效果比劣势对业务更有帮助而已，比如之前在工作中碰到过mysql主从同步有延迟的情况，mysql的高可能性其实就是靠主备同步的数据一致性来保证的，经过排查发现，业务代码中存在有操作大事务的SQL语句，这个导致从库拿到binlog去做重放的时候，时间周期拖长了，从而影响了业务，另外一个情况就是，在做秒杀的时候，除了采用redis外，还会对用户划分成两部分，一部分用户是来了以后直接报秒杀已结束，另外一部分用户才会进入秒杀的逻辑中，心里觉得还是挺对不住那部分抢不到秒杀的用户的，所以，有时候我们需要在可用性和可靠性上需要做一个取舍，没有十全十美的技术解决方案。除此之外，其实大部分的时候采用的策略是需要对业务尽量是无损的，不然运营和产品会请你喝茶的，最后想跟老师提个建议，就是希望后面的一些篇章，能否尽量将之前提到过的知识点实际运用起来或者说串联起来，并且提供一些实际场景的解决方案细节，我举个例子，比如电商秒杀，秒杀如果只采用mysql去做库存判断，会出现什么的问题，为了避免这样的问题出现，该采用什么系统，假如如果采用redis，为什么？redis的一些操作是原子操作，原子操作是什么？如何保证？类似这样的方案的优缺点和延伸，这样的话既能有效的总结之前学习到的知识点，能够将整个知识网络做一个规整，还能了解到每个技术方案的不足加深理解，从而明白什么样的场景说不能采用当前的技术方案的，还有就是在采用技术方案的同时，说明下采用方案的一些基础的理论，知识，比如cas，或者分布式系统中的cap理论，这样对于基础知识欠缺的人，在学习的时候也可以去补一些平时没有刻意学习的知识，上面是我举的例子，再次谢谢老师的分享，期待后面老师的干货文章。</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/33/5c/8c0a372a.jpg" width="30px"><span>Fourty Seven</span> 👍（33） 💬（4）<div>高可用思路，
1.开发设计层面
冗余---主备，负载均衡，failover
取舍----降级，限流，熔断，超时控制

2.运维层面
灰度发布，故障演练，监控报警</div>2019-10-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/6b/84/d1e6eac9.jpg" width="30px"><span>sun</span> 👍（17） 💬（7）<div>我觉得思想最重要，光教你们具体的人家用过的实际案例，那不过是画饼充饥，每个公司的业务都完全不同，侧重点也不同，掌握了思想，明白了了设计方案和要注意的点，接下来只不过是考验个人思维严谨程度和代码水平，思想大于奇淫技巧</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（17） 💬（4）<div>1.本篇讲得主要是系统设计层面的服务高可用。降级，限流，超时熔断，好像主要大方向就这些了。（走mq销峰这种，我认为也是一种降级）。
2.从运维来看，上k8s后，编排控制下，自动维护运行的服务实例节点数量算（包括无状态和有状态服务），这算是一个高可用方面的方案。
3.从部署架构来看，单机房的集群，主备，redis es的多副本等等也算。扯远点还有同城异地，异城异地以及搭建灾备中心等高成本操作。（主要看系统不可用带来的损失有多大，进而做决定）。
总之工作中，感觉追求系统高可用比追求高性能难太多。</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg" width="30px"><span>mickey</span> 👍（11） 💬（1）<div>希望老师能带来大家一步步设计出一个系统，从简单到复杂，演化出一个高并发、高可用、高性能、可扩展的系统。可以模拟遇到具体的问题，使用什么方法去解决。</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/61/58/7b078879.jpg" width="30px"><span>Julien</span> 👍（7） 💬（1）<div>老师您好，我们产品中用到了MongoDB自带的集群来达到高可用性，但发现当某个节点出现故障时，MongoDB大多数时候并不能自我恢复，从而极大影响了用户体验。对于这种案例，老师有什么好的建议?</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg" width="30px"><span>长期规划</span> 👍（5） 💬（1）<div>网络跟交通真是很像
限流：对应交通中的限号；
降级：比如火车的站票，人太多，坐座没有了，改为站票，但票价没变，这就是有损服务啊
故障转移：轿车上一般都准备一个备胎。有些人找对象时，也会准备一个备胎，以防主胎出问题了，还可以更换。</div>2019-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg" width="30px"><span>mickey</span> 👍（5） 💬（1）<div>希望老师能带来大家一步步设计出一个系统，从简单到复杂，演化出一个高并发、高可用、高性能、可扩展的系统。可以模拟遇到具体的问题，具体使用什么方法、使用哪些工具去解决。</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg" width="30px"><span>任鹏斌</span> 👍（4） 💬（1）<div>讲的思路很清楚，虽然以前也知道高性能高可用，但没看过这么全面的总结。</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（3） 💬（3）<div>RPC是什么？是一个调用远程接口的工具，还是一个什么框架？</div>2019-09-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/03/e8bac3ae.jpg" width="30px"><span>罗招材</span> 👍（3） 💬（2）<div>高可用，感觉本质上是冗余，所有关键路径避免单点。
核心要解决的问题是，故障发现 和 故障转移。 故障发现包括，超过处理流量做限流、熔断等，同时某个环节的某个节点故障时，系统能自动转移到冗余备份上，复杂点在于如何保证转移的可靠性。</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（2） 💬（1）<div>小结一下：
1：系统怎么做到高可用？高可用强调系统在出现问题的时候还可以继续使用，那怎么能做到呢？首先，就是冗余，服务冗余＋数据冗余＋设备冗余，通俗点就plan B，时刻准备。然后，就是故障隔离故障恢复，出问题不可怕，只要能自动或手动恢复就行。然后就是防止系统不可用，怎么防止限流熔断就是防止的手段。
2：不过这些说起来容易做起来并不简单，知道和做到之间是有鸿沟的。比如：现在有一个1亿条数据的文件，怎么高效的导入到数据库中，设计出一个完美的方案就不是那么容易。
3：高可用性比高性能实现起来难多了，难点我觉得在于各种出现各种异常情况该怎么处理，即使是小概率事件也需要思考对应的解决方案。比如：2中的例子，高效导入怎么实现？数据这么多库表怎么设计？如果导入的过程中出现异常怎么补偿？一亿条数据不多不少都保证放入库中怎么验证？</div>2020-04-06</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132" width="30px"><span>饭团</span> 👍（2） 💬（1）<div>看来基本就是，避免单点！做好熔断，限流措施！理念是这样。静待老师讲解具体手段，和分享老师的经验！</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg" width="30px"><span>天草二十六</span> 👍（1） 💬（1）<div>搭建一套和线上部署结构一模一样的线下系统，成本很高哦，估计很多没这个投入</div>2020-05-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/jXbwicoDwia7ooDfwBTRyvNYQkefnVwF1CMicMS8FqKfuFAdvVZo2pqc4ic0R9kSdHTIxaE6YyqxwX8BdNGv5PqSIw/132" width="30px"><span>kamida</span> 👍（1） 💬（1）<div>老师 请问一般load balancer和web server分别能处理多大的qps 分别设多少的rate limit比较好</div>2020-04-27</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK310IyFbYZjgYgDvaxibZOic5zbk28FpjLfccfYMSAgt11kd3jicA4Db3NbF8lLl4Cs9m6uRY7EFVWA/132" width="30px"><span>陆江</span> 👍（1） 💬（1）<div>灰度发布的机制不是运维层的，基于业务的灰度发布机制需要写代码来实现。
业界有两种比较常用的方案：
第一种就是在NGINX层挂载lua脚本的方式，在lua脚本里面实现流量控制；
第二种就是在NGINX层后面再加一层api路由网关层，路由网关层的实现就比较灵活，如果是Python的，可以选用高并发异步web框架sanic来实现。
不知道老师说的灰度发布机制是什么样的方式，后面有没有细讲部分？</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/c8/665100a3.jpg" width="30px"><span>周曙光爱学习</span> 👍（1） 💬（1）<div>老师请问限流一般在哪一层做呢？是在流量的接入层比如slb，还是在框架层比如使用的一些http框架，还是在我们的应用代码里呢？？</div>2020-03-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg" width="30px"><span>长期规划</span> 👍（1） 💬（1）<div>系统高可用是分级的，分级是考虑最坏情况下，系统不会崩溃。</div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/d3/a1/e5a3ce79.jpg" width="30px"><span>威特</span> 👍（1） 💬（1）<div>目前我们系统的主要手段就是降级，通过降级返回一些默认值或者其他约定好的值，以保证核心功能不收影响。</div>2019-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg" width="30px"><span>雷霹雳的爸爸</span> 👍（1） 💬（1）<div>系统高可用可能需要的不是技巧，而是各方的兢兢业业、殚精竭虑吧，研发要保证设计实现得足够强壮，运维要确保监控、应急响应预案到位，而且如文中所说，千万不要忽略了演练

</div>2019-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg" width="30px"><span>longslee</span> 👍（1） 💬（1）<div>老师，咱们设置Nginx超时时间为30s，但是很多服务都是这个nginx转发，那～就变成了不分业务和统计统统归为30s超时，这样问题很多，请教一下应该怎样拆出来呢？</div>2019-10-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a6/8a/d6e6aab8.jpg" width="30px"><span>秦时明月</span> 👍（1） 💬（1）<div>老师，对于一些概念一直比较混淆，请问文中说的单机限制处理1000次请求，请问是从请求到响应结束，还是只要接收了请求</div>2019-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg" width="30px"><span>吃饭饭</span> 👍（1） 💬（1）<div>我喜欢这种由浅入深，从宏观到局部的讲述方式，👍</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/9b/26/961c6be2.jpg" width="30px"><span>Lim</span> 👍（1） 💬（2）<div>微服务就是很好的实践。Hystix的降级，熔断。Ribbon的负载均衡。还有zookeeper主备选主Paxos</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/70/51/f1825adb.jpg" width="30px"><span>Lugyedo</span> 👍（1） 💬（1）<div>看来高可用需要DevOps</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/21/30/8ecce1e1.jpg" width="30px"><span>北天魔狼</span> 👍（1） 💬（1）<div>希望老师在以后章节中推荐一些性能检测工具</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/2d/5a/d965c147.jpg" width="30px"><span>wangbo</span> 👍（1） 💬（1）<div>限流算是个兜底策略吧</div>2019-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/64/15/9c9ca35c.jpg" width="30px"><span>sipom</span> 👍（0） 💬（1）<div>系统架构保障：
1、多节点冗余，避免单点
2、故障节点探测、隔离
3、故障转移、超时监控、降级限流

制度保障：监控机制、运维流程</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/66/e9/814d057a.jpg" width="30px"><span>小陈</span> 👍（0） 💬（1）<div>客户端用尽线程不会挂掉吧，应该是没有多余线程再请求了，慢请求也不会导致雪崩吧？</div>2019-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9b/d7/3e4eb062.jpg" width="30px"><span>🐒王子 ♡桃桃。</span> 👍（0） 💬（1）<div>感谢老师，收获很大</div>2019-11-29</li><br/>
</ul>