我们知道，高并发代表着大流量，高并发系统设计的魅力就在于我们能够凭借自己的聪明才智设计巧妙的方案，从而抵抗巨大流量的冲击，带给用户更好的使用体验。这些方案好似能操纵流量，让流量更加平稳地被系统中的服务和组件处理。

来做个简单的比喻吧。

从古至今，长江和黄河流域水患不断，远古时期大禹曾拓宽河道，清除淤沙让流水更加顺畅；都江堰作为史上最成功的治水案例之一，用引流将岷江之水分流到多个支流中，以分担水流压力；三门峡和葛洲坝通过建造水库将水引入水库先存储起来，然后再想办法把水库中的水缓缓地排出去，以此提高下游的抗洪能力。

而我们在应对高并发大流量时也会采用类似“抵御洪水”的方案，归纳起来共有三种方法。

- Scale-out（横向扩展）：分而治之是一种常见的高并发系统设计方法，采用分布式部署的方式把流量分流开，让每个服务器都承担一部分并发和流量。
- 缓存：使用缓存来提高系统的性能，就好比用“拓宽河道”的方式抵抗高并发大流量的冲击。
- 异步：在某些场景下，未处理完成之前我们可以让请求先返回，在数据准备好之后再通知请求方，这样可以在单位时间内处理更多的请求。

简单介绍了这三种方法之后，我再详细地带你了解一下，这样当你在设计高并发系统时就可以有考虑的方向了。当然了，这三种方法会细化出更多的内容，我会在后面的课程中深入讲解。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/4f/b2/1e8b5616.jpg" width="30px"><span>老男孩</span> 👍（166） 💬（5）<div>martin fowler好像曾经说过，能使用单体解决的问题，就不要采用分布式。不能为了技术而技术，采用分布式固然可以分流用户请求，提高系统的响应能力，但同样也带来了复杂性。软件开发最终的目的是商业利益。非常赞成老师的观点，罗马城不是一天就建立起来的。架构的工作应该是阶段性，解决阶段性系统的复杂性。如果单体跑的很好，或者通过scale up方式在成本可控的情况能解决就不要想着诗和远方，因为系统内部的进程间调用，肯定比不同物理机的进程之间调用要快。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/4b/4b/97926cba.jpg" width="30px"><span>Luciano李鑫</span> 👍（44） 💬（21）<div>代部落伙伴问个问题：关于秒杀这种场景我想的是用redis的list不就完全可以实现吗。活动开始前，先把要抢的N个商品push到list中。活动开始后，每来一个请求就从list中pop一个商品出去，当list为空后直接返回“已抢光”的响应，由于可秒杀的商品数量并不多，能通过的请求也可以采用同步的方式进行，这样不是既简单又快速。可是我搜了一下网上的方案，都特别的复杂，请问这种方式有什么问题吗？</div>2019-09-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/11/fa/e0dcc1bf.jpg" width="30px"><span>榕</span> 👍（20） 💬（1）<div>1.技术在不断演进，演进的目的和内驱动力是解决当前系统存在的问题，过早过度设计大多只会延误系统的发展。一切都以实际情况和需要出发，一步步优化，一步步演进，个人能力提升也是同样的道理。
2.高并发系统设计通用方法:水平拓展，缓存，异步。这只是指导思想，如何更巧妙的运用才是最具魅力的。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/94/55/afc64956.jpg" width="30px"><span>三年过后</span> 👍（12） 💬（9）<div>老师讲得很好！不过，还是觉得偏理论较多。例如，讲到踩过很多坑，这些坑没有一些案例说明和后来的解决问题方案。比如，之前负责的支付系统项目，在流量不是很大的情况下，就引入了zk集群(3台)zk集群所在的线上服务，存在一台宕机，整个线上支付都不可用。后面解决：只好切回单体服务</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/19/28/f4b4ed22.jpg" width="30px"><span>马留</span> 👍（11） 💬（5）<div>老师，你把“缓存”比喻成“拓宽河道”，个人觉得是不妥当的，应是建水库更好些。拓宽河道比较类似Scale-out</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/6c/06/2ac17d5a.jpg" width="30px"><span>yuan</span> 👍（8） 💬（2）<div>老师，消息队列用到缓存，之前没有听说过这个，请问哪种消息队列用到缓存？</div>2019-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0e/30/e613d032.jpg" width="30px"><span>鞠小军</span> 👍（7） 💬（2）<div>总结：高并发设计三种思路
1、横向扩展
2、缓存
3、异步

首先，不能为了设计而设计，不要过度设计。单机满足业务需求就不要分布式，架构不能盲目，架构一定是逐步演进的，而且是随着业务的需求逐步进行的。

三种思路理解要宽泛。比如横向扩展可以是集群，可以是主从分离，也可以是分库分表等等。

缓存呢其实无处不在，比如CPU的一级缓存、二级缓存、三级缓存，操作系统缓存（如windows的page.sys文件），mybatis的一级缓存，二级缓存等等。

异步就是解藕操作，比如将订单成交的消息我需要保证准确性而不是实时性，因此就先放入消息队列中，消息被消费的时候在进行业务的处理，这样就可以提高并发请数量</div>2019-11-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/7d/53/7a0399a4.jpg" width="30px"><span>MYG</span> 👍（6） 💬（1）<div>讲得真好！小建议，对于一些关键的术语可不可以像我们讲scale-out一样，同时使用中文和英文呢？比如cache，async，这样可以方便将来同时查阅中英文文献。</div>2019-09-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/56/90/bfb92de9.jpg" width="30px"><span>标</span> 👍（5） 💬（1）<div>老师，多级缓存中，redis层的好处理，但是Nginx缓存，tomcat本地缓存，都是多台机器分布式部署，该如何及时主动更新</div>2019-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/bb/07/0188bf41.jpg" width="30px"><span>由莫</span> 👍（4） 💬（4）<div>把缓存比喻成拓宽河道不合理。从另外的角度来看，拓宽河道就是增加流量的带宽。这跟缓存放在一起说感觉让人对缓存有误解。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg" width="30px"><span>业余草</span> 👍（4） 💬（7）<div>微服务不是架构演变的终点！

https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;TAHtAreMkxjWLfW1jSP88w</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/bd/18/2af6bf4b.jpg" width="30px"><span>兔2🐰🍃</span> 👍（4） 💬（4）<div>目前的芯片技术已经到达5nm级别了，最近台积电生产的高通骁龙875，使用的是5nm工艺制造，晶体管密度提升到1.713亿&#47;mm²（这个数据看到时也惊讶到了），比7nm提升70%左右，大概2021年的手机上会普遍起来。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（3） 💬（2）<div>讨论很激烈，很棒，证明能引起共鸣。
小结一下：
1：技术是服务于业务的，不过技术不行，也是服务不好的，所以，无论个人还是国家都想要更好更先进的技术
2：架构是需要演进的，不是一撮而就的
3：分布式技术就是为了解决大流量高并发的问题的，核心思路，一是水平扩展，二是缓存化，三是异步化
4：高并发问题说通俗点就是流量多，多到一台机器根本扛不住的程度，此时该咋弄？弄咋办?其实没啥法子，一个就是用更牛逼的机器，另一个就是多个机器一起扛，前一种思路根本上是走不通的，因为单机性能和容量即使再强也有极限，没得选啦！就只能用多个机器扛，后面的所有技术都是为了使多个机器像一个机器一样工作，原理需要操作系统考虑的事情，外溢出来交给开发工程师来考虑啦！
5：道理都是相通的，想一想怎么快速收麦子?怎么快速除草?怎么应对洪涝?那高并发系统的问题也是需要这样来思考的</div>2020-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/44/f9/8939732e.jpg" width="30px"><span>雾里看花</span> 👍（3） 💬（3）<div>为什么说缓存是拓宽河道呢？</div>2019-09-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg" width="30px"><span>jc9090kkk</span> 👍（3） 💬（3）<div>感谢老师的分享，分享下个人的经历吧，之前在金融科技创业公司工作过，刚开始的时候，系统的复杂度有限，基本都是单机，随着业务量慢慢变大，系统变得笨重，响应时间变慢，因为系统中包含很多模块+redis缓存，比如订单模块，风控模块，资金池模块，用户模块等等，最后慢慢一步步进行解耦，将订单模块和+用户模块解耦做服务化（PHP技术栈），风控模块解耦做服务化（Java技术栈），中间各个服务用RPC接口进行数据交互，加上服务化的心跳检测，整个系统的响应时间才慢慢降下去，不过也出现了一些问题，比如系统和系统之间的rpc调用在后面出现一些问题，主要是业务的bug定位的时候，需要追踪，整个定位流程时间成本比较高，当时也没有接入日志采集的服务，当时还不知道kafka，所以没用，后面发现服务化之间的心跳检测也不靠谱，有时候明明响应时间已经上升了，但是心跳检测确实正常的，像这样的外部检测机制都伴有随机性。。。</div>2019-09-19</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/sw9JHZsxtw5viaYoBlmC0UvM9NPHf1YG48fR6iaG8BbvgN1KpjlJ5dzYmDmbxSBDbzP2r9tGo020PXWWwlcCUssA/132" width="30px"><span>mahaitao617</span> 👍（2） 💬（2）<div>消息队列那个图能讲的详细点嘛？例如请求放入队列中之后再异步处理这个过程整个过程，谢谢老师</div>2019-09-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/70/1f/15e5356b.jpg" width="30px"><span>平步青云</span> 👍（2） 💬（2）<div>最近做项目也准备采用微服务架构，今天看老师这么一说，我还是注意下，毕竟微服务架构还不是特别熟，团队技术能力都一般，还是选择成熟，熟悉的架构了</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/65/29/6fca8610.jpg" width="30px"><span>发光的卢咪</span> 👍（1） 💬（2）<div>如无必要，勿增实体。</div>2020-04-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/64/15/9c9ca35c.jpg" width="30px"><span>sipom</span> 👍（1） 💬（1）<div>Scale-out、缓存和异步，应用多机集群、数据库&#47;缓存分库分表、rpc异步调用、消息队列。</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/c8/665100a3.jpg" width="30px"><span>周曙光爱学习</span> 👍（1） 💬（1）<div>我们回塞缓存的逻辑是查寻满足某种条件的全量数据，这种情况在并发请求的时候如果缓存miss可能会造成db压力，所以采用了异步回塞缓存方案，查询数据回塞前判断缓存是否存在，这样其实只有一次查询全量数据的请求避免了db压力问题</div>2020-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/67/f1/1d90f41f.jpg" width="30px"><span>每天进步一点点</span> 👍（1） 💬（1）<div>请问老师可以分析一下如果是直播或者短视频类型的应用该如何入手设计高并发吗？个人感觉首先快速看到视频流是缓存，但是像点赞和礼物实时性要求也非常高，是通过消息中间件吗？然后消息中间件的状态转换是需要用socket之类的协议动态发送给前端吗？🙏新手疑惑多多，项目和学业需要，感谢优质课程和大牛老师！</div>2020-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/6b/23/ddad5282.jpg" width="30px"><span>Aaron</span> 👍（1） 💬（2）<div>在公司做项目的时候，服务器用的是阿里云服务器，3台，最初的时候域名指向其中一台服务器A， 然后这台服务A做内部负载均衡，以为这种形式会运行的很稳定。但用户上来以后， 发现单台服务器的带宽不能满足，经常收到报警，特别是在高峰期的时候，报警特别频繁。后来新购买了一台阿里云的SLB，通过阿里云的SLB结局了带宽报警的问题。 这种情况下可以平滑的加减后台服务器的数量。这是实际的项目中踩过的坑，也是因为之前并没有这种经验。</div>2019-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/93/57/3ffdfc8d.jpg" width="30px"><span>vigo</span> 👍（1） 💬（3）<div>脱离业务的架构都是伪命题，只要结合实际业务而设计的架构才是靠谱的方案，虽然有时候看起来不那么高大上。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fa/fd/ec24cba7.jpg" width="30px"><span>fcb的鱼</span> 👍（1） 💬（2）<div>关于摩尔定律那块有些疑问：前边有讲到，当前芯片集成了足够多的晶体管，但是因为已经足够的薄，所以再可发挥的空间不多了！后边又说，多个cpu集成到一个芯片上拯救了摩尔定律！没太明白这块的关系！</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg" width="30px"><span>👽</span> 👍（1） 💬（1）<div>杨晓峰的专栏里提到过：“过早的优化是万恶之源。”
目前就职于一家小公司，其系统架构就存在着巨大的问题。
采用的缓存是 memcached ，并对齐有复杂的技术设计。
但是因为其项目比较老，团队技术体系也不够成熟，并且最主要的问题是【项目的体量以及并发量很低】，自认为并没有引进缓存技术的必要。
现在带来的结果是，新的接口直接选择查库，而老的接口又会因为缓存会有些许问题。给项目带来 了维护困难等一系列问题（当然，问题的根本不止缓存问题这一个），一切的技术选型与扩展都要基于业务需求，不能单纯为了扩展而扩展。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ea/28/9d621043.jpg" width="30px"><span>　　　　　　　　</span> 👍（0） 💬（1）<div>这边有一个dao层服务总是不定时出现几秒dubbo线程池满的情况 头疼</div>2020-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg" width="30px"><span>随风</span> 👍（0） 💬（1）<div>多少的量才算得上高并发，平时设计框架的时候以什么标准去衡量系统，什么样的场景下需要缓从，什么样的场景下需要消息对列，在我们设计之初能做决定</div>2020-04-06</li><br/><li><img src="" width="30px"><span>王家峥</span> 👍（0） 💬（1）<div>老师讲的蛮好的，思路比较清晰，逐渐带入，赞一个</div>2020-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/64/15/9c9ca35c.jpg" width="30px"><span>sipom</span> 👍（0） 💬（1）<div>“能使用单体解决的问题，就不要采用分布式。不能为了技术而技术，采用分布式固然可以分流用户请求，提高系统的响应能力，但同样也带来了复杂性。软件开发最终的目的是商业利益。罗马城不是一天就建立起来的。架构的工作应该是阶段性，解决阶段性系统的复杂性。”  理性、理智的观点！说得非常好👌</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ff/71/c492b7fa.jpg" width="30px"><span>来</span> 👍（0） 💬（1）<div>缓存，异步，水平扩展，实现高并发系统的三板斧。缓存，异步这两种方法是尽可能的提高单台服务器的处理能力，水平扩展则是可以让更多的服务器来一起处理请求。</div>2020-03-10</li><br/>
</ul>