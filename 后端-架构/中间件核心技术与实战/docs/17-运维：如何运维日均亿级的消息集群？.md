你好，我是丁威。

得益于我所处的平台，依托快递行业巨大的业务流量，我所在的公司的日均消息流转量（消息发送、消息消费）已经达到万亿级别，消息中间件在公司的使用也非常广泛。这节课，我会结合自己的实践经验和你一起来看看如何在生产环境中运维消息集群。

## 集群部署

尽管消息集群都可以灵活地扩缩容，但我们在运维集群时还是不应该搭建太大的集群。因为一旦集群受影响，影响范围会很大。合理规划消息集群尤为重要，结合我的集群规划实践，我提炼出了下面几条经验供你参考。

- 业务场景  
  核心业务要按业务域进行规划，并且通常采用RocketMQ。例如我们可以划分出订单、运单、财金等业务域。业务域内尽量独占。

日志采集类通常采用Kafka，并且也要搭建几套日志集群，做好拆分，控制好影响的范围。

- 应用特点  
  消息集群的客户端通常使用长连接。但大数据领域很多数据抽取都是批处理任务，而批处理任务使用的是短连接，所以大数据领域这种我们会规划到单独的集群；另外在定时消息、大消息等场景下，也要规划专属集群。

规划了这么多的集群，集群的管理就成了难点。我们专门开发一个消息运维平台ZMS，它支持在线安装RocketMQ、Kafka、ZooKeeper等中间件，安装原理如下：
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="" width="30px"><span>kai</span> 👍（1） 💬（1）<div>请问一下，Kafka 一个 Topic 多副本情形下，缩容 1 台机器，直接关闭这台机器之后，集群的很多副本就处于复制状态，这些滞后的副本该如何处理呢？谢谢</div>2023-02-02</li><br/>
</ul>