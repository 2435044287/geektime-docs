你好，我是陶辉。

前两讲我们介绍数据库的扩展时，写请求仍然在操作中心化的Master单点，这在很多业务场景下都是不可接受的。这一讲我将介绍对于无单点的去中心化系统非常有用的NWR算法，它可以灵活地平衡一致性与性能。

最初我们仅在单机上部署数据库，一旦性能到达瓶颈，我们可以基于AKF Y轴将读写分离，这样多个Slave从库将读操作分流后，写操作就可以独享Master主库的全部性能。然而主库作为中心化的单点，一旦宕机，未及时同步到从库的数据就有可能丢失。而且，这一架构下，主库的故障还会导致整个系统瘫痪。

去中心化系统中没有“Master主库”这一概念，数据存放在多个Replication冗余节点上，且这些节点间地位均等，所以没有单点问题。为了保持强一致性，系统可以要求修改数据时，必须同时写入所有冗余节点，才能向客户端返回成功。但这样系统的可用性一定很成问题，毕竟大规模分布式系统中，出现故障是常态，写入全部节点的操作根本无法容错，任何1个节点宕机都会造成写操作失败。而且，同步节点过多也会导致写操作性能低下。

NWR算法提供了一个很棒的读写模型，可以解决上述问题。这里的“NWR”，是指在去中心化系统中将1份数据存放在N个节点上，每次操作时，写W个节点、读R个节点，只要调整W、R与N的关系，就能动态地平衡一致性与性能。NWR在NoSQL数据库中有很广泛的应用，比如Amazon的Dynamo和开源的Cassandra，这些数据库往往跨越多个IDC数据中心，包含成千上万个物理机节点，适用于海量数据的存储与处理。
<div><strong>精选留言（12）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/7d/02/4862f849.jpg" width="30px"><span>杉松壁</span> 👍（11） 💬（1）<div>kafka是不是也是NWR模型</div>2020-07-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/17/39/3274257b.jpg" width="30px"><span>ple</span> 👍（9） 💬（1）<div>老师的风格很不一样 很专业 硬核,当真说了一些其他地方不容易看到的. </div>2020-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/ca/cbce6e94.jpg" width="30px"><span>梦想的优惠券</span> 👍（5） 💬（1）<div>zk就有quorum机制，之前只知道NW😂，原来还需要R才能保证强一致性，，，
</div>2020-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/09/9d/8af6cb1e.jpg" width="30px"><span>臭猫</span> 👍（3） 💬（7）<div>不同的进程请求写入，是如何协调顺序的呢？比如进程A要set X = 3;进程B要set X =4;</div>2020-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f9/30/54c71bf9.jpg" width="30px"><span>不会飞的海燕</span> 👍（2） 💬（1）<div>根据鸽巢原理是不是可以推论出，把9只鸽子放到10个笼子里至少有一个笼子是空的</div>2020-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/64/9b/d1ab239e.jpg" width="30px"><span>J.Smile</span> 👍（0） 💬（1）<div>NWR算法总结：当鸽子的数量超过了鸽巢后，就要注定某一个鸽巢内一定含有两只以上的鸽子，同样的道理，只要读、写操作涉及的节点超过半数，就注定读写操作总包含一个含有正确数据的节点。NWR 算法将这一原理一般化为：只要读节点数 R + 写节点数 W &gt; 存储节点数 N，特别是 W &gt; N&#47;2 时，就能使去中心的分布式系统获得强一致性。
--------------------------------
鸽臼原理推导出的NWR一致性算法，真的大开眼界了。nice！
</div>2020-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg" width="30px"><span>stackWarn</span> 👍（1） 💬（0）<div>keepalived 的配置 quorum up 估计也是同化了这个思想  </div>2020-07-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/c4/35/2cc10d43.jpg" width="30px"><span>Wade_阿伟</span> 👍（0） 💬（0）<div>真不错，收货良多。这个专栏讲了很多，在其他地方看不到的干活。</div>2024-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg" width="30px"><span>第一装甲集群司令克莱斯特</span> 👍（0） 💬（0）<div>真不错</div>2022-11-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f4/49/2b938b4f.jpg" width="30px"><span>北极的大企鹅</span> 👍（0） 💬（0）<div>感谢作者的耐心分享和指导</div>2021-04-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/56/75/6bf38a1e.jpg" width="30px"><span>坤哥</span> 👍（0） 💬（0）<div>陶老师，异步同步剩下的n-w个节点没说呢？  last-write-win 前提各个服务时间戳一致。对于剩下的n-w个节点  谁作leader去同步呢？又怎样同步？</div>2020-07-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg" width="30px"><span>黄海峰</span> 👍（0） 💬（0）<div>最后一个多中心例子，“数据中心各设置 N = 3，其中 R、W 则采用 QUORUM 一致性模型”。。。r w采用quorum模型那意思到底是r w分别设为多少呢？？为何写的时候alpha要两个返回，beta中心一个返回就行了呢？</div>2020-07-01</li><br/>
</ul>