从谷歌的搜索指数来看，微服务的热度在进入2017年后突然爆发，国内各大会议和论坛的相关讨论也如雨后春笋般层出不穷，各大一线互联网公司也纷纷将这一技术引入并在实际业务中落地。

![](https://static001.geekbang.org/resource/image/73/6f/7343e2873709893c810797cf7d708f6f.png?wh=1920%2A1089)

然而据我所知，国内不少中小规模的技术团队对微服务的概念都不甚了解，对该不该引入微服务也不置可否。还有一些技术团队，没有考虑实际业务场景，只是为了追求技术热点，盲目引入微服务，但又缺乏相应的技术掌控能力，最后影响了业务的稳定性。

对于该不该引入微服务，以及微服务体系需要哪些技术，目前并没有适合中小团队的架构实践落地的指引。因此我结合自己在微博多年的业务实践，总结出了一套微服务落地经验，从基础理论到架构实践，再结合业界最新趋势分析，希望能帮助中小规模团队了解微服务的本质以及对业务的价值，从而做出正确的判断。

我们先来看看维基百科是如何定义微服务的。微服务的概念最早是在2014年由Martin Fowler和James Lewis共同提出，他们定义了微服务是由单一应用程序构成的小服务，拥有自己的进程与轻量化处理，服务依业务功能设计，以全自动的方式部署，与其他服务使用HTTP API通讯。同时，服务会使用最小规模的集中管理 （例如Docker）技术，服务可以用不同的编程语言与数据库等。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/4b/e4/bfe26359.jpg" width="30px"><span>Colin</span> 👍（206） 💬（5）<div>服务化最难的是在数据库层，因为数据库中很多数据都是相互关联的，比如用户用户跟订单，订单和商品等等这些数据之间都是有关联的，服务拆分之后会面临以下问题:1当需要读取关联数据时，如果采用表连接的方式查询数据会出现跨数据库查询的可能，2如果是通过RPC的方式多次调用(比如要查订单，就需要查询商品及订单详细信息)，也会出现多次调用导致的频繁多次的数据库连接，而如果使用缓存，也会面临数据库与缓存之间的数据同步问题，特别是数据库与缓存服务器都存在集群的情况下，会更难处理，这也是在做微服务之前必须要考虑的问题。</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f5/1f/577265ea.jpg" width="30px"><span>少帅</span> 👍（77） 💬（2）<div>看到留言里面好多正在经历从单体到微服务的拆分过程，拆分微服务先要把业务梳理清楚，做到心中有数，梳理清楚了那么业务的边界自然清晰了，自然而然对应拆分哪些服务也出来了，拆分的过程中一定是绞杀式的，新的需求自然放到拆分的微服务，老的逻辑按照优先级和重要程度一个点一个点的从单体迁移微服务，服务化上线之后，渐渐取代老的单体，等全部拆分完毕，线上稳定之后，自然就可以下掉老的单体应用</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/80/96/eb16ff77.jpg" width="30px"><span>Neo_PJ</span> 👍（57） 💬（10）<div>现在的系统代码量50w，单体应用，但是拆分成微服务太麻烦了，领导不敢动，系统是金融管理基金托管计算的，太多复杂场景耦合，10几年的代码，好几个团队的代码堆积，俗话就是  又臭又硬的系统，只能不断维护，不敢重新搭建新的框架，不敢拆，拆不得，拆了谁负责，谁敢保证拆后所有功能按照原有一样逻辑呢？

唉，老员工都是吐槽，继续码代码，分支也多，团队也多，部署一次1小时，每次有代码提交就催着部署，意味着系统动不动挂一小时，部署相当麻烦，文件对比，打包等等

这个系统没救了</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/01/f4/21795b21.jpg" width="30px"><span>Geek_zmaqkg</span> 👍（46） 💬（5）<div>在我看来，用通俗的话来讲，服务化就是把传统的单机应用中通过 JAR 包依赖产生的本地方法调用，改造成通过 RPC 接口产生的远程方法调用。这句话真的讲的很透彻👍</div>2018-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg" width="30px"><span>技术修行者</span> 👍（20） 💬（4）<div>看了文章和留言，讲的很清楚，请教一个问题，之前也有同学问了。

对于典型的复杂web应用，当由单体应用改造成微服务时，一般会按照业务进行服务划分，彼此独立的业务拆分到不同的微服务中。但是在数据层面，涉及到下面两个问题:
1. 数据库是否拆分？从数据架构的角度看，可能有三个选择:1) 一个db实例，所有微服务在一个schema中，2) 一个db实例，每个微服务有自己的schema，3) 每个微服务有自己的db实例。我们在实际项目中应该如何取舍？
2. DAO层是否拆分？可能有两个选择: 1) DAO层保持不变或者单独部署成微服务，所有业务微服务通过引用jar包或者HTTP的方式和DAO进行交互。2) 把DAO进行拆分，每个业务微服务内部管理自己会用到的db数据。在所有微服务采用的技术栈相同的情况下，上面哪种方式更可取？</div>2018-08-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132" width="30px"><span>null</span> 👍（13） 💬（1）<div>5 年的 php 单体应用，整个项目结构复杂混乱，php 前端和 php 后端各种函数调用。业务逻辑代码也穿插着大量已过期或无关的代码，项目可维护性越来越低。每次需求开发完毕合并分支时，需要花费大量的精力去解决代码冲突。开发的速度远跟不上需求的速度。

在去年所有新的需求使用 java 进行开发，同时一点一点将 php 的业务迁移到 java。
从一开始就没规划好，一股脑喊出了微服务化口号，前期也是真苦了运维和测试。

一年多过去了，项目现在的的状态：
1. 项目内结构依旧混乱，A 模块和 B 模块都依赖于 C 模块，我们的做法是，A 模块里写一次 C 模块，B 模块同样写一遍 C 模块。其中有两个原因，无法实现分布式事务，只好放到同一个系统内，整个流程可以同属于一个事务；另一个原因是模块的边界划分是很模糊的。
2. 项目之间的依赖关系就跟意大利面条一样，而且之间的接口，并没有想着去向下兼容，甚至发生过接口定义变更了，导致线上依赖的服务都无法正常提供服务。现在每次发布也是战战兢兢。

目前面临最大的问题便是分布式事务的问题，导致 DAO 层的代码，重复散落在各个模块之中，真是令人头大。</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/fa/33/0eb31e67.jpg" width="30px"><span>Amorfati</span> 👍（13） 💬（1）<div>如何确定是过度膨胀也是比较难的问题，在膨胀前切分很有可能随着业务的发展，发现切错了，然后好尴尬，按照我的理解是，单体应用中已经经过足够时间业务上的检验，将其中模式比较稳定，整体高内聚的业务进行抽离。如有错误，还请老师指正。</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d7/df/fc0a6709.jpg" width="30px"><span>WolvesLeader</span> 👍（13） 💬（1）<div>老师，问一下，一般和数据库交互的dao层，是单独拿出来做成服务好还是不做好，还有一些公共的模块是不是也要做成服务呢？谢谢啦</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bb/28/914b5664.jpg" width="30px"><span>jogin</span> 👍（11） 💬（1）<div>现在好多公司强推微服务，不考虑实际情况，单体应用并不是就一定很脆弱，系统不稳定，服务拆分了也不一定稳定，开发效率不高，没准是流程问题，系统本身设计问题耦合严重，单体应用设计不好，玩不转，服务拆分后更乱。


有些开发就是为了研究微服务在内部推广，大家都想学一下然后就达成默契了。</div>2018-08-25</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/EiaAvXsIJoJmWP00FhZLicyBiapZickLNZmjlATKoe2RqicpPOHhWuDe0t2E5lLVBWC6kibcYbvOdbAhjCbtnx9OeVAQ/132" width="30px"><span>cc</span> 👍（10） 💬（1）<div>我的理解，微服务的重点在于拆分治理，spring boot，容器，这些只是实现拆分的一个工具而已，如果你想，使用传统的tomcat启动发布也是可以实现这样的目标的。</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/96/92/0245816d.jpg" width="30px"><span>WestonLee</span> 👍（7） 💬（1）<div>我们目前的系统就是从单体到服务化再到微服务化的，第一次转变是为了减少大计算量的模块带来的阻塞，提高负载，第二次转变是因为系统已经比较庞大，需要切分的更细，并且便于开发维护。目前用了spring cloud和docker，遇到的最大的问题是数据库伴随服务的切分以及一致性带来的复杂度提升</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/0e/c77ad9b1.jpg" width="30px"><span>eason2017</span> 👍（6） 💬（1）<div>反复读了老师的文章，和一些经典的评论，得到了如下几点：
1:微服务拆分的粒度，很有讲究，需要根据不同的业务情况作出不同粗细程度的区分。
2：进而决定了拆分的方式，按照大模块（用户，订单，单品），还是细粒度的那个核心公共功能，也是受用户并发来拆分。
3：就是拆分的原则，什么一定可以拆，什么一定不可以拆。
4:不要为了拆分而拆分。
请老师批评指正，谢谢🙏</div>2018-08-24</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJKILshrJiasJADt0FTdA9x9rJbSeM3t7BUgUxKqBpsZK4Uukg9qwmbOCmLia89VaqsPcKyauGBLRFw/132" width="30px"><span>青青木</span> 👍（6） 💬（1）<div>老师好，我所在的公司正在进行微服务化的系统改造，原有的系统是一个巨大的单体架构业务系统。在改造过程中我的困惑是微服务的拆分粒度 差的大了感觉效果不好，差的细了业务调用链太长 造成系统响应变慢 问题定位不容易等问题，老师您对微服务的业务划分有什么建议吗？谢谢</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/b5/d33bedf7.jpg" width="30px"><span>pws22</span> 👍（5） 💬（1）<div>阿忠伯好 ，应用微服务化是不是一定会造成系统的性能下降？单应用的架构拆分成微服务是不是可以先稍微大粒度的拆分，然后再进行服务细化</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/92/b4/bd466eed.jpg" width="30px"><span>刘旺旺</span> 👍（3） 💬（1）<div>服务化和微服务还是傻傻的分不清楚，感觉就是差不多的概念。微服务的那些特点，感觉在服务化的时候也可以用上</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/87/d4/90eca26c.jpg" width="30px"><span>Aronnnnnnnnnnnn</span> 👍（2） 💬（1）<div>目前在通过docker将利用dubbo+zookeeper架构的微服务项目容器化，遇到一个问题。服务注册到dubbo后，会显示端口为20880，那么如果将容器内的20880随机暴露在宿主机的话，消费者无法在宿主机中找到20880（因为暴露在主机的为其他端口），麻烦老师不吝赐教 分享下实解决方案。感谢。</div>2018-08-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/23/3c3272bd.jpg" width="30px"><span>林</span> 👍（2） 💬（1）<div>微服务4点中第一点说：服务拆分粒度更细。只要该模块依赖的资源与其它模块没有关系就可以拆成一个微服务。我有点疑惑，如果按依赖拆分，岂不是拆分的微服务过多了？微服务维护，调用链监控等等岂不是更复杂？另外是不是一个微服务对应一个数据库呢？</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/00/24/6ff7cb37.jpg" width="30px"><span>硕</span> 👍（1） 💬（1）<div> 项目都有个演变流程 ..还是从单体发展成 微服务模块拆化</div>2018-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg" width="30px"><span>小猪</span> 👍（1） 💬（1）<div>我看到文章里面谈的微服务都是基于Java开发的系统模式！那么我想知道，是否python、go语言的开发也一样可以做微服务模式呢？还是说目前都是Java开发项目，所以微服务都是研究Java程序的？</div>2018-10-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a6/43/cb6ab349.jpg" width="30px"><span>Spring</span> 👍（1） 💬（1）<div>如果服务拆分涉及到数据库，可不可以将数据库独立部署，多个服务访问同一个数据库？
微服务和服务化的区别还没看懂，只是知道微服务的粒度更小，意思是服务化继续拆分模块就成微服务了吗？</div>2018-09-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/85/e8/1e3e5657.jpg" width="30px"><span>彬哥</span> 👍（1） 💬（1）<div>请老师推荐一个微服务相关的开源项目，希望能参与。</div>2018-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4e/62/65466407.jpg" width="30px"><span>lundi</span> 👍（1） 💬（1）<div>从2016年开始使用微服务进行大规模系统改造，整个过程中最困扰大家的问题有很多。就个人经历来说，最复杂的莫过于服务的拆分。因为这是涉及整个系统服务设计的底层工作。但是往往因为服务拆分工作不好，反倒让微服务的能力和特点发挥不出来。因此，在本专栏中希望作者能够在这方面给出一些建议和指导。</div>2018-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg" width="30px"><span>f</span> 👍（1） 💬（1）<div>后面会稍微讲解一下，微博的大致架构吗</div>2018-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/96/7b92b28f.jpg" width="30px"><span>迹_Jason</span> 👍（1） 💬（1）<div>不光光只有rpc方式，还有像Spring cloud的http方式</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/03/0b/c32a7e97.jpg" width="30px"><span>令仔很忙</span> 👍（1） 💬（1）<div>说到了我们的痛点，尤其是小公司，没有那么大的业务量，也不会考虑这些技术。所以发布的时候就会出现老师说的单体应用出现的各种问题。</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/93/7f/2ade341a.jpg" width="30px"><span>Alex</span> 👍（1） 💬（1）<div>微服务网络这块的问题如何解决，像超时这种</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3f/b7/0d8b5431.jpg" width="30px"><span>snakorse</span> 👍（1） 💬（1）<div>服务拆分过细的话，不光是治理平台要求高，跨服务调用功能的开发和协作的复杂度和成本也会陡增，关于这些方面，老师后边应该会有所提及吧</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg" width="30px"><span>Hurt</span> 👍（1） 💬（1）<div>微服务 目前就java为主吗</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e4/76/a97242c0.jpg" width="30px"><span>黄朋飞</span> 👍（1） 💬（1）<div>现在公司正在准备向微服务方向演进，但是因为功能过多，现在所有业务都是在一个包中，如果采用微服务进行模块拆分，则相应的微服务太多，对应的开发成本将会相应的增加，况且人手不足，不可能一个人维护几十个模块，并且这么多微服务需要一个统一的管理平台，目前并不具备，请问有什么解决方式呢？</div>2018-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e8/33/9a44f239.jpg" width="30px"><span>martin</span> 👍（1） 💬（1）<div>微服务受语言限制吗？比如c#语言可以构建微服务吗？</div>2018-08-23</li><br/>
</ul>