专栏结束后，有不少同学留言希望我能讲一些微博基础架构的知识。所以接下来的微博技术解密系列，我将分享微博在信息流架构、存储中间件等方面的经验，希望能给你带来启发和帮助。

今天我们先来看微博信息流架构，也就是微博的Feed是如何构建的。首先什么是Feed呢？根据我的理解，Feed是互联网2.0时代的产物，它与互联网1.0时代的产物——门户网站最大的不同之处就是Feed不需要用户在各个板块之间来回跳转获取信息，而是把不同的信息都聚合在一起，可以供用户源源不断地访问。这里就涉及了两个问题，一个是信息如何保存，另一个是信息如何聚合。这也是今天我要分享的主要内容，我会从存储架构的角度阐述微博Feed是如何存储的，然后会从业务架构的角度阐述微博Feed是如何聚合的。

## 微博Feed存储架构

我们知道，微博Feed是由关注人的微博聚合在一起组成的，所以要存储每个人发的微博，那么在设计存储架构时主要需要注意三个问题：

- 每秒数据写入量，也就是每秒发博量是多大。
- 每秒数据访问量，也就是每秒微博请求量是多大。
- 是否有冷热数据之分，也就是微博的请求是否有时间特点。

结合微博的业务场景，我来回答上面提出的三个问题。首先是每秒发博量，这里要考虑到极端情况，比如元旦零点，瞬间会有大量用户发博，达到数万QPS。再来看下每秒微博请求量，同样要考虑到在热点事件时，比如“春晚”时会有大量用户访问微博，请求量也会达到数万QPS；并且每个用户关注的不止是一个人，假设关注数的平均值是200，那么微博数据的请求量就是几百万QPS。除此之外，微博的访问也是有时间特点的，用户一般访问新发微博的概率要远远大于一周前发的微博，所以说微博数据也是有冷热之分的。
<div><strong>精选留言（14）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/49/61/abb7bfe3.jpg" width="30px"><span>招耳</span> 👍（6） 💬（3）<div>存储在redis中,然后对微博信息进行聚合操作比较简单吧</div>2019-02-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoZ2ib2qeG69ibf1mb9eicfH0sF3MpHbaGtsyp6SVEiaA1F2Ked2RZw0jENTZlicibFr4FJCHvIU5VmWR3g/132" width="30px"><span>BestWill</span> 👍（4） 💬（0）<div>微博Feed是拉模式，如何方便地做分页查询呢？</div>2021-10-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f5/b9/888fe350.jpg" width="30px"><span>不记年</span> 👍（4） 💬（0）<div>采用图数据 Dgraph +redis 的方案</div>2020-02-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/be/52/568e8c06.jpg" width="30px"><span>lvvp</span> 👍（3） 💬（0）<div>1. memecached  维护问题 2. memecached 故障你们是如何解决的？</div>2019-01-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e4/39/a06ade33.jpg" width="30px"><span>极客雷</span> 👍（2） 💬（0）<div>关注人分组拉取具体是怎么分的，存储的时候也是分组存储的吗？具体怎么存的？这个最关键的地方写的有点语焉不详</div>2021-03-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8f/0b/a438de52.jpg" width="30px"><span>0xTang</span> 👍（2） 💬（1）<div>推拉结合真是很多架构都会使用到</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8f/0b/a438de52.jpg" width="30px"><span>0xTang</span> 👍（2） 💬（2）<div>写入是tps，查询是qps</div>2019-02-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg" width="30px"><span>旅途</span> 👍（1） 💬（1）<div>老师你好 推模式 一条微博为什么要存储多份 存一个外键行么</div>2019-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/09/9d/8af6cb1e.jpg" width="30px"><span>臭猫</span> 👍（1） 💬（1）<div>阿忠伯，我想问一下，拉模式情况下，在粉丝数量众多的情况下，如何保证数据一致性的？比如如何保证所有粉丝都收到了新微博</div>2019-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f4/49/2b938b4f.jpg" width="30px"><span>北极的大企鹅</span> 👍（1） 💬（0）<div>比较想问的是学完框架后，是先学设计模式还是先学JVM原理，并发与线程安全，然后中间件和架构设计，数据库设计，Linux学习，跨语言学习顺序，这些都是按照什么样的顺序学习的，还有源码阅读顺序</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/5e/81/82709d6e.jpg" width="30px"><span>码小呆</span> 👍（0） 💬（0）<div>memecached 故障如何处理,为何不使用redis来做呢,是历史原因吗,后续又做升级吗</div>2023-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/68/da/b8d734bf.jpg" width="30px"><span>白日辰</span> 👍（0） 💬（2）<div>怎么衡量用户的粉丝数多少算多？还有是怎么判断的？</div>2019-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（0）<div>关系型数据库：持久化关系型数据
KV内存数据库：加速数据的读写速度
非关系型数据库：存储海量数据，且结构不定</div>2019-06-16</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/g1icQRbcv1QvJ5U8Cqk0ZqMH5PcMTXcZ8TpS5utE4SUzHcnJA3FYGelHykpzTfDh55ehE8JO9Zg9VGSJW7Wxibxw/132" width="30px"><span>杨家荣</span> 👍（0） 💬（2）<div>目前，我信息流处理是Elastic search +redis+MySQL</div>2019-05-05</li><br/>
</ul>