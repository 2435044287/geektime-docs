你好，我是任杰。这节课我想和你聊一聊怎么做好金融数据的传输。

我们在开篇词提到过，如果你对系统的要求高，通常都会说要按照金融级的标准来设计。所以当我们提到金融数据传输的时候，你可能也会觉得数据传输应该也是要求非常高的，既要速度快，又要流量大，而且还有极强的容灾能力。

没错，在金融行业很多地方会有这样的要求，但是也有一些地方要求并不高。所以这节课我会带你分析一下金融业务在不同场景下对数据传输的要求是什么，以及解决方案都有哪些。

## 案例分析

按照惯例，我们还是从一个具体的例子开始。和我们之前讲扫码支付一样，这里的例子既要典型，又要简单。所以思考再三，我选择了简化版的券商算法交易平台对接交易所的例子，原因有这些：

1.涉及场景多。既有事务数据，也有市场数据。  
2.模型简单。只涉及到2个主体。  
3.复杂度可选。连接交易所的要求可以很高，也可以很低，具体取决于你愿意出多少钱，有多久的研发时间。

那我们来看看简化的模型是怎样的。

**在券商对接交易所的例子里，一共包括两个主体：券商和交易所。券商的任务是将券商提供的市场交易信息发送到自己的算法交易平台，平台分析这些信息之后发送买卖订单给交易所。交易所负责处理收到的订单，在处理完之后将交易信息传递给券商**。整个过程都是用软件实现，而不是用硬件。
<div><strong>精选留言（6）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/pCVwNYT22UX6XAXJ5XLmbSHRmuPIncaJkS7S6kUKe0C8qWURib8zOhHTPwR36FeZZ4BcnKuDia4nrekqDnAkxdJQ/132" width="30px"><span>luke</span> 👍（0） 💬（2）<div>FIX的缺点不就是数据冗余度太高，编解码效率太低么</div>2021-02-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg" width="30px"><span>tt</span> 👍（11） 💬（2）<div>平衡速度不同的节点，就像CPU和主内存之间的差异，往往都是引入一个中间层比如一级缓存、二级缓存来解决，这些缓存对外是透明的。

这么来看，实时数据推送的层级结构与CPU缓存、内存的层级结构非常类似:

越往上的层级，成本越高数量越少；
越往下的层级，成本越低数量越多。

缓存利用了数据在空间上的局部性: 一个数据周围的数据也很快会被访问。

只是问题中说的速度的差异还会带来数据量的积压，所以还需要有“削峰填谷”的能力，这个正好是消息系统最主要的职责之一。

但是，等一下，客户来不及处理的数据真的需要放入数据的“水库”中等待用户后续处理么？这可是实时数据，也许等到客户可以处理的时候，数据的价值已经消失了，所以此时的数据已经不值得用户再去花那么多钱了。

所以，用户在和交易所买席位费的时候先评估自己的需求：要么花费和交易所等量的钱去对接，要不就降低自己的层级。

对交易所来说，提供的就是实时数据，第一是不能被下游系统阻塞；第二是不必缓存没有被消费的数据，因为缓存完再提供，那提供的就不是实时数据服务了。

推导来推导去，得出的结论不过是：实时数据就是传输过程中发生丢失就不需要找回的数据。</div>2021-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f9/e6/47742988.jpg" width="30px"><span>webmin</span> 👍（1） 💬（0）<div>按时间窗合并明细数据，对于不同能力的用户给不同窗口大小的数据，比如：统计10，20，50毫秒窗口。</div>2021-01-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0b/8b/a8732008.jpg" width="30px"><span>张志生</span> 👍（0） 💬（0）<div>&quot;比如说 Apache Kafka 默认带有一定容灾功能。一般要求部署 3 个节点，其中一个是主节点，另外两个是备份节点。&quot;，麻烦老师确认一下，这个细节是否正确。我的理解apache kafka集群只有controller角色，分区才有leader,follower概念。</div>2022-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1e/4c/d6416f57.jpg" width="30px"><span>salt</span> 👍（0） 💬（0）<div>实时数据如何保证低延时的同时，保证数据的完整性 (不丢失)、顺序性</div>2022-05-21</li><br/><li><img src="" width="30px"><span>柳钢</span> 👍（0） 💬（0）<div>实时用户能否对于需要的数据进行筛选？需要的数据才处理，不需要的数据直接丢失？</div>2021-10-10</li><br/>
</ul>