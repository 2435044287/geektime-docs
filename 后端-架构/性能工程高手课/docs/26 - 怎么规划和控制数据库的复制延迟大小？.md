你好，我是庄振运。

在正文开始前，首先要祝你新年快乐！今天我们要通过我在LinkedIn（领英）公司做过的一个项目，来学习如何控制数据库复制延迟。

我在LinkedIn工作的时候，就遇到过因为数据复制延迟太大而导致的生产事故。当时出现了这样的情况：一个用户刚刚更新了自己的照片，可是他的朋友们却迟迟看不到更新。

你是不是觉得LinkedIn又不是微博，看个照片而已，早点晚点也没什么大不了的？

但换个内容，这性质就严重了。LinkedIn网站上面会播放广告，在一定时间内，广告商往往会设置一定的广告投放预算限额，比如一天一万元。如果广告投放的收入统计数据被延迟，就会导致很严重的统计错误，实际支出严重地超过预算。一切有关钱的事，可都是大事。

所以，从用户数据的有效性、时间性和一致性来考虑，数据的传输复制延迟当然是越小越好。

## 什么是数据库的复制延迟？

那到底什么是数据库的复制延迟呢？如果让我用一句话来说，数据库的复制延迟其实就是当线上服务需要多个数据库时（比如为了分散流量），一条信息从源头数据库传递复制到下游数据库时经过的延迟。

还是用LinkedIn的例子来说明。LinkedIn的全球用户已经超过5.9亿，用户流量异常庞大。这些用户流量，是由用户的各种活动而生成的事件数据。LinkedIn的系统要求是，实时地捕获这些用户数据，并不断存储在后台数据库中。这些存放在数据库中的用户数据很重要，会被各种应用程序和其他服务读取，比如广告投放就需要消费这些数据。
<div><strong>精选留言（5）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhuGLVRYZibOTfMumk53Wn8Q0Rkg0o6DzTicbibCq42lWQoZ8lFeQvicaXuZa7dYsr9URMrtpXMVDDww/132" width="30px"><span>hello</span> 👍（2） 💬（1）<div>老师，祝您新年快乐</div>2020-01-24</li><br/><li><img src="" width="30px"><span>Scott</span> 👍（1） 💬（1）<div>这个好像对我们很有用，我们预估是直接用上一周同一天的流量来预测，问题是有时候遇到特殊情况，比如春节国庆，就行不通了。</div>2020-01-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" width="30px"><span>xiaobang</span> 👍（0） 💬（2）<div>1 对排队论不了解，这边把数据的传输复制系统看成是一个排队系统，排队论给我们提示了什么信息？有没有排队论和它的重要结论的通俗资料推荐呢 ？
2 不了解ARIMA和季节性指数，有什么学习资料推荐吗 ？
3 有了预测流量怎么计算延时的呢 ？</div>2020-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0f/70/cdef7a3d.jpg" width="30px"><span>Joe Black</span> 👍（0） 💬（1）<div>请问LinkedIn是用的mysql数据库吗？对于单个数据中心，对于大量用户事件写入和读取怎么解决的？是通过数据库复制做主从集群吗？我觉得主库估计也得做分片吧？目前来看解决这个复制延迟主要就是通过部署更多节点的方式吗？</div>2020-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/75/dd/9ead6e69.jpg" width="30px"><span>黄海峰</span> 👍（0） 💬（1）<div>听不懂，应该具体一点，实践篇应该具体到用什么软件什么命令执行，现在实践篇也是理论。。。</div>2020-01-28</li><br/>
</ul>