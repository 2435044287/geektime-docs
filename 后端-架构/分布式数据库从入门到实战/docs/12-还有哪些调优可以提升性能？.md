你好，我是彭旭。

上节课我们整体了解了手机云服务系统基于HBase存储的架构设计，以及迁移过程遇到的一些问题。

这节课我们聚焦在性能问题上，看看还有哪些调优的手段。

首先从客户端着手。不过，客户端实际上不能调优性能，只能用来减轻服务端的压力。

## 客户端调优

那客户端怎么减轻服务端压力呢？

**第一个方法，批量提交。**HBase客户端对数据的变更等都需要跟RegionServer 进行RPC通信。默认情况下，每一个操作都会发起一个跟RegionServer的RPC请求。

像下面这张图一样。Put插入4行数据，需要跟RegionServer服务器进行4次RPC通信。

![图片](https://static001.geekbang.org/resource/image/ec/fb/ec9f028274dafc43ea9b795a66d8e8fb.png?wh=2624x1684)

为了提高数据传输效率，减少建立连接的时间和I/O消耗。我们可以使用BufferedMutator，将数据的变更在客户端缓存，等变更的数据量达到配置的缓存大小后，再批量发送到服务端，减少RPC调用次数。

可以看到，启用客户端缓存后，这4行数据的修改从原来的4个RPC请求，减少到了2个RPC请求。

当然，客户端缓存数据有一个风险，就是客户端程序如果出现故障，比如宕机，那修改的数据可能就会丢失。

**第二个方法，就是设置合理的重试次数与间隔。**当客户端捕获到了非DoNotRetryIOException子类的异常后，HBase客户端就会发起重试，客户端重试的目标是请求出错后能够得到及时响应，但是也要避免重试过多、过快，给服务端带来过大的压力，导致服务端雪崩。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/bc/02/3f7a7197.jpg" width="30px"><span>跨江大桥</span> 👍（0） 💬（0）<div>都2024年了，JDK8 仍然还是最兼容 HBase、Hadoop 的版本吗？JDK8官方都不维护了</div>2024-11-22</li><br/>
</ul>