你好，我是彭旭。

上节课我们讲了HBase实现高性能实时随机存取的过程，但是，还没有讲到索引。事实上，索引是保障数据读取性能的最基本手段。

我们知道，HBase的数据是按行键字典序排序的，所以行键就是HBase最天然、最有效的索引。通过行键的读取是最高效的。

但是，HBase除了行键这个索引之外，竟然不支持二级索引。

为什么单独提到二级索引这件事呢？

在我们的云服务场景中有一个联系人数据表，行键是“用户ID反转+时间戳”，当你需要用手机号或者联系人姓名查询时，就需要扫描全部联系人数据，然后再一条条地过滤、匹配手机号或者联系人。这样是不是性能可能又不好了？

所以，这节课，我们就看一下在HBase中，在需要支持多个条件筛选的场景下，如何自己实现一个二级索引来提升性能。在这个过程中，我还会引入一个叫做协处理器的组件。希望在学完这一讲以后，你也能掌握这个知识点。

## 如何用行键实现组合索引？

在我们的例子中，如果用户ID在每次查询时都是必填项，那么有一个稍简单一些的方法，就是我们简单改变一下行键的组成，利用行键来实现一个类似关系型数据库的多字段组合索引。

我们在设计HBase行键的时候，除了考虑怎样合适地划分分区外，还要把查询的条件字段尽可能地融入到行键里。如果例子中的所有场景都是基于用户ID加上手机号查询数据，那么行键设计可以是图片里的样子。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/03/ce/ec3b8de9.jpg" width="30px"><span>淡漠落寞</span> 👍（0） 💬（0）<div>是不是可以异步地把数据表里的内容写到索引表里去，这样获取下次用户来查询的时候通过索引表就可以查到数据了，以减少回表？写到索引表里的数据可以基于对于数据的访问热度来挑选，过久的不热的数据也可以将其在索引表里的内容删掉。防止最终所有数据都写了2份。</div>2024-10-20</li><br/>
</ul>