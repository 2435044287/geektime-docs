你好，我是彭旭。

上一讲我们介绍了事务和MVCC，说到分布式数据库（比如HBase）对事务的支持较弱，甚至StarRocks、ClickHouse是不支持传统事务的。这是因为分布式数据库涉及多个服务器，跨表跨行事务需要协调集群多个节点，复杂性大大提高了。

不过，分布式数据库在牺牲了一部分事务的支持之后，也带来了一个主要的优势。它会将数据分片，然后分散到集群的各个节点，合理利用分布式集群的能力，从而实现弹性伸缩和负载均衡。

那么如何更好地分区，从而实现弹性伸缩和负载均衡呢？这就是咱们这节课要讨论的重点内容。

## 从分库分表说起

在传统关系型数据库领域流传着一个说法，说是MySQL单表数据量如果大于2000万行，性能会明显下降。你有想过这是为什么吗？

我们知道，在InnoDB存储引擎里一般使用B+树作为索引存储数据结构，而B+树的查询性能与树的高度息息相关，树的高度每加1，起码就会多一次磁盘的寻道I/O。InnoDB最小存储单元是页，B+树一个节点（叶子节点或非叶子节点）的大小就是一页。而一个页的大小默认是16KB。

好，现在我们来算一下以B+树为索引的情况下，不同高度的B+树能够索引一个表的多少数据行。注意，这里我们是以主键为索引，数据聚簇存储的情况下计算。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1a/2e/c5/231114ed.jpg" width="30px"><span>Hadesu</span> 👍（3） 💬（1）<div>数据分区的难点之一是，如何保证在数据分区变化期间让写入的最新数据能读出来。这是非常多书，博客都没提及的。希望出一期介绍一下。</div>2024-06-23</li><br/>
</ul>