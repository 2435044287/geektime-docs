你好，我是彭旭。

从这节课开始，我们要积累一部分数据库的基础知识。今天我们主要聚焦在列式存储和行式存储的区别上，再给你介绍一个被多个数据库引擎支持的、最流行的列式数据存储格式。

在大数据时代，列式存储出现的频率很高，讨论列式存储优势的文章汗牛充栋，这些信息给人一种“列式存储难道是最优秀的数据库存储格式”的感觉，实际上这可能是一个“可得性启发”。比如如果你经常听到飞机事故，你可能会觉得飞机是最危险的交通工具一样，而实际上飞机是一个相对更安全的交通工具。

那行式存储真的会被列式存储替代吗？我们先来简单对比一下它们之间的不同。

## 行列存储对比

顾名思义，行式存储其实就是将数据库的一行数据物理上也存储在一起，列式存储则是按照列将数据物理上存储在一起。

你看下面这张图，R1C1代表第1行数据的第1列，R3C1代表第3行的第1列。

![图片](https://static001.geekbang.org/resource/image/23/7f/23023606553ae2ba3649f8bf921eea7f.png?wh=1352x1024)

我们可以观察出两点。

- 在列式存储下，列C1的数据在磁盘上聚簇地存储在数据块（或者页），但是一列可以由多个数据块或者数据文件存储。
- 在行式存储下，行R1的数据在磁盘上聚簇地存储在数据块上。

其实行式存储与列式存储的发展，与其对应的不同类型的数据库发展息息相关。

我们先来看一个例子。假设一个订单表有40个字段，包括订单编号、订单金额、订单状态、商品名称、会员信息等。
<div><strong>精选留言（9）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/30/77/2a/0cd4c373.jpg" width="30px"><span>-Hedon🍭</span> 👍（7） 💬（2）<div>思考题：

行式存储和列式存储都有其更加适合的场景，我个人认为，一种数据库单纯支持一种存储格式，才有可能将这种存储格式够做到极致，对于某些单一固定的场景，选择行式存储或列式存储中某一个可能是更好的选择。
但是绝大多数情况下都不需要这种“极致”，相反“灵活性”能带来更大的收益。所以混合模式可能在未来会更具有发展潜力。因为它能够提供更大的灵活性和优异的性能，适应不同的工作负载需求。</div>2024-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/96/72/a517bf25.jpg" width="30px"><span>方舟勇士</span> 👍（3） 💬（1）<div>我觉得应该是列式存储优先。技术以摩尔定律来发展，业务不扩张还倒退，没有那么多业务数据要写入，列式存储再优化优化，是不是就够用了。</div>2024-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0f/70/f59db672.jpg" width="30px"><span>槑·先生</span> 👍（2） 💬（1）<div>感觉讲得有些粗略，想了解parquet设计之中的亮点和优劣势分析。</div>2024-06-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg" width="30px"><span>CJJ</span> 👍（1） 💬（3）<div>有个疑问，starrocks的官网其中一个描述是高并发数据分析，为啥老师的表格里面写着starrocks适用场景里面说对高并发支持没那么好呢？</div>2024-06-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4a/6f/e36b3908.jpg" width="30px"><span>xzy</span> 👍（1） 💬（1）<div>列式存储通常很适合压缩

这个列式存储的非常重要的点，老师没有讲到。

</div>2024-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/f3/8d/402e0e0f.jpg" width="30px"><span>林龍</span> 👍（0） 💬（1）<div>列式存储多条件是如何获取??   假如我有三个字段(时间,区域,金额)。需要统计今天华南地区的总额。用实现下面哪个方式。

1.获得时间列条件查找偏移量数据，获得区域条件查找偏移量数据，然后求交集去金额列求和。

2.先从时间列条件查找偏移量数据如只有(1,2,3)，去区域条件查找偏移量数据(只在1,2,3)里面查询。去金额列求和。

1.是可以在两个条件并发获取，最终求并集
2.是条件2依赖条件1,虽然不能并发获取，但是查找的数据会少很多。


</div>2024-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg" width="30px"><span>完美坚持</span> 👍（1） 💬（0）<div>StarRocks 和 ClickHouse
StarRocks
设计目标：StarRocks 是一个高性能的分布式 SQL 数据库，主要用于实时分析和多维数据分析（OLAP）。
数据存储：StarRocks 使用列存储结构，并且通过基于分布式架构设计来提升查询性能。
特性：支持高并发的低延迟查询，具有丰富的数据建模能力，能够处理复杂查询。
典型使用场景：实时数据分析、数据仓库、商业智能（BI）应用。
ClickHouse
设计目标：ClickHouse 是一个面向联机分析处理（OLAP）的列式数据库管理系统，设计用于高性能的实时分析。
数据存储：ClickHouse 使用列式存储结构，并通过数据压缩和分区来提高查询性能。
特性：支持高速的数据写入和复杂查询，能够处理非常大的数据量，提供丰富的聚合和分析功能。
典型使用场景：实时分析、用户行为分析、监控和日志分析。
关系
相似性：StarRocks 和 ClickHouse 都是为 OLAP 场景设计的高性能列式数据库，支持实时数据分析和高并发查询。
区别：两者在架构设计、特性和具体实现上有所不同。StarRocks 强调高性能和灵活性，特别是在多维数据分析上有优势。ClickHouse 则以其高效的列式存储和查询优化技术闻名。
总结
Hive vs. HBase：Hive 是用于批量数据分析的数据仓库工具，HBase 是支持实时读写操作的 NoSQL 数据库。它们可以结合使用，以满足不同的分析需求。
StarRocks vs. ClickHouse：StarRocks 和 ClickHouse 都是高性能的列式数据库，主要用于实时数据分析和 OLAP 应用。它们在特性和实现上有细微差别，选择哪一个取决于具体的使用场景和需求。
这些工具各有特点，选择时应根据具体应用场景和需求来决定。</div>2024-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/04/0d/3dc5683a.jpg" width="30px"><span>柯察金</span> 👍（0） 💬（0）<div>读 parquet 文件的时候，可不可以直接读取 file meta，获取 shcema，而不用全部读取数据？？？</div>2024-10-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg" width="30px"><span>完美坚持</span> 👍（0） 💬（0）<div>Hive 和 HBase
Hive
设计目标：Hive 是一个数据仓库基础设施，用于在 Hadoop 上进行数据查询和分析。它提供了类似 SQL 的查询语言（HiveQL）来查询存储在 Hadoop 分布式文件系统（HDFS）中的大数据。
数据存储：Hive 的数据存储在 HDFS 中，并且采用批处理的方式来处理大数据。
数据模型：Hive 使用关系型数据库的模型，即表、行、列的形式来组织数据。
典型使用场景：数据分析和报表生成，处理大规模的批量数据。
HBase
设计目标：HBase 是一个分布式、面向列的 NoSQL 数据库，旨在为 Hadoop 提供实时读写访问。
数据存储：HBase 的数据存储在 HDFS 或 HDFS 兼容的文件系统中，并且支持随机实时读写操作。
数据模型：HBase 使用 Bigtable 模型，数据以行和列族的形式存储，行键可以排序。
典型使用场景：需要高吞吐量和低延迟的应用，如实时数据处理和在线服务。
关系
集成：Hive 和 HBase 可以结合使用。Hive 可以通过 HBase 的存储处理数据，从而支持实时读写操作。例如，你可以在 Hive 中创建外部表，表数据存储在 HBase 中，利用 HiveQL 查询 HBase 数据。
互补性：Hive 适合批处理和复杂查询分析，而 HBase 适合实时数据读写和快速查询。它们结合使用可以满足不同类型的大数据处理需求。</div>2024-07-08</li><br/>
</ul>