专栏上一期我们分析了JVM GC的基本原理以及监控和分析工具，今天我们接着来聊如何监控Tomcat的各种指标，因为只有我们掌握了这些指标和信息，才能对Tomcat内部发生的事情一目了然，让我们明白系统的瓶颈在哪里，进而做出调优的决策。

在今天的文章里，我们首先来看看到底都需要监控Tomcat哪些关键指标，接着来具体学习如何通过JConsole来监控它们。如果系统没有暴露JMX接口，我们还可以通过命令行来查看Tomcat的性能指标。

Web应用的响应时间是我们关注的一个重点，最后我们通过一个实战案例，来看看Web应用的下游服务响应时间比较长的情况下，Tomcat的各项指标是什么样子的。

## Tomcat的关键指标

Tomcat的关键指标有**吞吐量、响应时间、错误数、线程池、CPU以及JVM内存**。

我来简单介绍一下这些指标背后的意义。其中前三个指标是我们最关心的业务指标，Tomcat作为服务器，就是要能够又快有好地处理请求，因此吞吐量要大、响应时间要短，并且错误数要少。

而后面三个指标是跟系统资源有关的，当某个资源出现瓶颈就会影响前面的业务指标，比如线程池中的线程数量不足会影响吞吐量和响应时间；但是线程数太多会耗费大量CPU，也会影响吞吐量；当内存不足时会触发频繁地GC，耗费CPU，最后也会反映到业务指标上来。
<div><strong>精选留言（26）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/a4/9c/b32ed9e9.jpg" width="30px"><span>陆离</span> 👍（18） 💬（4）<div>老师，不是很明白线程sleep时间越长，为什么tomcat启动的线程就越多</div>2019-08-01</li><br/><li><img src="" width="30px"><span>dingdongfm</span> 👍（9） 💬（1）<div>请教一个细节，Timeout 设置为 1000 毫秒，接口延迟4S，那么ERROR不是100%么？</div>2019-09-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（5） 💬（1）<div>李老师好。
第二三阶段，有很多TIME_WAIT状态的线程。可是CPU使用率并没有增加很多。老师说CPU使用率和吞吐量有关，吞吐量由JMETER控制一直没变。频繁线程切换会消耗很多CPU支援，如果只是阻塞，切换不频繁。对CPU使用率还是比较小的是么?</div>2019-08-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRiaKX0ulEibbbwM4xhjyMeza0Pyp7KO1mqvfJceiaM6ZNtGpXJibI6P2qHGwBP9GKwOt9LgHicHflBXw/132" width="30px"><span>Geek_ebda96</span> 👍（3） 💬（1）<div>老师请问一下，windows机器上用jconsole工具，不能看到tomcat的进程，是什么原因</div>2019-08-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（2） 💬（3）<div>内存泄露的原因是什么呢？代码写的有问题？</div>2019-08-16</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/IgjIXs9jjpODTPaOLrms0XOhJ8pxMcaZgtgBrPG6deqsKXv1sPIqkg0faL6X0rtFicJn5Wf7QXTickjYWpmF0V8A/132" width="30px"><span>Geek_28b75e</span> 👍（1） 💬（1）<div>老师，通过监控工具看到了有哪些线程，但是发现有些线程大部分都在等待，怎么找到这些线程创建位置，进而调整线程池初始化大小？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（29） 💬（1）<div>使用prometheus + grafana 监控各种指标，每天上班前看一下昨天的情况，设置好阈值，如果达到就报警。</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1e/3a/5b21c01c.jpg" width="30px"><span>nightmare</span> 👍（10） 💬（2）<div>先查看日志，那些方法耗时较大，用阿里爸爸开源arthas监控有问题的方法，排查问题</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b7/ba/ae4cabd8.jpg" width="30px"><span>仙道</span> 👍（9） 💬（0）<div>如果这样类型的内容能够再深入点、再广一点就好了。因为作为普通开发，很难有机会接触到这方面的知识，也无从学起</div>2019-09-27</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/IgjIXs9jjpODTPaOLrms0XOhJ8pxMcaZgtgBrPG6deqsKXv1sPIqkg0faL6X0rtFicJn5Wf7QXTickjYWpmF0V8A/132" width="30px"><span>Geek_28b75e</span> 👍（4） 💬（4）<div>老师，springboot内嵌tomcat怎么使用jmx? 
</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e0/40/3301e490.jpg" width="30px"><span>despacito</span> 👍（2） 💬（1）<div>文中提到的上下游服务概念有问题吧，服务的提供方是上游，调用别人的服务是调用上游服务</div>2021-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg" width="30px"><span>旭东(Frank)</span> 👍（2） 💬（1）<div>文中线程数的配置是否重复了</div>2019-08-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIvUlicgrWtibbDzwhLw5cQrDSy2JuE1mVvmXq11KQIwpLicgDuWfpp9asE0VCN6HhibPDWn7wBc2lfmA/132" width="30px"><span>a、</span> 👍（2） 💬（0）<div>监控系统会每隔一段时间，ping下我们系统，我们系统会pong回监控系统，并带上ip地址，jvm当前使用率，cpu使用率等信息，如果超过一定数值，监控系统就会发出预警信息，我们就需要去生产管理通过日志和命令查看，到底出了什么问题。</div>2019-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg" width="30px"><span>| ~浑蛋~</span> 👍（1） 💬（0）<div>为啥不是上游服务器，NGINX的都叫upstream</div>2022-08-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cd/ed/825d84ee.jpg" width="30px"><span>费城的二鹏</span> 👍（1） 💬（0）<div>老师，jmeter压测30线程，发现接口95%的请求返回是50ms内，其余请求会达到170ms，如何监控这些延迟的请求做了什么导致缓慢。</div>2020-05-14</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIjRETqRjvLESLDZkNTjIiaSibtNYBaS1o8WMUicOFn3ycF3Mgh6LRJibqSBjVBjiaO2ibW0gHkafATb21A/132" width="30px"><span>lmdcx</span> 👍（1） 💬（0）<div>这一讲不仅仅可以用来监控 Tomcat 的WEB应用，对于大多数的 Java 应用程序都是适用的。  
猜想因为课程重点在于插接容器，不在性能优化，所以这里并没有讲解更多更细的调优情况和参数。
个人感觉相对于其他课程的同样内容，李老师的思路更清晰。</div>2019-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/24/70/4e7751f3.jpg" width="30px"><span>超级芒果冰</span> 👍（0） 💬（1）<div>“JMeter 每秒会发出 100 个请求，每一个请求休眠 2 秒”，为什么tomcat就要创建200个工作线程，这个地方不太理解</div>2022-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg" width="30px"><span>花花大脸猫</span> 👍（0） 💬（0）<div>通过springboot的acuator还有对应依赖组件的healthcheck，将结果统一发送到可视化监测平台，如果有超过3个周期未能推送或者1个周期推送结果为失败，就需要实时触发告警！</div>2022-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/76/40/ff8630c8.jpg" width="30px"><span>GeekWind</span> 👍（0） 💬（0）<div>Linux下jconsole怎么用</div>2021-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/7b/06/4d4fdb6d.jpg" width="30px"><span>panerai</span> 👍（0） 💬（0）<div>我在mac下面，使用jconsole无法连接到指定的x.x.x.x，提示未知主机，把127.0.0.1 x.x.x.x加入到host才解决。</div>2021-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ca/aa/2ce2bdce.jpg" width="30px"><span>。。</span> 👍（0） 💬（0）<div>配置后启动项目卡死呢</div>2021-04-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/86/f4/331f33a7.jpg" width="30px"><span>anchor</span> 👍（0） 💬（0）<div>计算需要的线程数有什么公式吗？</div>2020-05-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg" width="30px"><span>旅途</span> 👍（0） 💬（0）<div>收获非常大  </div>2020-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg" width="30px"><span>Demon.Lee</span> 👍（0） 💬（0）<div>老师，一般工程实践上一个tomcat实例下部署多少个app应用比较合适，如果我有一个系统，下面有20个微服务（即20个war包），都放在一个tomcat下面，是否不合适？如果不合适，用几个tomcat合适呢？假如每个微服务提供的能力都差不多的情况下。</div>2019-12-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ff/98/6e17646a.jpg" width="30px"><span>桔子</span> 👍（0） 💬（1）<div>processingTime处理这些请求共花费的时间。

</div>2019-10-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7d/da/780f149e.jpg" width="30px"><span>echo＿陈</span> 👍（0） 💬（1）<div>生产环境网络隔离……没办法适用jmx</div>2019-08-01</li><br/>
</ul>