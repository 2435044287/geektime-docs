我们可以通过Request对象的getSession方法来获取Session，并通过Session对象来读取和写入属性值。而Session的管理是由Web容器来完成的，主要是对Session的创建和销毁，除此之外Web容器还需要将Session状态的变化通知给监听者。

当然Session管理还可以交给Spring来做，好处是与特定的Web容器解耦，Spring Session的核心原理是通过Filter拦截Servlet请求，将标准的ServletRequest包装一下，换成Spring的Request对象，这样当我们调用Request对象的getSession方法时，Spring在背后为我们创建和管理Session。

那么Tomcat的Session管理机制我们还需要了解吗？我觉得还是有必要，因为只有了解这些原理，我们才能更好的理解Spring Session，以及Spring Session为什么设计成这样。今天我们就从Session的创建、Session的清理以及Session的事件通知这几个方面来了解Tomcat的Session管理机制。

## Session的创建

Tomcat中主要由每个Context容器内的一个Manager对象来管理Session。默认实现类为StandardManager。下面我们通过它的接口来了解一下StandardManager的功能：
<div><strong>精选留言（14）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg" width="30px"><span>-W.LI-</span> 👍（35） 💬（1）<div>session是会话的生命周期，每次请求都会重置超时时间，TCP链接超时，链接就被回收了(节约资源)，如果session没失效可以从新创建TCP链接通过sessionId找到之前的会话。sessionId存在cookie里面，通过http协议的head头传过来。
老师好，感觉设计模式大多的作用就是，解耦，复用，提高系统的简装性，灵活性，还有别的作用么?
有个问题，之前听隔壁班的老师说，在数据量大的时候ConcurrentSkipMap()juc下基于条表实现性能比ConcurrentHashMap性能好。可是Tomcat管理session还是用的ConcurentHashMap()。是不够多么，大概多少量级以后用跳表比较合适啊?谢谢老师</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/63/f47576e1.jpg" width="30px"><span>永钱</span> 👍（16） 💬（2）<div>Tcp是系统网络层面的，而session是应用层面的，应用层面完全由应用控制生命周期，他们之间没什么关系。不知道理解对不对，求指正</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg" width="30px"><span>发条橙子 。</span> 👍（13） 💬（1）<div>老师 我有个其他的疑问，一般我们用tomcat起java程序的时候都用的jvm的默认参数，那如果我想更改一些jvm参数 ，应该在tomcat哪里配置</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/51/0d/14d9364a.jpg" width="30px"><span>L.B.Q.Y</span> 👍（5） 💬（1）<div>StandardManager持有的sessions这个ConcurrentHashMap，其Key是sessionId对吧，这个sessionId是通过cookie送进来的是吗？如此，同一个主机上发送来的请求就能和指定的session关联在一起。</div>2019-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg" width="30px"><span>梁中华</span> 👍（2） 💬（1）<div>不谈下分布式session在tomcat中的实现吗？比如多个tomcat实例如何共享session？</div>2019-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg" width="30px"><span>WL</span> 👍（1） 💬（1）<div>老师请问一下如果是集群部署的Tomcat容器怎么实现分布式的session，还能有standardManager管理吗？我看有filestore和jdbcstore两个类，但是感觉靠这两个类好像也没法实现，请老师指点一下具体怎么集群情况下的session管理</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/24/5d/65e61dcb.jpg" width="30px"><span>学无涯</span> 👍（0） 💬（1）<div>HttpSessionEvent event = new HttpSessionEvent(getSession());
没太明白HttpSessionEvent 的作用是什么</div>2019-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/45/e4314bc6.jpg" width="30px"><span>magicnum</span> 👍（4） 💬（0）<div>一个是传输层连接的断开时间，另一个是应用层用户会话的过期时间，两者没啥关系，但是超时目的其实都是为了减少服务器资源占用</div>2019-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8a/76/4abc8ac1.jpg" width="30px"><span>完美世界</span> 👍（1） 💬（0）<div>tcp 是传输层协议，连接过期，需要重新三次握手。Session，是服务端的凭证，过期，表示会话过期，需要重新连接。此时tcp可能未过期。</div>2019-09-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg" width="30px"><span>| ~浑蛋~</span> 👍（0） 💬（0）<div>请问一下，session的isValid状态由谁来维护</div>2022-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg" width="30px"><span>旅途</span> 👍（0） 💬（1）<div>老师，创建session的时候，先用context过去的manager，然后session.setId的时候，又用manager获取的context，来过去listener，这是为什么</div>2020-01-19</li><br/><li><img src="" width="30px"><span>Geek_rebel</span> 👍（0） 💬（0）<div>对Request对象进行包装，这种操作是用的装饰者模式吗？</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ee/6c/246fa0d1.jpg" width="30px"><span>Mr.差不多</span> 👍（0） 💬（0）<div>我想请教一下，就是在tomcat中session的过期时间是什么时候重置的? 是在下一次获取到这个session中的数据的时候？还是随便向后台发送个请求就可以？</div>2019-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/09/67/7de7988a.jpg" width="30px"><span>小飞</span> 👍（0） 💬（0）<div>其实在StandardManager 中没有 backgroundProcess()和 processExpires()的具体实现的。他们的实现提取到了基类ManagerBase中</div>2019-07-23</li><br/>
</ul>