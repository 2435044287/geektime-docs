你好，我是大明。今天我们来聊一聊微服务架构下的隔离功能。

隔离和前面讨论的熔断、降级、限流比起来，在面试中要“冷”一点。一个很重要的原因是隔离在实际中的应用要比限流这种措施少很多。尤其是在中小型公司，很多时候是用不到隔离的。但隔离依旧是构建高可用和高性能的微服务架构中的一环，因为**在出现故障的时候，隔离可以把影响限制在一个可以忍受的范围内。**

比如说我们为 VIP 用户提供单独的服务集群，普通用户共享一个服务集群。那么普通用户集群出了问题，VIP 用户一点感觉都没有，依旧可以正常使用，这样就可以保证VIP用户体验不受损。特别是复杂的、核心的和规模庞大的服务，隔离机制就更加重要了。否则，一个小小的故障都能蔓延到整个系统，你就离喜提大礼包不远了。

所以今天我就带你看看隔离在实际工作中形形色色的用法以及两个比较出彩的隔离方案。

## 前置知识

隔离是通过资源划分，在不同服务之间建立边界，防止相互影响的一种治理措施。

隔离在实际工作中有很多种做法，从不同的角度可以进行不同类型的隔离。一般来说，使用隔离策略主要是为了达到3个目的。

- **提升可用性**，也就是说防止被影响或防止影响别人。这部分也叫做故障隔离。
- **提升性能，**这是隔离和熔断、降级、限流不同的地方，一些隔离方案能够提高系统性能，而且有时候甚至能做到数量级提升。
- **提升安全性，**也就是为安全性比较高的系统提供单独的集群、使用更加严苛的权限控制、迎合当地的数据合规要求等。
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/91/89123507.jpg" width="30px"><span>Johar</span> 👍（9） 💬（0）<div>1.热点数据不能集中放，因为热点数据一般的请求量很大，需要将热点数据均衡分配各个节点，降低热点数据造成的压力
2.我们是用的是spring cloud，在对接新服务并且是核心业务的时候会使用线程池隔离，原因：新服务一般稳定性差，不能影响核心业务。当然用的多了，到处都是线程池，增加线程切换和内存的消耗</div>2023-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7e/57/8c1051b6.jpg" width="30px"><span>3.0的A7</span> 👍（8） 💬（2）<div>一，刚开始觉得可以（主要是想着参考数据的冷热分离），但是写着写着觉得不太行，原因有以下几个：1、热点数据应该是比较重要的数据，如果出了问题，舆论影响会比较大。2、热点数据可以通过负载策略打到权重高的机器。3、热点数据只是说查询频繁，不是大请求，所以按照冷热分离解决不了本质的问题。
二、我是写 java 的，主要用到就是 springboot 这一套，见识短浅，没听过池隔离呀，尤其是文中说的那个快慢任务线程，不知道怎么实现，如果老师能给出常用后端语言的代码示例就更棒了</div>2023-06-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/31/4e/78/ee4e12cc.jpg" width="30px"><span>Lum</span> 👍（2） 💬（1）<div>给老师个建议，文字太多，显得干巴巴，可以搞点伪代码看看思路</div>2023-07-07</li><br/><li><img src="" width="30px"><span>Geek_c88cae</span> 👍（1） 💬（2）<div>明哥您好，我是C++程序员，我想请问下线程池隔离：
1. 线程池中的线程数怎么确定？通常来说是大于等于内核线程数的，既然如此，只要创建的用户线程数大于内核线程数，其底层都是所有的内核线程执行，那么其“大于”的意义在哪，为什么不“等于”呢？
2. 如果快慢线程池都是在一台服务器上，其对应的内核线程数是恒定的，怎么做到隔离的效果呢，将线程与CPU核心绑定吗？但是我从没见过线程池绑定CPU的呀^_^?</div>2023-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（1）<div>请教老师几个问题：
Q1：Redis会被用作消息队列吗？
文中“或者被用作消息队列的 Redis 最好是一个独立的集群”，消息队列有四个常见的产品，很少听说过Redis作为消息队列。
Q2：分组一般怎么做的？
在网关或Nginx给请求加一个分组标志位吗？
Q3：SpringCloud支持连接池隔离吗？
Q4：一台机器上，MySQL适合起多个实例吗？
还是说一台机器上只适合起一个MySQL实例？</div>2023-06-28</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ8a5dg6aBRojCo3eY7d2Jz6oNziaf1zZH3h0mSgHopyMg11vvCEvxdfOoejMVGcGV9yqHwucXkCSw/132" width="30px"><span>Geek_7b342f</span> 👍（0） 💬（1）<div>vip用户和普通用户，怎么识别呢，在哪一个阶段识别呢</div>2023-11-22</li><br/><li><img src="" width="30px"><span>Geek_680632</span> 👍（0） 💬（1）<div>1.这里的问题在于如何识别热点数据，以及如何设计相应的路由机制，在读写时找到对应的资源并进行操作，对于区分明显的场景可行；2.例如mysql是不支持线程池隔离的。</div>2023-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/da/54/33dabd0a.jpg" width="30px"><span>闫同学</span> 👍（0） 💬（0）<div>redis和redis cluster进行分别部署算不算隔离？</div>2024-10-11</li><br/>
</ul>