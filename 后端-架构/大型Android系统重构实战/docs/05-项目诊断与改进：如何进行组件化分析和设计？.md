你好，我是黄俊彬。上节课我们一起学习了四种移动应用架构的演进，也给你介绍了不同架构演进过程中遇到的各种问题。相信你已经感受到，遗留系统不仅会带来研发效率和质量方面的问题，还会影响产品的市场响应力。

今天我们正式进入到这个课程的示例项目中，看看Sharing旧架构（1.0 时期）的代码结构和工程管理方式，对它做一次诊断和优化。通过这节课的学习，你可以了解遗留系统常见的代码、工程组织方式及其存在的问题，并掌握组件化的分析和设计思路。

为了降低你对业务上下文以及代码的理解成本，课程的Sharing项目采用的是浓缩版的示例，其中的数据采用的都是本地数据，业务功能也做了精简。但该项目包含了遗留系统各类典型代码坏味道以及代码耦合问题，你可以将这个课程中学习的流程方法、工具、设计思想无缝运用到其他的项目中。

## Sharing 1.0：案例诊断

我们来对Sharing做个案例诊断。

### 代码结构

Sharing 1.0 采用的是单体的架构，所有的的代码都在一个模块中，主要包含了账户、文件和消息3个模块。账户模块主要管理用户个人信息、登录及登出；文件模块主要负责用户上传文件及浏览文件；消息模块主要负责用户共享文件给所有用户。

![图片](https://static001.geekbang.org/resource/image/60/11/60a0d5edff0982757d51fd7db570c811.gif?wh=1080x2220)

另外，**Sharing代码的组织方式是按技术维度来划分，并不是以业务维度进行划分，这是单体架构常见的代码组织方式**。Sharing主要的包结构和功能我梳理了一张表。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（3） 💬（1）<div>请教老师几个问题：
Q1：分层时，每层只能是同一类的组件吧。
比如业务层，该层只能是业务组件，不能包含功能组件和技术组件，对吧。
Q2：Sharing这个项目有源码吗？
Q3：按技术维度划分，如果有架构约束和规范，也可以采用，是吗？
文中有“遗留系统常见的代码组织方式是按技术维度来组织，如果缺少规范和架构约束，非常容易出现代码随意依赖、耦合度高的问题”，从这句话看，如果按技术维度划分，也可以，但前提是要有比较好的架构约束和规范，对吗？
Q4：在具体操作层面，在AS下为每个组件创建项目或module，然后打包成aar或so，在最终的集成项目中引用这些aar或so，是这样吗？
Q5：集成方式中有一种apk,一个项目可以引用一个apk吗？（不清楚此时是如何具体操作的）</div>2023-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/9d/8646083b.jpg" width="30px"><span>开飞机的老舒克</span> 👍（0） 💬（1）<div>请教老师个问题，就是如果登录、用户信息这些都封装在业务层的用户组件中，但是其他业务组件想使用这里面的功能或者信息的时候是需要在功能组件层提供路由支持吗？例如我在消息组件中需要更具登录态做一些操作之类的功能时，需要和用户组件通信，请问有什么好的通信方式吗？</div>2023-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/5b/75/f89d3cce.jpg" width="30px"><span>迷途的羔羊</span> 👍（0） 💬（1）<div>首页有4个tab，个人中心，和三个其它类型界面，按照这4个界面分4个业务组件可以吗？其它界面按照业务属性归到这四个里面</div>2023-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/5a/8a/dd06563f.jpg" width="30px"><span>Justin</span> 👍（0） 💬（1）<div>怪不得大公司都要分的很细，做好一个大型app不容易</div>2023-02-21</li><br/>
</ul>