你好，我是黄俊彬。

在过去的很多咨询项目中，我发现一个很有意思的现象——项目的架构设计是一回事，代码落地又是另外一回事，很多架构设计最终都只是落在了PPT上。发生这类现象，一方面可能是因为后续架构腐化了，缺少守护；另一方面是实际落地到代码的改造环节，它的复杂度比纸上画图高得多。

所以，我根据以往多个大型遗留系统的改造经验，将重构的改造流程分为了5个步骤，帮你安全、高效地进行规模化架构重构落地，并通过自动化手段来守护。

![](https://static001.geekbang.org/resource/image/2f/ea/2f4e010b01a55af51b152a7ab11153ea.jpg?wh=2900x2444)

如上图所示，这5个步骤分别是设计、守护、解耦、移动和验收。在前面的基础篇和分析设计篇，我们已经详细讲过了设计和守护；而移动和验收相对比较简单，我们只要掌握使用IDE进行自动化移动，并按照验收标准验证就可以了。因此，**解耦这个步骤才是落地代码改造的核心步骤。**

这节课我会按照第5节课的架构设计来重构Sharing的代码。这个过程里，我会带你掌握4种常用的解除依赖的手法，分别是类下沉、依赖接口、事件总线以及路由。

## 第一步：设计，识别内聚的组件

在[第5节课](https://time.geekbang.org/column/article/630925)中我们对组件的类型进行了划分，也对Sharing进行了一次全景的组件梳理，把组件分成了业务组件、功能组件和技术组件这三类。

![](https://static001.geekbang.org/resource/image/29/c9/298914097c624ffe9c0cd6a7299424c9.jpg?wh=3600x1559)

设计这一步其实就是在识别内聚的组件，不过当时我并没有展开说明如何识别这3类组件，现在我们就来做个分析。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="" width="30px"><span>Paul Shan</span> 👍（2） 💬（1）<div>我的经验是EventBus最好不要用，因为很容易被滥用，我有一次处理一个遗留代码花了很长时间才搞清楚，原因就是EventBus，当EventBus的事件被分发了五六次之后，事件之间的依赖关系就变得非常复杂，这些事件可能一开始是简单的，被人不断添加之后就变得晦涩难懂，很难维护，这种腐败是渐进的，光从代码审查上不容易察觉，请问老师有什么好办法来避免EventBus被滥用吗</div>2023-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/89/84/52bf6799.jpg" width="30px"><span>叫我怪兽好了</span> 👍（2） 💬（1）<div>反射在带来解耦便捷的同时也带来了风险，比如耗时、类被移动到其他包、删除，以及后期的维护，为了保证运行时的安全，通常还需要加上一大堆的 try-catch。总的来说，个人感觉收益没有成本高。</div>2023-03-03</li><br/><li><img src="" width="30px"><span>Geek_a8c1a2</span> 👍（1） 💬（3）<div>这里我有个问题，如果项目工程巨大，比如PDD、美团、字节这种大厂的App，那么功能组件、技术组件、业务组件必然非常多，看您的配置都是module级别，这样的问题是随着module的增加，module 数量的增加对 IDE 性能（尤其是 Sync 和 Index 耗时）的影响是不容忽视的。也很有可能出现“IDE Sync 直接触发 OOM” 的尴尬局面。  不知道您有什么这方面的见解</div>2023-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（1）<div>请教老师几个问题：
Q1：依赖接口这种方法难道不适用于功能组件和技术组件？
文中提到“依赖接口是指将原先直接依赖具体的实现，解耦成依赖稳定的抽象接口。这个解除依赖的手法适用于业务组件之间的依赖”，从这句话看，似乎只用于解耦业务组件之间的依赖，难道不适用于功能组件和技术组件？
Q2：热更新不实用吗？
我在一个群里咨询，有一些人认为“中小公司不用这个方法，有技术难度，有坑，而且google官方不支持这种做法”，还是要做正常的更新流程。 老师怎么看待这个问题。
Q3：EventBus没有过时吗？
五年前用的就是EventBus。五年过去了，EventBus还是最好的吗？没有新的此类框架吗？（这几年很少用安卓，不清楚变化）
Q4：EventBus类似于消息队列？
后端微服务架构也要用事件总线，具体实现就是采用消息队列，比如RocketMQ。（所以我一般就认为事件总线就等价于消息队列，不知道这个观点是否对）。 EventBus类似于消息队列吗？（或者说，EventBus是一种简单的消息队列？）</div>2023-03-04</li><br/>
</ul>