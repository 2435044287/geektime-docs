你好，我是黄俊彬。今天我们正式进入到解耦重构篇。在这个章节中，我们将根据“分析设计篇”中分析出的问题清单重构改造Sharing项目，最后将设计落地到具体的代码上。

在我过去碰到的很多遗留系统中，代码都存在一些相似的问题，其中最典型的有五种：过度嵌套、重复代码、无效代码及资源、缺少抽象和随意依赖。

千里之堤，溃于蚁穴，遗留系统不是一天造成的，而是在日常开发中不断累积出来的，而这五种典型的代码坏味道其实就是**推动系统演化成遗留系统的重要元凶**。

所以，在重构Sharing项目的代码之前，我们先通过一些示例看看这些代码坏味道带来的影响以及如何解决它们。当然了，最重要的是，我们怎么提前避免这些问题。

## 过度嵌套

我们先来看过度嵌套。**过度嵌套指的是代码的圈复杂度过高，存在大量的嵌套逻辑，不方便开发人员维护和扩展功能。**首先请你想一下，这个圈复杂度多少算高？多少算低呢？

提出圈复杂度概念的麦凯布给我们的建议是：**若一模块的循环复杂度超过10，需再分割为更小的模块。**按照这个阈值来看，如果圈复杂度超过10，我们就认为圈复杂度过高；如果在5-10之间认为是中等，可以接受；如果低于5，就认为圈复杂度比较低了。

下面我们来看一段圈复杂度超过10的代码，你可以细品一下，阅读这段代码时是什么感受。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/f4/11/727ebf8d.jpg" width="30px"><span>刘军</span> 👍（0） 💬（1）<div>老师讲得好，终于明白“防微杜渐”的含义了。</div>2023-03-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d6/7d/4b09b0bf.jpg" width="30px"><span>李鑫鑫</span> 👍（0） 💬（1）<div>idea 工具使用不太熟悉</div>2023-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（1）<div>请教老师几个问题：
Q1：怎么借用Idea来使用duplicate code检查？
Idea能打开安卓项目吗？没有用idea打开过安卓项目。
Q2：对于“僵尸代码”老师有什么好的实践方法？
在实际工作中，老师所经历的公司中，对于“僵尸代码”有什么方法？定期组织多人对代码进行review吗？
Q3：整个应用有“热更新”吗？
上次请教老师热更新的问题，老师的回答是“我的理解是热更新是应用内插件的更新，不是整个应用的更新”， 从这句话看，似乎对于整个应用来说，没有“热更新”，应用从版本1升级到版本2，没有“热更新”的方法，只能走正常的更新流程（即重新下载、安装），是这样吗？</div>2023-02-27</li><br/>
</ul>