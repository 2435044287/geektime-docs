你好，我是黄俊彬。

上节课，我带你学习了针对“过大类”代码坏味道的重构方法，我们将组件内分层架构重构流程分为3个维度和7个步骤。

![](https://static001.geekbang.org/resource/image/75/ae/75d88677c0284663ac8ae5fa585459ae.jpg?wh=3450x2069)

但在实际代码重构落地过程中，你一定会遇到这两个问题。第一个是在代码重构时，很容易引起新的Bug，然后会被质疑做代码重构的意义。这也是很多开发同学宁愿选择复制黏贴，也不轻易对原有代码进行重构的原因，因为一不小心，很容易背锅。

第二个问题是代码重构时仅通过人工挪动调整代码，既低效又容易出错。并且最后只能依靠手工测试来做质量验证，反馈效率也非常差。

所以今天这节课，我们将按照组件内分层架构的这7个步骤对文件模块的主页面进行MVP重构，在这个过程中你可以感受一下我们是如何解决上面这两个问题的，也就是说怎样重构才能速度快又不会出错？

## 第一步：业务分析

**搞清楚需求是一切的开始，重构也一样。如果我们对原有的需求一知半解，然后就急于重构，那么大概率会以失败告终。**甚至在重构时，我们需要更进一步去挖掘那些“失传”的逻辑，以始为终才能让我们不会做错方向。

文件模块的主页如下图所示，从页面上来看，文件模块只是用于简单地展示文件的数据。

![](https://static001.geekbang.org/resource/image/9d/88/9d61e4d309b1ea590e707124d136aa88.jpg?wh=3000x2769)

但通过需求分析及梳理，我们发现该页面还包含了其他异常处理逻辑：
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（1）<div>请教老师几个问题：
Q1：RxJava以前用过，记得是用来做网络请求的，也是线程库吗？
如果是的话，除了RxJava，还有什么线程库（或线程池）？
Q2：MVP中架构中，P被称作“表现层”。从字面意思看，“表现”容易被理解成界面、显示一类的东西。实际上，P一般是负责网络请求、逻辑处理方面的事情。感觉“表现层”这个用词不是很好啊。
Q3：安卓手机上的APP可以直接运行在安卓平板上吗？
或者，需要做一些移植工作？</div>2023-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1f/67/72f8fcf2.jpg" width="30px"><span>湛卢</span> 👍（0） 💬（1）<div>有完整的代码示例吗</div>2023-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d6/7d/4b09b0bf.jpg" width="30px"><span>李鑫鑫</span> 👍（0） 💬（1）<div>这块的代码有吗？</div>2023-03-15</li><br/>
</ul>