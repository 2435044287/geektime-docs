你好，我是黄俊彬。这是我们专栏的第一课，我将系统给你分享重构的类型、时机、收益和度量。

在之前的很多咨询项目中，每当我和一些同学聊起重构时，都会被问到一个问题：到底什么是重构？一个开发同学说他在研发过程中，经常有产品、测试、项目等同学对他提代码重构的需求，比如后面这些情况。

- 测试同学说：今天的版本测试又发现了内存泄露，你重构一下代码吧。
- 产品同学说：这个界面的用户路径操作太深了，你重构一下代码吧。
- 项目同学说：我们的线上Bug很多，质量太差了，你重构一下代码吧。

乍一听你可能会觉得这些同学说的好像也没错，但是你仔细一琢磨，就会发现这里面其实包含了性能优化、需求优化、缺陷优化等诸多内容，这些都算代码重构吗？另外，重命名一个方法、提取一个接口、单体架构组件化，这些又算是重构吗？它们之间有什么区别呢？

所以我觉得在课程的最开始，我们很有必要先理解清楚重构的概念，明白它能直接或间接为我们解决哪些痛点问题，以及如何来度量重构的收益。搞清楚这些定义后，上面的问题你都会有答案。

## 重构的类型和时机

首先，我们来看一下重构的定义。

在[《重构：改善既有代码的设计（第2版）》](https://book.douban.com/subject/30468597/)中写道：

> 重构（名词）：**对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。**
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/f9/c5/95b97dfa.jpg" width="30px"><span>郑峰</span> 👍（1） 💬（1）<div>实践中以中型重构为主。

小型重构在代码提交时已经完成。

大型重构则需要有计划进行，比如自动化重构工具的构建，和自动化保障规则的构建。</div>2023-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9c/e3/e4fd2ff5.jpg" width="30px"><span>白煮迁回</span> 👍（1） 💬（1）<div>之前重构项目都面临如何体现价值的问题?
文章中老师说的方重构前就需要对工程指标化,这部分相对容易些.
但对业务价值如何体现比较难?
比如:
1.承接需求开发效率指标无法准确获取.重构的同学一般与开发业务同学是2波人,需求评估工时无法明确重构带来提效价值.
2.重构后质量会有劣化期.复杂业务逻辑修改时引入新问题,反而多做多错.
3.重构专项推动比较难, 一般都是转化为做需求时顺便重构,反而劣化承接需求效率
解决方案
1.统计rd承接需求工时变化,但效果不明显
2.加载自动测试方案+多自测+多review,可以减少 但无法完全避免
3.在业务需求空白期推动&#47;拆成小步迭代</div>2023-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/10/3d/b3991de7.jpg" width="30px"><span>dulp</span> 👍（0） 💬（1）<div>大型重构进行的较少，其次是中型重构。中型重构一般是代码质量不高和业务改动较大同时出现时会进行。之前一直没有思考如何度量重构的收益，这篇文章帮助很大。</div>2023-03-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/2a/27/4c32c4ad.jpg" width="30px"><span>Geek_6061ea</span> 👍（0） 💬（1）<div>请问老师，Sonar 是个线上的平台，可以扫描多仓吗？扫描代码有泄露风险，以及需要收费，难以说服公司接入。对于收益和度量的每个点，都有本地扫描工具替代吗？</div>2023-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/77/a5/c5ae871d.jpg" width="30px"><span>zenk</span> 👍（0） 💬（1）<div>目前整个系统
1. 缺少分层不分核心业务和运维业务，各种逻辑都在一个函数里面
2. 缺少模块化，同样的逻辑分散
3. 导致理解业务逻辑，老担心是不是还有其他地方的代码没有看

这样的系统该如何一步一步的重构

目前的思路大致是：
1. 最多是组件级别重构
2. 识别那些坏味道，小步改进
3. 模块化的时候，梳理出依赖关系，按照依赖关系，先模块化前置依赖

请教老师
1. 这个步骤靠谱不，求其他建议
2. 另外执行的时候需要和领导沟通具体的工作和厂出，按照上面的度量，领导听了感觉太有说服力，不知这方面该怎么做</div>2023-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/63/57/b8eef585.jpg" width="30px"><span>小虎子11🐯</span> 👍（0） 💬（1）<div>干货满满，期待后面的内容</div>2023-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/08/46/8b244fc3.jpg" width="30px"><span>蓝啼儿</span> 👍（0） 💬（0）<div>实践中以中型重构为主。
</div>2024-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/46/71/28aa77a7.jpg" width="30px"><span>Agei</span> 👍（0） 💬（0）<div>大型重构的价值，其实看着都比较具象，但是其实在立项前去盘点价值其实难度很高，就是比如老师讲的bug数量如何减少这个在重构前去盘点有点伪命题，举例来说，之前开发A模块平均产生30个bug，重构完之后产生10个bug，这个其实是个结果，但是不一定重构能解决此问题，老师能直接给个大型重构价值推导的具体例子么？这样看着更有借鉴和学习思路，多谢老师</div>2023-05-08</li><br/>
</ul>