你好，我是徐昊，今天我们来继续学习AI时代的软件工程。

上节课，我们讲解了如何通过测试四象限（Agile Testing Quadrants）构造有效的测试策略（Test Strategy），以及为何构造支持团队的测试（Q1和Q2象限）是测试策略中重要的一环。而在构造Q1和Q2象限的时候，重点在于建立Q1象限和Q2象限的直接关联。这时候，功能上下文就起到了非常重要的作用。

那么今天我们就来看一看如何有效地划分功能上下文。

## 利用架构划分功能上下文

**划分功能上下文最简单的方法就是软件架构**。软件架构是软件系统的基本结构和组织方式，主要包括系统由哪些组件构成，以及各个组件之间的关系。在软件架构中，组件是指软件系统中具有明确功能定义和责任的模块。

因而，通过组件负责的功能单元就可以很容易地获得功能上下文。让我们看一个非常简单的例子：

![](https://static001.geekbang.org/resource/image/08/01/085ddcb769ec544b7f6c0d833a5de901.jpg?wh=1417x635)

这是一个非常常见的后端分层架构模式，核心的业务逻辑处在业务逻辑层中，业务逻辑层通过持久化接口访问数据，所有的逻辑通过HTTP接口暴露对外访问的API。现在，我们有一个业务场景需要使用这个架构模式实现。业务场景是“作为一个用户，我希望获取所有的在售商品，从而我可以选择我想要购买的商品”。
<div><strong>精选留言（5）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/3a/f9/69/106f4ff9.jpg" width="30px"><span>hakunamatata</span> 👍（1） 💬（0）<div>在买点咖啡的场景的中，可以按照消费者，咖啡馆服务员根据角色来划分上下文。</div>2024-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1c/cd/8d552516.jpg" width="30px"><span>Gojustforfun</span> 👍（0） 💬（0）<div>最后代码中注释有问题 ——&#47;&#47; 创建 ProductService 的替身

应该是创建ProductDAO的替身，创建ProductService的真是对象</div>2024-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/95/53/70a70139.jpg" width="30px"><span>咖啡</span> 👍（0） 💬（0）<div>在DDD架构下通过参与者的角色或者领域&#47;子域划分功能上下文感觉也行</div>2024-04-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f6/27/c27599ae.jpg" width="30px"><span>术子米德</span> 👍（0） 💬（0）<div>🤔☕️🤔☕️🤔
【Q】除了架构之外，还有什么划分功能上下文的办法？
【A】功能，它是钉子，它要技术的锤子，才能有用。可是，钉子死在田里，锤子窝在家里，两不相见，没用。
功能，它是穿线引针，技术，它是面料、它是里子、它是边角饰件。一件好衣服，需要好的料子、加上好引针、再加好穿线。穿过的每个点，都会发生事件（Event），连续的事件线串起来的技术，做成我们期待的系统。
因此，所谓的事件风暴法，我喜欢叫做穿针引线法，也是划分功能上下文的好法子。
— by 术子米德@2024年4月20日</div>2024-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f6/27/c27599ae.jpg" width="30px"><span>术子米德</span> 👍（0） 💬（0）<div>🤔☕️🤔☕️🤔
【R】划分功能上下文 简单法 软件架构。
Q1的可行需要依赖注入（Dependency Inject）和测试替身（Test Double）的加持。
哑（Dummy）&#47;有但不用，假（Fake）&#47;用随意值，存根（Stub）&#47;用特定值，间谍（Spy）&#47;记点东西，模拟（Mock）&#47;交互验证。
【.I.】单元测试，要Mock，这个太麻烦，这个引入很多工作量，这个没必要搞这么复杂，这个不靠谱，这个…，这么稀奇古怪的理由的潜台词，有两个：1）很明显，我根本不想单元测试；2）很隐晦，我根本没明白问题点在哪里。
我工作的单位是模块，一个有边界的模块，一个定义清楚接口和操作、其对象有状态切换的模块，那么我交付的模块，就是这边界定义清晰的模块，且，我能验证交付时模块具备的功能。
也就是说，在我出手交付前，我要对我的模块做验证，它是我的工作单元，于是我把这种模块级的验证，叫做单元测试。
【Q】单元测试，要进行哪些方面，或者说哪些维度的设计，是否有推荐的文章或书籍？
— by 术子米德@2024年4月19日</div>2024-04-19</li><br/>
</ul>