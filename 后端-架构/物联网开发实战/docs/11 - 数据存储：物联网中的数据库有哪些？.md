你好，我是郭朝斌。

上一讲，我讲解了物联网系统进行数据处理的思路和常用的开源框架。那么，这些数据要从哪里读取呢？还有，数据处理完成的结果要写入到哪里呢？这就涉及到数据存储方案。

跟灵活多变的数据处理框架比起来，数据存储方案要固定得多。

为什么这么说呢？因为确定了数据存储方案，其实也就确定了用来存储数据的具体软件。当系统开发出来并投入使用后，数据就会源源不断地流入软件存储起来。

当你因为存储软件的读写性能无法满足需求，希望重新做软件选型的时候，就会发现把数据从一种软件迁移到另一种软件是一件费时费力还容易出错的事情。它就像给飞行中的飞机换引擎，难度可想而知。

更何况数据是一种重要的**数字资产**，之前的数据公司是不能轻易丢弃的。

所以一旦确定存储软件，一般很难切换。这就要求我们做软件选型的时候，必须非常谨慎。因为一旦做出错误的决策，将来可能追悔莫及。

那么，怎么正确地选型呢？基本的原则还是我在第4讲中提到的，根据数据类型来选择。

数据大体上可以分为3类：

1. 结构化数据（Structured data）
2. 半结构化数据（Semi-structured data）
3. 非结构化数据（Unstructured data）

这一讲，我会一类一类地为你介绍选型经验。
<div><strong>精选留言（12）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg" width="30px"><span>YueShi</span> 👍（11） 💬（1）<div>NewSQL: 对ACID有严格的要求, 并发量特别大的场景, 
NoSQL: 数据查询量远大于写入更新, 

还有NewSQL一般对硬件要求比较高, 成本较高</div>2020-12-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/04/1c/15c00997.jpg" width="30px"><span>9ambition</span> 👍（5） 💬（2）<div>从处理性能看，选用不同数据库的前提是搞清楚自己需要的数据属于什么类型的。
如果是存储具有强一致性，或者说存储的数据具有典型的结构化特征，就很需要用结构化型数据库，老师之前也讲到过，数据量不是特别大的时候，其实用不用分布式关系数据库都ok，但是如果数据量很大很大，需要在很大的数据量中查找某一个特定的结构化数据，就可以用分布式结构化数据库以提升查询和存储速率。
如果存储的数据类型是可用“键”-“值”结构表示的，用半结构化数据库存储就可以，但是话说回来，其实很多结构化的数据也还是可以用半结构化的方式表示，所以有的时候两者混用也是ok的。（至少从实战角度看）
如果存储的数据不是结构化数据，也不是“键”-“值”结构的数据，就可以用分布式文件系统来读取和存储。

如果要横向比较的话，我会觉得用半结构化的处理效率会比结构化快，因为结构化就需要先锁定表，然后再去访问某一列，再锁定某一行。而半结构化只需要锁定“键”，就可以直接访问对应的值。分布式文件系统没有用过，所以不是很懂。

从成本来看，我首先会去看数据库是否开源，其次是使用人群规模，一般来说用得多还开源的想必对电脑的要求不会太高。</div>2021-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/36/59/221376c1.jpg" width="30px"><span>PM Silence</span> 👍（2） 💬（1）<div>作为小白，大只能这样理解吗？
在业务体系复杂，却又包含多种关联的时候，可以使用NewSQL，比如多条业务线，需要调用订单模块，订单又要与支付产生关联。这些数据结构相对比较结构化，但是关联关系又很多，所以用NewSQL合适一些。

比如烟感、地磁、水浸等设备可以用NoSQL，因为不同设备数据结构略有不同，相同产品不同型号可能也不同，使用NoSQL可以较好解决数据兼容问题。

音视频这种非结构化数据使用分布式文件系统，但是在一些场景下，例如安防监控、交通监控之类的，想从数十小时内找到目标内容很费劲，所以很多科技在致力于非结构化数据结构化处理，满足快速检索的需求。</div>2020-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg" width="30px"><span>小可</span> 👍（0） 💬（1）<div>老师请教个问题，除了数据本身存储选型，针对每个设备每天每种数据类型数据量的统计，比如20万设备5种类型保留30天，也就是3000w数据量，该选什么存储？统计粒度再细一点到每小时保留7天，也就是1.7亿又该选什么存储？</div>2021-02-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/2a/48/791d0f5e.jpg" width="30px"><span>Rovebiy</span> 👍（0） 💬（1）<div>老师，你好，我觉得postgresql数据库就很适合，除了分布式，其他场景都可以应用，为什么没提到呢</div>2020-12-14</li><br/><li><img src="" width="30px"><span>Geek_9b7997</span> 👍（0） 💬（2）<div>请问下，时序数据库不是应该归类到非关系型数据库吗？</div>2020-12-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3e/3c/fc3ad983.jpg" width="30px"><span>佳伦</span> 👍（2） 💬（0）<div>最近四维纵横的matrixdb挺火的</div>2021-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/d0/ce/a81126ea.jpg" width="30px"><span>代先生。</span> 👍（1） 💬（1）<div>请问Clickhose不推荐吗？</div>2022-03-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e6/3a/991c0e7a.jpg" width="30px"><span>班戟鱼</span> 👍（0） 💬（0）<div>有一个疑问，hdfs不是不适合存储海量小文件吗？如果图片文件都很小，hdfs存储是否就不太合适了
</div>2023-07-06</li><br/><li><img src="" width="30px"><span>Geek_scorpio</span> 👍（0） 💬（0）<div>这一讲特别有感受，在数据存储和数据未来的处理读取上，我们也是升级改良了几版本。
现在是Sharding-JDBC在MySql的基本上做水平扩展，并对价值比较高的时序报警做存储，并生成统计类分片表。
而各种设备的时序数据依托唯一键值，以JSON的方式存储进MongoDB中，当后续Spark进行离线批处理的时候，再按唯一键读取进行统计分析。
现在成本还比较小，也想过利用NewSQL来升级MySql，但是部署成本上确实要高不少</div>2022-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg" width="30px"><span>面试官问</span> 👍（0） 💬（0）<div>NoSQL 数据库类型中，ES 应该也是一个不错的选型。</div>2022-11-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg" width="30px"><span>最初的印象</span> 👍（0） 💬（0）<div>时序数据还有TDEngine</div>2022-08-31</li><br/>
</ul>