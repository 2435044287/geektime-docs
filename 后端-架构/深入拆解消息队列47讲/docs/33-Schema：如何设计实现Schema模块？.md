你好，我是文强。

这节课我们来看看消息队列中的 Schema 模块。看到 Schema 这个词，你可能会有点陌生，从而产生一些疑问。比如Schema是什么？它有什么用？什么时候可以用到它？这节课我们就重点解决这三个问题。

## Schema 是什么

Schema 翻译过来是“模式”的意思。它表示的是**数据结构定义**，即定义数据是什么格式的。

如下图所示，默认情况下消息数据在生产者、Broker、Consumer 的全流程中，代码层面没有对消息内容格式进行限制或校验。

![](https://static001.geekbang.org/resource/image/0f/59/0f757ba92e14a277dfb7276547fe7459.jpg?wh=10666x2707)

因此存在的问题是：消费者和生产者需要线下对齐数据格式，然后消费者根据约定的消息格式编写相应的处理逻辑。当生产端的数据格式或者某个字段的数据类型发生变化时，如果没有及时通知下游消费者，消费者就会无法解析数据，导致数据消费异常。

Schema就是用来解决全流程中的数据格式的规范定义问题，即**保证上下游数据在传递过程中，消息可以根据指定的格式和定义进行传递**。

举个例子，在订单场景中，一般通过消息管道传递订单数据，实现系统解耦。因此每个订单数据必须包含订单ID（OrderID）字段，否则下游就无法处理。此时就可以启用Schema，在生产端规范数据传递，在Broker端进行数据校验，在消费端根据指定的格式进行数据解析。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="" width="30px"><span>Geek_ec80d2</span> 👍（2） 💬（0）<div>pulsar并没有使用独立的注册中心</div>2023-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cb/92/cfc1cfd3.jpg" width="30px"><span>贝氏倭狐猴</span> 👍（1） 💬（1）<div>已个人经验，schema，尤其是强制schema验证还是会让使用方不太适应。一方面，用户不习惯于这种强制校验方式，经常忘记，出错才发现并让管理员关闭；另一方面，shema属于业务接口范畴，是否需要绑定在中间件里面，这个有点跨层，举例：schema应和具体消息中间件选型无关，但存储schema则难以迁移。</div>2023-09-04</li><br/>
</ul>