你好，我是文强。

我们接着上节课的内容，继续来看如何构建集群，我们先来看元数据存储服务的设计选型。在消息队列的集群架构中，元数据存储服务的选型和实现是整个架构设计的核心，其他模块的设计实现都是围绕着元数据存储服务来展开的。

## 元数据存储服务设计选型

在上节课我们讲到过，业界主要有基于第三方存储引擎和集群内部自实现元数据存储两种方案。我们先来分析一下这两种方案的具体实现。

### 基于第三方存储引擎

这个方案最重要的一件事就是**组件选型**。

从技术上来看，一般只要具备可靠存储能力的组件都可以当作第三方引擎。简单的可以是单机维度的内存、文件，或者单机维度的数据库、KV存储，进一步可以是分布式的协调服务ZooKeeper、etcd等等。

正常来讲，大多数消息队列只会支持一种存储引擎，因为一种存储引擎基本够用了。但是也会有如 Pulsar 支持插件化的元数据存储服务，用来简化不同场景下的部署成本，比如单机运行、测试集成、现网部署等等。

从分布式的角度来看，单机维度的存储能满足的场景有限，也会有单机风险。所以业界主流的分布式消息队列都是选用分布式的协调服务，如 ZooKeeper、etcd 等来当集群的元数据存储服务。所以基于第三方存储引擎的集群架构图一般是下面这样子。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg" width="30px"><span>张申傲</span> 👍（2） 💬（1）<div>请问下强哥，在Kafka KRaft这类架构中，Controller-Broker节点的职责会不会过重呢？
它相当于Metadata Service Leader + Broker集群的Controller双重角色，既要管理元数据信息，又要维护Broker集群的状态和数据同步，感觉Controller-Broker的负载会有点高。
这种集群内部实现元数据服务的架构，有没有可能把两类职责拆分开呢？比如Broker-1作为Broker集群的Controller，Broker-2节点作为Metadata Service的Leader？</div>2023-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/3a/7f/09/791d0f5e.jpg" width="30px"><span>Geek_03a4d8</span> 👍（0） 💬（0）<div>请教一下强哥。Kraft需要用配置文件去指定节点，这个配置文件是类似业务开发中的远程配置文件一样能让kafka集群感知的吗？
那这样的话是不是每个节点都要有一份相同的配置文件？
扩缩容的话是不是需要手动修改这份配置文件了？</div>2024-05-12</li><br/>
</ul>