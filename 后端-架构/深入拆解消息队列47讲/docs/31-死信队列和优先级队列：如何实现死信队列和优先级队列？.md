你好，我是文强。

在日常业务的消费数据过程中，如果遇到数据无法被正确处理，就需要先手动把消息保存下来然后ACK消息，这样才能顺利消费下一条数据。此时如果消息队列拥有死信队列的功能，就不需要这么繁琐的操作，直接开启死信队列就可以实现同样的效果。另外，当我们需要在业务中对消息设置优先级，让优先级高的消息能被优先消费，此时就需要用到消息队列中优先级队列的特性。

为了让你了解死信队列和优先级队列这两个功能特性的底层实现，这节课我们会详细分析它们的技术方案，学完之后，想必你对这两个功能的认识会更加深刻。

## 什么是死信队列

从本质上来看，死信队列不是一个队列，而是一个功能。为什么这么说呢？

![](https://static001.geekbang.org/resource/image/6f/53/6f9cd72d80d565db20d9f20345be8e53.jpg?wh=10666x3388)

参考图示，在实际业务场景中，死信队列一般有以下三种形态：

1. 在生产端，如果数据写入某个Topic一直失败，则生产端可以将数据临时写入到另外一个Topic，这样可以避免后续数据写入阻塞。
2. 在Broker端，如果存储在Topic的数据到过期后还没被消费，则可以将这些数据写入到另外一个Topic中，这样可以避免数据丢失。
3. 在消费端，如果消费者消费到某条数据后本地处理一直失败，消费就会阻塞，此时可以将这条数据投递到另外一个Topic中，这样可以避免消费阻塞。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="" width="30px"><span>TKF</span> 👍（0） 💬（0）<div>老师，pulsar也有消费端的死信队列。</div>2024-08-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg" width="30px"><span>| ~浑蛋~</span> 👍（0） 💬（1）<div>文中说的优先级索引的方案怎么管理消费位点呢</div>2024-01-15</li><br/>
</ul>