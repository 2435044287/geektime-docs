你好，我是徐逸。

通过上节课的学习，相信你已经清楚，当下游服务过载时，借助熔断和降级机制，我们能够有效提升服务的稳定性。不过，换个角度看，倘若我们自身作为其他服务的下游，在面对可能出现的突发流量时，怎样才能有效避免自身服务陷入过载状态呢？

今天，咱们就来聊一聊，当上游服务的调用流量突然增加时，如何保障我们的服务不出现过载的状况。

## 什么是服务限流？

我们知道，许多热门旅游景点会通过限制门票销售数量来控制景区的人数。当门票售罄后，后续的游客需要等待或改日再来。这种限流措施可以有效避免景区内过度拥挤，确保游客的安全和体验。

与之相似，在秒杀、大促抢购这类场景中，为避免超出预期的流量冲击，导致服务出现过载、性能下降乃至崩溃的状况，我们通常会给服务添加限流机制，**限制服务在单位时间内处理的请求数量，当请求量超过预先设定的阈值时，就直接拒绝超出部分的请求**。正如下方图示所呈现的，一旦触发限流，前端便会显示 “活动太火爆啦，请稍后重试” 之类的提示文案。

![](https://static001.geekbang.org/resource/image/e4/bd/e484b38d31f1b3a470a2c1c2d60b3bbd.jpg?wh=2026x1418 "图1 秒杀限流")

## 如何实现服务限流？

知道了什么是服务限流，那么我们该如何实现限流机制呢？

### 限流算法

首先，我们来一起看看常见的限流算法，主要包括下面四种。

先来看固定窗口算法，也称为计数器算法。就像下面的图展示的一样，计数器算法需要设定一个固定的时间窗口，在这个时间窗口里，每收到一个请求，计数器就加 1 。当计数器的值达到设定的限流阈值时，这个时间窗口内后续收到的请求就会被限流，直接拒绝或者排队，直到进入下一个周期后，计数器重置为 0，重新开始计数。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/27/19/fe/d31344db.jpg" width="30px"><span>lJ</span> 👍（0） 💬（1）<div>老师，限流算法有哪些推荐的开源库</div>2025-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e9/26/472e16e4.jpg" width="30px"><span>Amosヾ</span> 👍（0） 💬（1）<div>老是，请问“本服务集群名称”和“上游服务集群名称”这两种限流方式，在实际业务中使用的多吗？目前成熟的框架中是否有集成这部分功能的？此外，自适应限流算法有成熟的应用吗？</div>2025-02-08</li><br/>
</ul>