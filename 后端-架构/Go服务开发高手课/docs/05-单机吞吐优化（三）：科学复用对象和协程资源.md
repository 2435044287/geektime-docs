你好，我是徐逸。

上节课我们学习了几个高性能数据处理的技巧，它们能有效降低单个请求对 CPU 和内存资源的消耗，提升单机吞吐。

今天呢，咱们来聊聊另一种优化技巧 —— 资源复用。当我们在处理请求的时候，对于用完的临时对象或者协程，可以不立马销毁，而是把它存起来。等到处理其他请求的时候，我们可以直接复用之前创建好的对象或者协程。这样可以避免频繁地创建和销毁消耗CPU，让更多的CPU资源用于运行业务逻辑代码，提升单机吞吐。

在我开始讲具体的资源复用技巧之前，你可以先琢磨一下，要是我们不停地创建临时对象，Golang 运行时的哪些操作会消耗 CPU 资源呢？

## 对象池：如何避免频繁分配相同类型临时对象的开销？

实际上，如果频繁创建临时对象的话，Golang 运行时会在下面这两个操作上产生较大的开销。

首先是内存分配。我们不停地创建对象时，就得不断地在堆里面找空闲的内存块，然后进行分配。这就像是在一个大仓库里，每次创建新对象都要重新找地方放，这个过程是很消耗资源的。

再就是垃圾收集（GC）。要是临时对象很多，那在进行垃圾收集的时候，就需要耗费更多的 CPU 资源去扫描这些对象，看看哪些没用了，然后清理掉。这就像大扫除的时候，如果杂物太多，打扫起来就会更费劲。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/27/19/fe/d31344db.jpg" width="30px"><span>lJ</span> 👍（4） 💬（1）<div>数据库连接池，使用 database&#47;sql 包时，可以配置连接池来复用数据库连接，减少连接创建和关闭的开销。
HTTP 连接池，使用 http.Client 时，可以通过设置 Transport 来配置连接池，减少创建新的 TCP 连接的成本。
IO 操作的缓冲，使用 bufio 包中的 Reader 和 Writer，它们可以缓冲 I&#47;O 操作，从而减少系统调用的次数，提高性能。</div>2024-12-18</li><br/>
</ul>