你好，我是徐逸。

上节课我们学习了如何拆分项目，不过对于复杂系统来说，即便拆分了项目，每个子项目里的文件庞大且复杂，管理和维护都非常困难。这时候我们就需要学会如何抽丝剥茧，为这样的文件建立一个合理的目录结构。

今天我就用分层架构的思想，带你将一个包含订单、商品、用户业务逻辑，有好几万行代码的大文件，一步步重构成一个合理的项目目录结构。

![](https://static001.geekbang.org/resource/image/8c/28/8cc028f145d569d098502218b3f9e328.jpg?wh=3218x1423 "图1 逻辑复杂的大文件 main.go")

假如现在产品提了个需求，在获取用户订单的时候，需要将订单涉及的商品信息一起返回给前端展示。

为了找到修改点，我们需要从几万行代码的大文件里面，找到获取订单逻辑。这是一个效率非常低的事。我们要么从main.go文件的开头，一行行浏览代码，找到获取订单逻辑。要么通过order关键词进行搜索。但对于有几万行代码的文件来说，可能会搜索出来大量的order关键词，需要一个个去辨别。

有什么方法能快速定位到订单获取业务逻辑呢？

## 三层目录结构：数据访问逻辑复用

我们可以把接口里面的业务逻辑从main.go文件拆出来，并把业务逻辑按业务功能归类到一个个文件里，比如下面的order\_handler.go、product\_handler.go文件。再将这些文件放到handler目录中。

```shell
.
├── go.mod
├── go.sum
├── handler
│   ├── init.go
│   ├── order_handler.go // 订单逻辑
│   ├── product_handler.go // 商品逻辑
│   └── user_handler.go // 用户逻辑
└── main.go
```
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/17/e9/26/472e16e4.jpg" width="30px"><span>Amosヾ</span> 👍（0） 💬（1）<div>老师，四层目录结构的“数据持久层（DAO）”和“通用处理层（Manager层）”是不是可以统一归属为repo层呢？因为都是对第三方系统的依赖，repo层之上是业务逻辑，再之上请求处理层。</div>2025-01-14</li><br/>
</ul>