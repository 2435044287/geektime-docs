你好，我是徐逸。

在上节课的内容中，我们一起学习了网络编程技术，并了解了框架底层不同的网络IO模型是如何影响到服务性能的。

不过呢，当服务调用的IO延时比较长时，除了框架本身网络IO模型的优化之外，我们还可以使用其它方式，来降低服务调用的网络IO延时。今天我就来聊聊如何在不改业务代码的情况下，降低服务调用的IO延时。

## 跨机通信优化

就像下面的图展示的一样，两个服务之间的请求调用会经过网络上的很多节点。服务之间的物理距离越远，经过的网络节点越多，两个服务之间的网络通信延时就会越高。

![](https://static001.geekbang.org/resource/image/ba/e3/bae050cb46e8b90ed4bddd76d1593ae3.jpg?wh=4217x762 "图1 服务调用网络链路")

因此，为了降低网络IO的延时，咱们的第一个优化思路是——让通信的Client和Server物理距离尽可能近一点。怎么才能达到这一目标呢？

为了让进行通信的Client和Server尽可能近，在流量调度上，我们可以采取下面两个优化策略。

第一个策略是，当两个服务在多地域有部署时，Client和Server**不进行跨地域调用**。比如，以下面的图为例，服务A在华北区域的服务器，只调用服务B在华北区域部署的服务器，尽量不要跨地域去调用服务B在华东区域部署的服务器。

![](https://static001.geekbang.org/resource/image/67/c5/67c7905091e2089b4c37cc66d69245c5.jpg?wh=1289x886 "图2 同地域调用")

当然，如果同地域内的下游服务出现故障或不可用时，在延时满足要求的情况下，出于容灾上的考虑，我们可以允许短期的跨地域调用。  
![](https://static001.geekbang.org/resource/image/5f/c2/5f9f60dafe887a86cf60c95092d732c2.jpg?wh=2413x1805 "图3 跨地域容灾调用")
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/27/19/fe/d31344db.jpg" width="30px"><span>lJ</span> 👍（2） 💬（1）<div>合并编译在微服务架构中并非一种普适的优化手段，而是针对特定场景下服务优化的一种策略。
从《字节跳动合并编译实践》中的收益公式来看，合并编译的收益与服务的资源量、调用关系的密切度、编解码开销以及服务治理开销密切相关。适合合并编译的服务需要符合「资源量大、调用关系密切、编解码开销大」这些条件外，还要满足非缓存、固定开销类型的服务、容器负载不能太高、编解码大于 3% 的服务。
合并编译能够带来一定的性能提升，但也并非没有局限，它破坏了服务自治、可扩展性和故障隔离设计原则。</div>2024-12-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/d3/b5896293.jpg" width="30px"><span>Realm</span> 👍（0） 💬（1）<div>思考题：
1. 不符合统一的规范；
2. 不便于横向扩容；

请教老师，编译成rpc服务和编译成sdk，源代码层面需要修改什么吗？
</div>2024-12-30</li><br/>
</ul>