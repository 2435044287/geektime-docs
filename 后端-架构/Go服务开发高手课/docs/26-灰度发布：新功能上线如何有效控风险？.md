你好，我是徐逸。

通过前面课程的学习，相信你已经从编码和架构层面，熟练掌握了提升服务稳定性的多种方法。然而，即便我们再小心谨慎，在快速迭代的开发环境中，也难以完全避免忙中出错的情况。因此，为了防止有缺陷的代码或配置直接上线，对大量用户造成不良影响，我们还需要一些能够在小范围内发布新版本，并且能快速回滚的部署策略。

今天这节课，我们就来聊一聊业界常见的几种部署策略。

## 部署策略

当服务新版本准备上线时，为了确保新旧版本能够顺利切换，业界有下面几种常用的部署方式。

首先是**停机部署**。在这种部署方式下，在发布新版本时，我们需要先停止服务的运行，待新版本的代码和配置准备好之后，再重新启动服务。

停机部署过程相对简单，不需要复杂的流量切换和分批更新过程。但是系统在部署期间完全不可用，而且一旦出现问题，就需要重新停机部署旧版本，不能快速回滚。因此，停机部署常见于对系统可用性要求不高的系统，在业务低峰期进行版本升级。比如一些政府网站、小型企业或内部系统的更新，在发布版本前会提前发出停机部署公告，类似下图。

![](https://static001.geekbang.org/resource/image/83/11/83c361e501eac53f7b07f4d339c9fe11.jpg?wh=4321x2563 "图1 停机维护公告")

接下来，我们来看下**蓝绿部署**。在实施蓝绿部署时，除了正在运行稳定版本代码的线上蓝环境外，我们还需要搭建一套全新的绿环境，并且将绿环境中的代码更新为即将发布的新版本。当在绿环境中的各项测试与验证都确认无误后，再通过流量调度，逐步将线上流量从蓝环境切换到绿环境。