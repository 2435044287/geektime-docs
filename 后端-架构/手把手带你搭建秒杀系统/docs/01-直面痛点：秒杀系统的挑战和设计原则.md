你好，我是志东，欢迎和我一起从零打造秒杀系统。

每年的618、双11都是电商平台的狂欢日，各种营销活动、营销方式层出不穷，而秒杀就是其中最重要的手段之一。飞天茅台、华为手机、高端显卡等热门商品的抢购活动，即使你没有抢过，也或许听过，这就是秒杀带来的影响力。用具有价格优势的稀缺商品，来增加电商平台的关注度，带来空前的流量，进而可以为平台的拉新带来新助力，如果再辅以其他营销手段，比如抢购资格限制VIP等，那么这又是一笔可观的创收。

所以在当下这个流量为王的网络时代，能够提供秒杀的营销手段，就显得异常重要，这也是我们为什么需要做秒杀系统。

当然，实现一个秒杀系统也并不是那么容易的事，要考虑的点有很多。比如，我们首先要知道秒杀活动的业务特点，其次是要清楚秒杀系统的请求链路，这样才能根据其特点，针对请求链路中可能存在的瓶颈点做优化与设计。除此之外还有很多其他问题，我会在之后的课程中一一详解。

那么作为专栏的第一课，为了让你对秒杀系统有一个整体的认知，接下来我们就综合看一下当下秒杀系统都存在哪些挑战，以及所要遵循的设计原则，这些可以为我们后面的实战打下一个很好的基础。

## 秒杀怎么玩

我先简单介绍下秒杀业务具体是怎么玩的。
<div><strong>精选留言（12）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/26/2f/d9/fa6b654a.jpg" width="30px"><span>彼岸</span> 👍（8） 💬（1）<div>1：秒杀系统和其它业务系统隔离。
2：扣减库存，不能超卖。
3：防止非法用户刷单。
4：降级，熔断。</div>2021-09-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/44/d8/1a1761f9.jpg" width="30px"><span>James_Shangguan</span> 👍（5） 💬（1）<div>秒杀系统会进行压测吗？压测值要如何评估和设定？希望老师指点</div>2021-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/cb/66/c34226a9.jpg" width="30px"><span>非墨</span> 👍（4） 💬（1）<div>1、瞬间高并发；
2、活动页面静态化（减少不必要的服务端请求）；
3、使用CDN加速（全称是Content Delivery Network，即内容分发网络），降低网络拥塞，提高用户访问响应速度和命中率；
4、可以使用分布式锁、缓存预热等方式避免大量请求同时访问数据库，
5、扣减库存问题，可以通过在redis中写lua脚本来避免超卖等问题
6、限流：对同一用户限流、对同一ip限流、对接口限流、加验证码、提高业务门槛等</div>2021-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/06/32/3de6a189.jpg" width="30px"><span>范</span> 👍（4） 💬（2）<div>以上的都是基于明确有商品要秒杀而去搭建系统。而对于某些突然火爆的商品（预期之外的），系统层面应该做哪些预备方案？</div>2021-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/47/a3/588eed0a.jpg" width="30px"><span>lingo</span> 👍（2） 💬（1）<div>老师，流量激增和热点都是 主要是读 请求吗？
下单和和抢购 这两个写 操作 之前都会对其进行限流吗 ？是可以理解为 抗住大量查询  减缓写到数据库的压力</div>2021-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2a/41/6116db1b.jpg" width="30px"><span>yz</span> 👍（1） 💬（1）<div>瞬时流量之后的数据怎么存储，如何做补偿</div>2021-09-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/78/5d/39975064.jpg" width="30px"><span>🔥 Amber_Mao</span> 👍（0） 💬（1）<div>请问整个课程时长多少？怎么联系销售呢？</div>2021-09-23</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erpYAcOqrNNxmMuKsd6Dh69BzxiaXjJRh6IMnQlxOqBFiae1EMic32Wv6aFESWytliaL7uniaZ4DgNUwxg/132" width="30px"><span>黄序</span> 👍（21） 💬（1）<div>根据自己对于秒杀业务的了解，除了瞬时的流量，还需要考虑如下的点：
1）秒杀系统从入口到流量都需要与普通的入口进行隔离，防止系统间的影响；
2）需要实现多地多机房部署，保证系统的高可用；
3）实现分布式事务，保证用户下单、库存、扣款等操作的事务性，防止出现超买超卖问题；
4）增加风控能力，防刷；
5）增加限流、熔断和降级方案；
6）热点商品的自动发现与自动预警机制；
7）人工补偿机制</div>2021-10-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/39/92/88ed94f2.jpg" width="30px"><span>YX</span> 👍（1） 💬（0）<div>**1）秒杀业务逻辑是怎样的？**

- 商家拿出稀缺商品，事先在秒杀的运营系统中设置好活动的开始、结束时间，以及投入的库存。
- 活动开始之后，用户可以通过活动抢购入口（商品详情页或者链接），进入到活动的结算页，然后点击下单，完成商品的抢购

![img](手把手带你搭建秒杀系统.assets&#47;380d9ea5bbaeb991d2fcdf87bd1bd773.jpg)

**2）如果想对流量有个预期上限，方便做备战工作，那么应该怎么做？**

- 加上预约功能，预约的才有抢购资格

**3）如果业务场景更加复杂怎么办？**

- 联合风控，在参加活动时校验用户资质，踢掉黄牛以及有过不良行为的人，尽量将资源给到优质用户。

**4）如果业务再复杂些呢？**

- 可以搭配限购开展活动，控制个人维度下一段时间内的购买数，让抢购成功的快乐触达更多的人。

**5）秒杀系统面临的挑战有哪些？**

- 巨大的瞬时流量
  -  短短几秒中，几十上百万的流量
- 热点数据问题
  - 热门商品数据库的并发访问量太大，数据库，还是分布式缓存，都无法支持几十万、上百万对同一个 key 的读写
- 刷子流量
  -  刷子通过浏览器或是抓包工具拿到请求数据，自己通过程序实现接口的直接调用，并可以设置请求的频率。

**6）秒杀系统如何设计？**
**6.1）一次 HTTP 请求所经过的链路路径有哪些？**

**6.1.1）DNS的作用是什么？**

- 域名解析，将你的域名请求指定一个实际的IP来处理，一般浏览器会缓存这个IP一段时间。下次请求来的时候直接用这个IP来建立连接，就不用麻烦DNS了。

**6.1.2）Nginx的作用是什么？**

被 DNS 指定来处理请求的 IP

- 反向代理
- 负载均衡
- 也可以用来做静态资源服务器

- Nginx 接收到客户端请求后，根据负载均衡算法（默认是轮询）将请求分发给下游的 Web 服务。

**6.1.2）Web 服务的作用是什么？**

- 实际业务的增删改查都在这里

**6.1.3）RPC 服务的作用是什么？**

- 基础不牢，地动山摇。这个是实际业务的地基。仅供内部服务间调用，不对外开放，安全性高。

**7）用户的一次抢购过程中，每次和系统的交互都要做什么事情？**

商详页部分和支付页部分，对于一般平台来说，都是通用板块，而从“点击抢购”开始到“下单成功待支付”，这一段是属于秒杀系统的业务范畴。

**8)哪几件事情是需要秒杀系统来做的?**

- 提供活动数据
- 提供结算页
- 提供结算页页面渲染所需数据
- 提供下单：

**9）秒杀系统设计的基本原则有哪些？**

- 校验前置

- 分层过滤

</div>2022-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/1c/95/d25d96d7.jpg" width="30px"><span>游子</span> 👍（0） 💬（0）<div>nginx再强，一般单机只支持5万并发？千万级并发的请求，需要通过DNS分流，和专用LB服务器吧？</div>2022-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/07/4c/f9852f8f.jpg" width="30px"><span>骆驼、</span> 👍（0） 💬（1）<div>nginx+lua让我想起了apisix网关</div>2021-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg" width="30px"><span>风轻扬</span> 👍（0） 💬（1）<div>非常期待。很想知道为什么秒杀系统一定要引入nginx</div>2021-09-23</li><br/>
</ul>