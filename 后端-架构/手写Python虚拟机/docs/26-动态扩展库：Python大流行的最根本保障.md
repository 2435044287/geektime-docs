你好，我是海纳。

上一节课，我们初步构建了加载模块的能力。模块功能是现代语言的必备功能，只有通过模块组成的库，现代编程语言才有可能进行大规模的软件复用。

除了使用 Python 语言开发的库，还有一些功能是依赖于操作系统平台的，比如图形用户界面、文件、网络等功能。这些功能显然更适合以库的形式存在，而不是直接集成在虚拟机中。这一节课，我们就来研究虚拟机如何管理这种依赖于具体平台的动态库。

## 加载动态库

几乎所有的编程语言虚拟机都会支持使用 C++ 写扩展库，一是因为 C++ 的库非常多，很多十分重要的基础库，都是由 C++ 写成的，另一个原因是 C++ 及其编译器在性能方面的表现确实处于十分领先的位置，一些性能敏感的部分必须使用 C++ 来写本地扩展库。

注：关于动态链接的更多知识，请参阅[《编程高手必学的内存知识》](https://time.geekbang.org/column/intro/100094901?utm_campaign=geektime_search&utm_content=geektime_search&utm_medium=geektime_search&utm_source=geektime_search&utm_term=geektime_search&tab=catalog)。

这种扩展库往往是以动态链接库的形式组织的，在 Linux 上，动态链接库默认以 so 作为后缀，在 Windows 上，则多用 dll 作为后缀。当然，这种后缀名只是一种习惯，并不是强制的，我们完全可以把动态库的后缀改成其他的，并不影响库的正常加载和运行。

举个例子，如果我们想为某个虚拟机编写一些额外的扩展功能，第一种办法就是找到这个虚拟机的源代码，直接将这些功能写在虚拟机里，然后重新编译，得到一个新的虚拟机可执行文件。这种方式就是静态链接，它有两个缺点，一是代码的开发和维护非常困难，在动手修改虚拟机之前，要求开发者必须非常熟悉虚拟机的代码。二是扩展功能的部署、分发都非常困难，要使用新的功能就必须重新安装虚拟机。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/3b/59/44/727b90a8.jpg" width="30px"><span>冯某</span> 👍（0） 💬（0）<div>记录一下</div>2024-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2024-11-10</li><br/>
</ul>