你好，我是俊达。

在MySQL高可用架构中，备库延迟一直很重要。备库延迟会带来各种问题。在读写分离架构下，如果备库有延迟，读备库时就可能会读到陈旧的数据，影响业务。当主库发生故障，需要切换到备库时，如果备库有延迟，就需要先等备库执行完积压的Binlog，这会影响业务的可用性。

MySQL中Binlog复制和Binlog应用是分开的。使用半同步，或者使用MGR架构，也只是保证主库事务提交时，Binlog同步到了备库。备库上，SQL线程应用Binlog事件后，数据才真正能被访问到。

很多不同的原因会引起备库延迟，这一讲我们就来聊一聊备库延迟的一些原因，以及一些解决方法。

## 认识备库延迟

### 怎么查看备库延迟？

怎么判断备库有延迟，最简单的方法就是看show replica status中的Seconds\_Behind\_Source。如果Seconds\_Behind\_Source大于0，说明有延迟。但有时候，Seconds\_Behind\_Source并不一定可靠。

- 如果IO线程或SQL线程中断了，Seconds\_Behind\_Source显示为NULL。
- 级联复制架构下，一级备库上可能复制有延迟或中断了，但是二级备库上，Seconds\_Behind\_Source可能还是正常的。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/2a/39/93/f0247cf8.jpg" width="30px"><span>一本书</span> 👍（0） 💬（1）<div>假设事务在主库上执行了 N 秒，那么备库刚接收到 Binlog，开始执行时，延迟就是 N 秒了，如果备库上执行速度和主库一样，那么备库上延迟最高会达到 2N 秒。对于 DDL，如果使用单线程复制，备库上的延迟时间会从 0 秒开始，最高 N 秒。如果使用了多线程复制，那么备库开始执行 DDL 时，延迟可能就已经是 N 秒了，最高会达到 2N 秒。
老师，我对以上这个流程不是很理解，这里单线程复制与多线程复制的差异在哪里啊，前面说开始执行时，延迟就是 N 秒，那么延迟最低是N秒吧，但是为什么单线程复制时，延迟从 0 秒开始，最高是 N 秒呢？</div>2024-12-12</li><br/>
</ul>