你好，我是俊达。

为了实现事务数据的强一致性，group\_replication插件在事务的处理流程上，加入了一些特殊的处理逻辑。这一讲中，我们来大致地了解下组复制的一些实现细节。当然，由于组复制的实现比较复杂，这里只能介绍部分实现逻辑。

## MGR架构实现

MGR集群中，提交事务前，需要将事务广播到集群中，等集群中的多数节点接收到事务消息后，本地节点才能完成提交。

从流程上看，分为三个大的阶段。

**第一阶段：发送消息**

本地发起commit时，向MGR集群广播事务消息，消息中包含事务生成的Binlog和WriteSet。

**第二阶段：达成共识**

各个节点发送的消息，通过Paxos协议达成一致。达成一致的过程，也是对各个节点的消息进行全局排序的过程。各个节点会以相同的顺序来处理消息。比如在多主模式下，集群中的各个节点可以同时修改数据，各个节点的事务消息经过paxos协议处理后，在各个节点上会以同样的顺序执行。

**第三阶段：处理消息**

通过冲突检测的事务，在源节点上可以进行提交。在其他节点上，事务消息中的Binlog写入到Relay Log中。协调线程和Worker线程负责事务的应用。借助官方文档中的组复制的示意图，我标注了事务执行的三个阶段，你可以看一下。