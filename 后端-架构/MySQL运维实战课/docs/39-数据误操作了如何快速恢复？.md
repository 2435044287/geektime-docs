你好，我是俊达。

上一讲中，我们知道了如何使用Xtrabackup来备份数据库和恢复数据库。不管是全量备份，还是增量备份，实际上都只能将数据库恢复到一个固定的时间点，这个时间点就是Xtrabackup备份完成的那个时刻。

但是在现实中，数据恢复的要求往往会更高。假设我们每天凌晨都会备份数据库。某一天下午，由于误操作，某一个重要的业务表的数据被清空了。使用凌晨的备份文件，只能恢复一部分数据。从凌晨到误操作发生的那一刻，这个表上进行了很多DML操作，这部分数据如何恢复呢？

这一讲我们就来解决这个问题。根据误操作的不同情况，我们可以选择不同方法来恢复数据。

## Binlog备份

为了将数据库恢复到任意一个时间点，我们需要将Binlog也备份起来。如果Binlog没有备份，同时你又把Binlog删除了，那么就可能无法将数据恢复到这些Binlog覆盖的时间点。

备份Binlog实际上比较简单，一个Binlog，一旦完成切换，里面的内容就不会发生变化。你可以使用操作系统的命令，比如cp，将除了最后一个binlog之外其他Binlog，拷贝到备份空间。使用这种方式，无法实时备份最新的那个Binlog文件。极端情况下，如果这个时候数据库所在的服务器崩溃了，而且无法启动，那么你可能会丢失最后一个Binlog中的数据。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/2a/39/93/f0247cf8.jpg" width="30px"><span>一本书</span> 👍（1） 💬（1）<div>“如果备库本身存在延迟，那么备库上生成的 binlog 的时间戳和真实的业务时间可能存在偏差”，老师，针对这句话我有一些疑问，备库的 binlog 时间戳是binlog在备库中应用的时间点还是与主库保持一致？如果是跟主库保持一致，那就和真实的业务时间应该是一样的吧？gpt说备库的 binlog 时间戳通常与主库保持一致。
如果选择主备之前存在1分钟延迟，要备份12点的数据，而11：59到12点的数据没应用到备库上，备库的binlog也就没有这部分数据，从而用备库恢复会丢失这部分数据，所以达不到业务上的恢复目标，我猜测是老师想说的是这个意思？</div>2024-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/03/8d/38a98dc6.jpg" width="30px"><span>牧野静风</span> 👍（0） 💬（1）<div>有个问题，在使用binlog恢复过程中，这个库只能作为从库了吧，主库要切走之后才好操作，如果是主库，应用连着在写入，这块怎么处理，并且后续正常写入呢</div>2024-11-20</li><br/>
</ul>