你好，我是陈现麟。

通过学习“负载均衡”的内容，你知道了怎么评价一个负载均衡策略，以及针对不同的业务场景，应该怎么选择合适的负载均衡策略。现在，你已经能够顺利地解决分布式系统中，服务实例的选择问题，恭喜你又前进了一大步。

但是，随着极客时间分布式架构的逐渐演进，之前的单体服务慢慢被拆分为越来越多的服务，虽然拆分后的架构对公司研发的成本、效率和稳定性方面有着非常大的改进，可是你在系统运维的时候，特别是管理系统配置的时候，却发现效率越来越低了，并且还经常会出现因为配置问题导致的故障。

可能你很快就能想到这个问题产生的原因，因为在目前的分布式架构迭代过程中，极客时间的后端系统由之前单体架构的一个服务，被拆分成了多个服务，并且服务的数量还在继续增加。我们管理 1 个服务的配置是很轻松的，但是用管理 1 个服务配置的方法，来管理 10 个、20个甚至更多的服务配置，效率一定是非常低的，并且也避免不了出错。

虽然能想到原因，但是真正处理时，却不知道怎么做，你是不是也有这样的疑问呢？不要担心，在这节课中，我将和你一起来讨论在分布式系统中，我们应该怎么管理服务配置信息？

我们从分布式场景下，手动管理配置的问题出发，思考为什么需要配置中心，然后进一步讨论配置中心需要具备的功能，接着从存储系统的选择，配置信息的同步这两个方面，来结合业务场景实际讨论，解决如何实现配置中心的问题，最后再探讨一下，需要配置同时生效的场景下，如何确保配置信息的强一致性。
<div><strong>精选留言（10）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/0c/f7/d6547adb.jpg" width="30px"><span>努力努力再努力</span> 👍（6） 💬（2）<div>思考题：
其实就是 一个 数据一致性问题 ，关于共识算法
共识算法：
    1. Paxos （批量的Multi Paxos）
    2. Raft 算法。这种比较熟
    3.ZAB 算法
1. 如果允许 Prepare 状态的 Proxy 节点读，会出现什么问题？
     出去的数据 是旧的数据
     1.1 自己思路：这里是为了强一致性，如果不是强一致，其实感觉 有一个copy的数据 ，然后这边写完 再替换copy 其实是可以的
2. 如果允许 Prepare 状态的 Proxy 节点写，又会出现什么问题？
     并行走的有多个写操作，可能出现有时序问题
     2.1 自己思路： 如果是其他系统，可以使用mq 顺序消息 里面加一个时间戳的字段或者版本号 进行区分

我最近自己在玩计数服务，里面关于数据一致性 就用的是 2pc</div>2022-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg" width="30px"><span>bearlu</span> 👍（3） 💬（2）<div>如果我们选择 etcd 和 ZooKeeper，那么出现网络分区的时候，在网络分区的少数派节点一侧，配置中心将不能提供服务，这一侧的服务实例也就不能通过配置中心获取配置，这时如果有实例的重启等操作，就一定会发生故障。
老师。我这边有个问题。etcd分区后。只是不能写，但是读是应该可以，为什么不能提供服务呢？</div>2022-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg" width="30px"><span>青鸟飞鱼</span> 👍（1） 💬（1）<div>选择像Eureka这样子的AP系统，是最终一致性，不确定一致性的时间长短；像etcd出现网络分区时，少数节点的一边提供读服务，读的可能不是最新的数据。但是效果我觉得跟像Eureka差不多，因为不确定这个最终一致性的时间长度。</div>2022-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg" width="30px"><span>不吃辣👾</span> 👍（0） 💬（1）<div>老师 数据迁移的工作中为什么会有两个proxy呢？这两个proxy解决了什么问题？</div>2022-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（1）<div>请教老师一个问题：
在本章强一致性例子中，proxy不是配置中心，只是存储系统的proxy。图中没有画出配置中心。Proxy从配置中心获取配置信息。对吗？</div>2022-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg" width="30px"><span>Rayjun</span> 👍（2） 💬（0）<div>在 k8s 中，configMap 是否可以替代配置中心</div>2022-07-11</li><br/><li><img src="" width="30px"><span>鱼肥</span> 👍（1） 💬（0）<div>这一节有点抽象，是不是应该提一下阿波罗？</div>2023-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/bf/52/59304c42.jpg" width="30px"><span>默默且听风</span> 👍（0） 💬（0）<div>我们是用redis集群缓存，如果服务器扛不住的话，再自己往外弹。</div>2023-01-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/b9/3b/7224f3b8.jpg" width="30px"><span>janey</span> 👍（0） 💬（0）<div>思考题，eureka没用过，按照数据库的迁移尝试分析一下：
如果prepare时允许读，如果按迁移开始前的路由到proxy1,可能proxy1下对应存储的数据已经被迁走而读取不到数据失败；如果按迁移后的路由到proxy2,可能对应存储的数据尚未迁移到存储2而读取不到数据失败；
如果prepare时允许写，如果按迁移开始前的路由到proxy1,可能proxy1的对应存储已经迁走到存储2,写入失败或成功，但将来存储2丢失了这个写入，commit完成后，在存储2找实际写在存储1的数据失败；如果按迁移后路由到proxy2，可能相关的数据结构还不存在，导致写入失败，或者迁移后将写入给覆盖掉。</div>2022-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cf/5d/99756164.jpg" width="30px"><span>思绪走了灬光✨</span> 👍（0） 💬（0）<div>Eureka能做配置中心吗？不是只有注册中心的能力吗？</div>2022-04-08</li><br/>
</ul>