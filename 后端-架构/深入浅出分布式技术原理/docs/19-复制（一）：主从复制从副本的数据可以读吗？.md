你好，我是陈现麟。

通过学习“分片”的内容，我们使用分片技术，让数据按一定的策略分布到多台机器上，解决了极客时间用户量快速增长，导致存储或处理的用户数据量超过单台机器限制的问题。

但是，我们还不能高兴得太早，如果现在有一台提供数据服务的机器，由于宕机、网络不通等原因不可用了，那这一台机器上的所有数据分片就都不能被访问，这对于极客时间要求 7 * 24 小时提供服务的系统来说是不能接受的，而这就是我们工作中经常会涉及的高可用问题的场景。

那么从这节课开始，我们将一起花三节课的时间来解决这个问题。这一节课，我们先讨论让存储服务高可用的思路，接着讨论具体的解决方法，即数据复制的三种方案，最后学习第一种主从复制的基本原理，另外两种数据复制的方案在后面的两节课程中我们再来讨论。

## 如何让存储服务高可用

通过分析上文提到的场景，我们可以迅速锁定这是存储服务高可用的问题，解决高可用问题通常有两个思路：

**第一种思路是避免故障出现**。我们通过深入细节，一个一个去消除可能导致故障的原因，从而避免故障的出现，比如停电会导致宕机，那么我们就增加备用电源。但是这样，我们会遇到两个无法确定的问题：

- 我们可能无法穷尽所有的可能性，如果一个意料之外的问题出现了，故障就会发生。
- 我们虽然知道某些故障的原因，但是无法控制，比如机房会因为海啸、台风等自然不可抗力原因而宕机，在一定成本范围内，我们没有好的办法来防范。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/17/39/3274257b.jpg" width="30px"><span>ple</span> 👍（7） 💬（1）<div>细粒度方案中，【不论集群的机器的数量如何增加，副本的数量都不会改变，这样我们就可以通过增加机器，来提升整个系统整体的读写性能。】 ，这句应该是数据量持续增加的话 可以通过加机器，而不是加副本数量，提升读写性能么？</div>2022-04-19</li><br/><li><img src="" width="30px"><span>小达</span> 👍（4） 💬（1）<div>副本的数据读到的可能是旧数据，如果场景不要求数据必须是最新的就可以读。老师，是这样吗</div>2022-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（2）<div>请教老师几个问题啊：
Q1：异步复制从从副本读取时的版本号怎么实现？
文中提到，在异步复制的场景中，如果要通过从副本读取数据，一种方案是在读数据的时候给定一个版本号。请问这个版本号怎么实现？以MySQL为例，是每一个字段加版本号吗？好像不行。那是给每一行加版本号？如果是每一行加版本号，数据库中会存在多行不同版本号的数据吗？（对于一行数据，只要一个字段变化，就增加一行，用新的版本号标识）
Q2：多副本节点时，需要一个独立的调度器吗？
有主副本和多个从副本，可以从任意一个节点读取数据，那么，对于一次读请求，怎么决定从哪个节点读取数据？需要一个独立于这些主、从副本节点的调度器吗？另外，对于细粒度副本方案，更为复杂，也需要一个独立的调度器吗？
Q3：细粒度方案中，新数据会创建新数据块并增加机器吗？
文中的示例中，数据集为4*128M，占满了四台机器。那么，此时有新的数据后，怎么处理？因为机器已经占满，需要增加机器；其次，创建一个新的128M数据块，将此数据块存到新的机器上。是这样吗？
（文中的例子，副本数为3，至少增加3台机器）。</div>2022-03-16</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/SYxHx9k1fVAZGanCk5cFVdzFyhx2pkNk45RdH1Yo3ITBH7dCWjwzEzibAnZaXayqF1TibW6ynBkCqIOd6p1Yhlew/132" width="30px"><span>建锋</span> 👍（0） 💬（0）<div>无论是同步复制与异步复制，数据查询时，都会存在时延问题。对于写完立刻读的场景，都有可能读到的数据不一致。数据实时性要求高的场景可以指定主库读</div>2022-06-05</li><br/>
</ul>