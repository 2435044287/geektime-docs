你好，我是陈现麟。

通过上节课的学习，我们掌握了在可观测性体系中，监控的位置和重要性，以及设计一个监控系统的基本原则，这样我们就可以为极客时间搭建一个可观测体系，并且设计一个简洁有效的监控系统了。

但是，只有监控还是不够的，因为我们不能一直盯着监控系统，所以需要通过一些规则，自动从监控的信息中发现问题，实时通知给负责的工程师，让工程师实时接入来处理。

那么解决这个问题的有效方法就是告警，你作为工程师，应该收到过各种各样的告警信息，并且及时解决了很多线上问题。但是，你也一定收到过很多无效的报警信息，这些信息浪费了我们的精力；有时线上故障真的发生了，反而会出现收不到告警信息的情况，导致我们错过了最佳的修复时间。

其实这是因为告警系统的设计不够高效，那么在本节课中，我们将一起来解决这个问题。我们会先讨论一个告警系统的评价指标，然后基于我的亲身经历，来讨论如何进行告警的治理，最后再来总结告警系统的设计经验。

## 告警系统的评价指标

告警系统的作用是把线上已经出现，或即将出现的故障及时通知给我们，所以**一个理想的告警系统应该是不多报，不漏报，报对人**。即所有的通知都是有效的，是需要立即处理的；所有的故障或即将出现的故障，都有告警通知；所有通知的接受对象，应该是处理这个问题的最佳人选。
<div><strong>精选留言（9）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（2） 💬（3）<div>请教老师两个问题：
Q1：告警系统和可观测系统是两个独立的系统吗？
在可观测系统上添加告警功能，可以吗？
Q2：告警系统是从ELK中获取日志信息吗？
如果是，是将Logstash的数据直接导流到告警系统吗？或者从ES获取数据？如果不是，那告警系统是自己独立获取日志信息吗？</div>2022-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg" width="30px"><span>不吃辣👾</span> 👍（0） 💬（1）<div>思考题：我们的通知方式不是电话，收到告警后，针对核心服务，采用轮班制，每天一位责任人负责识别是否为有效告警，告警有效，催促别人的修复或者调整不合理的预警规则。针对非核心服务，就采用钉钉消息推送，靠个人自觉。</div>2022-04-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg" width="30px"><span>不吃辣👾</span> 👍（0） 💬（1）<div>老师，如果应用服务不在打印日志，有可能长时间gc，这种是否也应该告警一次？ 因为elk并不知道是因为服务宕机了还是触发了gc。</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg" width="30px"><span>不吃辣👾</span> 👍（0） 💬（1）<div>基于日志的告警，如果日志不再打印是不是可以认为服务不可用了，应告警。一分钟内两次这种告警就P0级别告警。</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/03/77/3f6a76a9.jpg" width="30px"><span>极客</span> 👍（0） 💬（1）<div>请教一个问题：
我们的业务是toB的，不同接入方申请的qps不同，我们基于当前的qps 同比前一分钟，对比昨天的qps来触发告警。

但是不同的接入方实际调用qps不同，比如我设置qps增量100%触发告警
A公司目前qps 1000,也就是到了2000要告警
B公司目前qps 10000, 不能到了20000才告警，期望在12000左右就要触发告警了（希望有个科学一点的公式）

不知道老师有什么经验吗</div>2022-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg" width="30px"><span>xmr</span> 👍（0） 💬（0）<div>转交率是指什么？没看懂</div>2023-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4b/d4/b7719327.jpg" width="30px"><span>波波安</span> 👍（0） 💬（0）<div>有些什么方法或者经验可以避免漏报呢</div>2023-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg" width="30px"><span>includestdio.h</span> 👍（0） 💬（0）<div>有个问题想请教下老师，我们目前是用告警监控增量，我觉得不太合理。具体是这样：比如一个机器的cpu常年cpu是30，然后设置一个阈值是40，如果超过40需要去确认下是否业务正常增量，如果是正常增量的话调高阈值，如果异常的话解决问题，但是这样搞的话 我觉得告警信噪比太低了，无效告警一大堆，影响业务的告警可能会被忽略，所以我的想法是cpu阈值全部调整到会影响业务的阈值，比如90 95，但是增量的监控我觉得也是有必要的，但是用告警的方法不太合理，哪怕是把告警等级降低 频率降低我也觉得不是很合理，毕竟这本质上不算“告警”，但是告警好像又是及时发现增量排除隐患的最快方法，以上是我目前告警收敛工作中遇到的障碍</div>2022-09-30</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/etgIh8kjicxzfBBTJ0GbecQJEEJqoKbhwgp05a1lGia07r6Cw9T5NyhMwBHTnxGjaXs5WHCBzowRDgkCRERot9BQ/132" width="30px"><span>罗东就</span> 👍（0） 💬（2）<div>告警精准推动到负责人，这个老师有什么思路吗</div>2022-08-12</li><br/>
</ul>