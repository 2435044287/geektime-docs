你好，我是陈现麟。

通过学习“数据复制”系列的内容，我们使用数据复制，将同一份数据按一定的策略复制到多台机器上，解决了存储服务由于宕机等故障，不能为用户提供服务和数据丢失的问题，恭喜你又攻克了一个难关。

但是，由于极客时间用户量增多，每一天课程购买的订单数都在急剧增加，你开始接到用户这样的投诉，他在购买课程时出现了错误，课程没有购买成功，但是余额却被扣了。同时，财务的同事也开始向你反馈，他们在算账时，发现收入和支出的数目对不上。在遇到这样的问题时，你是不是一时抓不到头绪呢？其实这些都是我们工作中经常碰到的**事务场景**问题。

那么从这节课开始，我们将一起花四节课的时间来解决分布式场景下的事务问题。这一节课，我们先通过分析业务场景来讨论事务是什么，以及它可以解决的问题，然后学习它的四个特性：一致性、原子性、隔离性和持久性，最后再一起来讨论如何实现事务的一致性。

## 事务是什么

在本课开头，我们列举了工作中经常碰到的两个事务场景问题，那么我们先来了解一下事务是什么？**事务可以看成是一个或者多个操作的组合操作，并且它对这个组合操作提供一个保证，如果这个组合操作之前的数据是一致的（即正确的），那么操作之后的数据也应该是一致的**。不论这个组合操作执行的过程中，是否发生系统故障，还是在这个组合操作执行的过程中，是否与其他事务一起执行。
<div><strong>精选留言（6）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg" width="30px"><span>不吃辣👾</span> 👍（13） 💬（2）<div>数据一致性是对复制而言，无偏差复制。事务一致性是对业务而言，符合现实逻辑。</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg" width="30px"><span>李二木</span> 👍（1） 💬（1）<div>感觉并发例子举得不妥。并发流程图里表示的串行执行。这里要加个锁什么的吧？</div>2022-03-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/1a/17/9e925f61.jpg" width="30px"><span>雾都</span> 👍（1） 💬（1）<div>我觉得是两个概念，举个栗子，我账户余额10，小明账户余额5，现在我要给小明转一块钱，在主副本中写入我账户余额9，小明账户余额5，主副本同步数据到从副本，我账户余额9，小名账户余额5。上述情况中，事务一致性没有得到保证，但是数据一致性得到了保证。</div>2022-03-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/41/f3/8bca4aba.jpg" width="30px"><span>普通熊猫 ଘ(੭ˊ꒳​ˋ)੭✧</span> 👍（0） 💬（1）<div>ACID四个特性，A是目的，I是手段，D是容灾。只有C，没有一家数据库实现了，也不可能单独靠数据库保证，所以说C就是打酱油的</div>2022-03-23</li><br/><li><img src="" width="30px"><span>Geek_8b0800</span> 👍（0） 💬（0）<div>老师，我的疑问如下：
有了底层存储多副本数据强一致性的支持，以及事务三个特性的保驾护航，不能够保证一定满足数据库层以及业务层的约束规则吗？为什么还有进行约束检测呢</div>2022-08-26</li><br/><li><img src="" width="30px"><span>Geek_8b0800</span> 👍（0） 💬（0）<div>老师，我有一个疑问：有了底层存储多副本数据强一致性的支持，以及事务三个特性的保驾护航，那么为什么还要做数据库层以及业务层的约束规则，所以最后我们要做好约束检测。这里又分为如下两个层面来讨论。</div>2022-08-26</li><br/>
</ul>