你好，我是钟敬。

上节课咱们完成了事件风暴，梳理了系统的行为需求。但你可能也发现了，其实还有些微妙的业务概念还没有澄清，这就要靠领域建模来完成了。

建立领域模型是DDD的核心。要建好领域建模，需要理论和实践相结合。由于我们的模型有一定的复杂性，所以我把领域建模的实践分成两节课。完成实践以后，我们会再用一节课，从理论层面让你进一步深化对领域建模的理解。

今天这节课，我们先通过租户、组织和员工这几个部分学会基础的建模方法。

## 领域建模中的一些基本概念

我们先来理清领域建模中的一些基本概念，方便你理解下面的建模实践。领域建模主要有两个目的：

- 将知识可视化，准确、深刻地反映领域知识，并且在业务和技术人员之间达成一致；
- 指导系统的设计和编码，也就是说，领域模型应该能够比较容易地转化成数据库模式和代码实现。

而我们建立领域模型，主要是要识别**领域对象（domain object）**，**领域对象之间的关系**，以及**领域对象的关键属性**，必要的时候还要**将领域对象组织成模块**。当然了，还有一些比较深入的内容，我们会在迭代二中再讲。

那么，什么是领域对象呢？**我们系统中要处理的各种“事物”就是领域对象**。比如说项目、员工、账户等等。这些对象都反映了名词性的概念。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/4a/e1/2a498473.jpg" width="30px"><span>李威</span> 👍（61） 💬（6）<div>为什么领域建模要由业务人员和技术人员一起协作完成呢？

1、知识传递：
技术同学说：我没太懂你到底想要个啥玩意儿
产品同学说：好，让我跟你再细说说

2、知识提炼：
技术同学说：你讲的我大概都明白了，但是就感觉有些凌乱，东扯一下，西扯一下，还是有点迷糊
产品同学说：好，那我们再来梳理一下，有些点确实可以归归类啥的，可能更方便理解

3、可视化：
技术同学：嗯，你的需求我基本是了解了，要不我把我的理解画出来，跟你确认一下？
产品同学：好主意，那咱们一起来搞吧。

4、认知对齐：
技术同学：你看我画的这个，是那个意思哈，确定哈。 还有这个这个，是那个那个意思哈。
产品同学：对的对的，这个是对的。 不过，那个可能稍微再调整一下更符合实情业务情况。

5、统一语言：
技术同学：看来，咱们画这一波图，已经把需求的要点都囊括了哈。只是有些概念我感觉还是有点模棱两可，要不咱们再对一下，把这些概念的叫法给定死咯，这样我写代码的时候，也方便取名字。
产品同学：要得要得，我们再拉一个表吧，把所有的业务概念再罗列一遍，包括中文表达和对应的英文表达都敲定一下，以后咱们就以这个术语表为准来沟通。</div>2022-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/c2/79/fbc18da4.jpg" width="30px"><span>超斌hello</span> 👍（9） 💬（1）<div>这一课主要讲了模型及各自之间的关系
问题：
1. 业务和技术需要当前的模型结构是否适合未来，
对于电商的订单业务，刚开始时，我们是一个订单只做一个配货单，增加了下订单时要按仓库拆单，复杂度有点麻烦；为了保证前端用户下单的TPS，我们做了妥协，使用一个订单多个配货单处理，不影响前端效率，整体的方案如下图：
https:&#47;&#47;www.processon.com&#47;view&#47;link&#47;639a6faa1e085317e09dde02</div>2022-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（18） 💬（3）<div>1.两个角色在一起协作产出，是因为两个角色共同参与是必要条件（不然，单干效率最高）。为什么会是必要条件，因为我们假定业务知识只在业务人员脑子里，领域建模知识只在技术人员脑子里，我们要得出某块领域知识，用领域建模做的模型图就必须要整合这两块知识。两者谁更核心些，业务知识更核心些，毕竟建模这个事有各种方式，只要能高效传递知识都是好方式。

2.租户的概念很特别，是否放到领域建模需要斟酌。毕竟租户来源于saas，saas来源于客户对产品的使用方式。但不是所有的软件都需要产品化（我就搞个功能集的小软件，不做限定），不是所有产品化都采用saas（也肯能是专项交付）。

3.多对多都可以拆成两个1对多，而且最好拆掉，拆时时常能发现一些隐式概念。 以上边为例，“员工”-**-“岗位” 中间可以加个 “编制”，“员工”-1*-“编制”-*1-“岗位”。 &quot;编织&quot;可以挂组织，可以挂项目，取决于交付模式。

4.注释和约束还是看情况加吧，抽象模型目的是聚焦核心方便沟通，铺得越详细也就越失焦。把注释和约束交给故事卡背景&#47;AC或则PRD，也是一种方式。（为什么有这个想法， 如果我抽象的模型需要一直改，哪很可能是抽象得并不好《还是太具象了》，比如文中的“开发中心”“直属部门”。uml图也是这个思路，加注释和约束后，要改的机会会显著增加）</div>2022-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/80/ec/b6149cbf.jpg" width="30px"><span>老狗</span> 👍（12） 💬（3）<div>1. 实际上DDD针对的复杂软件是个铁匠和花匠一起参谋做除草机的事情，业务人员懂它要干嘛，但是不懂如何做，铁匠能打造工具，但不知道工具如何被使用更好。单铁匠只能做出他学过的工具，比如他学过如何制造锄头，单花匠只能吐槽手里的锄头不好用。所以，从另一方面，如果这种软件你学过怎么做（你知道抄谁并且各种分析都到位了）就不要花匠（业务人员了）可能那个花匠还没你懂，不过能告诉我们开发人员抄啥的好日子好像越来越少了。</div>2022-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/b6/abdebdeb.jpg" width="30px"><span>Michael</span> 👍（9） 💬（2）<div>这个模型有点像《分析模式》第一节里面的模型。我比较好奇的是我们怎样去发现需要抽象的地方，就像例子里，为什么我们需要考虑组织层级变化这个点?其实也可以有其他的点，比如以后我希望企业和租户是多对一的关系，就关于抽象组织层级这个好像也没有从需求里能看到蛛丝马迹，我们应该怎么训练这种能力呢？</div>2022-12-15</li><br/><li><img src="" width="30px"><span>沐瑞Lynn</span> 👍（3） 💬（3）<div>正好同时在复习八叉老师的另一门课，里面提到的用知识消化（Knowledge Crunching），“双关联一循环”，来提炼领域模型。

让业务人员和技术人员一起，建立统一语言（Unified Language），建立双关联，也可以加速完成循环。</div>2022-12-15</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/FyiaSFQ7wBCswIyD36Tu0RrlmeibDonxzd6czxGack8EjGEwws3uwH5QkrUQJq0AgK2a0mjyziblVZ9aVMr674Saw/132" width="30px"><span>Geek_31faab</span> 👍（2） 💬（1）<div>我们的开发模式是产品提供原型，然后产品再根据原型给我们讲解需求。这类的我们还需要再进行事件风暴了吗？</div>2023-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/c8/a8/f11642b4.jpg" width="30px"><span>吴钢</span> 👍（2） 💬（1）<div>你好，企业是非常特殊的组织，企业最好作为独立的实体，即使合并也应该和租户合并。否则按企业查询用户，或按用户确定企业都很麻烦。</div>2022-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/9d/c0/cb5341ec.jpg" width="30px"><span>leesper</span> 👍（2） 💬（2）<div>领域建模由业务人员和技术人员共同完成，是因为技术人员开发的软件，是技术人员从业务人员获得的知识在大脑中的反映，因此技术人员必须把业务人员脑子里的知识可视化出来，才能开发出满足需求的软件。

实际项目中，往往是一上来就开始建表，然后围绕表就各种CRUD，这样开发出来的面条式代码，往往没有表达出目标问题背后那些不变的本质的东西，因此需求越复杂就越到后面越难以维护，写成了一坨巨大的屎山，程序员每天在屎山里搬屎</div>2022-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ec/2e/49d13bd2.jpg" width="30px"><span>SMTCode</span> 👍（2） 💬（1）<div>业务最终要落地到技术实现上，业务人员可能会把所有的业务场景都罗列出来，但不能从代码实现层面对相似业务的抽象；而技术人员需要把业务需求转成实实在在的代码，但只关注编程语言等的特性，不能整体把握业务的整体。通过业务人员和技术人员的共同头脑风暴，完成业务的抽象，提高技术人员对业务需求的整体认知，才能使用合适的语言特性实现业务的真实功能。这是一个打破业务与技术之间墙的非常高效的方法。能把这两者之间融合于一身的人，才能称为系统级架构师，但能做到的人少之又少。太好的内容，很厉害的老师。谢谢</div>2022-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（1） 💬（1）<div>AI 简化实体之间的关联关系

思路
======
1. 将模型图转换成 Mermaid 语法，便于 AI 处理
2. 简单描述核心需求，例如：尝试提取出抽象实体
3. 使用 coze 的 Prompt Optimize 功能优化提示词
4. 带入 Mermaid 模型图，查看 AI 处理结果
5. 根据 AI 处理结果，优化 Prompt
6. 多轮迭代后得到启发

结果
======

GPT4 缩减到 5 个实体
智谱清言缩减到 3 个实体

智谱清言胜出，结果更加简洁，符合实际业务需求。

详见 https:&#47;&#47;wyyl1.com&#47;post&#47;28&#47;practice1&#47;</div>2024-04-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/77/7b/338c4617.jpg" width="30px"><span>瀚海</span> 👍（1） 💬（2）<div>为啥感觉建模后，好复杂 😂</div>2023-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（1） 💬（1）<div>02 课被“分层”惊到了，我还不会分层
03、04 课被“事件风暴”惊到了，一个企业管理系统居然包含这么多功能！
05 课看到“进行抽象”后惊呆了：抽象之后居然变得那么简洁！模型就直接支持开闭原则了（添加新组织、组织的级联关系可以任意层、添加新岗位等）

这个过程有点像修仙小说中的炼丹师

分层：将不同的材料分类
事件风暴：找出现有材料可以炼制多少种功能的丹药
进行抽象：将材料投入炼丹炉，第一次提取精华，让原材料的某些属性威力倍增

虽然自己不会炼丹，但第一次见怎么炼丹，还是非常激动！</div>2022-12-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK9Ijx19rLDhHkYTpnicc58dDAuCy2Zg7hpuKHkianichqFIW5qS7SEAl6jkrCBLwcC6RuicvicjCXXadA/132" width="30px"><span>Geek_fe41a4</span> 👍（0） 💬（1）<div>事件风暴的产物需要体现在概要设计中吗?
领域模型在概要设计和详细设计中分别需要体现到什么粒度?</div>2024-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/d5/15/4927d5f1.jpg" width="30px"><span>牛奶</span> 👍（0） 💬（1）<div>1、我们一般是由具有开发经验的BA来建模，建模完成后和开发拉通。
2、比如我们业务中用到条款和条款组别的关系，报价单和商品关系，就把它们统一抽象到了关系表中。</div>2023-10-06</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoXicOrwX6JOqSdEficEsXjX9KsDo6vlFCVwibZ55vdz93aibwyz0zp8OFBHeBqvyk0tZnxzOCKLK4VBg/132" width="30px"><span>好人</span> 👍（0） 💬（1）<div>老师，有个问题想请教下：
一对多的关系，对应到代码里，是如何体现的？
比如一个组织对应多个员工，组织这个类，必须要有一个属性，比如一个 List 去承载对应的员工吗？一个组织的员工数不会太多，这么做似乎也没问题。

再比如设计一个账户系统，账户作为一个实体，账户的流水也抽象成一个实体。作为表设计来说，一个账户记录，会对应多个账户流水记录 也没什么问题。
但是如果在账户类里，把这个账户对应的流水作为一个 List 保存，如果流水记录数量相当大，这种设计合理吗？如果不把流水列表 作为账户的属性，又如何体现出一对多的关联？

谢谢！</div>2023-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2a/1f/0a/3dd0cabc.jpg" width="30px"><span>黑夜看星星</span> 👍（0） 💬（2）<div>老师，
1, 类和实例应该属于技术领域术语吧吧？在建模阶段，虽然是业务人员和技术人员共同进行，但是是不是由业务人员主导，而业务人员可能根本不知道这些技术术语，也不该出现这些具体技术术语。
2,一个组织可能被多个组织领导吧，虽然我没见过，但是也不能排除。</div>2023-08-08</li><br/><li><img src="" width="30px"><span>Geek_2197ae</span> 👍（0） 💬（1）<div>老师，没太明白，领域对象，类，和实体指的是同一个东西吗？</div>2023-07-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/12/65/846d566c.jpg" width="30px"><span>Breakthrough</span> 👍（0） 💬（1）<div>看老师做的领域建模，是基于组织类抽象。但是业务实体里面很多都是表单类的比如报工单、入库单、出库单等等，那这些是否都可以抽象为单据类？我有些困惑，因为组织类的抽象最后基本都会通过基础数据类模块来进行定义，但是单据类的抽象并没有抽共性到一个模块里面，而是在各自模块中有打印表单这个功能，所以在抽象这块还有什么需要注意的点，还望老师指点一二</div>2023-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/7e/b47946cd.jpg" width="30px"><span>樵牧</span> 👍（0） 💬（1）<div>一个员工不是也可以属于多个组织吗？ 属于研发组  属于研发中心  属于直属部门。 最后的图说一个员工只属于一个组织，有点奇怪。
</div>2023-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0c/37/913de94f.jpg" width="30px"><span>keys头</span> 👍（0） 💬（1）<div>为什么区别于开发中心的部门业务上一般叫做直属部门？不太理解。为什么开发中心不是直属的呢？</div>2023-02-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/74/aa/178a6797.jpg" width="30px"><span>阿昕</span> 👍（0） 💬（1）<div>1.从工作流程来讲，领域建模作为事件风暴讨论的产出物，各方需要对结论达成一致；
2.对大部分属性、功能类似的对象，需要考虑抽象的可能性，例如，多级别、多类型的实体；

继续对支付系统进行领域建模：https:&#47;&#47;boardmix.cn&#47;app&#47;share?token=GR6wYS0X3IRCHXMqi7vgL3Meq-iuuAT-8eg8ly6waHhZQtnUU7AEfoZO2W5hE_e21dPoSFtxR7laf5yUiiSc_f_vwrVOyKlohhfUxcq49OM=&amp;inviteCode=kjG6ak</div>2023-01-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/85/d0/56602a43.jpg" width="30px"><span>灵活工作</span> 👍（0） 💬（1）<div>请问文章中的领域模型图是什么工具画的，好像只能用纸笔画，市面上只有给架构和开发人员用的画UML图的工具，没有用来画和领域专家沟通的领域模型图的工具</div>2022-12-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（0） 💬（2）<div>领域建模主要是作为业务和技术人员之间的桥梁，那么有没有可能在以后，业务人员普遍具备了技术基础知识后，领域建模在这一方面的功能被弱化？

另一方面，领域建模用于指导系统的设计和编码，这个可以作为技术人员的工具箱，长期存在。但是感觉，在现阶段，即使是技术人员内部，也很难用领域建模来形成统一的沟通语言或者思考方式。

对于思考题，

1. 一般来说，技术人员对于业务不够理解，特别是在进入业务的初期，这时候需要有工具能够帮助技术人员和业务人员进行沟通；当然，另一方面，也需要协助业务人员了解，技术能够做到什么。到项目后期，可能会出现一些跨业务和技术的专家，但是也很难单纯用技术去驱动业务。

2. 对于抽象思维，照猫画虎的描出部门结构相对比较容易，抽象出“组织”这一步就比较困难了，能够再加上“组织类别”，就更厉害了。之前在实际项目中，曾经将文字材料、图片、音频、视频，统一抽象为“素材”，从一定程度上简化了业务流程。</div>2022-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（0） 💬（1）<div>回答课后思考：
1. 一起协作完成，因为业务人员永远总比技术人员懂业务，避免技术人员出错
2. 有代码类似的例子，就是抽象出公共方法，然后可以达到复用的功能。</div>2022-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b4/29/67646c1e.jpg" width="30px"><span>vivieast</span> 👍（0） 💬（1）<div>试着回答一下两个思考题
1. 为什么领域建模要由业务人员和技术人员一起协作完成呢？
领域建模要业务人员和技术人员在通用语言、领域对象、约束理解上对齐，让技术人员可以用准确的业务语言描述业务。
通过业务人员和技术人员一起协作挖掘出更多规则，这些规则准确描述出对象之间的关系，并将名词抽象出新的对象，完善对象的业务规则。
2. 通过抽象思维，可以抓住需求的本质，达到“神似”，你可以在遇到过的实际项目中，举出类似的例子吗？
建模一个检查任务对象的时候，任务需要执行一些检查项。
在某些用户场景下需要执行固定的检查项，可以将这些特定场景下的检查项抽象成场景，抽象出场景模板。</div>2022-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/01/e5/fcac1a6a.jpg" width="30px"><span>狐狸先生</span> 👍（0） 💬（3）<div>老师，有电商领域的相关领域模型分享不，尤其是中台方面的，如用户中心、订单中心等。目前在参考tw发布的《现代企业架构白皮书》实践，目前就在做订单中心的，和这个案例很像，我们涉及业务身份，订单，订单类型（机票，酒店，租车，火车票等），销售单元（打包销售）等对象</div>2022-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/fe/93/c7baea71.jpg" width="30px"><span>bighero</span> 👍（0） 💬（1）<div>第一个问题回答：因为统一语言的要求上下要做好校对，统一认识。统一理解。</div>2022-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/66/30/ce2cc535.jpg" width="30px"><span>小5</span> 👍（0） 💬（1）<div>思考题1：业务人员和技术人员一起参与，可以起到信息同步，达成共识的作用，否则也就没有所谓的统一语言了。

业务人员：这个功能怎么没有
开发人员：你也没有说要做这个功能啊
业务人员：这个我认为是常识啊，这不是理所当然的吗
开发人员：…

思考题2：工作中接触到审批流工作引擎，有点复杂，需要支持自由配置审批节点、抄送节点、还要条件分支，抽象之后就是一个节点，有节点类型，这个节点需要做的操作，然后就是流转到下一个节点</div>2022-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（1） 💬（0）<div>DDD 之 UML 入门 1
一对一关联、一对多关联、自关联、约束、多对多关联、多重性
https:&#47;&#47;wyyl1.com&#47;post&#47;23&#47;01&#47;</div>2023-01-19</li><br/>
</ul>