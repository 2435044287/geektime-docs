你好，我是钟敬。

前面几节课，我们学习了泛化的建模，今天开始我们继续学习泛化的实现。这节课我们先探讨怎样为泛化进行数据库设计，下节课再讨论怎样为泛化编写代码。

回忆一下[第 8 节课](https://time.geekbang.org/column/article/615573)讲过的数据库设计方法，如果只有实体和关联，那么数据库的设计还是比较直白的。但是泛化就会有些难度了。这是因为，同样的泛化模型，可以有不同的数据库设计方式，需要我们根据情况进行权衡。

这里又包含两个维度的变化，一个是怎样设计表，一个是怎样确定主键。

## 设计表的策略

我们先来讨论设计表的方法。为了说明问题，我们结合一个商家向不同客户售卖商品的例子来讲。

![](https://static001.geekbang.org/resource/image/14/07/14fa142ba1152a7757345e8813f48507.jpg?wh=3733x2260)

这个领域模型，说的是一个商家可以把商品卖给个人或者企业。也就是说，**个人客户**和**企业客户**都是**客户**。所以可以抽取出泛化关系。**客户**实体里的**送货地址**属性，以及客户和订单之间的一对多关联，都体现了个人客户和企业客户的共性。而个人客户里的姓名、企业客户里的税务号等属性，体现了个人客户和企业客户的区别。

为泛化体系设计表，有 3 种基本策略。

- 每个类一个表。
- 每个**子类**一个表。
- **整个**泛化体系一个表。

这三条策略读起来可能有些拗口，没关系，我们一个一个解释。

### 每个类一个表

第一种策略是“每个类一个表”，也就是说不管父类还是子类，都各建一个表。对于上面这个关于客户的例子，实际上就要建 3 个表。就是下面这个图的样子。  
![](https://static001.geekbang.org/resource/image/5a/6c/5a92b8e271d5d63146571a2d9a54926c.jpg?wh=3733x2260)
<div><strong>精选留言（7）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/b6/abdebdeb.jpg" width="30px"><span>Michael</span> 👍（5） 💬（2）<div>我明白泛化建表的三种策略的考量，但是不太明白“共享主键”在设计里起到的作用，或者说为什么还要考虑共享主键这件事情？老师能不能再展开说说？</div>2023-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/da/61/2290be43.jpg" width="30px"><span>KelperOvO</span> 👍（2） 💬（2）<div>我感觉建出来出来的模型是有问题，项目和子项目不应该有工时项id，工时项id不是项目的信息</div>2023-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/0a/7d/791d0f5e.jpg" width="30px"><span>子衿</span> 👍（2） 💬（1）<div>1. 可以考虑新增一个表表示所有员工都可以填报的工事项有哪些，当新增不需要分配员工的项目，或普通工时项时，都冗余插入该表一份，这样原来查询3次就优化为查询两次，本质还是CQRS，从查询角度考虑如何设计，但导致写加重，读减轻
2. 感觉本质考虑的还是一样的，多个表更灵活更贴合领域模型，但需要关联的场景就会性能下降</div>2023-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/61/ef/ac5e914d.jpg" width="30px"><span>麦耀锋</span> 👍（1） 💬（1）<div>在“每个类一个表”的例子里，在personal_client和corporate_client表都分别有name字段，理由是client表中如果放name，不能区分是个人姓名还是公司名称。对于此，我有不同的看法。首先，如果从业务角度（一般来看），应该能够有一个比较好的共识，就是对于name，如果用于个人，那么就是姓名，如果用于公司，那么就是公司名称，我觉得这是大部分业务逻辑都能接受的“共识”；其次，如果这种区分是必要的，那么对于“地址”呢，是否也得分“个人家庭住址”和“公司办公地址”？ 这样拆分的话，其实更加重了对模型的理解负担（对于本质上大家都认同的共识做不必要的拆分）从而造成不必要的复杂性。 即使到了实现阶段，假如采用继承，一般而言这个name也会放在基类。</div>2024-11-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaxhA2xdIRKQ0rXZhrjcWPYp4hR1mjST6lcBeuYTg0Omf0hyREfr8VH8JWXEyEVq82ht7wdzWsyA/132" width="30px"><span>Geek_682837</span> 👍（1） 💬（1）<div>在不共享主键的方案中，不一定需要逻辑主键吧，工时项可以用关联表的主键加source作为关联外键，这样也不会重复</div>2024-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/b8/bc/5f4c9cb2.jpg" width="30px"><span>掂过碌蔗</span> 👍（1） 💬（1）<div>工时项id，主要还是看有没有使用全局所有类型工时项的需求吧。比方说，根据工时项id对某个工时项进行一些操作。
如果所有操作都是基于项目、子项目、普通工时项单一维度进行操作的，工时项id就看上去没什么必要了。</div>2024-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（0） 💬（1）<div>学着学着，逐渐吃力起来，前面的好多业务知识都忘了</div>2023-02-21</li><br/>
</ul>