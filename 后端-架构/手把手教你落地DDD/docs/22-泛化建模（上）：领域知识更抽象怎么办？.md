你好，我是钟敬。

上节课，我们学习了“限定”技术。利用这个技术可以丰富模型的语义并简化关联。今天，我们要挑战领域建模中的另一个话题——泛化。

泛化是领域建模技能由初级水平迈向中、高级水平的门槛。也就是说，如果不懂泛化，那么你的领域建模水平就始终停留在中级以下。初步掌握了泛化，那么你的水平可能就能达到中级。把泛化玩得出神入化，那么大概就能达到高级水平了。

领域建模层面的泛化，大体上相当于面向对象设计中的继承和多态。如果你学习过“设计模式”的话，还记得刚开始的“痛苦”吗？其实，整本《设计模式》，无非是教你怎么灵活运用多态罢了。而在领域建模层面，与《设计模式》对应的就是《分析模式》。整本《分析模式》也无非是教你怎么成为使用泛化的高手。

我们现在要讲的内容，尽管达不到“分析模式”的高度，但是可以为你将来的学习打下基础，帮你在实际工作中解决一些相对复杂的问题了。

我安排了5节课的时间，带你分别由泛化的建模、泛化的数据库设计以及泛化的代码实现由浅入深地认识和理解泛化。

这节课会围绕着“在子项目上报工时”这个需求来展开讨论，演示泛化的建模方法。还是老办法，我作项目经理，你作架构师。

## 项目和子项目的“泛化”

我先来回顾一下需求：我们把业务由“零零后公司”扩展到了“九零后公司”，而“九零后公司”会把项目进一步分为子项目，然后在子项目上报工时。
<div><strong>精选留言（19）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/74/aa/178a6797.jpg" width="30px"><span>阿昕</span> 👍（10） 💬（1）<div>思考题，学习时间和管理时间虽然也可以进行分类，但是两者已经是原子属性了，没有必要进行抽象，所以不构成泛化关系</div>2023-02-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/0a/7d/791d0f5e.jpg" width="30px"><span>子衿</span> 👍（10） 💬（1）<div>1. 因为学习时间和管理时间，只有共性没有个性部分，所以不必泛化</div>2023-01-31</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/cQVffRuscdhnF5vnQjgAZnbLwHDALl3TsAQsgEYCYPVfuFMSkyaTUXHs2aA0ORpx7AjI3LTR2ibKw2Q0VepymqA/132" width="30px"><span>Geek_66158e</span> 👍（8） 💬（1）<div>问题一：因为从报工时的角度来看，已经不再关心普通工时项下的“个性”了，普通工时项这种“共性”对于报工时来说已经有意义的最小的粒度了。</div>2023-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（4） 💬（3）<div>思考题 2：想到一个实际上的场景，但是拿捏不定是不是泛化
父类：账户项
子类：现金账户、备付金账户、待清算账户等等

每个账户项都有余额属性：可用余额、冻结余额</div>2023-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/cb/c5/c1d7ca5e.jpg" width="30px"><span>赵晏龙</span> 👍（1） 💬（2）<div>老师你的总结是想引发粽子战争吗？

1. 粽子……不是，学习时间和管理时间在业务需求上没有需要泛化的必要，泛化则变成了过度设计。

2. 我现在满脑子粽子，等我缓缓</div>2023-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（1） 💬（1）<div>思考题
1. 「学习时间」和「管理时间」所有属性都相同，添加一个新属性「类型」就可以进行区分
2. 封装第三方登录（微信、手机号、QQ）；封装第三方支付（支付宝、微信、银联）；封装不同等级用户提现时的手续费计算逻辑

其他想法
1.「工时记录」中需要新加一个属性「类别」，这样方便以后按类别查找记录（由泛化引发的一个坑）
2. 今天刚好读到《DDD》第 9 章，趁热打铁，又多理解了一点
3. 感觉「泛化」就像代码中的「接口」。写代码时「面向抽象编程」，建模时「面向抽象建模」。当一个程序员，不会「抽象」还真吃力啊！
4. 「直接“借用”系统中已经存在的机制，在短期内虽然达到了目的，但长期来看会导致概念混乱，这种做法是很多开发团队常见的错误」这是我们项目中的常态，开发一时爽，后来很多人走了……
5. 明白了 Predicate（谓词&#47;谓语） 在编程中的意思：谓词是指计算结果为「真」或「假」的函数，并且可以使用操作符（如 AND 和 OR）把它们连接起来以表达更复杂的规则。
—— 《领域驱动设计 软件核心复杂性应对之道》9.2.3 模式： SPECIFICATION
钟老师还提到了一本书：《离散数学》，里面的一阶谓词理论，就是说这个</div>2023-02-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/b6/abdebdeb.jpg" width="30px"><span>Michael</span> 👍（1） 💬（2）<div>期待老师讲泛化的数据库设计和代码实现，有些时候我在做项目的时候也觉得应该有泛化，但是只体现在模型设计上，但是不懂怎么体现在数据库设计和代码实现上，导致很多想法就此打住。</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/66/30/ce2cc535.jpg" width="30px"><span>小5</span> 👍（1） 💬（1）<div>回答问题1：因为两者有共性但是没有业务上关注的差异性</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/46/c0/106d98e7.jpg" width="30px"><span>Sam_Deep_Thinking</span> 👍（0） 💬（1）<div>看了这篇文章后，对抽象的概念的理解，更加深刻了，感谢作者，写的真的非常细心和用心，这个DDD的实战专栏，堪称是极客时间里的【经典专栏】。

有一定技术积累和工作经验的人，看这个专栏会非常的爽，偶尔还会有任督二脉被打通的感觉。再次感谢作者。</div>2024-11-21</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/05Wiazxo0OS5w9KdJ4OQAeicibpMJ2OHyPOia8WwRkuz3JymeW0m4F3m9ia3ZIUVUoicNxSCUGpgJyVMeh8vkQZ0hSaw/132" width="30px"><span>刘毅</span> 👍（0） 💬（2）<div>钟老师您好，结合您前面讲的第5节中组织与组织类别的抽象过程以及java面向对象思想，我的理解如下，不知道是否正确。

值对象（个性）-&gt;实体（共性）与子实体（个性）-&gt;父实体（共性）两种机制都能够同时表现出不同实体间的共性和个性，两者主要的区别是个性部分在当前业务领域内是否复杂。
若个性部分在当前业务领域内比较复杂（具有自己的标识、属性或方法等），则可用子实体实现；若个性部分在当前业务领域中比较简单（如只是简单划分几个枚举值），则可用值对象实现。</div>2023-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f5/95/a362f01b.jpg" width="30px"><span>Geek1560</span> 👍（0） 💬（1）<div>工时项作为项目和子项目的泛化有点怪怪的，仅仅因为它们有个很小的相同点是工时就做这种抽象是不是不太合适？项目和子项目的大部分信息应该都是相同的，而不仅仅是工时</div>2023-10-26</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/zAZv4NyuS21Y1qk45j8JiaoEYdA5Zgc1PqpJsBokz5bZVmdkf6kNWvT4cUAAKAdH6TgN52DWZhiaH6wNFhw14nRg/132" width="30px"><span>Geek_4e4ec2</span> 👍（0） 💬（1）<div>有个问题，将工时项移到工时管理后，项目实体岂不是要继承或实现工时项，但它们是在两个上下文里，相当于一个上下文里直接引用了另一个上下文中的领域对象，这样也没问题？</div>2023-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/88/c8/6af6d27e.jpg" width="30px"><span>Y024</span> 👍（0） 💬（1）<div>“学习时间”和“管理时间”，我们是作为一个灵活工时项目来处理。</div>2023-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/30/e7/2b/c5e5ebc6.jpg" width="30px"><span>树袋熊🐨</span> 👍（0） 💬（1）<div>项目和子项目是不是可以改为：项目、子项目、普通项目，子项目和普通项目是项目的泛化？在该章节的项目和子项目应该有很多共性存在，应该进行一次抽象处理。</div>2023-02-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（0） 💬（1）<div>课后题，个人理解
1.本来就是泛化关系，只是在模型上要不要体现出来而已。 哪怕这几个类型的结构一模一样，也可能会标识泛化关系。是否标识的判断依据是这几类模型有没有自己私有的业务流程，如果有，那么展示泛化关系，在具体业务流程用子类的模型来构建类关系图。
两天基本思路，怎么画更不需要解释就怎么画，能降低认知复杂度就降低。</div>2023-02-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg" width="30px"><span>tt</span> 👍（0） 💬（1）<div>是不是因为学习时间和管理时间就是普通工时项，他们之间没有不同，只是名字、使用场景不同，可以用给普通工时项增加一个“类型”的枚举属性，就可以完全编程不同的实例了。</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（0） 💬（1）<div>终于追上了进度。

泛化 generalization 确实看上去很高阶，可以转化为自然语言中的分类、是一个（is-a）、共性三种说法。

空心三角（箭头）加实线表示”泛化“ generalization，继承关系，指向基类
空心箭头加虚线表示”实现“ Realization，类对接口的实现，指向接口
空心菱形表示”聚合“ aggregation, has-a，两个对象一般不平等
实心菱形表示”组合“ Composition, contains-a
虚线箭头表示”依赖“ Dependency，使用，偶然、临时、弱关系
实现箭头表示”关联“ Association，两个对象平等，强依赖，长期、平等

来自 https:&#47;&#47;www.cnblogs.com&#47;duanxz&#47;archive&#47;2012&#47;06&#47;13&#47;2547801.html

抽取工时管理模块，以及将普通工时项、工时项、工时记录迁移到工时管理模块的过程，确实很精彩，将隐式概念显示化，这个可能才是领域建模方法的精粹。

思考题：

1. 学习时间和管理时间也可以单独拿出来，但是在目前业务上下文中，没有必要
2. 在之前的项目中，有用到”泛化“的东西，但是并没有抽象出来。比如对于文字材料、视频、音频都可以看做素材，但是并没有泛化出”素材“的概念。</div>2023-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/b5/28/3de99570.jpg" width="30px"><span>龙腾</span> 👍（1） 💬（0）<div>自然语言层面的子类，说男人和女人是人的子类，所以我们可以说“男人是人”。本文所说 工时项的子类有项目和子项目，但是我们显然不能说“项目是工时项”，而只能说“工时项是项目的一个属性，或者说项目包含工时项”。可以看出自然语言中的类型是实体之间的关系，而非属性之间的关系。而本文所说的“类”、“统称”其实是实体的公有属性：是属性和多个实体的关系，因此我觉得这种关系不应该用自然语言的“类”、“统称”来表述。</div>2023-02-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ab/69/5f1f0d1c.jpg" width="30px"><span>支离书</span> 👍（0） 💬（0）<div>文章中项目和子项目抽象出来一个“工时项”，是因为有工时记录的需求，如果再加个给项目和子项目拆分任务但学习时间管理时间不需要拆分任务的需求，那就不能复用“工时项”这个抽象了吧？一是名称不合适，二是普通工时项不需要拆分任务了。这种情况再给项目子项目单独抽象出一个“任务项”的抽象吗？

这个问题群里有同学也问到了，看老师回复说详见泛化第三节课。坐等更新。</div>2023-02-03</li><br/>
</ul>