你好，我是陈皓，网名左耳朵耗子。

所谓的边车模式，对应于我们生活中熟知的边三轮摩托车。也就是说，我们可以通过给一个摩托车加上一个边车的方式来扩展现有的服务和功能。这样可以很容易地做到"控制"和"逻辑"的分离。

也就是说，我们不需要在服务中实现控制面上的东西，如监视、日志记录、限流、熔断、服务注册、协议适配转换等这些属于控制面上的东西，而只需要专注地做好和业务逻辑相关的代码，然后，由“边车”来实现这些与业务逻辑没有关系的控制功能。

# 边车模式设计

具体来说，你可以理解为，边车就有点像一个服务的Agent，这个服务所有对外的进出通讯都通过这个Agent来完成。这样，我们就可以在这个Agent上做很多文章了。但是，我们需要保证的是，这个Agent要和应用程序一起创建，一起停用。

边车模式有时候也叫搭档模式，或是伴侣模式，或是跟班模式。就像我们在《编程范式游记》中看到的那样，**编程的本质就是将控制和逻辑分离和解耦，而边车模式也是异曲同工**，同样是让我们在分布式架构中做到逻辑和控制分离。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/ba/d28174a9.jpg" width="30px"><span>Geek_zbvt62</span> 👍（20） 💬（2）<div>出门左转，service mesh就是靠sidecar支撑起来的，随着微服务的升级换代sidecar会越来越多的提起
netflix有prana，主要是针对自己的微服务全家桶的，好像spring cloud也有对应实现


</div>2018-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/01/0d/75b3cb10.jpg" width="30px"><span>AYOU</span> 👍（16） 💬（5）<div>求一个边车模式的开源项目。。</div>2018-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> 👍（7） 💬（1）<div>在近期的项目中用过，新项目是基于spring cloud的，我们有些旧服务是C#写的webservice，重新封装为rest，并用了side car模式提供服务信息和监控信息，虽然与spring boot实现的服务还是有些差距，但效果还可以：） </div>2018-06-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/41/94/dfbf6107.jpg" width="30px"><span>alienradio</span> 👍（3） 💬（0）<div>linkerd 边车部署</div>2018-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/ef/62/87d9ef62.jpg" width="30px"><span>Geek_CK2020</span> 👍（2） 💬（0）<div>为了把诸如监视、日志、限流等控制逻辑与业务逻辑分离解耦，我们可以采用边车模式。</div>2020-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c3/43/e4f6a609.jpg" width="30px"><span>Learning cat</span> 👍（2） 💬（0）<div>哈哈，前两天刚看了一点service mesh。今天看到sidecar越看越眼熟</div>2020-01-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/92/fd/6b0e58fe.jpg" width="30px"><span>文刂 氵共 超</span> 👍（2） 💬（0）<div>检查学习，学习笔记 https:&#47;&#47;mubu.com&#47;colla&#47;3uIVMTpB10M</div>2019-12-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/20/1299e137.jpg" width="30px"><span>秋天</span> 👍（2） 💬（0）<div>有没有可以参考的边车模式实现？？？？
</div>2018-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/17/68aa48cb.jpg" width="30px"><span>曾经的十字镐</span> 👍（2） 💬（2）<div>第一遍没有好好看，感觉和api gateway差不多，第二遍看的时候发现其中的猫腻，感谢老鼠哥</div>2018-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/8a/ca/1afcc75b.jpg" width="30px"><span>健康的小牛犊</span> 👍（1） 💬（0）<div>istio的数据平面使用的envoy就是一个典型的边车，接管了pod里所有和网络通信相关的内容</div>2021-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/b8/ce/0abbb54d.jpg" width="30px"><span>俊毓</span> 👍（1） 💬（0）<div>opentracing jaeger的agent，如果是在k8s或者容器化部署，时候可以给每一个服务自动注入。这样，trace信息就可以直接发给localhost。这是边车在agent部署的典型应用</div>2020-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/08/ce/f7d637fb.jpg" width="30px"><span>枫晴 andy</span> 👍（1） 💬（2）<div>一次调用副作用和调用多次副作用一样，这里的副作用是指什么？</div>2018-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（0） 💬（0）<div>不知道为什么，一直对这个边车模式印象深刻，可能是因为那个偏三轮摩托印象深刻。

由“边车”来实现与业务逻辑没有关系的功能——监视、日志、限流、熔断、服务注册、协议转换，边车 Agent 要和主车（应用程序）一起创建一起停用，共进退。

如果只看专栏的那副示意图，容易想到：在计算机领域，没有什么问题是加一层不能解决的。

边车模式的进程间通信最好使用网络远程调用的方式；
从 Sidecar 到 service 的内部协议尽量靠近和兼容本地 service 的协议，从 Sidecar 到远端 Sidecar 或 service 的外部协议，尽量使用更为开发更为标准的协议；
使用 Docker 来打包边车和服务；
不要把业务逻辑设计到 Sidecar 中；

不需要分布式架构的时候，不需要使用 Sidecar。</div>2023-03-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132" width="30px"><span>walle斌</span> 👍（0） 💬（0）<div>全异步架构。。例如以mq为核心的系统组件，不适合sidecar。。最简单的消息推送</div>2022-11-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bc/a8/810c8fd4.jpg" width="30px"><span>nikoart</span> 👍（0） 💬（0）<div>之前为了在运行时去修改nginx的配置，用go写了个简单的api，打到nginx镜像后跑在pod里供其他服务调用</div>2022-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg" width="30px"><span>饭粒</span> 👍（0） 💬（0）<div>有点像给业务应用绑定一个agent</div>2021-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/b1/81/13f23d1e.jpg" width="30px"><span>方勇(gopher)</span> 👍（0） 💬（0）<div>目前用的java   sidecar模式，解决异构服务的通信！</div>2021-11-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI0eGJygV4lh6PJuotKrz1jsZcOdNiaHnUC3y5A2O3yudUQLkzOE8758icDoXlvgpytQ50ibSIc9nJmg/132" width="30px"><span>余巍</span> 👍（0） 💬（0）<div>实现控制和业务的分离，有很多种方案，每种方案都是不同粒度层面选择。</div>2020-07-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/wI2LwgvwseNqXwkF67zicD9UXBSle9DPhmL6uyKG9Nib6NLfU3OuKYuSQ4DHCWxIQecnqell2vKVvNX8boox0B8w/132" width="30px"><span>Geek_dwq</span> 👍（0） 💬（1）<div>标题下面的三轮摩托车图片非常棒，很形象，一看就容易理解边车模式，太赞了！</div>2020-04-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg" width="30px"><span>亢（知行合一的路上）</span> 👍（0） 💬（0）<div>陈老师把边车模式讲透了，介绍了概念、解决的问题、实现方式、适合的场景、不适合的场景、注意事项等，这样深入才能把一个概念搞透，借鉴学习模式。
</div>2020-03-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/37/4e/5c3153b2.jpg" width="30px"><span>知行合一</span> 👍（0） 💬（0）<div>边车模式，全链路监控系统就是这种模式，应用端会有一个agent负责收集数据，发送到服务端来统计</div>2020-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f4/69/be6c8fc1.jpg" width="30px"><span>ericlf</span> 👍（0） 💬（0）<div>请问jmx管理属于边车模式吗？</div>2020-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/59/37/bd2de0a4.jpg" width="30px"><span>edisonhuang</span> 👍（0） 💬（0）<div>边车模式是为了解决服务控制和逻辑的分离，同时解决服务上下文的问题。和边车模式类似还有使用SDK或者框架的方式，后者相较边车模式的缺点在于需要侵入到软件代码中，当需要改造的软件较老时，使用边车模式可以不受编程语言的限制。
使用边车模式和应用软件是同机器一起部署的，虽然有跨进程调用的开销，但基本可以忽略</div>2019-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3a/d3/c273ee50.jpg" width="30px"><span>程序员Artist</span> 👍（0） 💬（1）<div>回头一想，发现这个模式有一个问题，就是粒度比较粗，它只能做到接口级别。这样细粒度（代码片段级别）的监控、日志做不了。但是其实也无所谓，更重要更大头的熔断降级限流重试、注册、协议适配等可以做。</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3a/d3/c273ee50.jpg" width="30px"><span>程序员Artist</span> 👍（0） 💬（0）<div>这个有意思啊，对于复杂的分布式服务来说确实好处非常多，我竟然第一次听说。这种模式目前有公司在用了吗？控制和逻辑分离，思想很不错，实现也简单，感觉有搞头。</div>2019-06-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a3/4c/ae84f80e.jpg" width="30px"><span>Sam_bo</span> 👍（0） 💬（0）<div>目前我所知道的边车模式 thanos https:&#47;&#47;github.com&#47;improbable-eng&#47;thanos 应该算是边车模式的一种，不确定说的是不是对的</div>2019-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg" width="30px"><span>剑八</span> 👍（0） 💬（0）<div>会有一点性能开销</div>2018-11-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg" width="30px"><span>Panda</span> 👍（0） 💬（0）<div>Sidecare 和Server Mesh 密切相关 例如开源项目istio</div>2018-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/20/2d/dfa5bec8.jpg" width="30px"><span>Han</span> 👍（0） 💬（0）<div>耗子叔，能否推荐个工具或框架能比较好的实现边车模式呢？ </div>2018-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/b3/40e8fa1d.jpg" width="30px"><span>风的叹息</span> 👍（0） 💬（0）<div>如果再有一节实践讲解就更好啦，知道原理和实践还有些路程。</div>2018-06-04</li><br/>
</ul>