你好，我是陈皓，网名左耳朵耗子。

正如我们前面所说的，构建分布式系统的目的是增加系统容量，提高系统的可用性，转换成技术方面，也就是完成下面两件事。

- **大流量处理**。通过集群技术把大规模并发请求的负载分散到不同的机器上。
- **关键业务保护**。提高后台服务的可用性，把故障隔离起来阻止多米诺骨牌效应（雪崩效应）。如果流量过大，需要对业务降级，以保护关键业务流转。

说白了就是干两件事。一是提高整体架构的吞吐量，服务更多的并发和流量，二是为了提高系统的稳定性，让系统的可用性更高。

# 提高架构的性能

咱们先来看看，提高系统性能的常用技术。

![](https://static001.geekbang.org/resource/image/a9/17/a9edeae125a80f381003d8d9d0056317.png?wh=863%2A321)

- **缓存系统**。加入缓存系统，可以有效地提高系统的访问能力。从前端的浏览器，到网络，再到后端的服务，底层的数据库、文件系统、硬盘和CPU，全都有缓存，这是提高快速访问能力最有效的手段。对于分布式系统下的缓存系统，需要的是一个缓存集群。这其中需要一个Proxy来做缓存的分片和路由。
- **负载均衡系统**。负载均衡系统是水平扩展的关键技术，它可以使用多台机器来共同分担一部分流量请求。
- **异步调用**。异步系统主要通过消息队列来对请求做排队处理，这样可以把前端的请求的峰值给“削平”了，而后端通过自己能够处理的速度来处理请求。这样可以增加系统的吞吐量，但是实时性就差很多了。同时，还会引入消息丢失的问题，所以要对消息做持久化，这会造成“有状态”的结点，从而增加了服务调度的难度。
- **数据分区和数据镜像**。**数据分区**是把数据按一定的方式分成多个区（比如通过地理位置），不同的数据区来分担不同区的流量。这需要一个数据路由的中间件，会导致跨库的Join和跨库的事务非常复杂。而**数据镜像**是把一个数据库镜像成多份一样的数据，这样就不需要数据路由的中间件了。你可以在任意结点上进行读写，内部会自行同步数据。然而，数据镜像中最大的问题就是数据的一致性问题。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/8b/d1/915f7aa6.jpg" width="30px"><span>刘斌</span> 👍（19） 💬（1）<div>架构的版本，不太理解怎么管理架构的版本。是通过一系列的中间件的版本决定的么？</div>2017-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a7/5a/2f98b96a.jpg" width="30px"><span>雪花飘飘</span> 👍（2） 💬（1）<div>陈老师，希望讲解下分布式事物的实现方式</div>2017-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/63/0b/ad56aeb4.jpg" width="30px"><span>AI</span> 👍（256） 💬（12）<div>陈大讲的比较有高度，我来说点具体的，做Java后端开发可能会涉及的一些性能优化。进程内缓存，如用Map、List来缓存一些基础数据。如果需要更灵活的操作缓存数据，如自动过期或定期更新，可以使用Guava的LoadingCache。为了减少对Java GC的影响，或者避免用户态与内核态的数据拷贝成本，也可以使用直接内存。但要小心使用，无节制的使用或者没回收内存将可能带来灾难性的后果，例如Netty就有监测是否有内存泄漏的开关，Netty在这方面已经玩得很溜了。大数据量的缓存，或者需要支持分布式访问，可以考虑使用Redis，记得设置过期时间哦。对于不需要实时响应或同步处理的请求，可以通过消息队列来实现异步化，根据实际业务场景来异步反馈结果，或者只须持久化数据。消息队列在削峰方面非常有用，可以很好的应对突发流量，或者是业务在促销期间的高峰，从而让业务下游可以平滑的处理请求。应用服务间的调用可以采用批量发送来提高吞吐。IO密集型的操作或调用可以适当增加线程数，调高调用线程数对于跨机房调用有非常大的提升作用。服务之间尽量同机房或就近机房部署，降低延迟。减少大对象，降低对象存活时间，从而降低Full GC的可能性。有些语言或第三方的API内部逻辑很耗时，必要时可自己实现，如BeanUtils.copyProperties方法。无锁化，如数据分片存储，ThreadLocal。减小锁粒度，减小锁的范围，通常锁代码块优于锁方法。使用乐观锁，如Java中的原子类采用自旋+CAS。</div>2017-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg" width="30px"><span>William Ning</span> 👍（21） 💬（0）<div>收获

1. 构建分布式系统的目的是增加系统容量，提高系统的可用性，转换成技术方面，也就是完成下面两件事。
-- 大流量处理。通过集群技术把大规模并发请求的负载分散到不同的机器上。
-- 关键业务保护。提高后台服务的可用性，把故障隔离起来阻止多米诺骨牌效应（雪崩效应）。如果流量过大，需要对业务降级，以保护关键业务流转。

说白了就是干两件事。一是提高整体架构的吞吐量，服务更多的并发和流量，二是为了提高系统的稳定性，让系统的可用性更高

2.提高架构性能
1.缓存：缓存系统 缓存分区，缓存命中，缓存更新
2.负载均衡：网关系统 负载均衡，服务路由，服务发现
3.异步调用：异步系统 消息队列，消息持久，异步事务
4.数据镜像：数据镜像 数据同步，数据分离，数据一致性
5.数据分区：数据分区 分区策略，数据访问层，数据一致性

3.提高架构稳定性：
1.服务拆分：服务治理 服务调用，依赖，隔离
2.服务冗余：服务调度 弹性伸缩，故障转移，服务发现
3.限流降级：降级限流 异步队列服务降级，限流熔断
4.高可用架构：高可用架构 多租户系统，宰被多活，高可用服务
5.高可用运维：高可用运维 全栈监控 devops，自动化运维


4.引入的问题
但是引入分布式系统，会引入一堆技术问题, 解决方法:
-- 服务治理
-- 架构软件管理
-- DevOps。
-- 自动化运维。
-- 资源调度管理
-- 整体架构监控。
-- 流量控制。

备注:
由上可知, 要实现出来得投入多少人力、物力和时间啊。是的，这就是分布式系统中最大的坑。

5.引入的问题的解决方案  --- Docker
我们应该庆幸自己生活在了一个非常不错的年代。今天有一个技术叫——Docker，通过 Docker 以及其衍生出来的 Kubernetes 之类的软件或解决方案，大大地降低了做上面很多事情的门槛。

现在你知道为什么 Docker 这样的容器化虚拟化技术是未来了吧。因为分布式系统已经是完全不可逆转的技术趋势了。

6.总结  -- 分布式系统的“纲”
总结一下上面讲述的内容，你不难发现，分布式系统有五个关键技术，它们是：
-- 全栈系统监控；
-- 服务 &#47; 资源调度；
-- 流量调度；
-- 状态 &#47; 数据调度；
-- 开发和运维的自动化。


而最后一项 —— 开发和运维的自动化，是需要把前四项都做到了，才有可能实现的。
所以，最为关键是下面这四项技术，即应用整体监控、资源和服务调度、状态和数据调度及流量调度，它们是构建分布式系统最最核心的东西.

Over</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/43/bf/9a982bc1.jpg" width="30px"><span>子悠</span> 👍（16） 💬（0）<div>这个系列的文章真是干货</div>2017-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg" width="30px"><span>程序员小跃</span> 👍（15） 💬（0）<div>如果不是之前半个月我学习了微服务架构，文中很多名词我都不理解，无法接受地去学习。现在回过头来看这个分布式，就好很多了。很多时候，是需要有基础的，有理解的在学习，凭空想象对于技术来说是坚决不可行的</div>2019-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/de/b3/921f3e39.jpg" width="30px"><span>安晓辉</span> 👍（10） 💬（0）<div>这个系列超级赞！</div>2018-01-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg" width="30px"><span>Dale</span> 👍（7） 💬（0）<div>受益匪浅，分布式系统中各个组件的调用链和组件监控做的不够好，这方面大公司运维很吃力</div>2019-01-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f4/52/10c4d863.jpg" width="30px"><span>FeiFei</span> 👍（6） 💬（1）<div>分布式架构的技术栈很多。
文章列举的已经是超大型分布式系统所需要的技术栈了。
但对于规模较小的公司，文中许多内容不需要实践的过于深。
架构是渐进式进化的，一口成不了个大胖子。</div>2018-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg" width="30px"><span>吴小智</span> 👍（5） 💬（0）<div>看了一些专栏，发现大佬总是能从更高纬度来思考一项技术的来龙去脉，让读的人能全局了解，赞了</div>2019-07-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/36/b9/3b28f67c.jpg" width="30px"><span>xueyuan</span> 👍（5） 💬（0）<div>相见恨晚</div>2019-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/59/37/bd2de0a4.jpg" width="30px"><span>edisonhuang</span> 👍（3） 💬（0）<div>分布式系统提高了系统的吞吐量，加大并发性能，可以实现关键业务保护。对于分布式系统主要注意下面的两方面：
提高系统的性能，可以在各级实现缓存技术，做负载均衡的调度，通过异步而非同步反问加大吞吐量，提高系统的并发。
提高系统的稳定性，包括服务拆分，服务治理，自动化部署运维，全站监控等。
抓住系统的纲，主要是实现全站资源服务的系统监控，从而让系统有了眼睛，服务和资源的调度，流量调度，数据和流量的调度，从而能够达到自动化运维和部署</div>2019-06-05</li><br/><li><img src="" width="30px"><span>Geek_22d08b</span> 👍（3） 💬（0）<div>请问如果采用阿里云华为云的话，那么多技术要实现是不是只要购买阿里云他们相应的产品，然后配置下就可以了，就没程序员什么事了？</div>2018-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/cc/ff/0e7fc131.jpg" width="30px"><span>.</span> 👍（2） 💬（0）<div>即使过了3年多了，陈大讲的这些东西依旧是非常有价值的，分布式系统架构或许并没有我们现在想的那么神秘莫测。</div>2021-01-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a7/e1/0e3ca7d8.jpg" width="30px"><span>Smilywd</span> 👍（2） 💬（0）<div>异步，持久化，状态管理，方便监控和自动修复，提升吞吐量，也一定程度上保证了稳定性</div>2019-02-14</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/2nM9PaEsM4UiaUc0R3iaiaOumFVkcugGhdUObpEBq0bEKnjF6DSTmjsibFbmJHtUphfXsFGd1ueJwMoonia3jicyPC1w/132" width="30px"><span>永靖</span> 👍（2） 💬（0）<div>你说服务需要具备，4个接口，start，stop，appconfig，healthcheck。
有2点疑问，1start不是系统外部命令行启动的时候，运行的main函数？2appconfig，很多参数比如配置文件或者配置文件地址，都应该是允许时传人参数，允许时可以读取配置，可以修改部分配置，例如修改日志打印级别等，是不是这些？</div>2017-12-15</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/2nM9PaEsM4UiaUc0R3iaiaOumFVkcugGhdUObpEBq0bEKnjF6DSTmjsibFbmJHtUphfXsFGd1ueJwMoonia3jicyPC1w/132" width="30px"><span>永靖</span> 👍（2） 💬（1）<div>全栈监控的各项核心技术指标能给详细介绍一下吗</div>2017-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/45/d5/d3b92d32.jpg" width="30px"><span>Case</span> 👍（2） 💬（0）<div>高内聚低耦合，强大的可扩展性，从很多大型软件后台，都可以看到他们的发展趋势，基本就是分而治之，随着业务发展而形成很多独立的模块，然而那是花了大量时间和人力来实现的，拥抱docker+云时代。</div>2017-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/65/d5/88beb15a.jpg" width="30px"><span>李志博</span> 👍（2） 💬（0）<div>马上要搞监控了，超级期待监控的文章</div>2017-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/bc/e8/0aeb1380.jpg" width="30px"><span>林生树</span> 👍（1） 💬（0）<div>面试的时候其实就问了这个，如何设计一个高性能低延迟高吞吐高可用的系统，杂七杂八的说了一通，早点看到就好了</div>2023-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（1） 💬（0）<div>构建分布式系统的目的：提高整体架构的吞吐量、提高系统的稳定性。

提高系统性能的常用技术：缓存、负载均衡、异步调用、数据分区和数据镜像（读写分离、分库分表）。

提高架构稳定性的常用技术：服务拆分、服务冗余、限流降级、高可用架构、高可用运维。

分布式系统的关键技术：服务治理、架构软件管理、DevOps、自动化运维、资源调度管理、整体架构监控、流量控制。

分布式系统的关键技术：全栈系统监控、服务 &#47; 资源调度、流量调度、状态 &#47; 数据调度、开发和运维自动化。

上面算是分布式技术的“纲”，对于我来说却有点像是“屠龙之技”，暂时用不到。如果有机会，我也非常愿意找一份相关的工作，修炼一下。</div>2023-03-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/a0/2e/787cbac0.jpg" width="30px"><span>白果园的格里高力</span> 👍（1） 💬（0）<div>在左耳老师的带领下俯瞰分布式技术全貌，有种一览众山小的爽快感受。
尽管有些概念还不是很明白，既是因为自己基础薄弱，又或许是在这节概述性的课中没必要过度展开。
我的小结：为了提升大流量处理能力和应用的稳定性、可用性，我们引入了分布式；分布式技术有很多手段（略），但同时也引入了很多问题（略）；解决这些问题的技术也有很多，但是最关键的三项技术分别是：监控、调度（服务、资源，状态、数据的，流量的）、自动化运维</div>2021-09-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ea/0c/d79ae60d.jpg" width="30px"><span>Vance</span> 👍（1） 💬（0）<div>分布式架构系统的技术栈还是比较深的。</div>2019-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/ec/8f/8299495a.jpg" width="30px"><span>少盐</span> 👍（1） 💬（0）<div>高吞吐，高稳定，那分布式的纲是什么呢</div>2019-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（1） 💬（0）<div>厉害，提纲挈领，一把抓住了分布式之网的大纲，需要多读几遍，然后顺藤摸瓜，逐步深入研究。</div>2018-12-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/09/10/10026ba8.jpg" width="30px"><span>小羊</span> 👍（1） 💬（0）<div>架构性能提高：
1.缓存：缓存系统 缓存分区，缓存命中，缓存更新
2.负载均衡：网关系统 负载均衡，服务路由，服务发现
3.异步调用：异步系统 消息队列，消息持久，异步事务
4.数据镜像：数据镜像 数据同步，数据分离，数据一致性
5.数据分区：数据分区 分区策略，数据访问层，数据一致性

架构稳定性：
1.服务拆分：服务治理 服务调用，依赖，隔离
2.服务冗余：服务调度 弹性伸缩，故障转移，服务发现
3.限流降级：降级限流 异步队列服务降级，限流熔断
4.高可用架构：高可用架构 多租户系统，宰被多活，高可用服务
5.高可用运维：高可用运维  全栈监控 devops，自动化运维


</div>2018-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/8a/b9/2b739dec.jpg" width="30px"><span>关冕</span> 👍（1） 💬（0）<div>“架构软件管理”可以再展开讲一下吗？</div>2018-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b9/a0/2e702efd.jpg" width="30px"><span>猪猪</span> 👍（1） 💬（0）<div>真的是干货，不错</div>2018-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/96/36/0025b51d.jpg" width="30px"><span>朱海峰</span> 👍（1） 💬（0）<div>老师，分布式 ，去中心化，讲讲</div>2018-03-27</li><br/><li><img src="" width="30px"><span>最初的信仰</span> 👍（1） 💬（0）<div>期待后面的文章</div>2017-12-14</li><br/>
</ul>