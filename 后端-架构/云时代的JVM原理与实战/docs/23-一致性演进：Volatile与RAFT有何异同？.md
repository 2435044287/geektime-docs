你好，我是康杨。今天我们来聊一下一致性问题。

在分布式系统中，一致性（Consistency）是一个至关重要的概念。这节课我们将探讨各种一致性概念，比如线性一致性（Linearizability）、顺序一致性（Sequential Consistency）、最终一致性（Eventual Consistency），并深入分析 Volatile 与 RAFT 在实现线性一致性的差异。

## 一致性定义

一致性是指系统中的所有实例在相同的状态下执行。根据 CAP 定理，一致性可以分为强一致性（Strong Consistency）和最终一致性（Eventual Consistency）。强一致性要求系统在所有时刻都保持一致状态，而最终一致性则允许系统在经过一段时间后达到一致状态。

### 线性一致性

线性一致性是一种强一致性模型，它要求所有操作按顺序执行。就如同一个严密的齿轮系统，每个齿轮都紧密相依，按照前一个齿轮的转动节奏，有条不紊地向前推进。我们在执行操作时，每个步骤都必须依赖前面的步骤，确保每个操作的结果都能充分地建立在之前所有操作的基础之上。

### 顺序一致性

顺序一致性是一种较为宽松的一致性模型，它要求操作按照它们在日志中的顺序执行。只要操作在日志中的顺序正确，系统就是一致的。顺序一致性则像是图书馆的管理系统，每本书都有自己的编号，只要按照编号的顺序上架和借阅，那么整个图书馆就能保持井然有序。同样的，这就像我们在处理电子邮件时，只要按照收件时间的顺序逐一阅读和回复，就不会出现混乱的情况。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/19/aa/5c/d2c1c7ce.jpg" width="30px"><span>^_^</span> 👍（0） 💬（0）<div>RAFT每一次读请求都由 Leader 节点处理，这样的话Leader节点是很容易成为性能瓶颈的，这块有什么好的解决方案呢？</div>2023-12-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（0）<div>请教老师几个问题：
Q1：进程内存假如是100M，3个线程，每个线程20M，那么，主内存是指剩下的40M内存吗？而且，这个“主内存”是和CPU缓存无关，对吗？
Q2：volatile全局版本号，是谁维护的，JVM维护吗？
Q3：etcd，不同的节点保存的数据是不同的吧，如果是不同的，为什么需要同步和一致？</div>2023-10-20</li><br/>
</ul>