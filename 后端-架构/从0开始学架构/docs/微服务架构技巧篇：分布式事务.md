你好，我是华仔。

上一节我们讲解了微服务架构设计中“服务分布式”带来的技术挑战，以及各种应对技巧。这一节，我们将继续讲解如何应对微服务架构另一个特点“数据分布式”带来的技术挑战。

“数据分布式”带来的技术挑战，本质上都可以归因于**原来可以在单个关系数据库上完成的复杂操作，因为微服务拆分后就没法用了**。

行业技术老兵应该都见过“存储过程”这种典型的面向数据库的开发模式。我曾见过长达几百上千行的存储过程，无论是看代码、调试、定位，还是修改、重用、移植等，对技术人员来说都是地狱级的难度。即便有的企业给出了存储过程使用的各种规范和限制，但只要没有严格的审核和监督，开发人员就会逐步滥用存储过程。很多时候，单次开发用存储过程确实很方便和快速，某些场景下性能也更高，因为不需要从数据库读取数据到应用程序中，处理后又将数据写入数据库。

当单体或者SOA系统拆分成微服务架构后，单个微服务职责简化，管理的数据范围缩小，微服务之间只能通过接口访问，可以说从根源上改变了复杂存储过程生存的土壤，而简单的存储过程相比代码来说没有什么优势，所以微服务中使用存储过程其实没有必要。

微服务架构虽然不需要“存储过程”这种开发模式了，但这也带来了一个新的技术挑战：**多个微服务如何保证数据一致性**。接下来，我们按照不同的拆分模式简单分析一下。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/37/b4/df897320.jpg" width="30px"><span>vooc</span> 👍（5） 💬（1）<div>微服务之间为什么不通过数据库层面的分布式事务协议 XA 来实现分布式一致性？
优点：业务无侵入，数据库支持比较广泛
缺点：阻塞时间长，性能差</div>2025-01-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg" width="30px"><span>return</span> 👍（1） 💬（1）<div>“Confirm：确认操作，对业务处理进行提交，即 commit 操作。只要 Try 成功，该步骤就一定成功。”
请教华哥，  只要 Try 成功， Confirm 一定成功， 这个怎么理解。
如果Try 成功后， 这个机器正好挂了，后面 Confirm 就不行吧。</div>2025-01-07</li><br/>
</ul>