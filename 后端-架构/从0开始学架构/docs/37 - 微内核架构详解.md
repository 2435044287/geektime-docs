微内核架构（Microkernel Architecture），也被称为插件化架构（Plug-in Architecture），是一种面向功能进行拆分的可扩展性架构，通常用于实现基于产品（原文为product-based，指存在多个版本、需要下载安装才能使用，与web-based相对应）的应用。例如Eclipse这类IDE软件、UNIX这类操作系统、淘宝App这类客户端软件等，也有一些企业将自己的业务系统设计成微内核的架构，例如保险公司的保险核算逻辑系统，不同的保险品种可以将逻辑封装成插件。

今天我将为你详细介绍常见的微内核架构及其实现。

## 基本架构

微内核架构包含两类组件：核心系统（core system）和插件模块（plug-in modules）。核心系统负责和具体业务功能无关的通用功能，例如模块加载、模块间通信等；插件模块负责实现具体的业务逻辑，例如专栏前面经常提到的“学生信息管理”系统中的“手机号注册”功能。

微内核的基本架构示意图如下：

![](https://static001.geekbang.org/resource/image/a9/d9/a97399aff2c030aabc9982783cc0bfd9.jpg?wh=3004%2A1590)

上面这张图中核心系统Core System功能比较稳定，不会因为业务功能扩展而不断修改，插件模块可以根据业务功能的需要不断地扩展。微内核的架构本质就是将变化部分封装在插件里面，从而达到快速灵活扩展的目的，而又不影响整体系统的稳定。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64HvRATbWjc3hkic7icUszl9hU9hpIMZcibKH4wWam4SHfkcvM7MUoKjGDRrvYGXuvR91Q/132" width="30px"><span>性能</span> 👍（41） 💬（1）<div>突然发现我们用了很久的框架，是微内核架构</div>2018-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e2/e9/d309c895.jpg" width="30px"><span>Boh</span> 👍（15） 💬（2）<div>请教老师一个问题，我们目前使用的规则引擎就是这种架构，不过目前存在一个比较头疼的问题，就是对内开放了一个引擎调用接口，可是由于规则非常多，所以接口的请求参数和响应参数是动态的，所以接口调用传参比较头疼。目前我们的做法是将规则根据业务整合成起来，然后将每个业务的输入参数输出参数写入配置表，调用方先根据业务类型读取配置表查询输入输出参数的定义和类型，然后调用方自己生成这份数据调用接口，这样导致接入很不友好同时每次变动改动的地方非常多，而且配置表也越来越臃肿，请问老师这种情况有什么比较好的方案吗</div>2019-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/dd/cb/23b114a7.jpg" width="30px"><span>xiao皮孩。。</span> 👍（14） 💬（1）<div>作者对规则引擎情有独钟啊</div>2019-04-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg" width="30px"><span>小喵喵</span> 👍（13） 💬（1）<div>1 规则引擎，我简单的理解为开发人员把规则提前写到数据库，这个是基础数据，然后用户选择规则，具体选择了那些规则可以通过外键关联。
2 那么多规则，就比如促销的例子，用策略模式实现是否更妥当？</div>2018-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c6/7a/3c95e843.jpg" width="30px"><span>醉爱星巴克</span> 👍（12） 💬（2）<div>想问问流程引擎算不算规则引擎的一种呢？</div>2018-07-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/08/36/98be3d69.jpg" width="30px"><span>奋斗心</span> 👍（9） 💬（1）<div>那能不能说规则引擎用了策略模式</div>2018-09-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/38/57/a9f9705a.jpg" width="30px"><span>无聊夫斯基</span> 👍（9） 💬（2）<div>微内核我还真没接触过，又get到灵活的方案
</div>2018-09-14</li><br/><li><img src="" width="30px"><span>Geek_b6e6bc</span> 👍（6） 💬（1）<div>你好 老师。读了这节感觉收益很多，尤其是加深对spring的认识，有点体会，想到了其他的 mysql是不是也是个微内核架构 server层是公用核心部分，存储引擎层属于插件，可以替换， 还有dubbo框架也算是个微内核架构</div>2021-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ca/16/a7ed6dca.jpg" width="30px"><span>飘宝</span> 👍（6） 💬（1）<div>李老师，我已经找到了基于产品这种说法的基本出处了，是在Mark Richards的软件架构模式中描述的。其中也对比了几种常见的架构，写的还是很实用的。
我也买了您的从零开始学架构的书，是一本非常适合反复翻阅的书。</div>2019-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d2/31/f1bec7fc.jpg" width="30px"><span>汉斯·冯·拉特</span> 👍（5） 💬（1）<div>老师，能不能写个基于微内核的代码例子在github上，之前也听过微内核，但是到目前为止，接触到的都是分层结构的架构</div>2018-07-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/28/3b6546e8.jpg" width="30px"><span>Snway</span> 👍（3） 💬（1）<div>采用过esper实现复杂事件流处理引擎，看完此文，对原有架构设计有更深层次理解，感谢华仔</div>2018-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/6e/85512d27.jpg" width="30px"><span>刘工的一号马由</span> 👍（2） 💬（1）<div>微内核架构和微服务架构区别就在于粒度吗？</div>2019-07-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132" width="30px"><span>梦倚栏杆</span> 👍（1） 💬（1）<div>是不是控制流程的框架类功能都是微内核架构，比如测试框架，junit等</div>2021-04-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIeYicSzsPcAWWxTq6LPwicvNg1DIzPjAo0nQDtqMMDRV8Nmm2Is5TiaEHSCZKeEDLBZ78uEViaKiccVFA/132" width="30px"><span>拉羒尔</span> 👍（1） 💬（1）<div>有点像我们的调度系统</div>2021-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6b/d4/86b09190.jpg" width="30px"><span>jason</span> 👍（1） 💬（2）<div>尝试了一下用规则引擎实现各种活动的业务逻辑，感觉很复杂，比如首先第一步你需要通过运营配置的原子规则构造规则模板，这一步少不了代码中写ifelse或者模板中写when then ,第2步需要把业务逻辑封装成各种规则规则，第3步组装规则为新业务，感觉还不如策略模式好维护和效率高，唯一的优点貌似只是动态化，并且这种规则运营会不会使用</div>2019-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg" width="30px"><span>花花大脸猫</span> 👍（1） 💬（1）<div>在实际场景中遇到的微内核架构基本没有，读了老师这篇文章，有了一个形象的了解，期待能在后续多接触接触微内核这块的架构，老师的文章干货满满！！</div>2019-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/13/3a/b0454322.jpg" width="30px"><span>Eric</span> 👍（1） 💬（1）<div>老师 我想问问 事件驱动型 比如 CQRS 是属于那种架构，我个人理解 是 面向流程的？</div>2018-11-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8e/0b/89055f4c.jpg" width="30px"><span>cn</span> 👍（1） 💬（1）<div>我们现在的数据平台是通过节点连接来表示数据处理和流转，是否也适合用微内核来实现底层引擎。请教下阿里这种数据流引擎是怎么实现的。</div>2018-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/13/34/abb7bfe3.jpg" width="30px"><span>小鱼儿</span> 👍（1） 💬（1）<div>以前做电子合同时有涉及到规则引擎，计算很快，不知道.net有没有类似于Drools的框架？</div>2018-07-23</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132" width="30px"><span>帝江</span> 👍（0） 💬（1）<div>以前实现过一个预擎系统，跟据规则采集数据然后报警，我把规则提出来了，核心代码体现流程，具体流程中各种加载。这算什么架构呢？</div>2024-10-01</li><br/><li><img src="" width="30px"><span>陈峰</span> 👍（0） 💬（1）<div>老师，微内核有几个疑问。

1. OSGi中bundle是不是和spring中的bean很像，前面也提到了 Spring的依赖注入也是插件连接的一种。那么，是不是，如果Spring中 我的Component提供一个具体的功能(比如，短信注册)，然后 通过依赖注入相互调用，本质上就是一种微内核架构呢？

2. 感觉文中，依赖注入 写的是 插件连接的方式，好像对比后文不太准确？

读完OSGi的介绍后，我感觉 如果把Component视为插件 Spring对Bean的管理(扫描和注册)是插件管理，Bean的生命周期 是插件连接，Bean相互依赖注入并调用，是插件通信。我不知道我理解的是否有问题？

3. 我们之前讲到，微内核是面相功能的拆分，而分层是面相流程的拆分，这两种方式是否是二选一的，还是说，我可以面相功能拆分成插件以后再对每个插件进行分层拆分。

4.  规则引擎的例子中说到 规则是插件 语言是连接 数据流是通信，对比下文的drools，我不太理解这几句(没用过规则引擎做过业务，不太理解场景)

就比如文中说的 规则是插件，这里的规则是指 drl文件中的一个 rule吗？

后面说 引擎将数据传递到下一个规则，所以数据流是通信。我看网上的demo是，编写 drl文件，在业务代码里过滤出一组规则进行执行。这里怎么样体现了数据流或者插件通信呢？</div>2023-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/93/ad/76101119.jpg" width="30px"><span>YANG</span> 👍（0） 💬（1）<div>Shopify Marketplace 不属于微内核架构？</div>2022-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/be/dc/ce674e93.jpg" width="30px"><span>Michael</span> 👍（0） 💬（2）<div>规则引擎是不是代码里编写一套如“当？条件发生，则执行？（比如增加最后结果的权重）”，再有一个判断逻辑“当最后结果满足？时，最终结果发生”。这是代码部分，里面没有一点具体业务规则，而？处就是db里配置的数据。
如果是这样的规则引擎，那这个引擎的代码要能考虑到各种奇怪的规则，而且这个推出最后结果是否发生的逻辑也要能适配各种复杂情况。这样才能在业务人员在portal配置好规则数据后，直接能用这些规则</div>2022-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg" width="30px"><span>| ~浑蛋~</span> 👍（0） 💬（1）<div>SPI机制算是一种微内核架构吗</div>2022-06-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2d/9a/9b/cc08f6b3.jpg" width="30px"><span>e⃰v⃰a⃰n⃰</span> 👍（0） 💬（1）<div>老师，您好，这个插件是用来修改数据库的吗？自己直接做个页面来指定规则不就行了吗？使用这个插件的意义是什么呢？</div>2022-05-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/d6/46/5eb5261b.jpg" width="30px"><span>Sudouble</span> 👍（0） 💬（1）<div>谢谢李老师！规则引擎，get到。前不久做了这个，那时候自己想了一套方案，看看目前这方面的是不是可以套用上，降低重复造轮子的程度。</div>2022-02-16</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/0iafBsuyfz4p49JhiceAtwT8cAL6bJGaUwZibjw5iatwiankZ9mqnjafzhpBt1Vwzy2mhUiagVqD0URIlKcH07ibnicO5g/132" width="30px"><span>Joker</span> 👍（0） 💬（1）<div>贴上一个手撸微内核架构的源码。 可以按分支版本查看收入的过程
https:&#47;&#47;github.com&#47;qzsang&#47;mini-promotion</div>2021-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/bf/cd6bfc22.jpg" width="30px"><span>自然</span> 👍（0） 💬（1）<div>OSGi还是挺复杂的，对整个开发团队要求很高。</div>2021-04-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epmAicDUiaUdtLhVwSs6fT0yx69ibWy6ia46ZD4vblGtyee8QFz71icKZJkzccAFG3zHnMngSz7WeGBtKw/132" width="30px"><span>小神david</span> 👍（0） 💬（2）<div>咋突然从微服务就讲到了微内核呢？其中的关联逻辑是？</div>2021-03-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/33/74/d9d143fa.jpg" width="30px"><span>silentyears</span> 👍（0） 💬（1）<div>请问李老师 用规则引擎 虽然动态了 但是不好管理和维护 规则粒度该怎么划分好？ 谢谢</div>2020-12-01</li><br/>
</ul>