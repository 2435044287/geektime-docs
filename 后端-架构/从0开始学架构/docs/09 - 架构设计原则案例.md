周二，我给你介绍了架构设计的三条核心原则，先复习一下：合适原则、简单原则和演化原则。我们在架构设计实践中，应该时刻谨记这三条设计原则，指导我们设计出合适的架构，即使是代表中国互联网技术最顶尖水平的BAT，其架构的发展历程也同样遵循这三条原则。

今天我就以大家耳熟能详的淘宝和手机QQ作为案例，来简单分析一下。

## 淘宝

注：以下部分内容摘自《淘宝技术发展》。

淘宝技术发展主要经历了“个人网站”→“Oracle/支付宝/旺旺”→“Java时代1.0”→“Java时代2.0”→“Java时代3.0”→“分布式时代”。我们看看每个阶段的主要驱动力是什么。

1.个人网站

> 2003年4月7日马云提出成立淘宝，2003年5月10日淘宝就上线了，中间只有1个月，怎么办？淘宝的答案就是：买一个。

> 估计大部分人很难想象如今技术牛气冲天的阿里最初的淘宝竟然是买来的，我们看看当初决策的依据：

> 当时对整个项目组来说压力最大的就是时间，怎么在最短的时间内把一个从来就没有的网站从零开始建立起来？了解淘宝历史的人知道淘宝是在 2003 年 5 月 10 日上线的，这之间只有一个月。要是你在这个团队里，你怎么做？我们的答案就是：买一个来。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/df/e2/823a04b4.jpg" width="30px"><span>小小笑儿</span> 👍（81） 💬（1）<div>适合原则，简单原则，演化原则这三个点归纳得很精辟，本次课程也通过实例来讲解了各个原则的使用。但是我还有个小小的疑问，就是在对这些成功项目进行复盘的时候我们可以很清楚的辨别什么时候采用什么原则优先，而如果把我们回到之前选择的时间点上，如何更准确的判断应该采用什么原则呢？</div>2018-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/9e/56/af7a9435.jpg" width="30px"><span>米斯特.杜</span> 👍（43） 💬（2）<div>探讨个问题，希望可以得到回答。之前看过云栖社区对faceu的cto的采访，他说当时他们上第一版后台系统时就直接选型了阿里云的drds，他自己也不知道用户量会不会上来。他还说如果当时他没选drds方案，到后来用户井喷式增长时系统再做调整估计等不到改好用户就跑光了。所以我的问题是，对于像这种近两年创业的公司可能做出爆款产品时，系统架构方面是否需要向前多考虑一些？</div>2018-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ce/2b/a47a0936.jpg" width="30px"><span>何国平</span> 👍（40） 💬（3）<div>所以有些公司要求两三年就重构一次</div>2018-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/15/03/c0fe1dbf.jpg" width="30px"><span>考休</span> 👍（29） 💬（4）<div>技术的架构有很大一方面也是由于互联网产品的特殊演化导致的，互联网产品讲究小步快跑、快速迭代，尤其是在产品初期，需要依据初始用户的反馈快速优化产品，所以技术上来说产品初期对可扩展性的要求比较高，而到了中后期，由于产品的核心功能开始稳定，但是用户量又达到了一定的量级，这个时候又对系统的高性能、高可用提出来较高的要求。</div>2019-07-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/94/56ea80f7.jpg" width="30px"><span>沐风</span> 👍（28） 💬（4）<div>能不能讲下关于并发和pv，日活，在线人数的计算方式和关系</div>2018-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ee/73/122500d0.jpg" width="30px"><span>bigticket</span> 👍（25） 💬（1）<div>今天看到一条微博，收集了七年前appstore里微信的用户评价，骂声一片，很多是说连不上数据库的问题，而现在用微信已经很少出现bug，感觉非常能体现架构演进的原则，早期用户量少，架构设计主要考虑合适、简单两个原则，当用户量变大引起复杂度提高，从而导致无法正常运行时，倒逼架构进行演进优化。现在能支持的高峰大并发的方案很多，应该算比较成熟了，那下一个能打破现有架构设计的业务需求可能是什么？感觉又回到了要不要预测问题，过度设计的循环中…</div>2018-05-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/68/c2/2280961f.jpg" width="30px"><span>syhasia</span> 👍（20） 💬（1）<div>请问老师，多租户（大于1k）场景下，用户读次数远大于写，数据库需要分库分表吗？还是一个库多个schema（一个schema代表一个用户）就够了？</div>2018-09-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/13/d2/1028a489.jpg" width="30px"><span>Dong Zhang</span> 👍（13） 💬（1）<div>我是做infra的，企业部分打交道多，主要做设计实施，售前设计接触过一点。前期拼方案的时候，演进原则不好说，简单和适用还是要的吧，为了降低竞标成本。当然最重要的是和客户感情上关系上生意上都谈拢，很多时候标书都可能是抄某个牌子来的。设计实施的时候简单适用还是很重要，演进还真不是特别快，一般能用未来3～5年就好。我在infra看，构架师和客户的沟通、说服、取信非常重要，特别不同部门不同级别；集成商将各种厂商粘合到一起很难，需要的知识很广；构架师对于项目和行业具体情况的经验积累也是很重要。总体来说我觉得构架师的双商都要高，既能搞定人，也要有技术广度和一定深度，还要有丰富的领域和临场经验。</div>2018-09-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/05/06/9b9b3143.jpg" width="30px"><span>如风</span> 👍（9） 💬（1）<div>很多跟我们公司类似，公司从创业再到上市，从无到有，再到每天几千万笔的流量都经历过了，开始也是追求快，所有业务公用一个数据库，一出现问题，引发全部拖死，不断优化演进，业务及架构不断分离，很多东西也是买，买云服务，架构不只是简单的一个框架，涉及的东西太广了，从网络服务器，再到应用软件，数据存储等等，需要建立一套可行的运维监控体系...</div>2018-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/dc/b7/e59c22f0.jpg" width="30px"><span>黄金的太阳</span> 👍（9） 💬（2）<div>一直追剧追到现在，感觉受益匪浅，也是第一次留言，因本人能力有限，这篇文章中关于架构演进过程中各个环节希望能有更进一步关于架构图的配套说明，例如
1.本次演进改进的点在哪里
2.为什么这样设计就能解决当时的问题
而不是直接一张图，没有任何说明，也许对于架构师大神们是很小白的问题，但咱们的课程是不是要考虑到从0开始学架构的兄弟们呢？一点小建议</div>2018-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg" width="30px"><span>孙振超</span> 👍（8） 💬（1）<div>各个公司的架构都是逐渐演进成当前的样子，在达到同样目的的过程中实现手段确并不完全相同，蚂蚁和阿里都进行了多地多中心部署的架构改造，但二者在诸如配置中心、跨ldc访问管控等方面都不尽相同，即使在蚂蚁内部也出现了后续实现推翻原始规划的情况。在多地多中心部署架构改造完成后，为进一步降低成本，避免大促活动中机器的浪费，又开始了弹性部署的改造，希望能够在大促高峰来临的前几个小时再临时增加服务器，等活动结束服务器就立即回收。等这个搞定，又开始在线离线混布的改造，进一步降低整体成本。
这些改造只所以一个接一个的能够实现，也在于使用的主要中间件和框架都是自研的，知根知底，可以快速迭代修改，如果是使用第三方的或者购买的，一方面可能非常贵，另一方面可能根本不支持，要重新设计改造部署所需的时间要远远大于自研的成本。</div>2018-06-04</li><br/><li><img src="" width="30px"><span>hater</span> 👍（6） 💬（1）<div>有些公司要求两三年就重构一次，不一定是公司重视技术，也可能是人有问题。业务量没增加，业务没变化，换个领导就带一批自己人，推翻以前的重构一次，过两年再换一个领导再换一批人，再重来一次，这样的公司也不少</div>2018-06-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d8/04/fa169712.jpg" width="30px"><span>乌云里的黑帆</span> 👍（6） 💬（2）<div>老师您好，这样的演化过程需要怎样的人力财力呢？我们公司没架构师，没高级工程师，但总监特别中意阿里的一些方案，这个路线可以成功吗？</div>2018-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/9c/73/4d23e4f2.jpg" width="30px"><span>俊哥</span> 👍（5） 💬（1）<div>Java 时代 3.0 我个人认为是淘宝技术飞跃的开始，简单来说就是淘宝技术从商用转为“自研”，典型的就是去 IOE 化。

这里说的是IOE指的是啥？</div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e9/13/1f92e7f5.jpg" width="30px"><span>one day</span> 👍（4） 💬（1）<div>在简单，演化，合适三原则之下我们也要考虑当时的技术水平，淘宝开始的技术是没有目前分布式成熟系统的，我们在架构设计时并不一定开始就搭建一个只是简单的系统，因为我们占在时代前进的道路上，原来是复杂的现在反而是简单，原来需要演化许多年的，现在也可能只需几天。根据业务，根据技术，根据人员，根据时间，根据可看到的未来。架构不确定，多思，就让设计的架构多撑几年</div>2018-05-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e4/45/846f8441.jpg" width="30px"><span>MichaelJY</span> 👍（4） 💬（1）<div>感觉所有的互联网产品都要遵循上面的原则。
首先要合适，然后简单，最后演进。
互联网时代机会稍纵即逝，所以要快速出一个基础产品，要快，要活下来先！然后随着业务的发展，逐步演进架构，当然这里面也涉及到一些技术架构的决策。

感觉上面的三原则和敏捷开发宗旨差不多，快速地持续地交付有价值的产品！

</div>2018-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/44/10/7bfc89a8.jpg" width="30px"><span>SHLOMA</span> 👍（4） 💬（1）<div>李老师，您好，简单和合适原则是否是贯穿所有架构设计，而演化原则，则是指在当前架构无法通过优化手段适应当前业务量，重新设计架构?</div>2018-05-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5d/9d/4ee1faf4.jpg" width="30px"><span>Bob</span> 👍（4） 💬（3）<div>要是当年淘宝买了商用的PHP连接池，世界将会怎样？PHP会真的成为宇宙第一语言吗😂</div>2018-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d8/c3/0f7bc39e.jpg" width="30px"><span>独步舞者</span> 👍（4） 💬（2）<div>也是受那个时代技术的影响决定的，05年有分布式，阿里也会选择使用</div>2018-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7f/1a/eb8021c3.jpg" width="30px"><span>追寻云的痕迹</span> 👍（4） 💬（1）<div>从0到1时牢记KISS原则，做大业务，等你有钱了自然请得起人了😂</div>2018-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg" width="30px"><span>escray</span> 👍（3） 💬（1）<div>其实从淘宝和 QQ 的架构发展过程来看，的确是体现了合适、简单、演化三原则。我觉的其中比较厉害的是，它们在架构演化过程中，在技术路线上，几乎没有犯过什么大的错误。也可能有过失误，要么不致命，或者是硬撑过去了。

在留言里面看到了一些对于微信架构的讨论，有点好奇，微信的架构演进是如何操作的，因为有 QQ 导流，所以微信在一开始面对的用户量可能会大一些。在网络上找到张文瑞 2016 年写的《从0到1：微信后台系统的演进之路》，和专栏里面的架构设计三原则有很多吻合的地方。

其实对于一个应用系统，理想的状况应该是从少量用户开始做起，逐步吸引更多的流量，无论是架构还是功能，都可以逐步完善。

说服领导接受架构设计的合适和简单原则，可能遇到一些困难；演化靠时间检验，也需要耐心；作为架构师，估计还得要磨炼一下沟通能力。当然，架构师的口碑和信用也是通过逐渐积累获得的。</div>2020-09-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/16/2d/2753369a.jpg" width="30px"><span>Geek_58ezrw</span> 👍（3） 💬（1）<div>看了李老师的架构原则，再回顾在公司的架构经历。之前定的的一些方案，感觉是为了技术而去技术，结果消化不良，出了问题，还不好解决。后面又回到了最容易掌握的架构方式去做。，系统也相对来说稳定。
总结:架构设计的三大原则都是从实践中得来。</div>2018-11-18</li><br/><li><img src="" width="30px"><span>kai</span> 👍（3） 💬（1）<div>
合适原则第一考虑，优先满足业务需求；
简单原则第二考虑，挑选简单方案快速落地验证；
演进原则第三考虑，适当预测业务发展，感觉预测不准就不预测，等真的出现问题的时候演进即可

这和大家常说的牌脑袋有什么区别呢？</div>2018-05-29</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5QbBF920qWNw4fmHtfyECDGbrMXbbhng60L4HyoGwYWIA9MKdeicJ3tGib7ibCiactOdVMy3s8dAVgw/132" width="30px"><span>Geek_3875b7</span> 👍（2） 💬（1）<div>合适原则很重要，之前去有些企业面试会遇到一些领导上来就是要做京东，做淘宝的类似项目，问架构如何搞？真的不知道如何回答他。毕竟这些抛开技术层面还是有很多其他方面需要考虑的。</div>2020-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6a/21/fe356d0b.jpg" width="30px"><span>辉辉</span> 👍（2） 💬（1）<div>适合互联网:快，短，频。是不是一定适合传统IT行业?传统IT行业，现在打标拼的技术部分不再是合适，简单，演化。是各种高大尚的方案。</div>2018-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/90/13/b5479887.jpg" width="30px"><span>Will</span> 👍（2） 💬（1）<div>在淘宝和qq的前面两个阶段都是采用了合适和简单原则，在第三个阶段候才采用的演化原则。前面的阶段技术实现要快，要快速的满足业务发展的需要，技术以够用为主。后面的技术选型就以发展为主，要为后来的发展奠定基础。这也给公司在大的技术路线选择上提供了参考。</div>2018-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/f7/ba/08044ec3.jpg" width="30px"><span>张平</span> 👍（1） 💬（1）<div>一切从实际情况出发，实事求是；步子迈小了，别别扭扭；步子迈大了，可能就扯到蛋了；</div>2021-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/28/aa/06c12256.jpg" width="30px"><span>两只狮子</span> 👍（1） 💬（1）<div>今天学完了设计原则的案例，对简单、合适、演化的原则理解加深了一步。两个大厂的架构升级都是从最开始的简单结构升级为复杂结构，这中间经历了整个互联网行业的大起大落，也同时为互联网行业的架构提供了丰富的经验。突然想到了一个问题，我们提倡简单、合适、演化的原则，从阿里和腾讯的发展经历看，最初的简单架构尽管符合了我们的原则，但从当时的技术条件来看，也很难提出复杂的架构来，如果阿里和腾讯当时有技术能力做出复杂的架构，那么两位老板会怎么选呢？
在有了这么多大型系统的架构经验后，技术上我们可以做出强大、复杂的架构。对比最初，尽管我们有条件设计复杂的架构，但是从文中的经验看，我们更要提醒自己要设计出合适的架构而不是高大上的架构。</div>2020-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（1） 💬（1）<div>嗯，老师讲的很棒，不过事后诸葛亮容易当，事前诸葛亮难寻。对于做事的原则，就拿架构设计的原则来讲，知道了也不一定能设计好。好似熟读了孙子兵法也不一定能打胜仗，这个怎么破呢？</div>2019-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/14/89/229bb890.jpg" width="30px"><span>舒偌一</span> 👍（1） 💬（1）<div>大多是这样做的吧，除非很有钱。</div>2019-08-21</li><br/>
</ul>