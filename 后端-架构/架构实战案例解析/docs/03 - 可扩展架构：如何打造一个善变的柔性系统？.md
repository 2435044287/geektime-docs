你好，我是王庆友，今天我和你聊一聊如何打造可扩展的架构。

在实际工作中，业务需求总在不断变化，因此，你经常会面临以下这些问题：

- 如何快速地上线新业务？老板很可能明天就想看到效果。
- 对某个功能进行修改，如何不影响到系统其它的功能？

对于新的需求变化，我们一方面要快快搞定，另一方面要稳稳接住。但问题是软件虽然姓“软”，但也不是想变就能变，如果事先没有经过良好的设计，调整起来，往往牵一发动全身，导致系统到处出问题。

那如何设计一个具有良好扩展性的系统，能够快速支持业务变化落地呢？

接下来，我们围绕系统的可扩展，先来了解下什么是系统，什么样的系统才能具备良好的扩展能力。然后通过一个实际的例子，说明如何通过架构手段打造一个可扩展的系统。

## 系统的构成：模块+关系

我们天天和系统打交道，但你有没想过系统到底是什么？在我看来，系统内部是有明确结构的，它可以简化表达为：**系统 = 模块+关系。**

![](https://static001.geekbang.org/resource/image/9e/8d/9ebf45d4bbaa1cf35873c2def64b618d.jpg?wh=1141%2A317)

在这里，模块是系统的基本组成部分，它泛指子系统、应用、服务或功能模块。关系指模块之间的依赖关系，简单地讲，就是模块之间有调用，我们知道，调用区分发起方和服务方，因此，依赖关系是有方向性的。

这个模型虽然简单，但它给我们提供了一个深入分析系统的工具。接下来，我们就从业务扩展性出发，讨论什么样的模块是容易修改的，什么样的依赖关系是容易调整的。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/79/b6/faaa95a2.jpg" width="30px"><span>航哥很帅</span> 👍（20） 💬（3）<div>看到目前，说说目前我对业务系统的理解：

架构的本质其实是如何通过一定的合理编排，让一个软件系统变得的有序，从而满足业务和技术的不断变化。说的高大上一些就是如何让系统变得更有序，而不是系统的熵变得越来越大。那如何让系统变得更有序呢？一般有两种方式：一种是分，一种是合。分就是能够对系统进行拆分，拆分成各个不同的业务模块，同时梳理清楚各个模块之间的关系；合就是能够将模块根据业务的种类，能够把相同的功能模块给合并起来，来统一对外提供服务。


对于业务架构的划分来说，有两个角色好像是在做相同的事情，一个是产品经理，一个是业务架构师。产品经理更多是面向用户侧的，目的是让用户能够对业务认识更清楚，而且产品经理一般不用从业务设计和实现的角度来考虑问题，所以产品经理和开发人员的对接就会比较困难。而业务架构师，则是在产品经理设计完产品功能以后，从面相对象设计的角度来划分模块，让软件的功能设计更加合理，更加适合开发。


一个非常简单的例子就是：产品经理设计的功能，一般都是流程化的，即整个业务流程图。而如果开发人员直接按照这个业务流程来进行开发，很有可能每个业务或功能都要照着流程来做，这样势必会造成大量功能的重复开发。而业务架构师往往就是做这个工作的，既然产品经理已经把哥哥业务流程梳理清楚了，那业务架构师就要把所有的业务流程进行融合和整理，从面相对象的角度来进行设计，画出各个对象之间的关系和依赖图，让开发人员能够更好的进行功能开发。


对于业务架构的可扩展性来说，系统如何能够做到柔性可扩展，是衡量一个系统架构设计好坏的金标准。什么是业务系统，说的简单一些业务系统就等于模块+关系。模块拆分好了，关系梳理好了，往往一个业务系统架构也就定义清楚了。但是一个业务系统好不好还有一个非常关键的指标，那就是：系统的可扩展性和功能的复用性是不是很好，因为这关系到了整个系统的生命周期。


系统的可扩展性好，本质上是系统中各个模块的依赖关系清楚，系统中的各个模块不是复杂和混乱的，而是模块和模块之间关系清楚，很少有相互调用，很少有双向调用。

系统的复用性好，本质上系统的逻辑划分清楚，功能模块能够做到粒度适中，通用功能能够合理整合，给各个业务功能提供调用。</div>2020-11-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/ec/49/410176b8.jpg" width="30px"><span>偏偏</span> 👍（10） 💬（1）<div>老师讲的很好，有几个问题请老师指点一下，1. 如果服务拆分的很细了，而且还有大中台提供服务，一般的做架构的话服务是不是可以不用分层和解耦了，如果按业务来看，影响分层和解藕都有哪些因素需要考量。

2. 关于系统重构，业务梳理并划分清楚后，在技术角度需要考量的因素还有那些。</div>2020-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/79/29/a90cf777.jpg" width="30px"><span>深山小书童</span> 👍（7） 💬（1）<div>老师您好，首先得感谢这个课程，案例丰富，干货满满，很有诚意，这十篇文章已经反复研读很多遍。关于可扩展架构的几篇文章老是串不起来，只记得可复用的几篇文章。能否请老师讲一下可扩展的几篇文章的安排思路，方便理解。</div>2020-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg" width="30px"><span>乖，摸摸头</span> 👍（4） 💬（2）<div>
老师，我们现在的一种业务场景，我们做的是一个信息对接平台，简化后的主要内容就是这样。

1.信息分为几大类，用户可以发布几种不同的信息，信息发布流程大不分逻辑是一样的，有一小部分差别，和你举例中的打车有点类似。
2.用户查看别人发布的信息需要消耗积分，查看几种分类的信息消耗的积分是不一样的。
3.用户可以置顶自己发布的信息，需要消耗积分，置顶不同分类信息的积分也是不同的。
4.积分是通过用户 拉新、充值等方式获得的。
5.用户的积分是储存在用户表的一个字段中。
6.用户查看信息、或者发布信息 之前会先判断用户的状态，如果用户被我们做了一些标记，就会先让用户做一些其他操作才能查看信息，比如先填手机号填个验证码.
7. 一条信息只扣一次积分，也就是说，在扣分之前会先查询是否已经扣分，扣过分就不再扣分了。


大致的场景就这样，我把系统划分为下面几个模块、和功能。

用户模块： 登录、注册、鉴权...
信息模块： 发布信息、修改信息...
积分模块： 设置各种信息的扣分单价（比如 A类信息需要1分查看，B类信息需要2分查看）。设置 充值单价(10元20积分，20元50积分等)。 记录 积分来源记、积分消耗等积分记录

问题1： 我这样划分模块合不合适？

问题2： 用户查看信息消耗积分这个动作应该放在哪个模块，是放到用户模块、还是积分模块，还是再新增一个模块。
如果放到用户模块： 先去信息模块获取信息，获取用户信息(需要判断用户状态是否健康) 再扣掉用户积分，然后调用积分模块增加一条积分消耗的记录
如果放到积分模块： 先去信息模块获取信息，调用用户模块(需要判断用户状态是否健康) 再次调用用户模块扣掉积分，再增加一条积分消耗记录。</div>2020-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/74/68/3725546b.jpg" width="30px"><span>Carlos</span> 👍（2） 💬（1）<div>老师，我在开发中遇到这种模块关系，怎么设计比较好？

我们经常基于客户业务流程开发系统，按照流程节点划分模块，每个模块仅和上一个节点模块关联。模块间关系抽象标识为：

节点1 &lt;- 节点2 &lt;- 节点3 &lt;- 节点4

正常情况下，每个模块仅需要了解相邻上个模块的信息即可。但有些情况下，客户需要在某个业务模块知道跨节点模块的信息，例如&quot;节点4&quot;需要能看到对应&quot;节点1&quot;的信息，这样“节点4”添加一个字段，就需要分别在“节点2”，“节点3”上添加一遍，然后“节点4”才能查到。

这种依赖关系有办法破吗？</div>2023-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/56/06/ea49b29d.jpg" width="30px"><span>小洛</span> 👍（2） 💬（1）<div>有几个问题请教下老师
1、模块业务逻辑要尽量围绕自身内部数据进行处理，但是有时候需要调用其他模块的数据才能正确处理自己内部的逻辑，就比如订单模块在算价的时候是需要调用优惠模块计算，然后拿到结果做保存，这时候失败了要怎么处理？
2、如何做好模块结构层次化，有什么准则吗？怎么定义相似的模块放到同一层次？开始如果放错，后期调整，如果对业务造成很大影响，是否需要去调整呢？
3、通用化整合，如果修改的是通用逻辑，依赖的多个业务线应该需要全部回归，在业务架构上如何去做权衡</div>2020-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8e/72/63c94eee.jpg" width="30px"><span>黄马</span> 👍（2） 💬（1）<div>为了业务流程之间的复用，系统分模块，为了关系模块之间的关系，模块分层；
这些所有的都是给予对业务的理解，
业务的理解公司的业务有关系，如果公司的业务不定，别说构建基础模块，连分模块都不可能。
如果有比较清楚领域知识的，能够识别业务领域的基础能力，直接构建基础能力平台，在此基础上构建各种的业务线
老师理解对吗？</div>2020-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c7/e6/11f21cb4.jpg" width="30px"><span>川杰</span> 👍（2） 💬（3）<div>有。领导觉得没有必要调整，或者，要你利用业余时间提出方案，甚至最好是能改好，还不能有什么BUG，最关键的是领导还是程序员出身；只能等他的短视自食其果了。</div>2020-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/da/af/a1fa6ebb.jpg" width="30px"><span>aszt</span> 👍（1） 💬（1）<div>王老师，早！重新温习此教程，又有新的收获，就模块划分和模块职责，我这有个小场景，希望你给些建议：标签平台管理标签及标签与商品之间的关系，现在A模块需要通过标签选商品，但标签平台中只有商品的id等少量信息，A模块需要更多的商品信息，应该由哪个模块来完善商品信息？</div>2021-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8a/f3/7c89d00e.jpg" width="30px"><span>Presley</span> 👍（1） 💬（1）<div>老师，分布在同一层的基础模块，一个模块可以调用另一模块吗？如果有调用关系，被调用模块，放到更下一层次会不会合理些？</div>2020-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg" width="30px"><span>梁中华</span> 👍（1） 💬（2）<div>看京东的架构除了聚合服务，还有流程服务，感觉这两类服务差不多的定位。</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/1a/30201f1a.jpg" width="30px"><span>Geek_kevin</span> 👍（1） 💬（1）<div>我们公司是传统生产商,公司在处理物流发货这块有4个系统，分别对接4家不同物流公司的系统，各个系统有80%的重复，以后再来1家物流公司，感觉还要再开发一套，很是头疼</div>2020-03-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/32/5e/4827557b.jpg" width="30px"><span>睡不着的史先生</span> 👍（1） 💬（1）<div>所以，我们可以把这些基础模块放在同一层，构成一个基础业务平台。之前，它们是一个个离散的服务，独立地输出能力，现在变成一个大的业务平台，可以提供整体的能力输出。
这里平台化说白了就是封装了一层对外的api吗？他跟独立的服务好像也没啥区别呢呀？</div>2020-03-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/d8/6e/c6c52ea3.jpg" width="30px"><span>松果</span> 👍（0） 💬（1）<div>为什么业务架构会在产品设计完成之后呢？

业务架构应该是更加贴近业务的，像业务未来发展而需要调整业务模型，这类的需求可能业务人员和产品经理都没有办法感知的，如果是从用户需求-产品经理-业务架构-开发，这样是不是没有办法进行未来规划？</div>2022-07-29</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKiaPepffspIghJJQ3qJIEKDEdX4amYlQYvOnOw3uOWleTm7vQLZYwF3OEPxDFDsRm71pUbIlpPf1icN7CjYVJ3oB62xXWbshcTg79iaY9RsZwzA/132" width="30px"><span>罗浩铭</span> 👍（0） 💬（1）<div>老师，想请教一下您画这些流程和架构图用的什么工具</div>2022-05-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ae/8b/43ce01ca.jpg" width="30px"><span>ezekiel</span> 👍（0） 💬（1）<div>我的理解是模块的划分是，可扩展性和可复用性的基础？</div>2021-10-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/69/d2/8a53f0a3.jpg" width="30px"><span>E</span> 👍（0） 💬（1）<div>“如果不对模块的依赖关系做针对性设计的话，依赖关系就是一个多对多的网状结构，一个有 N 个模块的系统，理论上有 N×N 个依赖关系，如果考虑依赖具有方向性，这个数字还要加倍。” 老师，N*N是已经算了双向的吧？否则应该是N的阶乘？</div>2020-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/15/4e/4636a81d.jpg" width="30px"><span>jian</span> 👍（0） 💬（1）<div>请问老师，control层是不是后台服务中的接入层？</div>2020-05-08</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyLCPnVq4gKMN5jPcd9wVVEXtZMibCNAkLrJf4uZKdV40Nelb3uPtCETfuw5hbbC693sUHQpRUMiaA/132" width="30px"><span>Robin康F</span> 👍（0） 💬（2）<div>扩展性本质：构建模块体系，控制复杂度，最小化系统调整。现在流行的DDD领域驱动设计中提到的领域模型和领域服务感觉可以很好的划分模块职责，王老师对DDD的认识是怎么样的</div>2020-04-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/1b/4b/33f5a948.jpg" width="30px"><span>充满希望的一天</span> 👍（0） 💬（2）<div>中台是把各个服务共用的东西聚合在一起吗？</div>2020-03-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/d0/14/50782491.jpg" width="30px"><span>zeor</span> 👍（0） 💬（1）<div>老师您好，请问一个查块的拆分，组合，要什么时候去做</div>2020-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/f3/65c7e3ef.jpg" width="30px"><span>cricket1981</span> 👍（0） 💬（1）<div>业务中台概念是不是就对应文中的业务平台</div>2020-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4d/d3/67bdcca9.jpg" width="30px"><span>林铭铭</span> 👍（5） 💬（0）<div>垂直拆业务线，水平拆流程，抽取通用模块，构建基础平台。</div>2021-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg" width="30px"><span>tt</span> 👍（2） 💬（1）<div>总结一下。

可扩展化的过程就是一个抽象的过程。

1、首先是从具体的业务场景中抽象出一个个的业务节点（接口），把类似的接口按照业务域放到不同的模块中。因为业务就是逻辑➕数据（对应于程序就是算法➕数据结构），每个业务的数据模型不相同。

所以，从数据层面来说，这一层抽象的标准也就是模块划分的标准是各模块的不需要依赖其它模块的数据。

2、下一个层次的抽象是继续把模块“聚类”，做更高水平的抽象，进一步减少逻辑实体的数量，利于人脑的思考。可以从两个视角出发：能力（功能）和定位。

从能力（功能）视角出发（比如通过参数化）可以进行通用化整合，标准是边际收益高，增加很少的代码，就可以提高很多的通用性，从而减少模块的数量。

从定位视角出发，进行平台化整合。本质也是从更高的角度看待系统，更有利于人脑进行分析。</div>2020-02-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f9/88/cdda9e6f.jpg" width="30px"><span>阳仔</span> 👍（1） 💬（0）<div>系统=模块+关系
模块则是由数据和业务逻辑组成
关系则是模块之间的依赖关系，也就模块之间的调用关系，涉及调用方和被调用方
我们希望依赖关系能够直观的提现业务，而不是复杂的相互依赖的关系
模块的组织关系很容易出现网状的结构，更好的做法是把层次化，例如上层应用依赖下层模块，而不是反过来
模块划分可以从垂直方向和水平方向对系统进行划分，分别代表着系统水平扩展能力和深度扩展能力
划分模块之后，随着业务发展，还可能需要将模块通用化，减少模块达到复用的目的，还会进行平台化将几个模块的能力组织起来对外提供服务</div>2020-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f4/49/2b938b4f.jpg" width="30px"><span>北极的大企鹅</span> 👍（0） 💬（0）<div>最后一问，遇到过，参与解决过，给我的感受就是从一开始系统要先进行抽象设计。</div>2022-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/c1/57/27de274f.jpg" width="30px"><span>萧</span> 👍（0） 💬（0）<div>可扩展性架构
系统：模块+关系

模块：
定位清晰，概念完整
自成体系，粒度适中
关系：
尽量减少依赖，层次化
可扩展性的本质：通过拆分，实现模块划分；通过整合，划分模块依赖关系

拆分：水平拆分和垂直拆分
整合：通用化整合和平台化整合</div>2020-10-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/68/e1/abb7bfe3.jpg" width="30px"><span>王亮</span> 👍（0） 💬（0）<div>说的很好 架构师必备技能</div>2020-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg" width="30px"><span>密码123456</span> 👍（0） 💬（0）<div>主要就是模块的分分合合，水平方面提供平台化，垂直方面提供通用化。我目前也只是了解。在谈优势的时候，却说不出来。</div>2020-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e7/b2/334bc992.jpg" width="30px"><span>AlfredLover</span> 👍（0） 💬（0）<div>看起来，良好的可扩展性，依赖可复用性？</div>2020-03-31</li><br/>
</ul>