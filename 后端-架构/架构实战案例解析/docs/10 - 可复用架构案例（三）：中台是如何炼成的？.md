你好，我是王庆友。

在[第8讲](https://time.geekbang.org/column/article/209138)中，我通过一个实际的订单服务案例，和你介绍了如何设计一个基础服务。今天，我就继续带你了解，如何在实际的业务场景中，通过一步步的架构升级，最后落地一个中台，实现企业级能力的复用。

通过前面的介绍，我们已经很清楚了共享服务和中台的价值，但在实践中，要不要对系统做这样的升级，我们还需要结合业务来判断，比如说：

1. **业务上有什么重大变化，导致当前系统的弊端已经很明显，不能适应业务发展了呢？**
2. **架构改造时，如何在业务、系统、资源三者之间做好平衡，对系统进行分步式的改造呢？**

我们知道，架构没有最好，只有最合适的。随着业务的发展，系统需要不断地升级，这是一个螺旋式上升的过程，如何结合当前的业务发展阶段，适时地推进架构改造，并能比较接地气地落地，是我们要追求的目标。

接下来，我以实际的订单系统改造为例，结合订单业务的发展和系统的痛点，为你介绍，如何推进架构从单体到共享服务、再到中台的改造过程，保证系统能够不断适配业务的升级。

先说下项目背景。公司作为供应商，为大型餐饮连锁企业打造O2O交易平台，包括三方聚合外卖、自有小程序、App点餐，这些线上用户的订单最终会落到门店的收银系统，由门店进行履单。
<div><strong>精选留言（26）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/0f/bf/ee93c4cf.jpg" width="30px"><span>雨霖铃声声慢</span> 👍（13） 💬（2）<div>老师，请教一下在文中这套系统中，用户的数据结构应该是什么样子，因为这里有小程序用户，有外卖第三方平台用户，那么用户系统的数据表是不是一张大表，包含了所有小程序和外卖用户需要的信息？如果是这样，后面在对接其他新业务用户，那么就要修改数据表扩展新字段，这好像不是很好，那么是不是可以认为内部有多个表存储这这些用户数据，然后订单里面在关联不同的用户id？</div>2020-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/f7/eb/e7127bb8.jpg" width="30px"><span>，</span> 👍（6） 💬（1）<div>   我对老师这次重构的理解是这样的,不知道对不对:
    最开始外卖系统只负责订单管理,像收银和用户等服务都在第三方平台处管理。
    然而在做小程序下单服务时,因为他是一个完整的业务流程,需要用户平台,收银平台,商品平台,所以延续以前对接第三方的做法,将收银服务,用户服务,等都放在小程序下单服务里,相当于将小程序做成一个第三方,对接外卖系统的订单服务。
      之后随着业务范围的扩大,逐渐出现了各渠道的业务体系,应用端从PC端到App再到小程序,他们分别有不同的业务流程,但业务域大同小异。为了减少重复开发,规范业务流程,快速上线新应用,于是决定下沉基础服务,基于面向对象的方式,建立通用的业务平台,于是就有了中台
    同时中台的上线,还必须满足这些假设:
    业务范围大,渠道足够多,但是业务域大同小异,如果任由其发展,不同渠道的服务将会出现重复开发的现象,这样才有做成中台的必要性</div>2020-07-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/6f/6a/3e8ce554.jpg" width="30px"><span>粗线条Jackie</span> 👍（6） 💬（1）<div>仔细研读了老师的每一期课程，受益匪浅。我们团队现有的Ecommerce平台，由最初的电话下单一体式应用，逐步演化成支持了PC Web、小程序、企业App和第三方外卖平台的SOA服务化架构。比对了老师的文中介绍，感觉目前我们的服务模块更像是一个&quot;应用平台&quot;+&quot;业务中台&quot;的结合体，供前端应用直接调用，向下与连锁门店和POS打通，为了适配业务的快速变化，现有服务模块的更新频次过高和模块间的紧耦合是比较突出的问题。后续，打算梳理和界定好业务的领域模型边界，把&quot;应用平台&quot;+&quot;业务中台&quot;尝试分离独立。

有两个小问题，请教一下老师，望指点迷津:
1. 老师文中提到了OMS系统，但在架构图中没有模块与之映射，通常情况下这个OMS与业务中台中的订单中心是同一回事情吗？

2.由问题(1)引申，我某位在零售公司做架构的朋友，他们出于在天猫&#47;京东开店的需求，采购了某外部商用的OMS产品进行私有化部署(需商用OMS公司做实施和二开)，并通过阿里接口与企业供应链WMS进行了打通。他们目前围绕这个商用的OMS做了一些二次开发，调用OMS的开放API可以批量导入更多小平台订单和手工单。请问这种模式下，这个OMS可以理解为业务中台的订单中心吗？还是仅仅做为一个抓单汇集的工具，企业中台需要重新做订单中心的规划建设？ 

3.&quot;业务中台&quot;的边界划分，领域驱动设计(DDD)相关知识是否必需？老师后续课程是否有会有涉及呢？</div>2020-03-13</li><br/><li><img src="" width="30px"><span>Geek_741b0e</span> 👍（4） 💬（1）<div>为什么对接三方外卖平台，是主动拉取？而不是平台主动推送呢。如果是为了对接成本或通用性考虑，主动推送也可以做成只配置推送目标地址，推送数据结构固定的方式。 想请教老师，外卖第三方主要是基于什么考虑，设计成主动拉取第三方数据？</div>2022-05-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/64/9b/d1ab239e.jpg" width="30px"><span>J.Smile</span> 👍（4） 💬（5）<div>老师，从功能上看，第二层的应用平台层是否可以省掉，直接由前端比如小程序或者app等渠道直接发起request调用中台呢？第二层主要作用是什么？</div>2020-03-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/1a/30201f1a.jpg" width="30px"><span>Geek_kevin</span> 👍（3） 💬（1）<div>老师,请教业务中台的订单和ERP的订单有什么关系? 如果是b2c, 促销订单非常多，均会进入ERP吗？ERP是单体应用，有性能瓶颈</div>2020-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d2/23/5e5dde9b.jpg" width="30px"><span>carl.zhao</span> 👍（2） 💬（1）<div>老师请问各个订单的个性化字段怎么保存？比如外卖订单和小程序的订单，是保存到外卖服务端或者小程序服务端吗？</div>2022-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/de/c1/450a0b52.jpg" width="30px"><span>暮色晨春</span> 👍（2） 💬（1）<div>我感觉老师举的这个例子也可以通过SOA架构实现，如果微服务模块数量没有那么多，业务应用互相数据调用交互更加频繁的话。
中台的建立构建在更大，服务场景更为复杂的企业或者政府机构中才更具有意义。譬如数字政府这类。
不知道想法对不对，如果把中台仅仅理解成为共享服务，那就可大可小了。</div>2021-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg" width="30px"><span>美美</span> 👍（2） 💬（1）<div>这个还不能算业务中台吧，叫共享服务比较Ok吧</div>2020-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/56/26/5f78314d.jpg" width="30px"><span>风中舞者</span> 👍（2） 💬（1）<div>老师，中台中心内部的微服务架构是否需要设计聚合微服务，这样会不会产生链路开销？还是推荐将服务编排统一做到应用层。</div>2020-04-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/97/3b/c98b68c1.jpg" width="30px"><span>AngryApe</span> 👍（2） 💬（1）<div>王老师您好，前面能力复用讲到的业务实体、业务流程、产品，但是这篇的架构图中只画了业务实体，没有出现业务流程对应的服务。我的理解中台更多的是业务流程的复用，是我理解的不对吗？</div>2020-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/b6/74/c63449b1.jpg" width="30px"><span>问题究竟系边度</span> 👍（1） 💬（1）<div>中台怎么支持快速变更的需求？ 中台流程中是否有定制位置？</div>2022-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0d/e9/2f02a383.jpg" width="30px"><span>冬瓜蔡</span> 👍（1） 💬（1）<div>老师你好，我有以下两个问题想请教下：
 1、业务编排层也是独立出来的多个应用吗？多个应用按照上面维度划分？按场景还是其他的？
 2、业务中台，有各自的核心业务领域，在人员划分上相对好隔离，如商品团队、订单团队等；
 但是编排层，没有具体的业务场景，主要是对底层的编排，感觉大家都不愿意负责这一块，那这块的人员划分和组队如何处理呢？</div>2020-07-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/4c/c5/946244a8.jpg" width="30px"><span>王叫兽。</span> 👍（1） 💬（1）<div>老师你好，看了很多确实学到很多东西，但是这里有一个疑问，商品信息和ERP同步，这样的基础数据就变成了两套，很容易就造成脏数据问题。为什么不直接是使用ERP的数据呢</div>2020-05-22</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyLCPnVq4gKMN5jPcd9wVVEXtZMibCNAkLrJf4uZKdV40Nelb3uPtCETfuw5hbbC693sUHQpRUMiaA/132" width="30px"><span>Robin康F</span> 👍（1） 💬（1）<div>我们公司是做生鲜电商的。架构演变经历了3个阶段，一、刚开始时是外卖平台和H5拉新；二、然后开发了自己的app,接收订单；三、开发了小程序，更轻量级获取订单。架构刚开始是多烟囱的多系统，然后现在慢慢沉淀为各个服务平台，订单平台，商品中台，物流中台等，实现了分布式架构SOA服务，同时公司开发了自己的组件mq,redis的自有版本，进行业务适配，很好的应对业务快速发展的需要</div>2020-04-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/56/26/5f78314d.jpg" width="30px"><span>风中舞者</span> 👍（1） 💬（1）<div>老师，中台架构改造后各中心的注册中心和数据库也是按中心内的服务架构划分,还是共享。</div>2020-03-31</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/71f7hSaAxibZicXvBVLqOwBTaRJ1hyYtAw1p6JYwQHpzj1Ssl1EaXaR2twkeyX4yv5vae8DepY8vic98L4aRRmxVQ/132" width="30px"><span>noia_zhou</span> 👍（1） 💬（1）<div>想请教一下，对于简单的只涉及单个应用的查询或修改，网关层能直接调用共享服务吗？还是说必须是一个严格分层模式。</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d6/0a/875d892d.jpg" width="30px"><span>阿男</span> 👍（1） 💬（1）<div>老师您好，如果是传统It公司，所做的系统没有这么大的体量，领导又想上个中台，有没有好的下手思路？</div>2020-03-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkeOAC8k7aPMfQZ4ickiavpfR9mTQs1wGhGtIicotzAoszE5qkLfFTabkDU2E39ovSgoibJ1IiaLXtGicg/132" width="30px"><span>bigben</span> 👍（0） 💬（1）<div>收银系统是什么。图上没有啊</div>2022-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg" width="30px"><span>tt</span> 👍（0） 💬（1）<div>老师，有一个问题，如果中台中的模块是由若干的不同的厂商开发的，要如何保证部署的独立性呢。一个基础服务版本升级，现有接口没有变化，增加若干新的接口，还如何组织测试呢？</div>2020-03-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg" width="30px"><span>Alex</span> 👍（4） 💬（0）<div>用户中心估计是大家第一个要动手的共享服务吧</div>2020-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/da/ee/63090718.jpg" width="30px"><span>流云追风</span> 👍（0） 💬（0）<div>我们的共享服务组,目前主要是承接用户中心和支付服务,而交易负责了订单服务,各种基础服务正在分布构建中,之前不太明白公司这种大改造的原因。现在经过老师的课程,清晰了许多</div>2021-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/3c/65/87912180.jpg" width="30px"><span>鲁正义</span> 👍（0） 💬（0）<div>平滑过度，圈表，业务价值，业务团队和服务团队</div>2020-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg" width="30px"><span>密码123456</span> 👍（0） 💬（1）<div>我以为1.0的方案很好，很强大了。结果扔出2.0的方案。经过对比1.0好low啊！</div>2020-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/1a/30201f1a.jpg" width="30px"><span>Geek_kevin</span> 👍（0） 💬（0）<div>目前公司还没有共享服务，业务服务复用率低</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1a/05/f154d134.jpg" width="30px"><span>刘楠</span> 👍（0） 💬（0）<div>我们公司的模式有点像，可以学习下，按这个样搞下</div>2020-03-20</li><br/>
</ul>