你好，我是七牛云许式伟。今天我们要聊的话题是操作系统的最后一个子系统：安全管理。

数字世界是高效的，但数字世界也是脆弱的。在越来越多的日常生活被数字化的今天，安全问题也越来越凸显出了它的重要性。

有经验的安全工程师都知道，做好安全的基本逻辑是：不要开太多的门和窗，最好所有人都在同一道门进出，安全检查工作就可以非常便利地进行。

要想构建一个安全可靠的环境，从最底层就开始设计显然是最好的。所以安全管理是一个基础架构问题。现代操作系统必然会越来越关注安全性相关的问题。因为一旦安全问题严重到触及人们的心里防线，整个数字世界都有可能随之崩塌。

让我们从头回顾一下操作系统安全能力的演进。

## 病毒与木马

首先是实模式的操作系统，以微软的 DOS 系统为代表。实模式的操作系统进程都运行在物理地址空间下。

这意味着，每个软件进程都可以访问到其它软件进程（包括操作系统）的内存数据，也可以随意地修改它。所以这个时期的计算机是非常脆弱的，它选择的是信任模式：我相信你不会搞破坏。

不过，好在这个时期网络还并不发达，所以一个单机版本的恶意软件，能够干的真正恶意的事情也很有限。这一时期恶意软件以计算机病毒为主，其特征主要是繁衍自己（复制自己），对计算机系统本身做某种程度的破坏。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/17/04/66/4452c882.jpg" width="30px"><span>KEN.Z</span> 👍（57） 💬（3）<div>问一下许老师，
&quot;这样，木！马程序和正常的软件代码同属于一个进程内，所有信息对其仍然一览无余。&quot;
这个是通过何种方式实现的呢？</div>2019-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/ef/89/8c73a24d.jpg" width="30px"><span>Chen</span> 👍（17） 💬（1）<div>Android从6.0开始在运行时向用户索要权限，版本越高越重视用户的隐私。运行时索要权限毕竟麻烦，很多开发者有意将版本降至6.0以下。现在谷歌和一些应用厂商开始采取一些措施避免这种行为。谷歌开始强制App适配更高版本，华为应用市场8月1日后禁止基于8.0以下的应用更新和上架。</div>2019-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/78/51/4790e13e.jpg" width="30px"><span>Smallfly</span> 👍（16） 💬（1）<div>许老师，病毒为什么要复制自己，每个功能都一样，不是多余么？即使有必要，它在运行中又是怎么实现自我复制的呢？</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/0d/29/18272af9.jpg" width="30px"><span>hxy</span> 👍（11） 💬（1）<div>Android 现在也是运行时索要权限吧？很久以前确实是安装的时候</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/b9/8d/00bded19.jpg" width="30px"><span>不温暖啊不纯良</span> 👍（6） 💬（1）<div>非对称加密就是我需要你给我传送信息的时候，我造一把钥匙一把锁，我把锁子打开给你，你把内容装进箱子，用我给你的锁锁上箱子，然后把箱子传给我，我在打开箱子之前，先看看锁有没有被撬过，如果有就说明箱子里面的内容已经不可靠。

所对应着公钥，钥匙是代表私钥。</div>2021-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a8/b2/998448ca.jpg" width="30px"><span>悠游</span> 👍（6） 💬（1）<div>https的本质就是在一个不可靠的信道上，基于数字证书和非对称加密协议生成一个对称的加密协议，进行可靠的通信</div>2020-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/88/d7/43cf7b60.jpg" width="30px"><span>Cc°°</span> 👍（6） 💬（1）<div>我在6月14号的留言，得到了老师的回复：使用对称加密！表示感谢！但是并没有解答我的疑问，对称加密的密钥也是需要在A和B之间进行传输的，如我问题中所说，如何保证对称加密的密钥的安全呢？因为使用B-private-key加密的对称加密密钥给A，中间人使用B-public-key是可以解开的！烦请老师解惑，多谢！</div>2019-06-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/14/c4/e354d8ba.jpg" width="30px"><span>魏颖琪</span> 👍（5） 💬（1）<div>HTTPS的证书获取流程，我的理解是B的证书是在A向B访问中获取，而不是向G获取。然后通过G的公钥（通常在操作系统或者浏览器）来验证这个证书的可信度，并通过这个证书获取B的公钥。在我们的应用中，通常将证书放在nginx中。</div>2019-06-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg" width="30px"><span>hua168</span> 👍（4） 💬（2）<div>老师现在很多网站用的是linux（centos，ubuntu），怎么样保证安全，我这样对吗？
1. 禁止远程公认的大权限账号如root，sa，administrator等
2. 禁止不用的端口，不能禁止就修改如22端口，修改其它
3.开启防火墙如iptable

如果入侵怎么跟踪分析别人入侵路径的？</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（1） 💬（2）<div>许老师好，我有一个关于操作系统的安全问题想请教一下。怎么保证操作系统(比如linux)本身的安全性呢，比如HTTPS协议生效的前提是Linux事先植入了权威机构的公钥，那如果这个公钥是有问题的呢？换句话说如果Linux的发布者“监守自盗”怎么办呢？更广义一点，怎么保证Linux本身不会窃取服务器中的信息呢，包括文件、内存还有数据库等。红帽等Linux厂商的发布镜像会有权威机构检测吗</div>2019-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a8/9f/febe9182.jpg" width="30px"><span>yxhuang</span> 👍（1） 💬（1）<div>许老师，Android 在 6.0 版本及其以上，也开始需要运行权限了。</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/06/5a/ca9d8453.jpg" width="30px"><span>VicX</span> 👍（1） 💬（1）<div>文章开头对于实模式和保护模式的讲解是否不够精确？CPU保护模式能访问比实模式更大的地址域，内存的合理隔离完完全全是靠的虚拟内存</div>2019-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/78/51/4790e13e.jpg" width="30px"><span>Smallfly</span> 👍（1） 💬（1）<div>许老师，文中说软件之间的内存隔离是基于 CPU 保护模式的，具体的实现是引入虚拟内存么？</div>2019-06-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLOMFSAg7ZEtwgdqTZMhjvdlOcRbHWTzDCBJMqdzpIqxQIRuE2aHianHHFibv1bGfAjnzmBpSJxx9MA/132" width="30px"><span>oliver</span> 👍（0） 💬（1）<div>许老师，谢谢上次的解答，但是问题一还是没有弄清楚。

对于A初次传递编码信息给B的过程，我的疑问在于A-public-key的传递细节和B验证（R，R-digest）信息的过程：把A首次需要传递的random-key代入R后，A在发送encoded（random-key，random-key-digest）时是怎么传递A-public-key给B的？我又仔细看了下，没看到相关描述，是B向A请求获取A-public-key？
R-digest是用 A-private-key 对 R签名得到的，B解码出（R，R-digest）后是如何根据A-public-key验证R和R-digest的关系的呢？
</div>2020-04-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLOMFSAg7ZEtwgdqTZMhjvdlOcRbHWTzDCBJMqdzpIqxQIRuE2aHianHHFibv1bGfAjnzmBpSJxx9MA/132" width="30px"><span>oliver</span> 👍（0） 💬（2）<div>许老师，HTTPS和非对称加密这块有两个问题不太明白
1.B 收到 encoded（R，R-digest），用 B-private-key 解密得到（R，R-digest），然后再用 A-public-key 验证信息的确来自 A。
这里的A-public-key从哪里来？是否encoded（R，R-digest）这里应该加上A-public-key变为 encoded（R，R-digest，A-public-key）？验证信息过程是否是通过R-digest和A-public-key运算得到A-private-key，再根据R和A-private-key加密看结果是否为R-digest？
2.A使用随机数random-key作为后续对称加密的秘钥，意味着A都是基于该随机键值为信任依据，那么只要中间人没有B的私钥，仅仅得到encoded（R，R-digest）无论如何是解密不出里面的内容，A被窃听、篡改和钓鱼的问题也就没有了，那么防范B的公钥B-public-key泄漏给中间人的意义，也就是数字证书存在的意义是什么？何况就算有意义，中间人得到这个数字证书很容易，再反向得到B-public-key也很容易。
</div>2020-04-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/23/f8/24fcccea.jpg" width="30px"><span>💢 星星💢</span> 👍（0） 💬（1）<div>老师，还是没看懂，为啥要用hash算法生成摘要，不能不使用hash算法生成摘要，直接用私钥加密数据么，然后对方用公钥解密数据么？</div>2019-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f6/10/f179db4a.jpg" width="30px"><span>舰长的水手</span> 👍（0） 💬（1）<div>老师，在阻塞io 编程时A,B 双方通过HTTP 通信，为安全无论请求还是响应都 body 的签名放在header 中，。但在 响应式编程中签名无法放在 header， 因为，hrader 发送时往往无法将body完整签名后放将签名放在header 中。我觉得这导致响应式编程难以在实际中推广，请问老师有没有方法解决这个问题。</div>2019-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/88/d7/43cf7b60.jpg" width="30px"><span>Cc°°</span> 👍（0） 💬（1）<div>对HTTPS的一个疑问：虽然客户端A使用域名B的公钥B-public-key加密，然后传输给域名B，数据只有域名B使用私钥B-private-key解密，不存在传输过程中数据被读(窃听)写(篡改)，但是域名B返回给客户端A的数据如何保证安全(无窃听无篡改)呢？原因如下：
1、客户端A并没有生成自己的秘钥对，即：A-private-key和A-public-key，所以不能一对一的加密通信；
2、如果域名B使用自己的私钥加密数据给客户端A，但是域名B的公钥是公开的，任何劫持到该数据的中间人都可以使用域名B公开的公钥进行解密，而不是只有客户端A才能解密！</div>2019-06-14</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKx6EdicYYuYKibnUiajL1ba1cmzXpK6RmvAoIX4mTgdzVELf6Ljzk2chQIBhk37xRuOAnAwtOjkaRMA/132" width="30px"><span>stern</span> 👍（0） 💬（1）<div>摘要算法是不可逆算法，摘要算法是没有密钥一说的。</div>2019-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/ee/16/742956ac.jpg" width="30px"><span>涵</span> 👍（0） 💬（1）<div>老师好，对于企业自己开发的系统的安全性要做到什么程度我一直有个疑问。因为自己在甲方企业工作，也会自己开发或请外包厂商做一些公司内部使用的系统，需要用到移动网络。如果把安全性做得很复杂，会大大增加成本，如果不做，又会担心互联网安全。互联网黑客发现一个企业内部应用，并对其发起攻击的可能性有多大呢?安全程度做到多高合适呢?谢谢。</div>2019-06-11</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ermRibwXSt1icBvH3IO1JfiaqakIcxxAP4zSkicewogKVWCFicb0NVc7tF3xSVMJwE3lBg2gH4r7u6sGtw/132" width="30px"><span>pawhrmyki</span> 👍（23） 💬（0）<div>看过一个讲rsa原理的文章，非常清楚，推荐给大家～～http:&#47;&#47;www.ruanyifeng.com&#47;blog&#47;2013&#47;06&#47;rsa_algorithm_part_one.html</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/8e/10/10092bb1.jpg" width="30px"><span>Luke</span> 👍（6） 💬（0）<div>老师此篇写的很精辟，各个场景都覆盖到了。
关于安全，只能说是相对安全，我们实际架构时，也只能根据实际情况制定合适的方案，在速度，安全等方面权衡。</div>2019-06-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/43/e1/b7be5560.jpg" width="30px"><span>sam</span> 👍（5） 💬（0）<div>凌晨4点多醒来，看到许老师更新，一口气读完，大脑出奇的清醒，再读前面几篇。</div>2019-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg" width="30px"><span>丁丁历险记</span> 👍（4） 💬（0）<div>太客气了，运营商篡改可以直接点名的，包括移动电信联通。
</div>2019-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/f1/70/bca09d2d.jpg" width="30px"><span>觉</span> 👍（3） 💬（1）<div>一门深入 长时薰修 我当奉持 如法修行</div>2019-06-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f6/ba/09ab72d2.jpg" width="30px"><span>幻灰龙</span> 👍（2） 💬（1）<div>PKI&#47;CA机制是中心认证机制，但是中心出如果不可信，信任体系就完蛋。非中心化的方式例如基于朋友圈认证的OpenPGP或者GNUPG加密邮件的方式，或者像BlockChain这种通过智能合约的方式，把信任转嫁到不可撤销的货币合约上。更进一步，直接假设中心的不可信，使用复杂的零知识证明原理实现提供数据服务但是不暴露数据给任何中心或者第三方，可惜zero-zkSNI</div>2020-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9d/df/a1edc84d.jpg" width="30px"><span>wanhex</span> 👍（2） 💬（0）<div>强烈建议老师出一门网络安全的专栏，惭愧啊，做了好几年的网络安全，对于网络安全的理解还没有老师的一篇文章透彻，惭愧惭愧啊</div>2019-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg" width="30px"><span>Aaron Cheung</span> 👍（1） 💬（0）<div>打卡16 深入了解了 ssl 不再是表面那一点</div>2019-06-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2023-08-17</li><br/><li><img src="" width="30px"><span>Geek_88604f</span> 👍（0） 💬（0）<div>不要开太多的访问通道，最好所有人都在同一道门进出，检查工作就可以非常便利地进行----这句话是系统安全工作开展的核心指导思想。
        端到端安全整体思路:始于底层CPU指令执行的权限，CPU的执行权限有4个级别ring0~ring3，一般应用工作在ring3，每一层只能访问本层以及权限更低层的数据。其次是进程级别的保护，即摒弃了实模式，而采用保护模式，让软件运行的内存地址空间隔离，进程之间相互不能访问。此时面临的注意威胁是BD和MM，不过，好在这个时期网络还并不发达，它们都能复制和繁衍自己，区别是:BD主要目的是对破坏计算机系统；MM是为了窃取信息。BD和MM只能来源于系统外部，当下载来路不明的软件时才可能中招，而计算机有不可能不下载软件，那唯一的办法是只下载授权的软件，如何保证呢--数字签名。没有签名的也可以安装，安装前主动提醒！在签名之前感染了怎么办--安全扫描，确保无感染的前提下再签名。iOS 还引入了沙盒系统，确保软件之间文件系统隔离，相互之间不能访问对方保存在磁盘上的文件。
        这样看来似乎固若金汤了！?确实系统已经尽力了，但还有一个重要安全因素。出于各种原因安装了不安全的软件，访问了不安全的网站导致系统被攻破。
        一路下来，所有的措施都是紧扣如何只开一通道，防止不安全通道为中心。</div>2022-12-10</li><br/>
</ul>