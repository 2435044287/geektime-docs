你好，我是七牛云许式伟。

想要让自己进步，我们首先得知道什么是好的。所以我们今天的话题是，如何判断架构设计的优劣？

## 架构设计的基本准则

架构设计会有它的一些基本准则。比如：

- KISS：简单比复杂好；
- Modularity：着眼于模块而不是框架；
- Testable：保证可测试性；
- Orthogonal Decomposition：正交分解。

KISS 全称是 Keep it Simple, Stupid，用最直白的话说，“简单就是美”。不增加无谓的复杂性。正确理解系统的需求之后才进行设计。要避免过度设计，除非有人为复杂性买单。

KISS 的“简单”，强调的是易实施性。让模块容易实现，实现的时候心智负担低，比复杂的优化更重要。

KISS 的“简单”，也是主张让你的代码，包括接口，符合惯例。接口语义要自然，最好让人一看方法名就知道怎么回事，避免惊异。

Modularity，强调的是模块化。从架构设计角度来说，模块的规格，也就是模块的接口，比模块的实现机制更重要。

我们应着眼于模块而不是框架。框架是易变的。框架是业务流，可复用性相对更低。框架都将经历不断发展演化的过程，逐步得到完善。

所以不让模块为框架买单。模块设计时应忽略框架的存在。认真审视模块的接口，发现其中“过度的（或多余的）” 约束条件，把它提高到足够通用的、普适的场景来看。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg" width="30px"><span>Bachue Zhou</span> 👍（35） 💬（8）<div>其实还有一种耦合度经常被人忽视，就是技术耦合度。我们相信，无论是今天多么流行的技术，未来都有失去竞争力的一天，但要开一家长达数十年甚至数百年的技术公司，不可能长期使用已经失去竞争力的技术，必然涉及到技术的多次演进。如果公司的关键性产品与某一种技术耦合度太高，则当该技术失去竞争力或彻底淘汰后，技术迁移成本过高，极易造成迁移彻底失败。所以我从不看好那种一个 Git 库里数十万甚至数百万行 xx 语言或者基于 xx 框架编写的代码，要起一个新项目还必须去引用这个库里的代码不可，这种项目不可能活很久。如果这个项目是公司的关键性产品，那么这个公司也活不了很久。</div>2019-11-22</li><br/><li><img src="" width="30px"><span>Geek_03056e</span> 👍（6） 💬（2）<div>两个核心模块之间由接口调用，并且是A调用B这种的单方面调用，可是两个模块有公用的结构体数据，这些结构体的定义，应该放到那个位置呢？</div>2019-11-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKUcSLVV6ia3dibe7qvTu8Vic1PVs2EibxoUdx930MC7j2Q9A6s4eibMDZlcicMFY0D0icd3RrDorMChu0zw/132" width="30px"><span>Tesla</span> 👍（4） 💬（1）<div>我是这样想的，极客时间的核心是知识，学生是知识的订阅者，老师是知识的发布者。但是知识的形式又是多样化的，所以知识本身也需要抽象。
设计出来的核心数据结构是，保留知识基本信息及类型ID的类，用户类，用户发布知识的权限类，用户订阅知识的权限类，用户余额类。核心接口是用户注册接口，余额增加 减少接口，发布知识接口，订阅知识接口，判断是否有权添加 修改知识的接口，判断是否有权查阅知识的接口。
其他的功能是周边系统，有知识的具体内容类，各种订阅优惠券类等等。
不知道这样分析的思路对不对😂</div>2020-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg" width="30px"><span>亢（知行合一的路上）</span> 👍（3） 💬（1）<div>* 模块的规格，也就是接口，比模块的实现机制更重要。
    * 接口是抽象的，比较稳定的，与具体实现无关，实现可以不断优化，但接口不变。因此与外部模块的关系就是稳定的，整个系统就是稳定的。
* 不让模块为框架买单，框架是业务流，可复用性相对更低。
    * 业务是易变的，框架也是易变的。
    * 不同项目或产品，业务相差很大，框架也就各异。
    * 不同项目是不是会使用一些通用的模块呢？
        * 例如缓存功能，不关心缓存的是什么；
        * 限流，也不关心业务内容；
    * 模块设计时，要尽可能和业务解耦，提供抽象的接口。
* 老师把架构设计的质量评估表述成公式，很有意义，为我们提供了判断依据。
</div>2020-04-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKUcSLVV6ia3dibe7qvTu8Vic1PVs2EibxoUdx930MC7j2Q9A6s4eibMDZlcicMFY0D0icd3RrDorMChu0zw/132" width="30px"><span>Tesla</span> 👍（2） 💬（1）<div>老师，可以简单说下 极客时间app的核心系统和周边系统大概是什么吗？</div>2020-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg" width="30px"><span>有米</span> 👍（1） 💬（1）<div>判断依赖的程度其实就是看它们交互的次数，无论静态或者动态</div>2020-04-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/9c/2d/cc205cfa.jpg" width="30px"><span>tomz</span> 👍（0） 💬（1）<div>老师你好，在看你的耦合度公式，收益良多。但是不清楚为什么公式是log2()？我可以理解一定不是线性正比（因为那就意味着：n个符号各依赖1次 === 一个符号依赖n次，而显然，前者耦合性更大），但是为什么是log2()？</div>2022-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c1/10/28d5a686.jpg" width="30px"><span>Longerian</span> 👍（0） 💬（1）<div>生产过程中，核心系统的伤害值、模块的耦合度测量，有公司或者团队在这么定量操作吗？感觉应该要有此类插件或者代码分析工具给出近似值才行。</div>2020-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1c/af/a4ed26e9.jpg" width="30px"><span>@㍿社长</span> 👍（0） 💬（1）<div>想知道，动态的耦合会对系统的复杂性造成什么影响吗？</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/73/a7/d4b45013.jpg" width="30px"><span>袁</span> 👍（6） 💬（0）<div>“优先使用对象组合，而不是继承”是面向对象设计的原则之一。其中老师说的组合是乘法，继承是加法让我困惑了下。网上查了下资料《组合也叫“对象持有”，就是在类中定义另一类型的成员，继承会破坏类的独立性，增加系统的复杂性，一般系统的继承层次不超过3层。组合拥有良好的扩展性，支持动态组合，因此优先考虑组合方法。》 更清楚了些。</div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg" width="30px"><span>丁丁历险记</span> 👍（5） 💬（0）<div>笔记  
1 kiss  有时候，效率就是少做无意义的事。
2 模块化
缺经验，伤害值，耦合度为啥那样，理解不来。
模块设计时应忽略框架的存在。认真审视模块的接口，发现其中“过度的（或多余的）” 约束条件，把它提高到足够通用的、普适的场景来看。
3 可测试 
  好处  一验证和引导代码设计的是否足够解偶。martin fowlor 敏捷开发 模式 实践里有详细论述
其二  确保完成的代码可用。  在坚固的基础上叠加。
4 正交分解，  架构就是一种不断正交分解的过程(需要长时间去体验感悟)
让模块直接。  (推荐看吴军信息论，里面也有介绍信息正交性)
组合是一种正交，让互为正交模块以乘法模式去组合业务。
集成是一种加法，(个人觉得有时候抽象类干多了直接变减法)

最后  缺经验。如何量化，知其然，不知所以然。
先胡乱理解一波
伤害公式  ，模块耦合度  用好设计模式，重构技巧优化。
，总耦合公式引导了团队开发方向。</div>2019-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/d3/20/95e71191.jpg" width="30px"><span>吴</span> 👍（3） 💬（0）<div>精彩，用心的总结</div>2019-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d8/00/4650b237.jpg" width="30px"><span>Qoo</span> 👍（1） 💬（0）<div>为了子系统之间的解耦，通常会使用消息中间件将子系统隔开，然后通过消息异步通信，但是每个子系统需要的信息不一样，这个消息接口该怎么制定？</div>2020-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2023-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/4b/1a7b36ab.jpg" width="30px"><span>欧星星</span> 👍（0） 💬（1）<div>还是不太明白组合为什么比继承更好，老师说组合是做乘法继承是做加法为什么会是组合好呢，本来是想着继承是强依赖如果父类发生了变化会直接影响子类的行为，但如果用组合的话不一样也会影响实现的行为吗？希望老师解惑</div>2019-11-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg" width="30px"><span>Aaron Cheung</span> 👍（0） 💬（0）<div>KISS：简单比复杂好；


封装很多次的代码    是否所谓体现抽象能力呢</div>2019-11-20</li><br/>
</ul>