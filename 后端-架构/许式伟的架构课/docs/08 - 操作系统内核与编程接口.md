你好，我是七牛云许式伟。

今天我们在开发软件的时候，已经处于一些基础的架构设计之中，像冯·诺依曼计算机体系，像操作系统和编程语言，这些都是我们开发一个应用程序所依赖的基础架构。

在上一讲“[07 | 软件运行机制及内存管理](https://time.geekbang.org/column/article/93802)” 中，我们着重介绍了软件是如何被运行起来的。**今天，我们着重聊一聊软件如何利用它所依赖的基础架构。**

**首先是冯·诺依曼计算机体系**，它由 “中央处理器+存储+一系列的输入输出设备” 构成。这一层，提供了编程接口的是中央处理器（CPU），编程接口是 CPU 指令，但 CPU 指令非常难用。

为此，人们发明了编程语言来降低 CPU 指令的使用门槛。编程语言面向人类，CPU 指令面向机器，编译器负责将人类容易理解和掌握的编程语言的程序，翻译成机器能够理解的 CPU 指令序列。

**其次是编程语言**。虽然编程语言出现的起因是降低 CPU 指令的使用门槛，第一门编程语言汇编语言的能力也很接近 CPU 指令，但是语言的自然演化会越来越脱离 CPU 所限制的条条框框，大部分语言都会演化出很多基础的算法库。

比如，字符串算法库有：字符串连接（concat）、字符串子串（substring），字符串比较（compare）、字符串长度（length）等等。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/ca/fd/4346c87b.jpg" width="30px"><span>Fz</span> 👍（55） 💬（5）<div>交叉编译不是很理解</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/d5/92/1e741777.jpg" width="30px"><span>SuperFranky</span> 👍（33） 💬（2）<div>cpu不需要检查是否发生了中断，它的原理类似于开关和灯泡的关系，当开关合上，灯泡就会亮，灯泡不需要定期检查开关是否合上了</div>2019-05-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a0/27/bdc6307d.jpg" width="30px"><span>晓凉</span> 👍（27） 💬（1）<div>优秀的架构设计能带来的好处可能超出架构师最初的预想，例如Linux系统的容器特性，现在成了云计算领域的重要基础技术，成就了一个领域。基于前辈大师的优秀架构，现在的信息世界才能如此生生不息。优秀的架构不仅能解决当前的实际问题，更具有理论上的优雅，像一种真理，可照亮未来。</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg" width="30px"><span>云学</span> 👍（17） 💬（2）<div>看完有种苹果砸到脑袋上的感觉，好多问题之前总想不透，现在贯通了，许老师可以创立个品牌专门教小孩编程，以老师的功底肯定能教会</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0d/c1/d36816df.jpg" width="30px"><span>M</span> 👍（16） 💬（3）<div>请问一下cpu是如何检查是否有中断的。是怎么及时知道发生了中断？每执行完一条指令都去检查一次吗？</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/09/d6/5f366427.jpg" width="30px"><span>码农Kevin亮</span> 👍（11） 💬（1）<div>我重复一下我理解的交叉编译，老师帮忙看看理解对不对：
编译的目标是生成机器码指令，即对cpu有意义的01序列。当出现新的cpu指令时，本质上只是生成一个新的01序列。整个自举的过程有点像自然语言的自举，比如用原有的词汇去解释新的词汇。
是这样理解么？</div>2019-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c3/fc/791d0f5e.jpg" width="30px"><span>杨寅冬</span> 👍（11） 💬（2）<div>老师可以谈谈最近华为要推出的“鸿蒙系统”吗，和Linux有什么关系，如果想开发一个操作系统，从哪些方面考虑。</div>2019-06-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/17/ba/c56aa720.jpg" width="30px"><span>new life</span> 👍（10） 💬（2）<div>老师  但是实际上常见的系统级语言（比如 C 语言）都是可以编写出不依赖任何内核的程序的。这句话是说我们编写的程序 没有操作系统也可以跑起来是吗</div>2019-05-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/6b/b1/32cb2393.jpg" width="30px"><span>小袋子</span> 👍（9） 💬（1）<div>插个题外话，以老师的经验，小孩几岁开始学编程比较合适😂</div>2019-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/eb/80/baa681be.jpg" width="30px"><span>行者</span> 👍（8） 💬（2）<div>关于动态库，是不是可以理解为：提供动态库不是操作系统的责任（因为其他语言完全可以通过系统调用来自己实现动态库的功能），只是操作系统为了方便其他语言（减少不必要的冗余）而做的多余的事？</div>2019-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f6/00/2a248fd8.jpg" width="30px"><span>二星球</span> 👍（7） 💬（2）<div>老师好，我这有个问题，就是有中断必有对应的中断处理程序，那么执行中断处理程序会不会像普通线程那样抢占cpu资源呢，如果没抢到还要等一等？还有就是一下同时来了十几个中断，那么怎么处理呢？</div>2019-05-13</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLluwfFjxlCmg9p2rJVicBdBo6OYpN0EAotUguias8wc78WtAEPHsWic0880CqGwyNypy2KZqVpYhGiag/132" width="30px"><span>Geek_gooy</span> 👍（6） 💬（3）<div>前面提到:
操作系统与我们编写的软件并不同属一个进程，两边的内存地址空间都是独立的。

后面提到:
当然你可能要问：既然操作系统内核和我同属一个地址空间，……

老师，这是不是矛盾啊？中间的解释看不懂，求形象举例。</div>2020-01-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a5/66/cd335f3e.jpg" width="30px"><span>尹少爷</span> 👍（5） 💬（1）<div>操作系统内核的进程都是共享内存的，在联合上一章内容：

其实操作系统内核上层如果按照保护模式来看，通过虚拟内存做了一层安全隔离，不同程序的隔离， 那么同一个程序中的，不同进程的隔离是怎么做的， </div>2019-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/cd/f6/ee383eab.jpg" width="30px"><span>apk</span> 👍（5） 💬（1）<div>go有自己的编译器，它也是基于CPU+操作系统实现的，还是自己通过机器码，汇编，go编译器思路实现的呢？像按行解析的编译器比如python和C这种执行加载的语言在编译器上有什么区别呢？</div>2019-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/24/df/645f8087.jpg" width="30px"><span>Yayu</span> 👍（5） 💬（1）<div>请问老师，变成语言提供的内置库（SDK）可大体氛围两类：1、对（操作系统各个子系统的）系统调用的封装；2、业务（逻辑）层的工具。那我们这里说的SDK是文章末尾分层图中的 【编程语言操作系统相关的标准库】和【编程语言的算法库】对吧？那【编程语言的核心文法及内置库】这一层如何理解？落实到具体的指代哪些库呢？</div>2019-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/5a/a8/f25ec64c.jpg" width="30px"><span>long.mr</span> 👍（5） 💬（1）<div>许老师，问一哈在画架构图的时候有没有一些约定俗成的准则呢，比如虚线 实线 方框 圆角矩形的选择。业界有一些权威的参考吗？</div>2019-05-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/19/28/f4b4ed22.jpg" width="30px"><span>马留</span> 👍（4） 💬（1）<div>对“硬件中断要周期性检查”不太理解。CPU和外设交互，有三种方式:轮询 中断 DMA。对CPU来说，硬件中断来自于外部触发，是异步的，怎么需要周期性检查呢？</div>2019-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/eb/80/baa681be.jpg" width="30px"><span>行者</span> 👍（4） 💬（1）<div>有个疑问，CPU怎么区分操作系统和常规软件，从而做到给予不同软件的CPU权限？是BIOS在决定将软件运行权时就直接交给该软件（OS）所有权限的吗？</div>2019-05-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg" width="30px"><span>QQ怪</span> 👍（4） 💬（1）<div>老师能否讲下协程的优势?不太理解</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/78/51/4790e13e.jpg" width="30px"><span>Smallfly</span> 👍（3） 💬（2）<div>又看了一遍全文和留言，实在太精彩啦。

关于绕过系统调用，直接调用内核函数我有一些疑问。

1、假设通过某种手段，应用程序能够直接调用内核函数，内核能否知道，这是来自应用程序的调用，还是系统函数的调用？

2、内核和用户进程同属一个地址空间，这块空间被设置为“不可读，不可写，不能执行”，是只针对应用程序来说么？针对内核函数还是可读、可写、可执行的。如果是，那虚拟内存页保护机制怎么区分是内核访问还是应用程序直接访问的呢。</div>2019-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a9/84/c87b51ce.jpg" width="30px"><span>xiaobang</span> 👍（3） 💬（1）<div>请教下最后总结图里“编程语言文法和核心库” 为什么在操作系统下面？还有编程语言的编译工具在操作系统看来也只是一些特殊的应用程序吧

另外现在有用高级语言比如go Java之类写操作系统的传闻，我一直有个疑问这些高级语言依赖的运行时是怎么搞定的，毕竟写操作系统时不能再依赖操作系统的支持了</div>2019-06-18</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLluwfFjxlCmg9p2rJVicBdBo6OYpN0EAotUguias8wc78WtAEPHsWic0880CqGwyNypy2KZqVpYhGiag/132" width="30px"><span>Geek_gooy</span> 👍（3） 💬（2）<div>用汇编写程序是面向CPU的还是面向操作系统的。
如果可以面向CPU是不是可以写出跨操作系统的软件。</div>2019-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg" width="30px"><span>honnkyou</span> 👍（3） 💬（1）<div>老师，cpu是怎么知道什么代码可以在ring0中执行，什么代码需要在ring3中执行的呢？
是在程序中标注的吗？</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/62/a7/3e6fee86.jpg" width="30px"><span>K战神</span> 👍（3） 💬（1）<div>k8s是不是也是类似于软件治理平台？</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/5b/79/d55044ac.jpg" width="30px"><span>coder</span> 👍（3） 💬（1）<div>编译器和操作系统这种系统级别的软件在历史发展的过程中，概念的区分很明确吗？从第一代可编程的计算机开始，既然可以运行软件，底层应该有一大堆的非概念级别的工具链或者非概念级别的操作系统。为了解决软件治理和可编程问题，所以才逐渐衍生、总结出编译器、OS等这些概念，从进化、发展的角度去看，能这么理解吗？</div>2019-05-10</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ermRibwXSt1icBvH3IO1JfiaqakIcxxAP4zSkicewogKVWCFicb0NVc7tF3xSVMJwE3lBg2gH4r7u6sGtw/132" width="30px"><span>pawhrmyki</span> 👍（3） 💬（1）<div>假设可寻址范围4G，用户空间：0～3G，内核3G～4G，那对于保护模式下的用户程序，他能访问到的虚拟的4个G中，其实真正属于他的只有3G，还有1G是和内核以及其他所有进程共享的，而这1G的地址对于所有进程（包括操作系统）都是一样的，可以这么理解吗</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/cf/97/fcd8957d.jpg" width="30px"><span>82</span> 👍（3） 💬（2）<div>编程语言只是一个工具，而操作系统作为接口平台，干了很多复杂的事情。其实语言本身也是可以直接跳过操作系统去对接硬件。
操作系统作为聚合平台其实也不是必须的，只是为了提升某块的效率，对吧
</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/63/40/69590f46.jpg" width="30px"><span>Jeyrce.Lu</span> 👍（2） 💬（1）<div>老师我想问一下，go编译后的二进制程序都是单个文件，我貌似没有找到可以编译出动态链接库的方法，原因是go程序完全没有使用系统封装的动态链接库吗，他自己实现了所有的系统调用？还有就是我更改一个环境变量就可以在amd上编译出arm上可执行的二进制，这个原因也是go实现了arm amd等常见的架构下所有系统调用么？</div>2021-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f6/ba/09ab72d2.jpg" width="30px"><span>幻灰龙</span> 👍（2） 💬（1）<div>跨语言交互能增加理解，特别是有虚拟机的语言之间，例如在C#或者Java里跟Lua交互。</div>2020-02-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c5/6a/7f858f1f.jpg" width="30px"><span>白不吃</span> 👍（2） 💬（1）<div>可能我学的java吧，篇幅中过多的go语言内容</div>2020-01-28</li><br/>
</ul>