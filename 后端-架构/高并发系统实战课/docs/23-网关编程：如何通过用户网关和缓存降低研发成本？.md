你好，我是徐长龙。

如果说用户的流量就像波涛汹涌的海浪，那网关就是防御冲击的堤坝。在大型的互联网项目里，网关必不可少，是我们目前最好用的防御手段。通过网关，我们能把大量的流量分流到各个服务上，如果配合使用Lua脚本引擎提供的一些能力，还能大大降低系统的耦合度和性能损耗，节约我们的成本。

一般来说，网关分为外网网关和内网网关。外网网关主要负责做限流、入侵预防、请求转发等工作，常见方式是使用Nginx + Lua做类似的工作；而最近几年，内网网关发展出现了各种定制功能的网关，比如ServiceMesh、SideCar等方式，以及类似Kong、Nginx Unit等，它们的用途虽然有差异，但是主要功能还是做负载均衡、流量管理调度和入侵预防这些工作。

那么网关到底提供了哪些至关重要的功能支持呢？这节课我们就来分析分析。

## 外网网关功能

我们先从外网网关的用法说起，我会给你分享两类外网网关的实用设计，两个设计可以帮助我们预防入侵和接触业务的依赖。

### 蜘蛛嗅探识别

流量大一些的网站都有过网站被攻击、被蜘蛛抓取，甚至被黑客入侵的经历。有了网关，我们就能实现限速和入侵检测功能，预防一些常见的入侵。

这里我主要想和你分享一下，非法引用和机器人抓取这两类最常见、也最严重的问题要如何应对。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/d6/2f5cb85c.jpg" width="30px"><span>xmr</span> 👍（1） 💬（1）<div>k8s就是使用DNS做服务发现</div>2023-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c6/20/124ae6d4.jpg" width="30px"><span>若水清菡</span> 👍（0） 💬（1）<div>为什么内网都在用网关或实现服务发现功能，而不用内网 DNS 服务来实现这一功能呢？
DNS记录在TTL失效前无法生效更新，一般情况下服务器会配置DNS缓存，本地缓存+内网DNS增加了记录生效时间的不一致，还需要确保本地DNS换成和内网DNS服务保持一致，增加了运维难度。如果使用网关实现服务发现，新服务启动后在网关注册一下，更新后再重新注册，只要客户端定时或者实时监听网关中这个服务的注册记录就可以及时发现服务注册变更情况，简化了运维难度，提升了运维效率。</div>2023-01-26</li><br/>
</ul>