你好，我是徐长龙。

在之前的课程里，我们探讨了读多写少、强一致、写多读少、读多写多这四种常见类型的系统如何优化。不过，很多复杂业务系统中，读写逻辑常常混合在一起、相互牵制，这给优化工作带来了很多挑战。

碰上这样的情况，我们不妨考虑一种更高级的拆分模式——CQRS。你可能对CQRS早有耳闻，但觉得太过复杂就望而却步了。不过别担心，这节课里我会结合例子，带你看看传统单体服务架构与CQRS的思考方式有什么不同。

学完今天的内容，你将会深入理解CQRS的拆分思想，找到规避数据服务接口陷阱的方法，还能理解一些反常识的设计，比如微服务里为什么要把5个项目拆成200个。

## 传统单体架构缺点

我们先看看熟悉的传统单体架构设计思路，重点关注一下它有什么缺点，这有助于你理解为什么会出现CQRS这种模式。

这里我们继续沿用前面课程里用户中心的案例，请看下图。图里面展示了单体服务状态下的用户中心，这时候高频和低频的读写服务放在了一起。

![](https://static001.geekbang.org/resource/image/ac/cb/ac2ce23df9f3f523fc0537455a1c10cb.jpg?wh=2259x1273 "单体服务 高频、低频的读写服务放在一起")

在我们的印象中，用户中心读并发流量大。但实际上用户中心里，不是所有功能都是读多写少类型的，你可以参考后面表格列出的例子。

![](https://static001.geekbang.org/resource/image/31/b9/310850892192667bb0e2bda1a030fab9.jpg?wh=2821x1818)

可以看到，除了读多写少的服务功能外，还有很多其它类型的功能（事实上这取决于调用方的场景）。  
![](https://static001.geekbang.org/resource/image/53/4c/536254f796ccdf4f436f83e9c49ee04c.jpg?wh=2259x1273 "传统单体架构优化方式")
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/c6/20/124ae6d4.jpg" width="30px"><span>若水清菡</span> 👍（2） 💬（1）<div>为什么说 CQRS 拆分数据接口很方便，却很难拆分业务接口呢？
可以从课程开头以课程里用户中心的案例看出，每个业务接口对后端数据层（数据库）的访问频次、访问类型都不一样，有多少个业务就需要拆分多少次，很难根据业务接口来做CQRS；拆分数据接口反而简单一些，对数据接口读写拆分即可。</div>2023-12-25</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/YbUxEV3741vKZAiasOXggWucQbmicJwIjg3HDE58oyibYXbSop9QQFqZ7X6OhynDoo6rDHwzK8njSeJjN9hx3pJXg/132" width="30px"><span>黄堃健</span> 👍（0） 💬（1）<div>同层 Service 服务之间没有上下层级关系，可以相互调用（虽然不推荐）  老师， 如果我们允许同层Service服务 相互调用。 对于出现A-&gt;B B-&gt;A死循环，怎么防止</div>2024-02-29</li><br/>
</ul>