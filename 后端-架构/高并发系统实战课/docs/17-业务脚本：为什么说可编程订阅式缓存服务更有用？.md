你好，我是徐长龙。

我们已经习惯了使用缓存集群对数据做缓存，但是这种常见的内存缓存服务有很多不方便的地方，比如集群会独占大量的内存、不能原子修改缓存的某一个字段、多次通讯有网络损耗。

很多时候我们获取数据并不需要全部字段，但因为缓存不支持筛选，批量获取数据的场景下性能就会下降很多。这些问题在读多写多的场景下，会更加明显。

有什么方式能够解决这些问题呢？这节课，我就带你了解另外一种有趣的数据缓存方式——可编程订阅式缓存服务。学完今天的内容，相信你会对缓存服务如何做产生新的思考。

## 缓存即服务

可编程订阅式缓存服务的意思是，我们可以自行实现一个数据缓存服务直接提供给业务服务使用，这种实现能够根据业务的需要，主动缓存数据并提供一些数据整理和计算的服务。

自实现的数据缓存服务虽然繁琐，但同时也有很多优势，除去吞吐能力的提升，我们还可以实现更多有趣的定制功能，还有更好的计算能力，甚至可以让我们的缓存直接对外提供基础数据的查询服务。

![图片](https://static001.geekbang.org/resource/image/ef/f3/effe5afb3ac029f5c21d94d9b2d2a2f3.jpg?wh=1920x1048 "自实现缓存功能结构图")

上图是一个自实现的缓存功能结构，可以说这种缓存的性能和效果更好，这是因为它对数据的处理方式跟传统模式不同。

传统模式下，缓存服务不会对数据做任何加工，保存的是系列化的字符串，大部分的数据无法直接修改。当我们使用这种缓存对外进行服务时，业务服务需要将所有数据取出到本地内存，然后进行遍历加工方可使用。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/YbUxEV3741vKZAiasOXggWucQbmicJwIjg3HDE58oyibYXbSop9QQFqZ7X6OhynDoo6rDHwzK8njSeJjN9hx3pJXg/132" width="30px"><span>黄堃健</span> 👍（0） 💬（1）<div>老师，有什么开源的go服务使用lua来做业务缓存。这样真正看看人家怎么玩，踩坑相对少很多</div>2024-02-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/41/f3/8bca4aba.jpg" width="30px"><span>普通熊猫 ଘ(੭ˊ꒳​ˋ)੭✧</span> 👍（0） 💬（1）<div>与其在golang的项目中引进redis，然后对外提供类似于redis的简单协议，并且自己实现一套内存数据的加载逻辑，为什么不考虑直接用lua订制redis？会不会更简单一些😂</div>2023-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/97/0b/a943bcb3.jpg" width="30px"><span>zhou</span> 👍（0） 💬（2）<div>问题1、文中的可编程缓存可以把数据结构化存在map中，相比传统模式序列话串要省内存。我想问下有些对象格式是无法存在map格式中的，另外map的方式跟json的方式存储大小上应该没有很大区别。
问题2、我是java语言，用redis缓存数据，我认为业务缓存修改后实时生效是可以直接重新拉去即可。</div>2023-02-10</li><br/>
</ul>