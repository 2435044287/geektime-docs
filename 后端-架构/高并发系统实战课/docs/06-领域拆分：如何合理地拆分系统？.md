你好，我是徐长龙。

从这一章开始，我们一起看看怎么对数据一致性要求极高的系统做高并发改造。在这个章节中，我会以极具代表性的电商系统为例，对改造的技术关键点进行讲解。

一般来说，强一致性的系统都会牵扯到“锁争抢”等技术点，有较大的性能瓶颈，而电商时常做秒杀活动，这对系统的要求更高。业内在对电商系统做改造时，通常会从三个方面入手：系统拆分、库存争抢优化、系统隔离优化。

今天这节课我们先来热个身，学习一些系统拆分的技巧。我们知道，电商系统有很多功能需要保持数据的强一致性，我们一般会用锁确保同一时间只有一个线程在修改。

但这种方式会让业务处理的并行效率很低，还很容易影响系统的性能。再加上这类系统经常有各种个性活动需求，相关功能支撑需要不断更新迭代，而这些变更往往会导致系统脱离原来的设计初衷，所以在开发新需求的同时，我们要对系统定期做拆分整理，避免系统越跑越偏。这时候，如何根据业务合理地拆分系统就非常重要了。

## 案例背景

为了帮你掌握好系统拆分的技巧，我们来看一个案例。有一次，我受朋友邀请，希望我帮他优化系统。

他们是某行业知名电商的供货商，供应链比较长，而且供应品类和规格复杂。为确保生产计划平滑运转，系统还需要调配多个子工厂和材料商的生产排期。
<div><strong>精选留言（9）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg" width="30px"><span>👽</span> 👍（13） 💬（1）<div>这节课其实个人认为应该拆分为两节：1.领域设计；2.业务抽象设计；

领域设计的核心在于，将一个很大的流程去把它尝试独立拆分使其边界明确。本文中的例子就将一个臃肿的订单流转，根据业务流程进行领域设计和拆分。使其在每一个阶段都有自己的生命周期。每个生命周期对应一个单独是核心业务实体以及数据库表。每个领域向内聚合，领域之间划清边界，每个领域业务的生命周期流转，仅囊括当前业务自己的这部分，尽量减少与其他领域过度耦合。

底层服务拆分又是另一个概念了。方法有从下到上（被动抽象），从上到下（强制标准）两个方向。从上到下是理想状态。但实际实践中还要根据实际业务来，抽离通用业务，强制抽象设计，引入公共服务总线等都是方法。业务和实际情况不是一成不变的，要根据当前的实际情况进行选择。</div>2022-12-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ce/6d/530df0dd.jpg" width="30px"><span>徐石头</span> 👍（2） 💬（1）<div>MVC是项目目录功能分层设计，偏框架，而DDD更多是业务实体领域和彼此之间的关系，偏业务</div>2022-11-04</li><br/><li><img src="" width="30px"><span>Geek4892</span> 👍（1） 💬（1）<div>老师，我看到的图7和图6完全一样，是放错了还是有别的意图～</div>2023-10-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/74/aa/178a6797.jpg" width="30px"><span>阿昕</span> 👍（0） 💬（1）<div>思考题：1.mvc是从代码结构层面来指导分包的，使得整体代码结构更有条理；2.ddd分为战略和战术两个层面，在战略层面来讲，它采用了实体、聚合、泛化等概念来指导领域建模，让架构更贴近业务；在战术层面来讲，分包的方式比mvc更进一步，在整洁架构方面表现得更好。</div>2023-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/d0/de/5eb5ffb0.jpg" width="30px"><span>严程序</span> 👍（0） 💬（1）<div>DDD我感觉主要是从业务流程的独立性来逐步往下拆分到最后的实体分工~它比较强调业务的独立性和低耦合度，而mvc偏向从实体出发再去拆分它的业务动作。主要还是拆分方向不同 整体的理论最终达到的目的是比较一致的~所以中间过程一些是有一致性的</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（0） 💬（1）<div>同层级之间的模块是禁止相互调用
------------
这个的服务划分，同一层级的不允许相互之间调用，由上层类似于 bff 做聚合了，会不会太严格了？ 很多业务模块都会在同一层，相关之间会有依赖</div>2022-12-23</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DoNwd7Fm9Ynsk0ZoHbfY4fXbwctf7SR6Jdyh7HIKwI2Dsgh56rT80ndpd4xeriareZ0MibdgiavicccFqjOztpMfqQ/132" width="30px"><span>Geek_994f3b</span> 👍（0） 💬（1）<div>我个人觉得两者只是作用域范围不同，从程序的角度看，MVC模式用在线程间(单体应用)，而DDD用在进程间(微服务)，那么MVC + RPC协议 + 业务拆分 ≈ DDD(个人愚见：)，像是在单体上多套了一层</div>2022-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg" width="30px"><span>花花大脸猫</span> 👍（0） 💬（1）<div>其实大部分问题的出现，都是由于对初始的架构设计过于理想，在迭代过程中对需求与初始架构之间的规划缺乏思考，导致后续产品的臃肿，遇见的大部分场景都是这样的原因。文中说的拆分和架构设计需要我们不定期回看、自省、不断调整。这一段恰恰是作为工程师最欠缺的部分或者说最容易忽视的部分，当有这样的想法的时候，说明已经相对是一个高层次的视野去审视问题了</div>2022-11-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/6c/2b/0395fdd0.jpg" width="30px"><span>似水年华</span> 👍（0） 💬（1）<div>老师的这节课对于我们面临各个业务发展周期如何合理的进行业务模块划分有了比较清晰的解答，另外一点也证实了过度设计有弊而无利。其核心的关键点是在理解业务领域模型的基础上，利用合适的方法论和工具去做业务模块合理的划分，并在抽象设计上需要把握平衡点。</div>2022-11-10</li><br/>
</ul>