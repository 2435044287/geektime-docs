你好，我是王磊，你也可以叫我Ivan。

在这门课的第1讲，我想和你探讨一个最基本的问题：**什么是分布式数据库？**

回答这个问题，其实就是在给分布式数据库下定义。

分布式数据库和很多技术概念一样，没有权威机构来做这个定义，甚至对于哪些机构是权威机构，我们都很难有共识。

作为技术人员，我们常会提到一个概念，叫“事实标准”。当一个技术产品占据市场的主导位置时，它自然就成了同类产品的事实标准。例如，对于关系型数据库，可以说Oracle就是事实标准，因为所有数据库产品发布新版本时，都要拿自己的特性去和Oracle比一比。

很遗憾，分布式数据库作为一个新兴的基础软件，还没有一款产品占据“事实标准”的位置。既然没有参照，我们就自己动手，一起来定义分布式数据库这个概念吧。

由表及里、由外到内是人们认识事物的普遍规律，所以我们让也从内外部两个视角来观察。

## 外部视角：外部特性

外部视角，就是看看分布式数据库具备哪些特性，能解决什么问题。

通常，业务应用系统可以按照交易类型分为联机交易（OLTP）场景和联机分析（OLAP）场景两大类。OLTP是面向交易的处理过程，单笔交易的数据量小，但是要在很短的时间内给出结果，典型场景包括购物、缴费、转账等；而OLAP场景通常是基于大数据集的运算，典型场景包括生成个人年度账单和企业财务报表等。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg" width="30px"><span>趁早</span> 👍（74） 💬（6）<div>我也不太能理解老师说的分布式数据库服务于写多读少的应用，我觉得不管是写多还是读多都可以应用分布式，关键是单体已经承担不了这么多请求了（不论读写），所以其实高并发就够了，不应该吧写多读少加入到分布式数据库的定义里面</div>2020-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg" width="30px"><span>kylexy_0817</span> 👍（22） 💬（1）<div>一直没接触过分布式关系型数据库，感觉就是把客户端或中间件的方案直接作为数据库服务端的特性组件，把分库分表做得更为自动化🙃</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg" width="30px"><span>峰</span> 👍（16） 💬（1）<div>云dbms再分布式基础上更关注于计算存储分离后可独立扩展，甚至动态扩缩容，self-driven搞起来，更好卖了哈哈哈。当然这引发了不少问题，aurora提出了log is database的思想，降低写压力，snowflake通过建立中间分布式换存层，降低网络瓶颈等等。</div>2020-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg" width="30px"><span>开心哥</span> 👍（12） 💬（2）<div>aurora也用到一点投票机制，6个副本，半数以上就确认写入成功。也算沾点边。但没有分片，不能多写，肯定不算分布式。</div>2020-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/b5/36/d444d19e.jpg" width="30px"><span>xy🥝</span> 👍（11） 💬（1）<div>AWS aurora，阿里polarDB，腾讯CynosDB，架构上是比较类似的，计算存储分离。
所有计算节点都访问存储节点上的同一份数据，也可以说是分布式架构的。建议老师加个餐讲讲</div>2020-08-14</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJqUkoCXOxRraVNVg1fTm4O892WFVCjeL9pS8kUX2nEeTEcaS6k0kP25h3rRKtUCwSoUrY6dvP43w/132" width="30px"><span>赵见跃</span> 👍（7） 💬（3）<div>老师您好，基于OLAP使用场景的分布式关系型数据库，都有哪些呀？谢谢，</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（6） 💬（1）<div>建议老师画一张分布式数据库的全景图，后续的章节都可以在这张图上添砖加瓦，不然单节学完就是学完了而已，没有成体系，谢谢</div>2020-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/22/98/7151165f.jpg" width="30px"><span>万丰路甲一号</span> 👍（5） 💬（1）<div>希望老师能够讲讲交易场景下，交易代码配合分布式数据库而做出的交易补偿或者数据回放等等</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c4/c1/1118e24e.jpg" width="30px"><span>Stone</span> 👍（4） 💬（1）<div>从老师的措辞上来看感觉老师水平很高，相对于其它老师学术范更浓一点。</div>2020-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg" width="30px"><span>qinsi</span> 👍（4） 💬（1）<div>请问OLTP中“写多读少”中的“多”和“少”是指请求的数量还是请求的大小，或是什么其他的指标呢？都说互联网应用的数据请求通常是“读多写少”，所以才会有一主多从读写分离、全量数据缓存等解决“读”的问题的扩容手段。如果说的是同一个指标的话，是不是意味着分布式数据库不适合互联网应用？</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/b8/24/039f84a2.jpg" width="30px"><span>咱是吓大的</span> 👍（3） 💬（1）<div>课程看到这里还有一个疑问，分布式数据库的数据是分别完整存储在几台不同服务器，还是以某种规则拆分存储在几台服务器</div>2020-11-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/18/11/f1f37801.jpg" width="30px"><span>James</span> 👍（3） 💬（1）<div>可以更新快点吗？不够看的</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f2/66/b16f9ca9.jpg" width="30px"><span>南国</span> 👍（2） 💬（1）<div>仅仅是简单看过Aurora的论文，算是有一点点了解。对于老师的问题，首先我觉得Aurora是提出一种新的单体架构以减少网络IO和同步阻塞，逻辑上可以看做一个庞大的单体数据库，用分布式来支持容错和高吞吐量。至于差异方面，我个人其实并没有看出差异。。理由如下：Aurora分片的方式是将数据库的总容量划分为固定大小的数据段，在每一段内存储数据，每一个段是一组机器（六个），个人认为算是支持分片；写多读少、低延时这就是Aurora所重点的做的事情，通过log is database和支持异步来实现；海量存储可以靠堆机器（当然这些机器肯定是有一个控制中心来管理的，论文中没有提）；高可靠则是靠每一个数据段把数据冗余到三个可用区的六台机器；而且它同样也是关系型数据库呀。希望老师纠正！</div>2020-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/12/13/e103a6e3.jpg" width="30px"><span>扩散性百万咸面包</span> 👍（2） 💬（3）<div>不是很懂为什么说Aurora不是分布式数据库。Aurora通过计算和存储服务分离，使得亚马逊的云存储服务更加高效和易于使用。算是Newsql中比较成功的一个流派了。</div>2020-08-12</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJqUkoCXOxRraVNVg1fTm4O892WFVCjeL9pS8kUX2nEeTEcaS6k0kP25h3rRKtUCwSoUrY6dvP43w/132" width="30px"><span>赵见跃</span> 👍（2） 💬（2）<div>老师好，MyCat现在发展的怎么样，性能上不知道，是否改善了。谢谢。
再请教一个问题，阿里的PolarDB是分布式数据库吧？它采用的是哪种方案呢？靠谱不？谢谢。</div>2020-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg" width="30px"><span>神经旷野舞者</span> 👍（1） 💬（1）<div>分布式数据库是区块链流行的推动吗？还是技术领域本来就到了他出场的时候，因为感觉分布式数据正好适用于区块链的场景，区块链也催生分布式数据库</div>2020-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/f2/66/b16f9ca9.jpg" width="30px"><span>南国</span> 👍（1） 💬（1）<div>想问问老师，根据文中的定义，BigTable就算是属于特殊的（代理中间件 + 单体数据库（分布式文件系统））吗？它毕竟是靠Chubby来作为一个中间层的，不过数据的获取是直接与文件系统中交互完成的。我一直以为它也算是分布式数据库。</div>2020-08-13</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJMwJp2vbhkH4z9WAg71xquHp2mCialKbtgOwOjmHjG1DgZOF6Nne53xHl7JXlAjr9NYQfEcl8vqzg/132" width="30px"><span>Geek_aa8617</span> 👍（0） 💬（1）<div>请教一下，OLAP和OLTP是不是需要选用不同的数据库存储方案？目前OLAP 一般都用大数据平台进行计算，但还是会把结果数据导出到数据库进行报表、数据接口类的应用。是不是应用数据的存储也需要选择不同于传统数据库的，更适合快速查询的存储方案？</div>2022-09-06</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmyjUJe2FxeyL5VMuJlpCFeJKy4SYpicbpCgyPSqbiafPlhibQT2fLWJzqV1ANSDiaSMDVTJVGyAnIow/132" width="30px"><span>wangshanhe</span> 👍（0） 💬（1）<div>单元化架构下，通过路由进行数据分片，而对于单个单元下，又使用了一主两从的主备复制的数据库架构设计方案，现在针对这个单个单元的两个备用数据库想要利用起来，想在这个基础上再去做读写分离，想请教一下老师这种有没有风险，对于整链路的可靠性是否有影响？</div>2022-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/de/5c/3b594e24.jpg" width="30px"><span>十</span> 👍（0） 💬（1）<div>老师，我向问下，分布式数据库的六个外部特性，是不是只是针对OLTP场景的，如果是OLAP，就不是这六个特性了？</div>2021-06-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/2d/ca/02b0e397.jpg" width="30px"><span>fomy</span> 👍（0） 💬（1）<div>所谓分布式数据库我认为是屏蔽了内部细节的单点数据库吧。比如分布式数据一致性，分布式事务等都是分布式数据库必须解决的问题。</div>2021-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/aa/431de942.jpg" width="30px"><span>dbtiger</span> 👍（0） 💬（1）<div>“将技术细节收敛到产品内部，以一个整体面对业务应用。”这句话怎么来理解呢？怎么区分真正的分布式，如果应用端发起SQL，各个节点都起会话，1个应用端连接就占用节点个数连接数资源，那这样算是那种框架的分布式数据库呢？</div>2020-11-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg" width="30px"><span>神经旷野舞者</span> 👍（0） 💬（1）<div>看到老师说银行上线tidb，感觉开源数据库可能没商用的oracle稳定，会不会出现丢数据的bug呢</div>2020-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/47/b1/290cd99d.jpg" width="30px"><span>Aaron</span> 👍（0） 💬（3）<div>老师现在银行选用Newsql的多嘛？光大银行本身有没有使用newsql？</div>2020-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/a5/d50f4c9f.jpg" width="30px"><span>FF</span> 👍（0） 💬（1）<div>可以从实际场景说下Aurora和分布式存储的应用的差别吗</div>2020-08-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIdCoCuWIfSd0z2Xd2iaYtM15Io390aqkQwpicvezs6Oeh7O5jleM555EZcmA5ibs2Rgu8nlWE1nvqww/132" width="30px"><span>Geek_eo2sbf</span> 👍（0） 💬（1）<div>没主动了解过Aurora，一直把它当成常见的分布式数据库看待的，他很特殊么？</div>2020-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/ef/b9/c0c12bea.jpg" width="30px"><span>gtp</span> 👍（0） 💬（1）<div>期待已久</div>2020-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/75/b7/e5f8c418.jpg" width="30px"><span>萧少聪Scott</span> 👍（16） 💬（0）<div>活学活用「加餐」&amp;「拍砖」，希望与更多朋友交流分布式观点。

关于“Aurora是不是分布式数据库”的问题，更为精准的答案应该是：“Aurora（及PolarDB，PolarDB-X除外）是应用了分布式存储能力的数据库”。

Aurora提供的是基于MySQL或PostgreSQL改造的一写多读架构，现有架构下写节点只能Scale-up，不能横向扩展，只读节点可以扩展到15个。同时，借助于分布式存储的多副本及横向扩展能力实现更高的IO带宽，也提升了存储的容错能力，但存储容量最大只能到128TB。Aurora利用最新的CPU、RDMA网络甚至如同Optane这样最新的硬件降低延迟，提升整体性能及高可用切换效率。

回到王老师的观点，分布式数据库是：“写多读少、低延时、海量并发、海量存储、高可靠性、关系型数据库”。Aurora在写多读少方面因只支持一写多读，而有不足；海量并发方面因最多也只能扩展15个只读节点，而有不足；海量存储方面因最大只能到128TB，而有不足。有了以上的前提，可以认为“Aurora是不是分布式数据库”。

[未完待续…]</div>2021-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e3/8b/27f875ba.jpg" width="30px"><span>Bryant.C</span> 👍（9） 💬（0）<div>老师好，对于分布式数据库设计上的几种不同的share方式，在这个课程里有介绍吗？在平时经常听说类似share nothing，share everything，share disk以及share storage，这些设计理念在网上的概念都不是特别清晰，想听听老师对这块知识的梳理，谢谢～</div>2020-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/75/b7/e5f8c418.jpg" width="30px"><span>萧少聪Scott</span> 👍（7） 💬（2）<div>[接上]

先来「加个餐」，对于为什么Aurora只能支持到128TB，我有一个猜想：是因为每一次进行SQL的处理是，实际上只会有1个计算节点参与处理，因此用尽1个节点的CPU、内存可以处理的数据量最终是有限的。所以我猜想，并不是存储扩展能力有限，而是从产品设计角度出发，存储再大实际上没有意义，因此控制存储大小引导客户使用其他产品处理更大的数据量问题，才是云厂商的上策。

再来「拍个砖」，王老师在本课程将只讨论“关系型数据库”，因为基于SQL的结构化关系型模型是大众使用最为广泛的。但是，实际上我还是十分希望可以有机会进行更广泛的讨论，数据库的形态多样，仅仅NoSQL就可以分出Document、KV、图、时序、对象等一众序列，我认为未来数据库的发展，会推动多种不同模型之间产生更多的连接和融合。</div>2021-04-24</li><br/>
</ul>