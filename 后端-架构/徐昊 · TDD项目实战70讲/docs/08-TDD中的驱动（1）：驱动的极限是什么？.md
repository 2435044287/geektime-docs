你好，我是徐昊。从今天开始，我们来讨论一下测试驱动开发中的驱动是什么意思。

在上节课，我们讨论了测试驱动中测试的性质。它们不是“单元测试”，而是不同粒度的功能测试。或者如我建议的那样，你可以叫它们“单元级别功能测试”。

那么这些单元级别功能测试将会如何驱动我们的开发呢？今天我们就来讨论一下这个问题。

## 如果当初我们那么做了

[上节课](https://time.geekbang.org/column/article/496699)我们讲到，TDD中测试针对的粒度是独立的功能上下文或变化点。测试验证功能上下文或变化点符合功能需求。

对于相同的功能，如果我们划分的功能上下文不同，会有什么结果呢？回看之前的TDD演示，在[第一讲](https://time.geekbang.org/column/article/494207)中，我们讨论了三种实现方式：

1. 从给定的参数列表中寻找对应选项，并根据选项类型读取参数；
2. 将参数列表按照选项，分割成由选项名称和参数组成的数组；
3. 将参数列表按照选项，分解成由选项名称和参数组成的映射。

这三种选择实际上就划分了不同的**功能上下文**。当时出于实现方式复杂度的考虑，我选择了第一种实现方式。即，从功能上下文的角度考虑，也就是从API视角出发，将全部功能当作一个上下文。那么如果我们当时选择了其他的实现方式，会如何呢？请看接下来的视频演示。

好，到此为止，通过红/绿循环，我们实现了参数分割的功能。剩下的部分，其实与我们之前展示的相差不多。我稍微演示一两个测试，其他的你可以自行操作。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/84/0b8e2d25.jpg" width="30px"><span>邓志国</span> 👍（28） 💬（1）<div>最长碰到的挑战就是问：TDD如何驱动某个算法的实现。这篇文章给了很好的答案。</div>2022-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/65/21/101a7075.jpg" width="30px"><span>davix</span> 👍（5） 💬（1）<div>請問老師，我體會到的一個現實情況是實現跟設計常常是同時進行的。也就是說大多情況拿到一個需求，開始只有一個模糊的設計。對於功能模塊的劃分，各模塊對外接口具體參數等，是在實現的時候逐步明確清晰的。如果ㄧ上來對邊界就十分明確，自然很容易ㄧ個個寫成測試，再一個個實現pass就行了。但這種情況很少。您怎麼看？</div>2022-04-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（4） 💬（1）<div>TDD 不能做什么？

- 不能窥探方法内是如何实现的，例如对于一个排序算法，只能验证结果是否符合预期，不能验证使用了哪种算法（冒泡、插入等）
- 不能求解自己不会的问题，例如：
  - 自己没有思路的算法题
  - 破解世界七大数学难题获得高额奖金</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/d6/46/5eb5261b.jpg" width="30px"><span>Sudouble</span> 👍（10） 💬（0）<div>红：搭建一个框架；
绿：实现了框架；
重构：改进了框架。
是一个从无到有，从有到完善的架构演进过程。</div>2022-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（5） 💬（4）<div>原来以为可以学好了 TDD 在 LeetCode 上大杀四方，看来我想多了！
多谢老师告知 TDD 不能做什么</div>2022-03-29</li><br/><li><img src="" width="30px"><span>Geek_a03aa5</span> 👍（4） 💬（0）<div>红：这个需求很简单，怎么实现我不管
绿：不要跟老夫说设计模式、面向对象，jQuery 一把梭.jpg
重构：改掉上面产生的坏味道

在每个阶段只需要达成一个小目标，个人感觉是用来降低开发过程中的认知负担的好办法。
</div>2022-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/2d/93/0f1cbf44.jpg" width="30px"><span>枫中的刀剑</span> 👍（3） 💬（0）<div>红：以代码的形式呈现功能最终的样子，以终为始的思想，通过测试迫使自己去思考功能的上下文。
绿：将想法变为现实。通过红的步骤我们可以只专注在一个小的上下文上来思考如何实现，降低认知负担。
重构： 对功能和结构再次调整，消除不合理的地方，朝更好的设计前进。</div>2022-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/87/e1/b3edcc09.jpg" width="30px"><span>范飞扬</span> 👍（1） 💬（0）<div>现在不用带着测试代码到 Stack Overflow了。带着测试代码找GPT，它会帮你实现</div>2024-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/4e/ca/fdc5eb78.jpg" width="30px"><span>Kea</span> 👍（1） 💬（0）<div>道生一 一生二 二生三 三生万物 tdd 可以帮助你高效且工程化地由一生二 二生三 三生万物 但是不能帮你如何实现道 本质你还得知道道是什么 而且 tdd 本身也是一种道</div>2022-09-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/ef/58/d05ec302.jpg" width="30px"><span>Frode</span> 👍（1） 💬（0）<div>1. TDD“驱动”的是架构，因而实际是一种架构技术。
2. 测试驱动开发到底驱动了什么：功能在单元（模块）间的分配。我们也讲了，测试驱动开发在什么地方会失去驱动力：单元（模块）内的实现方式
3. 如果我们要驱动单元内的功能实现，该怎么办呢？那么就需要将这个单元对应的功能上下文，分解为更小的上下文，并将功能需求在这个上下文中加以分解。
4. 如果真的不知道怎么实现？拆分功能，可以先mock出来，然后实现可以实现的，再想办法解决，例如请教他人</div>2022-03-30</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqYELRicTr5JPp1oc3icKP9nRN1bYg382vIHWOfIe6Idc8xA6YCic0fL8VVy08Kp3pg9u1D3mOfOESUQ/132" width="30px"><span>Geek_99be51</span> 👍（0） 💬（0）<div>所以，在更细力度的测试需求的驱动下，模块的功能从耦合到松散，架构也越来越清晰。</div>2024-02-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8a/8a/7c1baa25.jpg" width="30px"><span>buoge</span> 👍（0） 💬（0）<div>TDD 解决的是业务需求 到功能模块 该如何拆分， 功能模块是否正确工作！
从它并没有解决代码实现的细节，而是实现了一个框架，从这个角度来讲，它是一种架构技术。</div>2023-04-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/c7/d6/32d7bd4e.jpg" width="30px"><span>zhuyc</span> 👍（0） 💬（0）<div>红：描述需求
绿：实现需求
重构：优化实现

设计是对需求进行分解并重组。

TDD过程：
- 用验收测试用例明确需求（然后disable掉这些用例）
- 根据经验分解出能实现部分（TODO list）
- 红，绿循环实现部分
- 逐渐拼凑出需求，通过验收用例
- 过程中根据bad smell情况，适时重构代码&#47;调整TODO list</div>2022-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/aa/48/63746a27.jpg" width="30px"><span>eoeoeo</span> 👍（0） 💬（0）<div>从架构的角度来说
红-根据当前需求设计最终希望得到的目标或者结果
绿-找到一种能满足需求的架构设计或者备选架构设计
重构循环-不断发现架构中的缺陷和未澄清的需求，改进设计</div>2022-09-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/65/21/101a7075.jpg" width="30px"><span>davix</span> 👍（0） 💬（0）<div>如此看TDD驅動的實現方向是按測試金字塔從頂到底？從端到端到UT？</div>2022-05-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/04/41/082e2706.jpg" width="30px"><span>keep_curiosity</span> 👍（0） 💬（0）<div># TDD 打卡＃学习打卡</div>2022-05-01</li><br/>
</ul>