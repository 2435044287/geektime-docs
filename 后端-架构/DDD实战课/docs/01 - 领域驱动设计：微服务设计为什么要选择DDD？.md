你好，我是欧创新。

我们知道，微服务设计过程中往往会面临边界如何划定的问题，我经常看到项目团队为微服务到底应该拆多小而争得面红耳赤。不同的人会根据自己对微服务的理解而拆分出不同的微服务，于是大家各执一词，谁也说服不了谁，都觉得自己很有道理。

那在实际落地过程中，我也确实见过不少项目在面临这种微服务设计困惑时，是靠拍脑袋硬完成的，上线后运维的压力就可想而知了。那是否有合适的理论或设计方法来指导微服务设计呢？当你看到这一讲的题目时，我想你已经知道答案了。

没错，就是DDD。那么今天我就给你详细讲解下：“微服务设计为什么要选择领域驱动设计？”

## 软件架构模式的演进

在进入今天的主题之前，我们先来了解下背景。

我们知道，这些年来随着设备和新技术的发展，软件的架构模式发生了很大的变化。软件架构模式大体来说经历了从单机、集中式到分布式微服务架构三个阶段的演进。随着分布式技术的快速兴起，我们已经进入到了微服务架构时代。

![](https://static001.geekbang.org/resource/image/8a/f8/8a859915250ffcab04675fb02fdf34f8.jpg?wh=2388%2A1255)

我们先来分析一下软件架构模式演进的三个阶段。

**第一阶段是单机架构：**采用面向过程的设计方法，系统包括客户端UI层和数据库两层，采用C/S架构模式，整个系统围绕数据库驱动设计和开发，并且总是从设计数据库和字段开始。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1a/04/c4/ef4bd241.jpg" width="30px"><span>Geek_a91670</span> 👍（13） 💬（8）<div>事件风暴到底是什么啊?</div>2019-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a3/d0/882b5388.jpg" width="30px"><span>吴建中</span> 👍（204） 💬（13）<div>面对复杂问题，解决办法通常是拆分，模块化，化整为零。领域驱动建模DDD是面向业务，对业务领域的划分和整合，是逻辑层面。微服务是面向物理落地，是对应用的物理形态进行拆分和整合。从软件工程过程角度看，DDD的战略设计输出物，领域模型及划分的区域，是微服务的输入，一个区域对应一个微服务，微服务运行框架、平台可以承载所有的微服务，提供微服务统一的运行框架，也就是承载所有的业务领域。可见领域驱动与微服务是在软件不同阶段使用的工具，技术或方法论，围绕一个共同的目标，搭建企业业务中台，企业级业务复用，快速的需求响应能力。DDD战略设计得输出，是微服务的输入。</div>2019-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/de/b5833dc6.jpg" width="30px"><span>Skye</span> 👍（132） 💬（13）<div>翻了挺多留言，有一个感觉就是大家的容忍度特别低，总想把DDD的思想或者微服务架构一下子就在项目中完整的落地。就比如，只要使用DDD，在代码层面就不能使用MVC；只要使用微服务架构，就一定要基础设施完善，不然就是垃圾，这可能也是DDD一直推动不下去的原因之一。

人需要不断的学习，团队的认知也需要逐步的完善，是需要时间的。现在的代码是MVC的，没必要推翻，可以先在业务端多与市场、客户成功、产品等角色沟通，尝试用DDD的设计思想来建立合适的模型，等到团队都有这个sense的时候，再去慢慢搞定战术层面的东西。我认为，当业务领域模型足够健壮的时候，即使使用MVC模式，产品的健壮性和可维护性也会高很多。

只有让团队体会到领域设计的好处，才有可能继续推动DDD的落地。

另外一方面，微服务的基础设施也是逐步去构建完善，完全没有必要一开始就大而全。在业务初期，未必要建设庞大的监控系统，通过在代码中打印接口耗时、手动收集业务中的错误日志等方式来监控，也未尝不可，只要适合当前团队就好。

再者，也不用刻意去追求单元测试的覆盖率，能够保证重点业务接口的单元测试覆盖率即可。如果你真的有深入理解TDD的话，你就明白，TDD完全没有要求单元测试覆盖率这种指标，有些接口写单元测试真的只是浪费时间。

最后总结一下，饭是一口一口吃的，路也是一步一步走出来的，多给自己一点耐心，也多给团队一点时间。</div>2021-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4e/49/20a4b82d.jpg" width="30px"><span>Geek_9695b4</span> 👍（51） 💬（7）<div>我们公司现在也有这方面的想法，但是一直无从下手，主要原因是，
1、我们是给工厂做软件的，不同的工厂相同的功能需求会有有差异，这个怎么解决？显然一个工厂一个版本是不好的
2、不同工厂需要使用不同的数据库
3、功能模块主要有物料管理、订单管理、计划管理、出入库管理、库存管理等，里面功能模块较多
4、DDD怎么更好的去解决SAAS化的产品研发问题</div>2019-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f4/0a/02ecee7a.jpg" width="30px"><span>女干部</span> 👍（34） 💬（8）<div>我能说我等极客时间出这个等了1年吗？</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/02/66f65388.jpg" width="30px"><span>雷霹雳的爸爸</span> 👍（30） 💬（4）<div>当然是微服务架构，不是也得跟投资人宣称是

要说最大的问题，就是业务拎不清；让我更进一步分析这种状况，应该是就没有事实上的领域专家，只有很多充其量是熟悉现有业务流程的人，而这些人站在自己的视角阐述问题都没有问题，但是缺少能捏合起来统筹考虑的人，在我们的组织中（我怀疑大多数组织中都是这样），在产品研发团队，关于业务的话语权特别是信息垄断权是掌握在产品（经理）部门手中的，而微服务、DDD的武器却是掌握在技术部门手中，如果技术人员不赶紧学好吃透这些招式，这就对微服务的实际落地，DDD的推广应用，带来了巨大的障碍和困难，我觉得也别无他法，只能忍着被误解和做好顶雷背锅的心态，像Carty说的那样，技术团队中有人挺身而出去承担本该产品经理的责任吧，这样才能给DDD，微服务落地准备足够的营养...我还记得在这个团队在成立初期，产品总监戏称应该定一个组织结构设计架构师的岗位，我估计他主要是说给我这个技术架构师听的，而我只能一脸严肃地表达，确实组织架构应该根据你系统演化的需要来变更的，我就差说你回去好好看看书去不行吗？</div>2019-10-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/de/f0/ccf46294.jpg" width="30px"><span>忠厚</span> 👍（20） 💬（3）<div>中台是战略目标，DDD是设计思想，微服务是落地手段，云原生是落地基础....企业数字化转型四大核心知识体系，一个都不能少，哈哈哈哈...</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/12/73/2183839d.jpg" width="30px"><span>huaweichen</span> 👍（18） 💬（3）<div>我之前的公司从legacy单体应用转型为DDD微服务，
最大的问题是：
1. 使用消息队列的过程中，有很多事件不同步、死循环问题。
2. legacy数据库和新数据库的同步。
3. 做reporting的时候，不知道有什么好的招术。</div>2019-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/d3/89/6f5c09bc.jpg" width="30px"><span>姚俊</span> 👍（14） 💬（2）<div>从2016年偶然间发现了springcloud springboot，于是开始带领团队玩起了微服务，在有一些技术积累之后，开始反过来看做过的项目，发现微服务的拆分并没有带来多少好好处，于是今年开始ddd试错。在拆分过程中，个人碰到的几大问题就是
1、数据库彻底拆分之后，带来的编码问题，和多服务调用的性能问题，举个例子，性别代码表，在n多个系统都需要的情况下，如果复制，也数据库没有彻底拆分，或者有冗余，彻底拆分的话，原来关联查询简单的sql，则变成服务之间的调用，可能存在性能问题。比较棘手
2、接触ddd有几个月吧，也在按照这个模式，重新构建项目，只是实体，聚合根在复杂的业务逻辑下，如何拆分和聚合，一直觉得没掌握到位。希望后续案例可以给我启发
</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/5d/73/ffc3b06d.jpg" width="30px"><span>方堃</span> 👍（14） 💬（1）<div>我觉得微服务现在转型有个挺大的问题就是团队认识深度。因为现在好多项目都是先简单的以单机项目为基础开发，追求上线速度。后续发现项目越来越大才考虑进行架构方向的整理。导致很有可能出现早期只有开发产品没有架构师参与。这时候转型，架构师多久能吃透现有的业务就是转型速度的瓶颈了。毕竟产品不了解代码，开发人员又往往只盯着自己的模块缺少整体的了解</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/f0/f4/22dbe2d9.jpg" width="30px"><span>肖大保健</span> 👍（13） 💬（1）<div>目前公司用的是spring boot 框架，根据业务也做了明显得服务拆分（接单web，调度服务，订单服务，用户服务，资金服务，api服务 等），后期打算把数据层（mysql，mongo，redis）单独拆分出去，web层controller再单独拆分做HA 或者 ng，不知道算不算的上微服务架构，我们在做服务拆分，功能聚合这块是按业务模块来的
问题一：服务的功能界限该如何划定（按功能，还是按业务，有点矛盾）
问题二：服务调用，横向一个个调用，还是按web或者调度中转，比较好？（也存在争议）
问题三：文章中提到界定上下文，请问在服务中该如何体现，不是很明白</div>2019-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（10） 💬（2）<div>1.一年前学的ddd，半年前学的重构，现如今项目从架构到核心业务都重构了。这个专栏，实在等了太久。

2.目前公司采用了微服务组件和框架。但绝对不是微服务，缺少合理的业务拆分，缺少对应的敏捷开发基建（没有cicd，没有测试用例，没有自动化回归测试，没有完善的监控平台，微服务技术的引入很可能弊大于利）。我将这架构认定为传统soa引入微服务组件和框架，依旧是传统soa。拆得再细都还是单体，因为每个服务不能自成体系，相互依赖严重。

3.难点很多。业务债高难还，员工（所有业务开发）在业务的架构抽象上认知太浅，基础架构平台从0搭建，效能工具平台从0搭建，最难的是，2b项目改造价值有限，如果没有升级为saas平台并带来额外利益的可能，那么一切改造都是空话，能用就行。
</div>2019-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/53/2f/9f3f2c5e.jpg" width="30px"><span>Dr</span> 👍（10） 💬（4）<div>实战源代码，成体系吗？还是散落在文章里面？有的话，哪里可以下载？理论看了很多，缺一套代码，琢磨琢磨。</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/12/e5/592d9324.jpg" width="30px"><span>TH</span> 👍（8） 💬（5）<div>DDD是针对业务的，那么到底怎么理解“业务”呢？什么属于业务，什么不属于业务呢？尤其是业务与技术、基础设施、中间件之间的关系怎么划分？

换句话说，DDD是否适合技术框架、技术平台甚至技术中台的建设呢？比如我要开发一个代码部署系统或者配置管理系统，这样的系统是否适用DDD呢？因为对整个公司来说它们应该属于基础设施层的东西吧。

DDD是否存在大系统套小系统的形式？比如整个公司业务用DDD来设计，然后业务中的某个子系统也用DDD来设计，它们可以嵌套吗？</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/96/f9/3f976c91.jpg" width="30px"><span>james.d</span> 👍（7） 💬（1）<div>微服务的关键不在服务的大小，在于边界是否清晰和有效隔离。单体应用向微服务架构演进的第一步是理清系统的领域架构，然后根据领域模型进行重构，每个领域都是“高内聚，低耦合”的模块，这样才能方便后期的拆分。至于服务拆分的大小，哪些需要拆，哪些不需要拆，哪些先拆，哪些后拆，还需要综合考量很多因素，比如团队的组织结构（小团队就不要拆分得太细了），性能，核心功能&#47;非核心功能等等，业务拆分只是其中一小部分，数据拆分才是难点，总之先做好模块化（确定边界，做好隔离）才能实现想拆就拆。</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/30/2a/30354f00.jpg" width="30px"><span>KimZing</span> 👍（7） 💬（1）<div>没有DDD的微服务是没有灵魂的，新瓶装旧酒</div>2019-10-14</li><br/><li><img src="" width="30px"><span>Edward</span> 👍（6） 💬（1）<div>老师 如何能够用比较通俗的语言来解释soa与微服务的差别。尤其是针对企业IT部门的中高层，他们一般是懂一些计算机原理和编程技术，但是对什么是soa和微服务分不开，都以为是一个事情的不同阶段。</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/a7/fb383ef7.jpg" width="30px"><span>MaLu</span> 👍（6） 💬（1）<div>关于两层边界，聚合虚边界，限界物理实边界，很有启发，也给我一直困惑的，如果一个业务领域中，有多个聚合根的情形下，更加清晰与更好的理解。</div>2019-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/52/2b/3e42686d.jpg" width="30px"><span>斯图尔特</span> 👍（6） 💬（1）<div>这里提到的业务人员是指？还有领域专家。套用公司场景，一个做企业服务，tob的公司，有自己的产品。这个过程中，有客户的需求，有项目经理的梳理客户需求。有产品经理对系统的规划，有客户成功提交的使用优化。这个过程中参与人，客户，项目经理，产品经理，客户成功。人员参与，那这些人在DDD领域模型的角色是？</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ee/96/dae024ff.jpg" width="30px"><span>john_zhang</span> 👍（5） 💬（1）<div>toB的企业系统，用了微服务，但是还是采用传统的业务流程方式来开发的，感觉都是为了微服务而微服务，希望通过学习后能对DDD有一定的了解，并能对现有的系统进行优化。</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b2/e4/2c593d2f.jpg" width="30px"><span>刘晓帆</span> 👍（4） 💬（1）<div>要进行事件风暴，可以想象是已知信息越多、越全、越准，则越好。
但比如正处于创业初期，存在信息少、未知性多、需求功能少、多领域等情况。
在这样的情况下，老师建议是：
基于现状和不远的以后（比如一年内）来做事件风暴？
还是，尽可能发散到更远的来做事件风暴？</div>2019-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg" width="30px"><span>南山</span> 👍（4） 💬（1）<div>第一个接触ddd的服务是在leader带领下及自己恶补啃ddd砖头书的情况下完成的，收获就是有了点ddd的思想，但是现在对整体和细节都存在理解不清的地方。后面多结合老师的课做回顾和请教~</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/45/2f/b0b0dd74.jpg" width="30px"><span>杨杰</span> 👍（4） 💬（3）<div>最大的问题就是拆分没有固定标准，有的时候觉得这样分合理那样分也可以</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg" width="30px"><span>谭方敏</span> 👍（3） 💬（1）<div>公司目前在实施微服务，最大的问题是公司没有针对业务流程进行梳理，更加谈不上用DDD，他们的关注点就没离开过spring cloud全家桶，他们把公司业务中台转型建设只理解为技术升级，而非业务流程，数据再融合，数据壁垒再打通。。。。</div>2020-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/8e/4e/985caf6b.jpg" width="30px"><span>悟</span> 👍（3） 💬（4）<div>老师您好，DDD的劣势有哪些呢？</div>2019-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3e/fb/51f8dfe7.jpg" width="30px"><span>like_jun</span> 👍（3） 💬（1）<div>正在用DDD设计进行项目重构</div>2019-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/69/78/b75b68e5.jpg" width="30px"><span>蒋宇翔</span> 👍（3） 💬（3）<div>“比如，在系统建设过程中，我们经常会看到这样的情形：A 负责提出需求，B 负责需求分析，C 负责系统设计，D 负责代码实现...”难道不是很正常的吗？莫非一个人能全搞定？</div>2019-10-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/14/9d/19dcdd42.jpg" width="30px"><span>瓜瓜</span> 👍（3） 💬（1）<div>如何用DDD解决复杂业务的架构问题，一直在等这方面的相关课题</div>2019-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/71/22/b8c596b6.jpg" width="30px"><span>风</span> 👍（2） 💬（1）<div>我们是采用微服务模式进行系统的建设，我们现在是业务驱动开发，我们的每个服务都是独立的涉及业务的相关方面，存在重复性开发，这就是最大的问题。
在系统建设中出现工期紧的情况，没有多余的时间去划分业务域，抽象核心能力，分析之间的限界上下文怎么办？
我们是每个季度第一个月稍微轻松点，第二个月赶进度，第三个月上线如此往复，一个人负责多个系统，项目一般需求分析、系统设计、开发都是一个人，平时还要运维并开发新的功能需求，想要推行DDD，我们这种状况有什么好的建议吗？</div>2020-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/99/1b/e924f17f.jpg" width="30px"><span>阿耿</span> 👍（2） 💬（2）<div>复杂系统集成的关键，是基于架构（或体系）的集成，而不是基于部件（或组件）的集成，这句话老师是怎么理解的，我理解一个软件难道不是由各个组件构成的吗，基于架构的集成是什么概念</div>2020-10-10</li><br/>
</ul>