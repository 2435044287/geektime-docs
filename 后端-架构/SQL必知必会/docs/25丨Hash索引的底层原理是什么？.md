我们上节课讲解了B+树的原理，今天我们来学习下Hash的原理和使用。Hash本身是一个函数，又被称为散列函数，它可以帮助我们大幅提升检索数据的效率。打个比方，Hash就好像一个智能前台，你只要告诉它想要查找的人的姓名，它就会告诉你那个人坐在哪个位置，只需要一次交互就可以完成查找，效率非常高。大名鼎鼎的MD5就是Hash函数的一种。

Hash算法是通过某种确定性的算法（比如MD5、SHA1、SHA2、SHA3）将输入转变为输出。相同的输入永远可以得到相同的输出，假设输入内容有微小偏差，在输出中通常会有不同的结果。如果你想要验证两个文件是否相同，那么你不需要把两份文件直接拿来比对，只需要让对方把Hash函数计算得到的结果告诉你即可，然后在本地同样对文件进行Hash函数的运算，最后通过比较这两个Hash函数的结果是否相同，就可以知道这两个文件是否相同。

Hash可以高效地帮我们完成验证的工作，它在数据库中有广泛的应用。今天的课程主要包括下面几个部分：

1. 动手写程序统计一下Hash检索的效率。
2. 了解MySQL中的Hash索引，理解使用它的优点和不足。
3. Hash索引和B+树索引的区别以及使用场景。

## 动手统计Hash检索效率
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg" width="30px"><span>吴小智</span> 👍（79） 💬（4）<div>所以老师能在稍微解释一下“自适应 Hash 索引”吗？自己查了一些资料，不是很懂。</div>2019-08-22</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/lfMbV8RibrhFxjILg4550cZiaay64mTh5Zibon64TiaicC8jDMEK7VaXOkllHSpS582Jl1SUHm6Jib2AticVlHibiaBvUOA/132" width="30px"><span>用0和1改变自己</span> 👍（16） 💬（1）<div>1，Hash索引有很大的限制，如联合索引、模糊查询、范围查询，以及列里有重复值多。
2，需要遍历链表中所有行指针，逐一进行比较，直到找到所有符合条件的</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg" width="30px"><span>TKbook</span> 👍（14） 💬（4）<div>有个疑问，在数组中，针对下标的检索，时间复杂度是O(1)。老师的代码中用的是result.index(i)，这个函数用的应该不是下标检索。因为当我把代码改成result[i]，检索时间 0.0009975433349609375</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/37/e6/71bcbc93.jpg" width="30px"><span>渴望飞的哺乳类</span> 👍（10） 💬（2）<div>老师，B+ 树使用 LIKE 进行模糊查询的时候，like ‘xx%’ 才会使用到索引吧</div>2019-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg" width="30px"><span>我行我素</span> 👍（10） 💬（1）<div>回复下蒙开强，如果是使用navicat创建索引的时候在后面是可以直接选择索引类型的，如果使用sql创建索引就是在穿件的使用using指定，一般默认是B+</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/1b/4a/f9df2d06.jpg" width="30px"><span>蒙开强</span> 👍（10） 💬（2）<div>老师，你好，hash索引与B+树索引是在建索引的时候手动指定么</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/da/36/ac0ff6a7.jpg" width="30px"><span>wusiration</span> 👍（6） 💬（1）<div>mysql查询中存在着很多范围查询、order by的场景，在这些场景下，B+树的性能好于Hash索引；关键字出现相同Hash码时，会出现hash冲突。</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（6） 💬（7）<div>老师你好，数组检索数据的算法复杂度为 O(n)。
不应该也是O(1)吗？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg" width="30px"><span>许童童</span> 👍（5） 💬（1）<div>查找某个固定值时 Hash 索引比 B+ 树更快，为什么 MySQL 还要采用 B+ 树的存储索引呢？另外，当两个关键字的 Hash 值相同时会发生什么？
因为B+ 树的一些特性像范围查询，联合索引的最左侧原则，支持 ORDER BY 排序等Hash索引没有。
会发生Hash冲突，然后去按key顺序在桶中等值查找。</div>2019-08-07</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/ic8KF0sfxicsx4F25HZrtZwP2fQEibicfibFeYIQBibxnVlHIiaqkfictJuvLCKia0p7liaQvbTzCYWLibjJK6B8kc8e194ng/132" width="30px"><span>爱思考的仙人球</span> 👍（3） 💬（1）<div>hash函数里的桶（bucket）和hive里的桶（bucket）原理是一样的吗？</div>2019-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg" width="30px"><span>ABC</span> 👍（3） 💬（2）<div>感觉Hash索引和Java的HashMap的Hash实现有点像，不过Java用链地址法解决了Hash冲突的问题。</div>2019-08-08</li><br/><li><img src="" width="30px"><span>Ashlar</span> 👍（2） 💬（1）<div>能不能请老师分别推荐一下学习MySQL，Oracle，sql Server的一些书籍或者资料呢？</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/24/b0/a6e0b03a.jpg" width="30px"><span>一语中的</span> 👍（2） 💬（1）<div>来自信息安全专业，看到这一节hash索引原理中提到hash算法，hash是不可逆的，有种异常熟悉的感觉，嗯，那些年学的安全算法们AES,DES,IDEA,Hash,HMAC...</div>2019-08-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4HlmmWfWicNmo3x3HKaOwz3ibcicDFlV5xILbILKGFCXbnaLf2fZRARfBdVBC5NhIPmXxaxA0T9Jhg/132" width="30px"><span>Geek_Wison</span> 👍（1） 💬（2）<div>前模糊查询具体指啥，能举一个具体的例子吗？比如是指: &#39;a%&#39; 还是指 &#39;%a&#39; ？</div>2019-08-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d7/45/d1621188.jpg" width="30px"><span>学渣汪在央企打怪升级</span> 👍（3） 💬（1）<div>感觉有点抽象。原理都知道。但是不会用</div>2020-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg" width="30px"><span>David.cui</span> 👍（3） 💬（0）<div>Hash最大的使用场景是where=的情况</div>2020-02-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/d5/5e/1e09cb8b.jpg" width="30px"><span>bigliu66</span> 👍（2） 💬（1）<div>而 B+ 树使用 LIKE 进行模糊查询的时候，LIKE 后面前模糊查询（比如 % 开头）的话就可以起到优化作用。这句话不太对吧，应该是 LIKE &#39;属性%&#39; 这种后模糊才会起到优化作用吧。</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/69/bf/58f70a2a.jpg" width="30px"><span>程序员花卷</span> 👍（2） 💬（0）<div>1、第一个问题
因为我们在实际的应用中遇到的情况是多种多样，等值查询只是一种而已，而hash索引存在hash冲突，并且有很多的限制，所以需要B+树，在不同的情况下适合的来选择使用！

2、第二个问题
发生hash冲突，然后遍历桶中的行指针来比较，这是非常耗时的一个操作，数据量很小还看不出来，数据量一大，几百万几千万，那这个效率可不是一般的差！

不存在没有hash冲突的hash函数，所以在使用hash索引的时候一定要分析清楚！</div>2019-12-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/ab/4d/441e5cc3.jpg" width="30px"><span>Joecoo丨</span> 👍（1） 💬（0）<div>b+树索引和hash索引的区别第三点有错。B+ 树使用 LIKE 进行模糊查询的时候，like ‘xx%’ 才会使用到索引，like &#39;%xx&#39;是不走索引的</div>2021-05-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（0）<div>数据结构是基础，不同的数据结构特性不一，解决的问题也不一样，需要根据找到合适的。很像自然界中的生物，适者生存，不是强者也不是智者。</div>2024-08-24</li><br/><li><img src="" width="30px"><span>Geek_f7fd80</span> 👍（0） 💬（0）<div>老师能讲一下hash索引是如何形成的吗？也就是描述一下hash索引的形成过程
</div>2023-05-15</li><br/><li><img src="" width="30px"><span>Geek_dc1862</span> 👍（0） 💬（0）<div>能说一下哈希搜索的过程吗？看的不是很明白</div>2022-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/6f/c5/5cbaad93.jpg" width="30px"><span>李博</span> 👍（0） 💬（1）<div>老师，hash索引中的❌和点分别是什么意思，为什么后面有的点指向的内容是叉，有的叉指向内容是点</div>2021-05-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/69/e8/bba34199.jpg" width="30px"><span>微信还是支付宝</span> 👍（0） 💬（0）<div>受益匪浅啊！</div>2021-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/d5/5e/1e09cb8b.jpg" width="30px"><span>bigliu66</span> 👍（0） 💬（0）<div>老师，能讲下联合索引在B+数中是如何存储的吗？一直不是很理解为什么mysql索引要遵从最左匹配原则。</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/56/d2/65db8cc6.jpg" width="30px"><span>稻草人</span> 👍（0） 💬（1）<div>老师可以再解释下输入空间大于桶空间时会hash冲突吗？从图中没看出来是怎么产生冲突的</div>2020-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg" width="30px"><span>旅途</span> 👍（0） 💬（1）<div>老师 问一下 hash 联合索引的计算是多个 hash键合并后进行计算hash值 能起到 避免重复的效果吗 例如 布隆过滤器 一个输入使用多个算法来避免hash值的重复 </div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg" width="30px"><span>William Ning</span> 👍（0） 💬（0）<div>1. [Hash 索引不支持 ORDER BY 排序，因为 Hash 索引指向的数据是无序的，因此无法起到排序优化的作用，而 B+ 树索引数据是有序的，可以起到对该字段 ORDER BY 排序优化的作用。同理，我们也无法用 Hash 索引进行模糊查询，而 B+ 树使用 LIKE 进行模糊查询的时候，LIKE 后面前模糊查询（比如 % 开头）的话就可以起到优化作用。]  没想明白 ?

2.[hash索引的流程: 键值=&gt;桶=&gt;数据行] 没理解? 

3.[自适应Hash采用Hash函数映射到一个哈希表中，所以对于字典类型的数据查找非常方便
哈希表是数组+链表的形式。通过Hash函数可以计算索引键值所对应的bucket（桶）的位置，如果产生Hash冲突，如果产生哈希冲突，就需要遍历链表来解决。]

老师能不能结合图之类的解释下 ? 谢谢.</div>2019-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/15/87/d22d8c3e.jpg" width="30px"><span>_你说了不算</span> 👍（0） 💬（1）<div>老师，b+树为什么可以使用最左前缀匹配原则可以解释一下吗？
</div>2019-11-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e1/1a/20977779.jpg" width="30px"><span>峻铭</span> 👍（0） 💬（0）<div>用java代码测试下数组和map的效率呢，将元素增加到1000000，会有惊喜！！！
</div>2019-09-12</li><br/>
</ul>