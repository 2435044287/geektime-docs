我们之前已经了解了B+树和Hash索引的原理，这些索引结构给我们提供了高效的索引方式，不过这些索引信息以及数据记录都是保存在文件上的，确切说是存储在页结构中。

对数据库的存储结构以及页结构的底层进行了解，可以加深我们对索引运行机制的认识，从而你对索引的存储、查询原理，以及对SQL查询效率有更深的理解。

今天的课程主要包括下面几个部分：

1. 数据库中的存储结构是怎样的？页、区、段和表空间分别指的是什么？
2. 为什么页（Page）是数据库存储空间的基本单位？
3. 从数据页的角度来看，B+树是如何进行查询的？

## 数据库中的存储结构是怎样的

记录是按照行来存储的，但是数据库的读取并不以行为单位，否则一次读取（也就是一次I/O操作）只能处理一行数据，效率会非常低。因此**在数据库中，不论读一行，还是读多行，都是将这些行所在的页进行加载。也就是说，数据库管理存储空间的基本单位是页（Page）。**

一个页中可以存储多个行记录（Row），同时在数据库中，还存在着区（Extent）、段（Segment）和表空间（Tablespace）。行、页、区、段、表空间的关系如下图所示：

![](https://static001.geekbang.org/resource/image/11/b7/112d7669450e3968e63e9de524ab13b7.jpg?wh=739%2A503)  
从图中你能看到一个表空间包括了一个或多个段，一个段包括了一个或多个区，一个区包括了多个页，而一个页中可以有多行记录，这些概念我简单给你讲解下。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg" width="30px"><span>我行我素</span> 👍（34） 💬（5）<div>1.逻辑上连续的，在文中有说采用链表的结构让数据页之间不需要是物理上的连续，而是逻辑上的连续；
2.二分查找发，在总结图中有详细的说明，首先是从B+树的根开始，逐层检索直到叶子节点，找到叶子节点对应的数据页，将数据页加载到内存中，通过页目录中的槽采用二分查找的方式先找到一个粗略的记录分组，在分组中通过链表遍历的方式进行记录的查找</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg" width="30px"><span>吴小智</span> 👍（15） 💬（1）<div>请问一下老师，这些内容的源头是在哪里呢？想去源头看看</div>2019-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/69/bf/58f70a2a.jpg" width="30px"><span>程序员花卷</span> 👍（4） 💬（1）<div>第一个问题
我认为物理上是连续的（具体原因我现在还说不出来，因为这个问题感觉逻辑连续和物理连续都没有绝对的说法，后面补上）

第二个问题
B+树的检索流程是一个自顶向下，逐层检索的过程！具体的过程老师在24讲以及这一讲中已经说的很明白了！

我得认真思考！老师的问题总是很耐人寻味！
题外话：希望大家都继续坚持学习，学习是一辈子的事，不要渴望一遍两遍就掌握某个东西！很多东西都是在反反复复的学习之中的某个时刻突然领悟的！加油！</div>2019-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/55/fe/e8fb06fb.jpg" width="30px"><span>梁</span> 👍（4） 💬（1）<div>聚集索引是在物理上的顺序和逻辑上的顺序相同</div>2019-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg" width="30px"><span>往事随风，顺其自然</span> 👍（4） 💬（1）<div>逻辑上连续的，记录之间采用单链表方式实现</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg" width="30px"><span>geraltlaush</span> 👍（2） 💬（6）<div>A clustered index, on the other hand, is actually the table. It is an index that enforces the ordering on the rows of the table physically.物理上连续的</div>2019-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/77/74/c1f0aa46.jpg" width="30px"><span>习惯沉淀</span> 👍（2） 💬（1）<div>老师，“在B+树中，每一个节点都是一个页”这句，有点不太理解，非叶子节点不是不存放行记录吗，非叶子节点就是页，只不过页里面不存放数据是这意思吗？</div>2019-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f1/c6/6f39a982.jpg" width="30px"><span>Yuhui</span> 👍（1） 💬（2）<div>请教一下老师，”通过文件尾的校验和（checksum 值）与文件头的校验和做比较“来判断页数据传输是否完整这个是怎么回事？谢谢！</div>2019-09-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/1a/269eb3d6.jpg" width="30px"><span>cfanbo</span> 👍（1） 💬（1）<div>对页里查找记录时，可先根据二分查找法，先找到记录所有在槽，时间复杂度为O(log2n)。槽内有多条记录，再遍历所有记录，直到找到指定记录为止，时间复杂度为O(n)。</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/1a/269eb3d6.jpg" width="30px"><span>cfanbo</span> 👍（1） 💬（1）<div>遍历槽 3 中的所有记录，找到关键字为 9 的记录，取出该条记录的信息即为我们想要查找的内容。由于单链表，所以查询复杂度为O(n)</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（27） 💬（2）<div>关于数据页有几个疑问：
1、分组1为什么只有一条记录？
2、分组之间采用的是二分查找，表示分组1，分组2，...，分组n之间是通过某种顺序进行排列的。假设除了最后一个分组n外，所有的分组都存储满了8条记录，这时新增一条记录x按有序性应该放置在分组2中，是不是分组2，3，分组n-1都需要进行记录的改动？
3、最大最小记录是专门给数据页内二分查找赋值low与high设计的？</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg" width="30px"><span>Monday</span> 👍（18） 💬（3）<div>Mysql如text、MediumText等类型最大存储长度为64k、16M，已经超过了一个页16k，请问包含这几种类型的记录都怎么存储的？</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/46/d0/6bafd7d4.jpg" width="30px"><span>DZ</span> 👍（14） 💬（0）<div>逻辑上连续，物理上未必连续。数据库的最小分配单位是页，连续分配一定数量的物理页构成段。每页存储只够存储有限的记录，记录不断增加，一定会超出页，继而超出段，无法保证物理连续。进一步说，数据库的磁盘分配操作基于操作系统，单个“页”是否一定在物理介质上连续，也不一定。

B+树只有叶节点含有数据指针，总是从根节点开始检索，直到叶节点。如果是范围检索，只需要一次根到叶的检索，然后就能借助叶节点的双向链表结构特性，顺序移动直到找出所有满足范围的数据。</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/da/36/ac0ff6a7.jpg" width="30px"><span>wusiration</span> 👍（10） 💬（2）<div>问题1：聚集索引是在物理上连续，因为聚集索引是指表中数据行按索引的排序方式进行存储，表设置了聚集索引，数据行会按照索引列的值在磁盘上物理存储和排序；（摘抄自23索引的概览）
问题2：先是从B+树的根开始，逐层检索找到相应叶子节点对应的数据页，将数据页加载到内存中，通过页目录中的槽采用二分查找的方式先找到一个粗略的记录分组，在分组中通过链表遍历的方式进行记录的查找</div>2019-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/1b/4d/2cc44d9a.jpg" width="30px"><span>刘忽悠</span> 👍（7） 💬（0）<div>按照聚集索引的话，逻辑上肯定是连续的，物理上就要分情况，如果是在页内，那么根据前面说的，区是一块连续的空间，包含64个页，那么页内的记录也肯定是物理上连续的，而页与页之间是通过文件头的两个指针链接起来的一个双向表，所以物理上不连续；</div>2020-03-28</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6LaITPQ4Lk5fZn8ib1tfsPW8vI9icTuSwAddiajVfibPDiaDvMU2br6ZT7K0LWCKibSQuicT7sIEVmY4K7ibXY0T7UQEiag/132" width="30px"><span>尔东橙</span> 👍（5） 💬（0）<div>我有个问题，B+数每个节点都是一页的话，那非叶子节点不存数据，16k的大小不是比较浪费么</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg" width="30px"><span>book尾汁</span> 👍（2） 💬（0）<div>问题1：行记录是逻辑上连续，因为采用单链表结构，分组里面的记录也是逻辑上的一组，物理上并不一定连续。
问题2：首先会通过B+树的根节点向下查找到叶子节点，再在同过叶子节点里页的表目录二分查找到对应得槽点，在遍历槽里的记录。</div>2020-03-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIR9QrAn9TZOrJMSYMyN96PAuAjETVrN5SPp3hMbfUAGIWtHceWPEoQtPdXeuBn7VB7dagtxynAIA/132" width="30px"><span>ballgod</span> 👍（1） 💬（0）<div>重新再看一下，还有问题：&quot;非叶子节点，包括了多个索引行，每个索引行里存储索引键和指向下一层页面的页面指针&quot;。请问索引行中的索引键和指向下一层页面的页面指针在数据页中具体是记录在哪个位置（是在页记录里面吗？）？以什么样的形式记录？</div>2020-04-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/48/26/93fd21d5.jpg" width="30px"><span>书痕</span> 👍（1） 💬（0）<div>关于问题1，应该只是通过双向链表保证数据在逻辑上与聚集索引顺序一致，物理介质上不一定连续</div>2019-11-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/14/c4/e354d8ba.jpg" width="30px"><span>魏颖琪</span> 👍（1） 💬（1）<div>关于普通索引和唯一索引的效率问题还想请教一下：普通索引不是主键，不是物理索引，叶子节点记录的是行的位置，实际可能分散在多个页中，那就存在多次IO读取，效率会降低，为什么说差不多？</div>2019-08-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（0） 💬（0）<div>逻辑上是连续的，物理上一个数据页之内的行数据也是连续的。跨页的数据行逻辑上连续，物理上应该不一定，可能连续（假如数据页物理上也连续），也可能不联系（假如数据页只是在逻辑上连续，物理上不联系）</div>2024-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/01/40/a203a3b9.jpg" width="30px"><span>爱学习不害怕</span> 👍（0） 💬（0）<div>“InnoDB 存储引擎的页大小为 16KB，在一个页中可能存储着上千个记录”这句话也说明了，如果数据量没有足够大，直接上索引对于提升检索效率没啥帮助，因为还是在这个页面去进行二分查找了。</div>2022-12-05</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKX6QqquojicLSgpgu88MibWkuXfIQcqlgoWReZ97bfygwThIHWqUmJyjGlOhJj1Be3tA1WFkJkSjFw/132" width="30px"><span>Geek_4e68bc</span> 👍（0） 💬（0）<div>老师，请问单个数据页在物理上是连续的吗</div>2022-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/ef/3c657df8.jpg" width="30px"><span>Cary</span> 👍（0） 💬（1）<div>请问页在区里是连续分配的，为什么不用数组替代链表呢？</div>2021-05-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/38/9f/895353ab.jpg" width="30px"><span>黄卫江</span> 👍（0） 💬（0）<div>有个问题：B+树索引的非叶子结点不是不存储实际数据吗，为什么还说每一个结点都是一个页，是不是非叶子结点的页是只有页的结构但行记录是空的。</div>2021-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/3e/af/c3d3c167.jpg" width="30px"><span>心诚泽霖</span> 👍（0） 💬（0）<div>B+树和页结构的对比：上图的根节点表示一个页（Page）？还是叶子节点表示一个页？</div>2021-02-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/93/35/20b249bc.jpg" width="30px"><span>Ming</span> 👍（0） 💬（0）<div>老师您好，看完还是有很多疑问，表和索引创建的时候会创建表段和索引段，那么按照我的理解，表段是存放数据的，索引段是一颗B+树，那这个树的叶子节点存的是数据本身还是指向表段数据的指针？</div>2021-02-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/27/94/b2f5b4ef.jpg" width="30px"><span>zich</span> 👍（0） 💬（0）<div>索引是通过 B+ 树组织的，所以 MYSQL 的记录数据实际上也是通过 B+ 树来组织保存的么</div>2021-01-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/2a/2f/d6ec6940.jpg" width="30px"><span>Qaz</span> 👍（0） 💬（0）<div>精华，这篇不错</div>2020-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/26/54f2c164.jpg" width="30px"><span>靠人品去赢</span> 👍（0） 💬（0）<div>1 行记录逻辑上一点连续，物理不一定，超出范围，系统分配
2 首先是是根到叶找到对应的数据页----数据页加载到内存-----数据页二分查找分组-------分组连了遍历找到数据</div>2020-11-12</li><br/>
</ul>