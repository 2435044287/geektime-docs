你好，我是徐昊。今天我们来继续聊聊弹性边界对业务建模的影响。

上节课我们介绍了弹性边界的概念，以及弹性优先原则。照此来看，我们是不是按照组件不同的弹性要求，将它们分别放置到不同的弹性边界中，就可以最优化地利用云平台的能力了呢？

答案并没有这么简单。因为除了弹性边界外，我们还需要考虑流量的传播，以及在弹性边界间造成的依赖关系。

今天我们就来讲一讲弹性边界间的依赖关系。包括什么样的依赖关系是合理的，有什么样的依赖关系是我们希望避免的，以及不同的弹性依赖关系又会给业务建模带来什么样的影响。

## 弹性边界间的依赖与耦合

就好像软件的模块之间会存在依赖关系一样，弹性边界间也会存在依赖关系。不恰当的软件模块依赖，最终会引发散弹式修改（Shotgun Surgery），也就是软件模块的边界并没能隔离变化的传播。换句话说，在一个模块中出现的变化，会传播到其他模块中，引起其他模块的修改。

**而弹性边界间的依赖（也就是服务间调用关系，或是数据交换关系），会造成流量的传递**。如果上游弹性边界突然需要处理大量的流量，那么这些流量自然也会传递到下游弹性边界中。

让我们举一个生活中的例子，来帮助理解弹性边界间的依赖关系。假设你是一家快餐店的负责人，你雇佣了一个负责点餐的员工。厨房是负责制作餐食的部门，有一套能完成对应操作的设备，以及负责餐食制作的厨师。
<div><strong>精选留言（13）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（8） 💬（2）<div>本章内容
1.异步交互：如果最后践行的结果依旧是使用同步代码的方式写异步代码，那应该没问题。但如果是以异步的方式去写，感觉就有点诺曼设计了。业务建模引入异步设计的复杂性，总觉得不是一个好的形式。我认同云原生下异步交付能发挥更大价值，只是践行的方式还是有待观察。毕竟异步交互在云原生下节省的性能成本，不见得就能盖过业务建模和异步设计的叠加带来的设计成本的增长。
2.谈点实现，瞎猜：弹性伸缩必要重要的价值理应是解决峰值并发场景带来的短时吞吐量述求差异大的问题（毕竟你服务流量很平稳，我靠人工扩容好像也没啥问题）。但感觉能想到的方式都有挺多资源冗余或则说浪费。先说基本思路： （按空闲程度分发）理论上实现弹性扩容，无非就是监控服务资源水位+自动扩&#47;缩容。但实际上，对于高并发场景这个是做不到的，毕竟高并发不讲道理，不会等着监控服务资源的实时情况做分发。服务资源的情况，监控必然有延迟，高并发会借助这个延迟直接干翻你的单个服务造成部分用户不可用；节点的扩容也必然有延迟，而这个延迟，高并发可以让你的集群都不可用。可以想到的应对的解决方案：平均分发，不依赖服务资源监控，均分流量；冷后备，预备大量冷后备节点减缓扩容的时差。但这些，似乎对资源最优分配还是有些距离，只是用冗余保可用而已。

课后题
自治，容错。

自治:  前微服务重心在以业务边界拆分独立的作战单元，讲究的是最小完备&#47;自我履行&#47;稳定空间&#47;独立进化。体现就是软件产品化，数据隔离，迭代自由。
容错：前微服务我们一样接受服务总会出错的现实，所以服务间交互会是以依赖集群+自动隔离故障+自动发现新服务（也就是服务治理）的方式。每个发布单元就像人体的一个细胞，生生死死不断轮回，但都不会影响某个器官（服务）的正常运作。</div>2021-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/9b/ba/7f42f28b.jpg" width="30px"><span>菜菜</span> 👍（1） 💬（1）<div>如果把异步技术引入到模型中，就相当于把事务性引入了业务当中，所以复杂度可能会发生质的变化</div>2021-08-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/77/a5/c5ae871d.jpg" width="30px"><span>zenk</span> 👍（0） 💬（1）<div>“业务天生是异步的。同步是简化”

大佬，怎么理解</div>2021-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/c3/14/5208adb5.jpg" width="30px"><span>极客侠女</span> 👍（0） 💬（1）<div>云带来了哪些运营模式的变化？像例子中，举动极客时间专栏提供了企业版，这个变化跟 云的关系在哪呢？请教老师细细解释下呢</div>2021-09-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/93/32/e11fcd33.jpg" width="30px"><span>Oops!</span> 👍（0） 💬（1）<div>下次去上海我也去这家咖啡店体验一下。言归正传，为了解除弹性耦合，就需要使用异步的方式实现业务流程，将响应时间的依赖转变为对吞吐量的依赖。从一致性这个角度看，就是系统从保证强一致转变为最求最终一致性，通过各种兜底逻辑保证所有中间态都能到达最终最终状态。</div>2021-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f9/e6/47742988.jpg" width="30px"><span>webmin</span> 👍（0） 💬（1）<div> O.P.S. Cafe 这家不足10平方米的顶流大店，咖啡确实不错，排一个小时队是常态，现制咖啡还是受制于咖啡师，咖啡师无法被Clone，水平扩张无从谈起。</div>2021-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/59/73/e0aa8c84.jpg" width="30px"><span>超</span> 👍（0） 💬（2）<div>我有个疑问，关于点餐和厨房的例子的，不管是异步还是同步，厨房的吞吐能力不行，还是没解决顾客耐心耗尽的问题。</div>2021-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/b9/81/1680ec3f.jpg" width="30px"><span>冯</span> 👍（7） 💬（0）<div>事实是，我们的现实世界就是异步的，软件也是越来越向现实世界靠拢。从同步走向异步，从强一致走向最终一致。</div>2021-08-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（0） 💬（0）<div>2024年01月18日09:00:16
异步交互的确会引来很多问题，这些问题属于同步无得，所以人还是喜欢同步，那蛮期待后面如何解决异步交互带来的问题，比如一致性、状态机、整个流程的编排、轮询时间等等</div>2024-01-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/61/2d/65f016bf.jpg" width="30px"><span>常文龙</span> 👍（0） 💬（0）<div>看了几遍本文，也看了asyncapi和netflix zuul2的异步改造，我对文中的“异步”的理解，是采用nio方式发起请求，这节省了线程数，但在使用侧看来，依然是同步的。

然后对 【弹性依赖】 应该秉持 允许 的态度，对 【弹性耦合】 应该通过异步避免。

希望老师点评</div>2022-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/61/2d/65f016bf.jpg" width="30px"><span>常文龙</span> 👍（0） 💬（0）<div>前云时代的架构约束，便是云时代在解决的问题——水平扩展的便利。因为扩展不便利，所以往往会将多个业务上下文都集中在一个应用中，导致应用的体积庞大（不轻量）、单一上下文的流量过大会影响处于同一个应用中的其他上下文的CPU、内存资源。</div>2022-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e7/ba/aceadf0b.jpg" width="30px"><span>RoyLING</span> 👍（0） 💬（0）<div>补作业：
相较于云平台引入的新架构风格，前云平台一样会着眼于业务一致性和事务性问题，这些都会对业务建模提出挑战。
</div>2021-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/66/11/f7408e3e.jpg" width="30px"><span>云师兄</span> 👍（0） 💬（0）<div>我们不仅需要根据弹性优先原则，来划分弹性边界，还需要保证弹性边界间具有恰当的依赖关系，避免出现弹性耦合。👍</div>2021-08-01</li><br/>
</ul>