你好，我是徐昊。今天我们来聊聊领域驱动设计中的提练知识的循环。

在[上一讲](https://time.geekbang.org/column/article/387945)，我们介绍了什么是统一语言，讲了它为什么是领域驱动设计的必要实践，以及为什么统一语言提供了一种更好的协同方式的可能性。

在回答这些问题的过程中，我们强调了统一语言和它背后的领域模型，赋予了研发人员通过重构定义业务的能力。这是从技术方的角度来理解的统一语言。那么**从业务方的角度来看，要如何利用统一语言去影响研发方呢**？

那就要谈到“两关联一循环”里的“一循环”了：提炼知识的循环。它是**领域驱动设计的核心流程**。

## 将提炼知识的循环看作开发流程

上节课已经说过，提炼知识的循环大致是这样一个流程：

- 首先，通过统一语言讨论需求；
- 而后，发现模型中的缺失或者不恰当的概念，然后精炼模型，以反映业务的实际情况；
- 接着，对模型的修改会引发统一语言的改变，再以试验和头脑风暴的态度，使用新的语言以验证模型的准确。

如此循环往复，不断完善模型与统一语言。示意图如下：

![](https://static001.geekbang.org/resource/image/59/82/5905cbfea08dd11e6e2929a215a62c82.jpg?wh=7275x3974)

如果我们仔细思考一下上面的场景，会发现当模型中出现不恰当的概念时，提炼知识的循环就和**重构**（Refactoring）的过程有诸多相似之处：

1. 发现坏味道（Bad Smells）以明确改进方向：头脑风暴与试验，通过统一语言描述需求，发现模型中存在不恰当不准确的概念；
2. 尝试消除坏味道以改进目前状况：修改模型，提炼知识到模型中；
3. 通过坏味道是否消失判断改进是否成功：提取统一语言，头脑风暴与试验，验证新的模型是否准确。
<div><strong>精选留言（23）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/28/cb/c5/c1d7ca5e.jpg" width="30px"><span>赵晏龙</span> 👍（10） 💬（1）<div>上一课我的回答基本都在这一课中得到了验证，看来我的理解和主流观点应该没有太大偏差，老师总结得还是更到位！

在大约9年多的学习和实践中（旧约实践，非常期待你的新约课程），我遇到的最大的问题应该是模型变更前后数据迁移成本较高，必须是人工迁移，并且生产环境无缝迁移基本不可能。

另外我自己做甲方的时候，模型都给他分析出来了，乙方不愿意配合实现模型（都告诉他其实我是在为他节约开发成本）。倒是做乙方的时候，甲方一般都还是比较能够接受这种方式。

再有，建模真的很依赖于建模人员的抽象能力。你无法交给能力一般的开发人员去做。这种人才太少了，人才稀缺算是DDD的缺点么^_^</div>2021-07-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg" width="30px"><span>Jxin</span> 👍（20） 💬（5）<div>关于内容：
只谈责权行动是难以维持的。责权利心法，责任权利利益必须匹配。
关不关心生产实现，对于业务方是一场无悬念的博弈。
关心了，成效很模糊，但累和困难很明确。因为我除了自己的业务还要学习开发定义的业务概念（学习&#47;沟通成本），同时描述业务故事也得基于这些概念来沟通（约束），搞错了我还有责任。而好处也许能大大加快我后续功能的迭代，甚至像发现宝藏一样洞察新的方向，但是这些感觉很遥远，所以我对它估值很模糊；
不关心，风险模糊，轻松无责明确。因为我只需要关注自己的业务，对于开发只需要提出我要什么，如果有问题也是开发的实现不符合或者达不到我的期望，这样工作就很单纯和轻松，便于专注业务做出更好的成绩。而风险就是软件质量差，后续迭代缓慢甚至改不动，越往后线上bug概率越高，这些就有点远了，所以它很模糊，毕竟我也不知道明天是不是还是我负责这块业务，为它付出成本贴现率很低。

如上，如果无法洞察业务方的利益点，并以利牵头，这样的博弈基本没有悬念。怎么办？
1.放大风险，强调系统异常带来的危害。幸幸苦苦干一年，一朝资损全年白干。
2.拉近价值，如果按这个方式配合，我们就给你开通排期绿色通道。
3.领导支持，拉领导拍案，并非以势压人，而是为他人搭建发挥的舞台。

课后题：
关联模型与软件实现我说两个难点：
1.代码模型透出。
2.模型变更与代码变更必须保证原子性。

YY处理：
1.代码模型透出：
（1）提供接口依赖树查看能力（可以看出部分关联关系）
（2）提供代码映射模型的能力。设置定义模型的注解，然后用注解标注代码，启动时基于注解生成对应的模型文档。
2.模型变更与代码变更必须保证原子性
（1）在CICD流水线创建实例时要求而外关联一个模型变更需求，必须由项目负责人CR模型文档确实同步了当前变更才能执行流水线。（在流程制度上加环节，且责任到人）
（2）最理想的状态，代码既模型，模型既代码。web界面实施模型会直接生成代码，改动对应代码会直接反应到web界面的模型上。模型与代码自动联动。</div>2021-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/93/32/e11fcd33.jpg" width="30px"><span>Oops!</span> 👍（1） 💬（3）<div>看到关于权责的论述的部分时脑海里浮现出一个疑问，就和让业务和技术双方都接受这个权责分配？很多时候，业务方只关心结果，其实没有意愿“享受”“影响软件实现”的权利，因此，就没有意愿承担相应的义务。本课后半程也提出了这样的问题，“如何推动业务方更主动地参与提炼知识的循环？” 。万事开头难，这个可能是架构师在推动DDD落地过程中首先可能所遇到的坎——如何有效的启动知识消化的循环？这块可能和DDD的核心关系不大，不过也希望老师能分享一下一些经验😀。</div>2021-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f9/e6/47742988.jpg" width="30px"><span>webmin</span> 👍（19） 💬（1）<div>某知识服务商有一道考验新人试题，请说说怎么解读《新华字典》。

如果采用总结提炼划重点方法，你说它的重点在哪儿？哪个字重要，哪个字不重要？它的结构是完全平铺的，没有重点。

但是从问题出发，看看一部字典为我们解决了什么问题，那角度就比较多了。

个人的一点浅见要从业务想要解决的实际问题出发来找出包含在其中的知识，感觉领域和问题是一体的两面。</div>2021-07-02</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/cK4aAENG9h42KqeibyVNTeSUichzhv6zH1nA6iah4u6USqITMDA6qzuiaKY3of68tROwSzuRIsPpLnqgVW8ClMRH2Q/132" width="30px"><span>Geek_39bdd5</span> 👍（3） 💬（1）<div>领域驱动设计，理解就是为了将具体的业务场景以及开发所要实现的代码结构，通过‘说人话’的方式进行呈现。如何‘说人话’（领域驱动设计），应该就是：
1、将业务场景通过‘完全穷举、相互独立’的方式列举出来；
2、将列举出的场景通过抽象的方式，将实体之间的关系进行展示；
输出第1、2点的内容后，不断与业务、技术一起进行探讨，保证正确且无遗漏，
最终得出的，就是我们的‘模型’。
不知道理解的是否对，请老师指教！</div>2021-10-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4d/d3/67bdcca9.jpg" width="30px"><span>林铭铭</span> 👍（2） 💬（1）<div>看完这一讲，突然想起来之前做金融类系统，需求文档开头会把涉及的概念和术语定义出来，我觉得这个应该算是最初版本的统一语言。</div>2021-07-21</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5uDOruARAmFN4JKicicYvVge5yMoA5dd1rvpJeuEISwkfkSr75GQNArYHHudmeXic6iafeuB9f4MV9w/132" width="30px"><span>Geek_ea8a4f</span> 👍（1） 💬（1）<div>怎么把实体合理分成多个聚合。判断实体属于一个聚合的标准是什么</div>2021-07-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7d/e3/ad6a4758.jpg" width="30px"><span>Todd  BD</span> 👍（1） 💬（2）<div>请教一下老师 Ubiquitous language 和 Domain Specific Language 有什么区别和联系？</div>2021-07-06</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIibashTHtGDWH5L0NlbuOrA6ZuI4uc1HkMD0hbIt8iaoH8hFf3jpb8jjhsvrRLTIazZP3YoR5WpMpg/132" width="30px"><span>箭和方糖</span> 👍（1） 💬（3）<div>回答思考题，模型本身是与技术无关的，但软件实现是受限于技术选型的，因此有可能出现模型不能很好的用所选技术直接实现，或技术本身的最佳实践会给模型引入一些新的概念，进而丰富统一语言，如观察者，访问者等等可能业务方需要适应的概念。

解决方法，我觉得还是权衡吧，如果技术对模型的反馈是大家都能够理解并接受的，未尝不可；但如果模型无法直接实现，可以选用技术工具弥补不足，也许也可以使用。比如模型直接实现有性能问题，可以使用cache layer解决性能问题，从而保证模型的简洁和高效</div>2021-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8e/bb/c039dc11.jpg" width="30px"><span>garlic</span> 👍（1） 💬（1）<div>可能的困难：业务能力差，技术人员不懂业务。业务方能力差，可以请一些业务专家来支持；技术人员不了解业务，组织一些专题培训，多向业务人员请教，不一定所有技术人员都要很懂业务，但是核心技术人员一定要懂，否则大概率会出问题。我是做外包项目的，基本是二次开发，业务功能通过现有的系统或多个系统组合实现，项目中感觉不到模型的存在，我们的项目更依赖人员经验将业务需求转化为代码实现。我这个土豹子搬着小板凳来学习下(ﾉಥ益ಥ)</div>2021-06-29</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erD8CwHKGGIia1HwRBxy5GxMLTfGGzOeLjrmZ6ich9Ng7bbPia89iaSibbldnV4uiaKNXFcO2vQ3ztibCrDw/132" width="30px"><span>Williamleelol</span> 👍（0） 💬（1）<div>课后题观点：
实现时会遇到各种细节的问题。领域模型是偏整体上的设计，但是模型中不同领域会存在交互。所以最终存在多种思考角度。
可能会因为减少交互而破坏了领域的概念。
可能最终为了便于做展示层逻辑而牺牲领域的边界。
总的来说软件+工程之后就会变的很难控制。

如何解决？可能需要工程师素质，团队文化等等很多方面共同来提升。</div>2021-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3d/2a/16357640.jpg" width="30px"><span>黄土高坡</span> 👍（1） 💬（0）<div>我有三个问题：
1. 技术人员对模型的修改应该遵循怎样的流程或约束？谁都可以修改，总归是有问题的
2. 业务人员需要看懂模型图吗？
3. 采用哪种建模语言，如何多人协作绘制、如何持续有效地管理越来越多的模型图</div>2021-09-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（0） 💬（0）<div>2023年12月15日08:58:59
看到这一节的感受：产研团队落地 DDD&#47;知识消化的难度太大太大了</div>2023-12-15</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/kFuWg0sRPIT94SGU5Ciaic1LXlHpMkAf4vC0GlCURVFZczUnL0sMhf3TBombsTxReicxl7VhafI5uHyoShUpwoHOg/132" width="30px"><span>Geek_有心</span> 👍（0） 💬（0）<div>模型与软件实现的关联:修改模型就是修改软件实现 修改软件实现就是修改模型</div>2023-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg" width="30px"><span>看不到de颜色</span> 👍（0） 💬（0）<div>感觉在关键模型与软件实现上，比较难的点在于模型不一定能很好的解决一个技术难点。有时模型看似是完美的，但是并不一定能很好的解决了问题。可能还需要基于技术解决手段反向调整模型。</div>2022-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ed/84/0b8e2d25.jpg" width="30px"><span>邓志国</span> 👍（0） 💬（0）<div>关联模型与软件实现上主要困难是：1、不会OO编程 2、不会重构&amp;不敢重构</div>2022-05-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2c/6c/ad/8ea2e93e.jpg" width="30px"><span>晴天</span> 👍（0） 💬（0）<div>个人理解，领域模型建模其实是一门管理学。
比较重要的一点是门槛，因为两关联其实代表着业务和技术的不同领域，既然是两个领域自然有各自的认知和理解，如何使之合作已达成共赢是值得思考的，不能指望厨子和痞子合作，除非有契机，当然业务和技术也并非差距太大，这里需要有折中办法让两者先关联，后循环，循环就相对容易的多了。</div>2022-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/ec/93/d77a303a.jpg" width="30px"><span>孙腾蛟</span> 👍（0） 💬（0）<div>DDD的目标是解决业务和开发的沟通效率问题。
统一语言是某个业务领域专有名词定义，统一语言是业务和开发沟通的基础，可以提高沟通效率。
模型是业务和开发人员使用统一语言讨论后达成的共识。
模型的作用有两个：第一个是业务知识的提炼；第二个是快速验证，根据大家的讨论形成模型后可以验证大家的理解是否一致。

统一语言和模型是相辅相成的关系，使用统一语言讨论后制作和完善模型，形成模型后也可以从中提取新的统一语言。

统一语言为什么要在完善模型后再提取？因为模型形成后代表大家的理解是一致的，定义是稳定的</div>2022-01-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/22/e0/6295a753.jpg" width="30px"><span>Harvey</span> 👍（0） 💬（0）<div>应该叫“限界上下文”吧</div>2021-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/b3/40/54894c8f.jpg" width="30px"><span>Geek_fe0336</span> 👍（0） 💬（0）<div>聚合根是不是就是一对多中的那个多啊？</div>2021-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/63/a4/e663c4d4.jpg" width="30px"><span>果然爸爸</span> 👍（0） 💬（0）<div>我有个问题，统一语言以什么方式记载下来？</div>2021-11-17</li><br/><li><img src="" width="30px"><span>Geek_460f43</span> 👍（0） 💬（0）<div>在模型演进中，导致对应实现的数据结构发生变更时，在线上环境完成历史数据的无缝迁移，成本高昂，开发团队通常为了保证业务进度，放弃对模型的升级</div>2021-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/ab/e8/16d7c8ee.jpg" width="30px"><span>花花</span> 👍（0） 💬（0）<div>
回顾及新知:
这节课的上半部分又让我对上两节课进行了回顾，对【模型-&gt;统一语言-&gt;需求】的循环又有了一番新的收获。
1.从模型中提取出统一语言，由于模型是确定的所以统一语言完全描述了模型及实现的现有功能(前置:模型与实现一致)，
2.从统一语言中去寻找模型中没有描述的逻辑或功能并确认是真正的需求
3.从该需求中提取出确定的”知识“补充到模型中。
三者循环代表的含义比我之前理解的更加全面与深刻，猜想过段时间重新回顾还会有新的收获。

经过对思考题的不断追问让我对于【模型与实现相关连】有了一些新的理解。
模型提供的是抽象的逻辑或算法(逻辑中的判定与条件等，而不是具体的算法)，是作为“具体实现”的指导原则而存在的,
只要能保证具体实现依赖于模型给出的抽象逻辑就能保证实现与模型相一致。

而对于思考题中的问题个人感觉可能出现的一个困难和障碍就是开发人员能够相信模型能够指导开发实现，
在开发时以模型指导技术的实现且时时刻刻注意不偏离模型的主线，毕竟开发人员有一种偏执就是相信自己的技术并喜欢按照自己的想法去完善与美化。
</div>2021-09-03</li><br/>
</ul>