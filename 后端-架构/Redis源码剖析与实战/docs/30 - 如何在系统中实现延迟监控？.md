你好，我是蒋德钧。

我们知道，Redis的一个显著特征就是**能提供低延迟的数据访问**。而如果Redis在运行过程中变慢了，我们就需要有方法能监控到哪些命令执行变慢了。更进一步的需求，就是我们需要有方法监控到，是Redis运行过程中的哪些事件导致Redis变慢了。这样一来，我们就既可以检查这些慢命令，分析它们的操作类型和访问的数据量，进而提出应对方法，也可以检查监控记录的事件，分析事件发生的原因并提出应对方法。

那么，为了满足这些需求，我们就需要有一套监控框架，一方面能监测导致Redis变慢的事件，另一方面，能监控并记录变慢的命令。其实，这也是我们在开发后端系统时，经常会面临的一个运维开发需求，也就是**如何监控后端系统的运行状态**。

今天这节课，我就来带你了解Redis的延迟监控框架和慢命令日志的设计与实现。掌握今天的课程内容后，一方面，你可以把这套监控框架应用到实际的业务，而另一方面，你也可以参考Redis的实现，给自己的系统增加延迟监控功能。

下面，我们就先来看下Redis实现的延迟监控框架。

## 延迟监控框架的实现

实际上，Redis在运行过程中，以下表格中给出的几类事件都会导致Redis变慢，我们通常也把这些事件称为**延迟事件**。你可以参考表格中的这些事件类型，以及它们在源码中对应的事件名称。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/e4/2d/acaca6b9.jpg" width="30px"><span>斩弦</span> 👍（1） 💬（0）<div>蒋老师好，今天很巧正好在思考延时的问题，同时看到了更新了这节课，
我的问题(1).&#47;redis-cli --intrinsic-latency xxx这个命令能够看到内核本身的延时，因为我们的redis环境是部署在虚拟化环境的，时不时会有延时增大的现象发生，也有过发生问题后排查到集中发生在某个虚机所在的宿主机上，问题处理就是将这个虚机迁移到了其他的宿主机上，那么能否围绕.&#47;redis-cli --intrinsic-latency这个命令，我们可以自行开发一个逻辑，每10s或者15s采样一次，然后作为CPU内核延时的指标值，放到我们的监控逻辑中，这个耗时可以作为问题出现时的一个参考，作为问题出现时的一个重要的延时的成分；
另外还有一个问题(2)latency monitor这个功能对系统的性能影响是否明显呢，其实看到了这个功能后，有想要尝试使用这个功能以扩展延时问题排查时的手段</div>2021-10-19</li><br/>
</ul>