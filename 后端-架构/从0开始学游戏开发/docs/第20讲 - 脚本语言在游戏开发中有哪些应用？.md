上一次，我们谈到了如何在游戏中嵌入脚本语言，我们用的语言是Lua。Lua语言具有轻量级、速度快的特点，而且API的调用也非常方便和直观。现在，我们仍然拿Lua脚本，试着把它应用在我们开发的游戏中。

我们使用C语言来对Lua脚本的绑定做一次深入的剖析，然后来看一下，在游戏开发中绑定了脚本语言后，脚本语言能做些什么事情。

首先，我们要明白一点，事实上**任何模块都可以使用脚本语言编写**。当然在游戏开发的过程中，需要分工明确，如果不分工的话，效率可能会比较低。

在需要某些效率要求非常高的情况下，一般是用C、C++或ASM语言，将底层模块搭建好，然后将一些逻辑部分分出来，给脚本语言处理。比如我们熟知的服务器端，可以使用C/C++来编写服务器端的IOCP或者epoll处理；而接收、发送、逻辑处理等等，都可以使用绑定脚本的方式编写。

我们在编写的过程中，需要对C/C++的语言和代码有个了解，我们需要先考虑这个函数。

```
int test_func(lua_State *L)    
{    
     return 0;    
}
```

这只是一个空的C函数，在这个函数里面，我们看到它的传入参数是lua\_State，接受一个指针L。随后，这个函数返回一个0。

lua\_State是Lua虚拟机的对象指针，也就是我们需要把前面new出来的一个虚拟机传进去，才可以保证在这个函数里面，使用的是一致的虚拟机。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg" width="30px"><span>云学</span> 👍（2） 💬（0）<div>test_fun里的dosomething是在调用lua脚本中的函数吗？p1 .p2是入参？</div>2018-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/f6/a6/19ff9596.jpg" width="30px"><span>猫少</span> 👍（1） 💬（2）<div>想提一个问题，请问老师，这一篇的结构体和宏，极其调用代码都是直接写lua里吗，还是得用c语言写</div>2019-09-18</li><br/>
</ul>