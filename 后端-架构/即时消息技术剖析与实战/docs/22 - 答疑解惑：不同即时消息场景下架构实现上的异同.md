你好，我是袁武林。

随着专栏最后一个进阶篇模块的更新后，咱们的即时消息专栏课程，到这里就要告一段落了。首先，感谢你在这段时间里对专栏的持续关注，也非常高兴看到你一直在积极地思考和学习。

在专栏的讨论区，同学们也都十分活跃，都在热情地留言和互动讨论，留下了很多比较典型和有意义的问题。

有一些问题可能限于篇幅的原因，我没有详细展开，那么今天，我就摘录出比较有代表性的5个问题，来做一下集中的整理和回复。也希望通过这种方式，能够帮助你对这些知识点有更清晰的理解和认识。

## 第一问：消息的服务端存储和本地存储

在[第1讲“架构与特性：一个完整的IM系统是怎样的？”](https://time.geekbang.org/column/article/127872)中，有很多同学都问到了这个问题：**即时消息系统实现中，消息一定需要在服务端的存储服务里进行存储吗？**

首先呢，关于服务端存储的问题，我们需要更多地考虑存储成本和数据安全。

一方面，如果消息不在服务端存储，服务器只是作为消息的中转路由服务，那么，相应的消息存储成本就会低很多，在数据安全性方面也更好一些。

另外，这个问题也和产品定位有关。

比如，如果你的产品定位上不需要支持消息多终端同步（比如微信），那么像核心的消息等这些数据，就可以不在服务端进行存储。不过，用户的好友关系等数据信息还是需要存储在服务端的。
<div><strong>精选留言（6）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（9） 💬（1）<div>老师我有一个问题，这个用户--&gt; 连接的映射是如何存储在中央资源里的，对于像 java 这样的语言，其实这个所谓的连接其实是一个 java 对象，对于更底层的实现，这个连接其实就是一个表示文件描述符的数字而已，而这个数字不同的网关机肯定会重复的，所以我想问一下，这个用户到连接的映射到到底是怎么存储在中央资源里的。对象或者一个可能会重复的数字，存储起来也没有意义吧。是不是用户到连接的映射实际上只存储在网关机的内存里，中央资源里存储的只是某个用户在哪个网关机的映射，找到网关机后直接发消息给那台网关机，由那台网关机在自己的内存中查找到用户到连接的映射，然后发送消息？</div>2019-10-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg" width="30px"><span>小可</span> 👍（3） 💬（1）<div>直播房间和群聊消息扇出这个问题特别好，两者确实有区别，老师的解答也很清楚😁</div>2019-10-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/de/c3/e0a4c93f.jpg" width="30px"><span>mong</span> 👍（2） 💬（1）<div>老师你好，有一个问题，想和你交流一下，关于离线群消息的存储的问题，我想问一下，离线的群消息你们是为群里的每个人都存储他的离线消息，还是消息只是存储一份；，如果选择存储一份（大家进行共用），你是如何他们在拉离线消息的时候，进行标记哪个用户拉取到群的离线消息的哪一条了？</div>2019-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/30/61/50e24e09.jpg" width="30px"><span>煜</span> 👍（0） 💬（1）<div>老师，websocket网关和im服务能否用dubbo通信？或者老师对他们之间的rpc通信有什么好的建议</div>2019-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/47/d2/024e8f0a.jpg" width="30px"><span>忘</span> 👍（0） 💬（1）<div>谢谢老师，以后有问题了，还可以和你讨论吗？</div>2019-10-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epherEfVrWjewxg5WZkMbXr1vOlSia2njaqM9Ort0vr2TfozSOSGrIclapjo5aOEzASpDU0sEREn6w/132" width="30px"><span>最初的爱恋</span> 👍（0） 💬（0）<div>老师 我有个问题 我想问一下  我最近在做自营客服系统研发 我现在打通两个端 可以进行聊天  那么他们的聊天数据 应该是存缓存还是数据库了? 还有回撤操作 回撤操作我之前的想法是做假删除  然后通知另外一端 对关键字回复  针对种 我的想法 用户发送消息 拿到字体去匹配关键字吗 如果有则直接回复?</div>2022-11-09</li><br/>
</ul>