我们知道，Hadoop主要是由三部分组成，除了前面我讲过的分布式文件系统HDFS、分布式计算框架MapReduce，还有一个是分布式集群资源调度框架Yarn。但是Yarn并不是随Hadoop的推出一开始就有的，Yarn作为分布式集群的资源调度框架，它的出现伴随着Hadoop的发展，使Hadoop从一个单一的大数据计算引擎，成为一个集存储、计算、资源管理为一体的完整大数据平台，进而发展出自己的生态体系，成为大数据的代名词。

所以在我们开始聊Yarn的实现原理前，有必要看看Yarn发展的过程，这对你理解Yarn的原理以及为什么被称为资源调度框架很有帮助。

先回忆一下我们学习的MapReduce的架构，在MapReduce应用程序的启动过程中，最重要的就是要把MapReduce程序分发到大数据集群的服务器上，在Hadoop 1中，这个过程主要是通过TaskTracker和JobTracker通信来完成。

这个方案有什么缺点吗？

这种架构方案的主要缺点是，**服务器集群资源调度管理和MapReduce执行过程耦合在一起，如果想在当前集群中运行其他计算任务，比如Spark或者Storm，就无法统一使用集群中的资源了**。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg" width="30px"><span>落叶飞逝的恋</span> 👍（90） 💬（1）<div>实际项目开发中，要做到依赖倒置的方法，一般就是抽象出相应的接口的方法，不依赖具体。面向接口编程。</div>2018-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg" width="30px"><span>hua168</span> 👍（29） 💬（1）<div>看完几期感觉没有什么能难得住大神你的，回答问题在您那里感觉都很简单……我一般学习是先找视频看一下，照着截图，练习，然后去官网看一下说明文档，看更新了哪些知识。照视频学习又要截图，感觉很慢，很费时，看官方文档又很难深入，能否请教一下自学如果能深入，是我方法不对吗？有很多问题官网都没答案的啊，google不少也搜索不出来……运维类学的东西很多，精通感觉比较难……把原理东西，理解好，慢慢锻炼能不能达到您一半的水平呢？😂</div>2018-11-17</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKPBiaSZVibZwoUEUcvbF4JCfOghmvPdUfbFHeDd2g5m6NbuzeN3S3b7KxZCA8FmtrH9N51Z5P177iaA/132" width="30px"><span>小千</span> 👍（25） 💬（2）<div>sql语言是不是也是依赖倒转原则？不同的数据库都要支持sql语言规范，（很多）sql语句语句都可以在不同的数据库执行。</div>2018-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ba/f9/351e4fc0.jpg" width="30px"><span>生活在别处</span> 👍（23） 💬（1）<div>老师，资源调度和计算调度的区别是什么？</div>2019-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4f/b2/1e8b5616.jpg" width="30px"><span>老男孩</span> 👍（22） 💬（1）<div>突然明白了，这么多年都是错误的观点。我之前的所谓分层展现层，服务层，持久层其实都是上层依赖下层的抽象，不是依赖倒置。</div>2018-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/40/10/b6bf3c3c.jpg" width="30px"><span>纯洁的憎恶</span> 👍（17） 💬（1）<div>MapReduce框架遵循把程序发送到数据存储位置运行的原则。而资源调度框架的任务是动态调配计算资源（内存+cpu），那么就很有可能出现本地数据需要发送到其他节点计算的情况，于是就会有网络传输大量数据的现象，这是否与程序在数据存储节点运行的初衷相悖呢？我这么理解对么？</div>2018-11-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/48/67/128eda8f.jpg" width="30px"><span>席席</span> 👍（16） 💬（1）<div>李老师。框架：指的是能兼容一类底层问题的技术，这么理解可以嘛？Spring 的依赖注入指的是框架嘛？</div>2020-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/00/f4/cc5f0896.jpg" width="30px"><span>Jowin</span> 👍（10） 💬（2）<div>请教老师，关于mapreduce和yarn的结合，是不是mapreduce ApplicationMaster 向资源管理器申请计算资源时可以指定目标节点（数据分片所在节点），而如果系统资源能够满足，就会把mapreduce计算任务分发到指定的服务器上。如果资源不允许，比如目标节点非常繁忙，这时部分mapreduce计算任务可能会分配另外的服务器（数据分片不在本地）？也就是说，yarn对资源调度是尽力而为，不保值一定满足ApplicationMaster的要求，这个理解正确么？</div>2018-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a8/e2/f8e51df2.jpg" width="30px"><span>Li Shunduo</span> 👍（10） 💬（1）<div>请问Yarn里的容器和docker这一类容器有什么关系吗？</div>2018-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e1/9e/109f6105.jpg" width="30px"><span>涤生</span> 👍（8） 💬（1）<div>有没有可能存在一种情况就是，在分布式集群中，DataNode存了10G的数据，但是该节点服务器计算资源很少了（假设系统中已经有其他大数据应用在跑），其他DataNode也是存了10G数据，但是其他阶段计算资源都很充足，那最后是不是就导致了整个reduce操作都要等当前的map操作结束了才能执行，大大降低了整个程序的计算效率。</div>2019-11-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg" width="30px"><span>李二木</span> 👍（7） 💬（1）<div>强烈建议老师加餐一篇你对架构设计理解的文章。^^</div>2018-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/6f/ea/44d60d01.jpg" width="30px"><span>蜡笔小新</span> 👍（6） 💬（1）<div>老师请教一下，MapReduce ApplicationMaster怎么计算出需要多少资源的呢？</div>2018-11-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d7/d5/b9e3332e.jpg" width="30px"><span>星凡</span> 👍（5） 💬（1）<div>您好，请问一下，Yarn的工作流程中（以MapReduce为例）只会向ResourceManager申请两次容器资源吗，一次用来运行ApplicationMaster，一次用来运行MapReduce程序</div>2019-10-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg" width="30px"><span>hunterlodge</span> 👍（5） 💬（1）<div>老师前面说&quot;每个应用程序启动后都会先启动自己的 ApplicationMaster&quot;，后面具体mapReduce例子里又是先启动ApplicationMaster的，这不矛盾吗？</div>2018-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/72/f0/abb7bfe3.jpg" width="30px"><span>Mcnulty</span> 👍（4） 💬（1）<div>前文中写道
3.JobTacker 根据作业调度策略创建 JobInProcess 树，每个作业都会有一个自己的 JobInProcess 树。
6. 如果 TaskTracker 有空闲的计算资源（有空闲 CPU 核心），JobTracker 就会给它分配任务。
可以理解为jobtracker 在服务器A上，负责整个job的调度，包括subjob的生成与分发。tasktracker在服务器B C D上，负责subjob的执行mapreduce。

本文中写道:
这种架构方案的主要缺点是，服务器集群资源调度管理和 MapReduce 执行过程耦合在一起，如果想在当前集群中运行其他计算任务，比如 Spark 或者 Storm，就无法统一使用集群中的资源了。
这里说的 服务器集群资源调度与mapreduce执行过程耦合，在前文中具体是怎么体现的呢？不太理解</div>2018-11-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/cc/f3/5e4b0315.jpg" width="30px"><span>追梦小乐</span> 👍（4） 💬（1）<div>老师，我有俩个问题不是很理解:
1、为什么会有其它nodeManger（NM）的容器指到另外一个nodeManger上面的applicationMaster（am）上，am去nodeManger（NM）上面申请资源，申请的资源不是在am所在的NM上使用的吗

2、提交应用程序的时候，提交程序我知道可以通过脚本分发上去，那提交的mapreduce applicationMaster  和 启动命令是怎么表现的?</div>2018-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/a3/68/e913d823.jpg" width="30px"><span>*其</span> 👍（3） 💬（1）<div>有了Yarn之后,MapReduce似乎就只是一个编程模型了，资源调度交给了RM，计算任务调度交给了AM</div>2021-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/e6/9a/d0725a24.jpg" width="30px"><span>Athena</span> 👍（3） 💬（1）<div>为什么 ResourceManager 会分配两个 ApplicationMaster在容器上？ 我所了解的资料是只会分配一个ApplicationMaster</div>2019-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg" width="30px"><span>饭粒</span> 👍（2） 💬（1）<div>请教下老师，文中提到 ApplicationMaster 需要运行在容器里面，Map Reduce 程序也是在容器内，这两种程序是在单独分开的容器内吗，我看图示好像是这样的。那这样是 ResourceManager 分配创建 ApplicationMaster 运行的容器，ApplicationMaster 再申请创建 Map Reduce 程序运行的容器。这理解对吗？</div>2020-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a0/8e/6e4c7509.jpg" width="30px"><span>一</span> 👍（2） 💬（1）<div>老师好，我想问一下yarn所管理的“资源”具体是指哪些呢？</div>2019-05-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/28/4f/71/18300cab.jpg" width="30px"><span>赛博泰格</span> 👍（1） 💬（1）<div>请假一下，Yarn是怎么解决hadoop架构单点故障的呢？如果Resource Manager故障了，那整个大数据系统不就瘫痪了吗？谢谢！</div>2021-07-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d5/f3/56d484db.jpg" width="30px"><span>风灵子</span> 👍（1） 💬（1）<div>老师，想请问下，学习大数据有什么推荐的书籍吗？</div>2021-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/e3/d7/d7b3505f.jpg" width="30px"><span>官</span> 👍（1） 💬（1）<div>感觉依赖倒转是不是就是高底层框架，通过遵循已经的技术规范（比如J2EE，MapReduce），达到不相互依赖的目的，这样可以保证高内聚低耦合，使得无论是底层框架还是高层框架进行变动都不会影响对方。</div>2020-07-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/1d/71/4d3d2a62.jpg" width="30px"><span>猪哥灰</span> 👍（1） 💬（1）<div>我理解下来是不是所谓的“高层”和“底层”是这样定义的，站在用户调用的角度，越“外层”的其实是“底层”，而越“内层”的是“高层”，因为根据方法栈的调用原理，离用户越是近，越是外层越是后调用，越是内层的先调用，因此，真正内层的也就是“先定义好的”代码即所谓的“高层”，不应该依赖于“后定义好的代码”即所谓的“底层”，在我的实际工作中，“高层”类应定义为泛型类，方法的参数应为接口类型，而具体的实现应由调用他的“底层”代码来决定。从而实现“依赖倒置”的原则。</div>2019-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/a4/bb/dc8e1d69.jpg" width="30px"><span>tom</span> 👍（1） 💬（1）<div>依赖倒转原则还是不太清楚，service层抽象通用的crud操作，在crud方法中调用基类dao的方法，这个符合依赖倒转原则吗？</div>2019-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/03/a2/ceb37046.jpg" width="30px"><span>crazyone</span> 👍（1） 💬（1）<div>我记得docker是用cgroup来对资源进行隔离的，不知道yarn是用什么方式来实现对资源的分割的？</div>2018-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg" width="30px"><span>小老鼠</span> 👍（1） 💬（2）<div>搭一个大数据学习环境最多需要几台机器</div>2018-12-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7e/8b/3cc461b3.jpg" width="30px"><span>宋晓明</span> 👍（1） 💬（1）<div>老师，后续课程中是否讲解spark相关技术跟案例？</div>2018-11-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3e/78/0654bcc1.jpg" width="30px"><span>Wy 🐠</span> 👍（1） 💬（2）<div>使用yarn后，mapreduce的运行过程是怎样的？在08课的时候我们看到一个application作业提交后创建job process，job process又会进一步生成多个task process，这些操作是都被yarn来执行了吗？对于applicationmaster来说，分配到的容器里面运行的是task吗？</div>2018-11-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg" width="30px"><span>piboye</span> 👍（0） 💬（1）<div>jobtrack拆出来了，分资源和job单独管理，job也不会卡死在单个的jobtrack上。集群规模可以上一个量级。资源管理器做主备容灾也更容易</div>2022-01-12</li><br/>
</ul>