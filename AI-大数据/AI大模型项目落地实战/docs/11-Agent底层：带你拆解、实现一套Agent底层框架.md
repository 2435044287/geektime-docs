你好，我是金伟。

经过上节课，我想你已经对Agent智能体的应用开发有了一定的了解。你有没有想过Coze这样的平台底层是如何实现的呢？

我把上节课的话茬留在了我们选择自研了一套营销Agent平台底层，那这节课，我就带你完全实现一遍Agent平台底层框架，对你了解完整的Agent平台架构非常有帮助。

我们先说最核心的第一部分，底层开发。

## 底层开发

先回顾一下我们上节课说的Agent和大型模型之间的代理关系。这个代理层构成了系统的核心部分。我们应该将这一万个Agent视为一个统一的Agent实体。这个统一的Agent可以通过提示词进行重新定义。本质上，它就是一个基于大型模型的聊天应用程序。

关键在于，我们需要一种机制，将我们的业务执行逻辑嵌入到聊天的过程中。

![图片](https://static001.geekbang.org/resource/image/28/b9/28417228f762c8c0652a105f70b9d9b9.png?wh=1920x1047)

有的人可能会想，让大模型直接调用我们的业务逻辑不就行了吗？从广义上来说，这样实现也没问题，只不过我们这里说的大模型指的是只有文本聊天能力的大模型。所以还需要一个“助理”角色代理执行。

### 意图识别

那怎么才能实现这个核心的代理层呢？我们先从一个简单的例子开始说。用过GPT的朋友可能都有下面的体验，当我们要求GPT基于互联网已有知识回答问题，它会怎么做呢？

![](https://static001.geekbang.org/resource/image/74/23/74bd708924b3dfc3535325db11e23723.jpg?wh=3536x2212)

你看，我问了一个问题，GPT搜索了7个网站，然后根据这些网站的内容做出了回答。但是显然大模型是不具备网络搜索能力的。那它是怎么做的呢？答案是我们提问里的 `请你先查询网络资料再回答我` 这个意图必须被识别出来，并改变原有流程，它才能做到执行搜索操作。
<div><strong>精选留言（5）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1c/f6/80/85ec2c2a.jpg" width="30px"><span>连瑞龙</span> 👍（1） 💬（1）<div>Agent 代理层的核心有两点，一是基于上下文的用户意图识别，二是调用自定义的工作流完成业务逻辑。而最好的上下文意图识别的方案就是大模型。</div>2024-10-02</li><br/><li><img src="" width="30px"><span>研发账号</span> 👍（1） 💬（2）<div>老师，跟Coze雷同的fastgpt，熟悉吗，哪个更好用</div>2024-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/20/5e/c9981e3b.jpg" width="30px"><span>梁少杰</span> 👍（0） 💬（1）<div>黄焖鸡点餐大师  这部分的代码，在资料中没有找到</div>2024-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/c3/c5db35df.jpg" width="30px"><span>石云升</span> 👍（4） 💬（0）<div>微调的优势:

更好的整合性: 微调后的模型可以更自然地将插件能力融入到自身的知识和推理过程中,而不是单纯依赖提示词触发。
性能提升: 经过微调,模型可以更准确地判断何时使用插件,减少不必要的调用,提高效率。
上下文理解: 微调模型可以基于更广泛的上下文来决定是否使用插件,而不仅仅依赖特定的触发词。
灵活性: 可以根据具体应用场景定制模型的插件使用行为。

微调的劣势:

成本高: 微调过程需要大量的计算资源和时间,相比简单的提示词方案成本更高。
复杂性: 需要设计合适的微调数据集和训练策略,这个过程比编写提示词更为复杂。
可能的过拟合: 如果微调不当,模型可能过度依赖特定插件或在不恰当的场景使用插件。
更新困难: 当需要添加或修改插件时,可能需要重新进行微调,而提示词方案则更容易更新。

相比之下,提示词方案的主要优势在于实施简单、成本低、易于更新。但它可能缺乏灵活性,且在复杂场景下的表现可能不如经过微调的模型。</div>2024-09-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6b/f8/b4da7936.jpg" width="30px"><span>大魔王汪汪</span> 👍（0） 💬（0）<div>赞，coze没有云api回调吗？这样就可以和私有数据通过定制api交互了。
还想问下，如果想要提升functioncall的准确性（方法、参数）是不是只能微调了。</div>2024-12-30</li><br/>
</ul>