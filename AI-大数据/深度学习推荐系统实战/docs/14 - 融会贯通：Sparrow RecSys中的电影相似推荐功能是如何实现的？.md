你好，我是王喆。

课程进行到这里，推荐系统架构的大部分知识点，包括特征工程、Embedding模型，到推荐服务的搭建，线上推荐过程的实现，我们都已经学习并且实践过了。如果你坚持跟着我一起学下来的话，可以说已经是“武功小成”了。

为了帮你巩固所学，今天，我就带你从头到尾地实现一个完整的推荐功能，**相似电影推荐**，来帮助你打通推荐系统的“任督二脉”。

## “清点技能库”，看看我们已有的知识储备有哪些

在开始实现相似电影推荐功能之前，我想先带着你一起清点一下自己的技能库。我喜欢把推荐的过程比喻成做菜的过程，接下来，我就按照做菜的四个关键步骤，带你回顾一下前面学过的重点知识。

**第一步，准备食材。** 准备食材的过程就是我们准备推荐所需特征的过程。在特征工程篇中，我们不仅学会了怎么挑选“食材”，怎么处理“食材”，而且还实践了“备菜”的高级技能Embedding技术。具体来说就是，我们能够利用物品序列数据，通过Item2vec方法训练出Embedding，也能够使用Deep Walk和Node2vec把图结构数据生成Graph Embedding。

总的来说，因为Embedding技术的本质就是利用了物品之间的相关性，所以Embedding是做好“相似推荐”这盘菜的关键。
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/8e/5d/562e90d6.jpg" width="30px"><span>金鹏</span> 👍（34） 💬（3）<div>在小视频行业，基于CTR或播放量的商业逻辑进行推荐策略的调整，在实际过程中往往会变成大量推荐低俗、擦边内容，短期各个指标会上涨，但从长远来看，其实是损害了整个商业收益。所以在短视频一般会以播放时长ts做为商业指标。</div>2020-11-05</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/qLpWmAg6TR6GgXQ3x5345k2eJsOdsJibYYjxbPtcHlfYSdG5qT1qR72BYzxXWvJuxicPG2lH92ynGfpVtdz5IjjA/132" width="30px"><span>InfoQ_ea311a6b3a82</span> 👍（23） 💬（1）<div>计算相似度的时候考虑电影的内容信息，如利用描述等生成内容Embedding，和之前训练得到的Embedding连接起来，再进行相似度的计算。</div>2020-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg" width="30px"><span>那时刻</span> 👍（18） 💬（1）<div>我觉得除了热门电影头部推荐之外，还有用户对电影的评论，以及用户观影行为，比如很多人看电影是把热门电影轮流看一遍。
</div>2020-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/c9/f8/72955ef9.jpg" width="30px"><span>浣熊当家</span> 👍（17） 💬（4）<div>对于最后的问题的改进，之前老师讲Node2Vec的时候，提到了BFS倾向于结构性， DFS倾向于同质性，所以为了减轻热门电影的扎堆推荐，可以调整随意游走的概率，让他更倾向于同质性(DFS)吗？因为热门影片可能处于节点的中心位置这样的结构性， 然后同一种的影片（比如动画片，惊悚片，。。）属于同质性。 不知道我又没有理解对</div>2020-11-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/c9/f8/72955ef9.jpg" width="30px"><span>浣熊当家</span> 👍（14） 💬（2）<div>对于玩具总动员那个例子，老师提到推荐结果类别不够精准， 不过我的想法是，对于一个物品的分类，有很多种方面，虽然我们的模型在电影类别方面不够精准， 但是他却反映了另一个方面，就是热门（或者经典）。这也是个很好的共性，比如有些人的兴趣就是看热门影片。 只要在最后在排序的时候，过滤掉用户已经看过，和推荐过n次依然没有看的（说明不感兴趣），这样的推荐应该很make sense。 就想2老师最后说的，评价系统好不好的终极标准是观看时间和点击率，而且我的直觉感觉推荐热门电影的点击率就会比其他的高。 所以我有个最后的问题，我们主管的测评评价电影的相似度的时候，往往由于思维局限，会忽略某些事物本质的关联，对模型尽量少的人工干预，会不会更科学</div>2020-11-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/46/f4/93b1275b.jpg" width="30px"><span>Alan</span> 👍（11） 💬（1）<div>答：热门电影的头部效应造成的，有一定影响因素！但我们要分析为何它们这些电影会成为热门呢？热门特性，可以大概的猜测几点：经典、新颖、价值高、文化核心、受众用户群、时间效应等等。所以就像老师召回层的多路召回策略又会衍生出几个问题：1、如何调整热门推荐与个性化推荐权重。2、随着时间效应消失，热门度对个体对用户群又是怎么影响的，又如何实现精准的推荐呢？3、推荐系统针对个人与用户群场景如何切换？ 
大致上可以 Embedding 方法上的改进建议：1、Attention机制的Embedding算法  2、类别标签TF-CR权重计算等  。
最后，具体问题具体分析，请结合业务改进推荐系统，又如其他同学提及的短视频推荐：停留时间、点击率、点赞数、点击转化率等作为热门评估指标。 </div>2021-03-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/6d/c5/c0665034.jpg" width="30px"><span>Wiiki</span> 👍（7） 💬（2）<div>王老师，请教一下关于Embedding的问题。如果我有这样的一个需求，需要融合时序，位置空间，还有内容等信息到一个Embedding，通常针对这种情况都是怎么生成Embedding的？是不是说Embedding的出现，代表着传统手动，凭经验生成特征的方式已经没有应用场景了？谢谢~</div>2020-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg" width="30px"><span>JustDoDT</span> 👍（7） 💬（1）<div>在推荐最终展示前在加一层简单的规则过滤，例如利用电影类别把非儿童的电影剔除掉。</div>2020-11-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/be/56/6a2998ba.jpg" width="30px"><span>คิดถึง </span> 👍（2） 💬（1）<div>老师好，如果我想更换MovieLens 20M Dataset数据集的话，重新训练的具体步骤大概是什么？</div>2021-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/72/73/d707c8be.jpg" width="30px"><span>MutouMan</span> 👍（2） 💬（1）<div>可能也和电影的受众有关，当年皮克斯推出玩具总动员时，其中一个宣传策略就是成年人也可以看的动画片。所以玩具总动员和真实的谎言对成年人的吸引力可以认为是相似的。另一点动画片我们常常认为是儿童看的多，但是儿童看的多也不代表他们回去评价。更多的评价还是来自爸爸妈妈们。为了改进embedding，我觉得：1. 可以加入电影类型、风格等side information，让模型也考虑电影风格的影响；2. 是不是也可以加入时间戳，我看了100部电影，很大可能前十部和最后十部电影完全不同。或者采样的时候，随机游走的时候，边的权重可以相应调整。
</div>2021-05-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/68/98/522e034c.jpg" width="30px"><span>lyx</span> 👍（1） 💬（1）<div>老师你好，请问如果在召回的时候就采用了embedding计算相似度的策略，然后在排序的时候又用embedding之前的cosine相似度，这感觉没差呀？就相当于直接用embedding相似度选topN了。</div>2021-10-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/b4/58/b8fdef05.jpg" width="30px"><span>c</span> 👍（1） 💬（1）<div>王老师你好，有个问题，线上服务建立候选集的时候，文章里面提到利用sql等方式进行查询，这样的话对于大量物品会不会有耗时问题，真实环境一般是怎么处理的，能稍微说一下吗？</div>2021-04-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/68/98/522e034c.jpg" width="30px"><span>lyx</span> 👍（0） 💬（1）<div>看源码，ranker中似乎采用的是embedding的余弦相似度而不是这里说的內积相似度呢？</div>2021-10-09</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/55lYKUdcPFgUHibRYmaRiaBdrsmnLGOHdPp4OicjBh197X0vyGa9qAwruEqicAPuUgibXO4Lz5jLudlcbtsqq2p3CpA/132" width="30px"><span>Sebastian</span> 👍（0） 💬（1）<div>老师好，推荐服务上线后，对于用户badcase发现和处理的有没有什么典型流程，以及如何用于完整模型</div>2020-11-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ef/f1/8b06801a.jpg" width="30px"><span>哇哈哈</span> 👍（0） 💬（0）<div>请问老师在召回层和排序层都用了embedding，两处使用embedding的差异是什么呢</div>2022-09-18</li><br/><li><img src="" width="30px"><span>Geek_seven</span> 👍（0） 💬（0）<div>请问老师，在这个“相似电影推荐”例子中，有“召回层”吗？排序阶段：是在redis中存储的所有的embedding vector，利用类似lsh进行向量检索。这相当于对所有候选物品进行检索，也就不存在召回的概念吧？谢谢~</div>2021-08-14</li><br/>
</ul>