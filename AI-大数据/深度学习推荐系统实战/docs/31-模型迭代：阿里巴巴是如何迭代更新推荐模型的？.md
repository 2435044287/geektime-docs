你好，我是王喆。

前两天，我问了我团队中推荐工程师们一个问题，“你们觉得在推荐系统领域工作，最大的挑战是什么？”。有的人说是模型调参，有的人说是工程落地，有的人说是找到下一步改进的思路。那现在听到这个问题的你，认为会是什么呢？

其实，刚才的这些回答都很好。不过，我的想法和大家稍有不同，我认为工作中最大的挑战就是，**不断地优化整个推荐系统的架构，做到持续的效果提升和高质量的模型迭代**。这是因为，从我们成为一名算法工程师的第一天开始就在不断面临挑战，不仅要跟别人赛跑，也要跟自己赛跑，而超越过去的自己往往是最难的。

那这节课，我就以阿里妈妈团队的经验为例，带你看一看业界一线的团队是如何实现模型的持续迭代创新，做到好上加好的。在学习这节课的时候，我再给你一点小建议，不要纠结于每个模型的细节，而是要多体会阿里的工程师是如何定位创新点的。

## 阿里妈妈推荐系统的应用场景

阿里妈妈是阿里巴巴集团的营销广告团队，他们负责了阿里大部分广告推荐系统的工作。下图1就是一个阿里妈妈典型的广告推荐场景。

这是我在手机淘宝上搜索了“篮球鞋”之后，App给我推荐的一个商品列表。其中，第一个搜索结果的左上角带着HOT标识，左下角还有一个比较隐蔽的灰色“广告”标识。那带有这两个标志的，就是阿里妈妈广告推荐系统推荐的商品啦。
<div><strong>精选留言（13）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/21/b2/cb/9c6c7bf7.jpg" width="30px"><span>张弛 Conor</span> 👍（24） 💬（1）<div>思考题：我在想，当前模型在考虑用户历史行为信息时，只考虑了用户的点击行为，能否将特定的曝光行为也考虑进去呢？比如，历史曝光过得广告商品，或曝光时间较长的商品。这样做，不仅可以做更深层次的兴趣挖掘，还可以尝试去做兴趣培养。就像对于某音某手的平台，人们往往诟病的是推荐算法让人变得更极端，推荐算法能否挖掘出或识别出能够改变人兴趣或观点的item呢？</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/72/1d/abb7bfe3.jpg" width="30px"><span>顾小平</span> 👍（11） 💬（1）<div>多模态建模是啥意思呢？有没有比较通俗的例子呢？</div>2021-01-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/8f/cf/890f82d6.jpg" width="30px"><span>那时刻</span> 👍（10） 💬（1）<div>课后思考题，感觉还可以利用用户的浏览记录，搜索记录，以及用户与朋友之间推荐分享记录。</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/21/08/a2/346431a9.jpg" width="30px"><span>Geek_b86285</span> 👍（5） 💬（1）<div>老师您好，能否讲讲你的团队在Roku搭建推荐系统过程中的经验。如何从0到1不断迭代，其中遇到过哪些问题和挑战，又是怎么解决的呢？想听听您从事这行的经验</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e4/a1/2f5b9764.jpg" width="30px"><span>你笑起来真好看</span> 👍（4） 💬（1）<div>使用了深度学习模型之后，比如历史点击特征，传统的机器模型需要我们手动提取特征。而深度模型值需要吧序列的itemid输入就好。是不是说 有了深度模型，传统机器学习特征工程就不需要做了呢？</div>2021-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/97/8f/ccce7df1.jpg" width="30px"><span>小匚</span> 👍（3） 💬（1）<div>有一个问题，平时其实会推荐与购物车&#47;收藏夹相似的商品，这部分推荐是否已经应用到实践中了？仔细看了一下文中确实是只用了历史购买信息。

个人体验会过一个月啊过半年的更新购物车内容。收藏夹的东西大部分是好友分享同时自己也感兴趣的。

还有喜欢节日购物的还是那种不敏感的。不知道这个是不是已经包含在历史特征里了。</div>2020-12-25</li><br/><li><img src="" width="30px"><span>Geek_8a732a</span> 👍（2） 💬（1）<div>用户的点赞、收藏、分享行为，还有加入购物车的行为，是不是可以增加一些这类商品的权重？比如已加购物车的商品，想买还没买的，可能是品牌或者价格的因素导致用户没有下单，是不是可以推荐类似的商品。</div>2021-08-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/05/d7/53fa7473.jpg" width="30px"><span>硕</span> 👍（1） 💬（1）<div>2.还有什么方式能够进一步利用好用户行为信息？这里对于模型层面的积累比较浅薄所以没有什么思路，或许可以针对用户提前做一个分档，根据我们这儿的经验来说活跃用户和非活跃用户的行为表现存在很大差异，针对不同档位的用户分别训练不同的模型可能有更好的效果</div>2021-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ec/64/7403c694.jpg" width="30px"><span>ALAN</span> 👍（1） 💬（1）<div>老师讲的非常好。这里有几个小问题，DIN网络训练时，N个商品的N是固定的吗？一般取多少？候选ID会放进去训练吗？输出的目标是什么？</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/05/d7/53fa7473.jpg" width="30px"><span>硕</span> 👍（0） 💬（1）<div>1.可供挖掘的用户行为信息还是有不少的，比如用户点击浏览收藏搜索等行为，虽然不如购买这么强烈，但是胜在量大覆盖度广，比如用户近期的浏览行为可能会比1个月前的购买行为更有参考意义。同时还可以做一些用户和场景的交互，比如用户在服装类目下的活跃度购买力等特征，甚至可以单独构建模型来计算。</div>2021-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/27/54/3d/366462d0.jpg" width="30px"><span>Yvonne</span> 👍（0） 💬（1）<div>或许MIMN的多个兴趣向量如果是平行的话，可以尝试交叉？有些商品的融合属性可能比较明显，例如被曝光商品如果是“悬浮灯泡”的话，那“工具”+“艺术”这两个兴趣向量的结合就不错？</div>2021-05-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/32/de/88e98677.jpg" width="30px"><span>舒光华</span> 👍（1） 💬（0）<div>王喆老师，你好，最近读一篇同样来自Ali&#47;Taobao关于Embedding-based Retrieval 的文(https:&#47;&#47;arxiv.org&#47;abs&#47;2106.09297), 有个关于在处理real-time signals时候的模型选择的问题想听一下看法。在图2的模型中，处理real-time behavior的时候，在采用MSA之前，采用了LSTM，而在short-term和long-term的时候并没有采用LSTM。文中没有细说为什么，提了一下说用LSTM capture evolution。我的理解是Positional Encoding也可以达到类似的效果。所以不知道为什么要采用LSTM。而且如果序列长的话，还会比较慢。当然最好的办法是直接对比一下。不过目前模型相对比较复杂，而且数据采集也比较难。所以在有机会试之前想听听你的看法。谢谢！ </div>2022-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/ed/b7/972cd42c.jpg" width="30px"><span>꧁꫞꯭R꯭e꯭i꯭r꯭i꯭꫞꧂</span> 👍（0） 💬（0）<div>通过社交网络将用户的行为特征和亲朋好友通讯录上的行为特征做交叉</div>2023-02-02</li><br/>
</ul>