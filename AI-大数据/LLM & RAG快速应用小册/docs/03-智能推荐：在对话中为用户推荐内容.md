> 本门课程为精品小课，不标配音频

你好，我是王吕。上节课我们讨论了极客时间小助手的功能和设计，这节课我想跟你聊聊如何在对话过程中给用户推荐优质内容，这里以极客时间课程推荐为具体案例。

我们知道，在极客时间的课程中，对话消息中的上下文包含了文章片段，有了文章片段，我们就可以得到文章 ID 和课程 ID，之后我们就可以把引用的课程推荐给用户，整个过程如下图：

![图片](https://static001.geekbang.org/resource/image/06/66/06ecbfa05727780c67d30dba13cb1066.jpeg?wh=1920x1080)

这是最直接的方案，实现起来也非常简单，把引用文章所属的课程直接推荐给用户，听起来也很合理。

**我们假设这样一个场景：**我是一名后端工程师，我问了一个 Nginx 相关的问题，恰好有一门前端课程，整个课程只有一个小节的一小部分用上了Nginx，其余部分都是前端知识，这个时候，很有可能这个课程也被推荐给了我，但这并不是我想要的。

为什么会出现这个问题呢？其实根本原因还是在于我们想要推荐的课程是一个整体，它有自己的主题，而课程下的文章被分割成段落之后，每个段落也有了自己的主题，这两者很多时候并不是完全一致的，如果按照段落去找课程，很容易就会以偏概全，导致推荐出不合适的课程。那么，极客时间是怎么解决这个问题的呢？

我们给课程也增加了 **Embedding**。在向量数据库，我们增加了一个课程集合，每当有课程上新，我们就在课程集合里增加一条记录，根据课程的介绍生成向量。用户提问的时候，还是按照上下文的规则，拿到引用课程，同时使用问题向量去课程集合检索，找到最接近的2门课程，和引用的课程做一下合并去重，重新排序之后，取前 3 条作为推荐课程推荐给用户。我画了一个流程图供你参考。
<div><strong>精选留言（2）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/6b/f8/b4da7936.jpg" width="30px"><span>大魔王汪汪</span> 👍（2） 💬（1）<div>可以简单介绍下用户画像和协同过滤部分的方法吗</div>2024-09-18</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELvqowyjk03bEDYiaXcly9ficL75tpKKqlD3kFwZEMduzNSf4tiaMo1VHQmtHicoH8V4W8rrfJeHw0qfA/132" width="30px"><span>愤毛阿青</span> 👍（0） 💬（1）<div>围绕用户问题如何将内容库匹配度高的内容推荐给用户，一步一步将问题掰开，干货满满</div>2024-09-09</li><br/>
</ul>