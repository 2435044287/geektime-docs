你好，我是范学雷。

从今天开始，我就要和你一起逐渐接触密码学的具体细节了。在这个过程中，我会讲到很多密码学相关的概念和诉求，这是我们打好基础的关键。不过，你也不用紧张，我会和你一起分析，一步步带你掌握这些知识点。

还记得上一讲，我们讨论的话题吗？我们通过牛郎织女约会送信的小例子，探讨了“密码学有什么用”这个问题，从而理解了信息安全的基本问题和基本需求。

问题出现了，我们也知道了该用密码学。现在就要来解决问题了，接下来的几讲，我们就先来解决“信息的完整性”这个问题。你还记得解决完整性的工具是什么吗？——单向散列函数。

可是，什么是单向散列函数？它是怎么解决完整性问题的？今天，我们就来讨论这两个问题。

## 什么是单向散列函数？

首先，我们从名字上看，一眼就能看出来单向散列函数有两个关键修饰词，“单向”和“散列”。

其实，在数学上，单向函数和散列函数是两个不同类型的函数。所以，我们要想理解单向散列函数，我们就要先知道什么是单向函数，什么又是散列函数。

### 什么是单向函数？

如果你没有了解过什么是单向函数，你可以先猜一下，为什么它叫单向函数？

**单向函数（One-way Function）是正向计算容易，逆向运算困难的函数**。也就是说，给定你一个输入，你很容易计算出输出；但是给定你一个输出，你却很难计算出输入是什么。
<div><strong>精选留言（18）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/95/82/02056ecc.jpg" width="30px"><span>tony</span> 👍（7） 💬（4）<div>牛郎利用非对称算法，生成一个公钥与私钥。公钥对外公开。
织女利用非对称算法，生成一个公钥宜私钥。
公钥对外公开。

牛郎生成对称密钥（对称算法织女知道）。牛郎用自己的单向散列函数计算信件内容输出哈希值。然后进行用自己的私钥进行签名。这样就有了签名与信件原文，将这两者用对称密钥加密。同时将对称密钥用织女的公钥加密，简称数字信封。然后将数字信封与密文信息都发给织女。

织女收到密文及数字信封之后，只能织女用自己的私钥才能解开。织女用自己的私钥解开数字信封，得到对称密钥。再用对称密钥解密得到明文与数字签名。

然后织女使用相同的单向散列函数计算出哈希值，用牛郎的公钥解密收到的数字签名得到哈希值。如果这两个哈希值一致这说明信息未被篡改，否则这说明被篡改。



传递过程中，通过使用织女的公钥加密对称密钥，从而保证了对称密钥的安全传输同时也可以保证仅仅织女才能解密并且可以获取到对称密钥。而该对称密钥通过这种方式任何人则无发获取到。
织女然后通过该对称密钥解密信息内容，获取原文与哈希值，判断信件的完整性。

我把数字信封复习了一遍。</div>2020-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/7b/03/03583011.jpg" width="30px"><span>天天有吃的</span> 👍（7） 💬（2）<div>希望老师可以把课程中用到的代码整理一份到git，比如今天的SHA1，虽然之前没接触过但是可以看看代码跑一跑理解一下，不然自己再去找博客去调试还是挺费时间的</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/e4/a1/178387da.jpg" width="30px"><span>25ma</span> 👍（2） 💬（2）<div>突然有个大胆的想法，给老师这个课想了一个有趣的名字[趣谈密码学]，哈哈😄，让枯燥的密码学算法的学习变得更加有趣，生动，形象，感谢老师</div>2020-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/3c/10/61efe672.jpg" width="30px"><span>向东是大海</span> 👍（2） 💬（3）<div>1）织女生成一对密钥，一个是公钥，另一个是私钥；
2）织女把公钥寄给牛郎；
3）牛郎写信给织女，对信对内容进行hash；用公约对hash值加密作为数字签名；用公钥对信的内容进行加密；把加密后的信和信的数字签名一起寄给织女；
4）织女收信后，用私钥解密信的内容；用私钥解密数字签名得到信的hash值，比对信的hash值，如hash值正确，说明信未被篡改。</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/d8/68/89770b8b.jpg" width="30px"><span>LXX</span> 👍（1） 💬（1）<div>首先牛郎和织女在某一次见面的时候，自己约定一份公钥和私钥，然后牛郎之后可以对自己的约会信息以及单向散列函数算出约会信息的哈希值，一起用通过私钥加密，再通过公钥将信息加密 一次，装入信封里头，如果能过对传输通道进行隐秘保护就更好啦，最后织女收到之后，通过公钥解密，再通过私钥解密，获得信息和哈希值，织女通过计算信息内容的哈希值，与收到的对比，即可。</div>2021-01-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/a7/dc/2438f394.jpg" width="30px"><span>Baldwin</span> 👍（1） 💬（2）<div>牛郎和织女约定好好加密方法。这几个字的实际存储比特取反然后用gb2312编码。最后用孙悟空的浑号做关键字；计算写一个校验和。当然加密方法和关键字 和签名算法只有牛郎和织女知道</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg" width="30px"><span>彩色的沙漠</span> 👍（1） 💬（1）<div>老师，接口数据采用的AES加密之后通信，对于明文还有必要在做哈希让后端在做完整性校验吗？如果做了哈希把哈希值放到某一个字段里面，然后在整体加密传输，感觉必要性不大，因为数据已经加密，如果被别人破译了加密，那完整性校验就不攻自破了。
需要一种混合算法，把明文的哈希值和明文的加密数据通过某种算法混合到一块，这种安全性高一点。</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/c9/23/76511858.jpg" width="30px"><span>洛奇</span> 👍（0） 💬（1）<div>为什么java的hashcode()方法逆向运算很容易？</div>2022-10-13</li><br/><li><img src="" width="30px"><span>霍尔</span> 👍（0） 💬（1）<div>如果黑客知道了单项散列函数，修改原文，并修改哈希值，那是不是就无法检测到原文被篡改</div>2021-01-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/0e/94/4a2bb019.jpg" width="30px"><span>Lorin</span> 👍（0） 💬（1）<div>既然散列函数已经具备雪崩效应了，按理说，反向破解应该很难，这个时候为什么还要单向函数呢？</div>2020-12-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/87/4e/98173974.jpg" width="30px"><span>明</span> 👍（0） 💬（1）<div>老师 小白问一个很简单的问题（评论里大佬说的我都不会😂😂）单向散了函数说的是一个函数 既满足单向性质，又满足散列性质吧  而不是两个只满足其中一个性质函数的组合使用</div>2020-12-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/ec/49/410176b8.jpg" width="30px"><span>偏偏</span> 👍（0） 💬（2）<div>使用RSA方式 私钥对数据进行加密，并携带数据和加密算法，公钥解密。
比如：A：加密算法，B：数据，C：hash值
整个信息为：A.B.hash(A+B+私钥）组成的，如果B 被篡改了，公钥验证hash里面的就会验证失败。
而RSA方式公钥不能对数据加密和篡改，只能验证。
带来的问题是 数据透明，可以使用可逆的加密算法加密数据部分。</div>2020-11-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/a6/d6/1bf9f5bf.jpg" width="30px"><span>成</span> 👍（0） 💬（1）<div>老师，我觉得可以把信息内容用单向散列函数计算出散列值，然后把这个值和函数算法包含在信件里发出，然后接受者可以用相同函数来计算信件里的内容，得到的散列值同附带的散列值比较，如果相同说明内容没有被篡改。但是有个问题，如果王母娘娘得到这封信把内容改了，用算法再计算一个新的散列值，发出去这就不好办了。所以还需要一个新的协定来约束。</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/05/69/a1ededde.jpg" width="30px"><span>Charlie Guo</span> 👍（0） 💬（4）<div>可以把牛郎要发给织女的信的每个字的笔画数记录下来，然后加上声调数算出来的整数总值用二进制表示，然后通过Sha-256算出值加在信的最后。如果再可靠一点的话可以在第一步算出来的值上再加一个只有牛郎和织女才会知道的幸运数字再做Sha运算。</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/cb/6f/b6693f43.jpg" width="30px"><span>Litt1eQ</span> 👍（0） 💬（2）<div>牛郎喝织女可以先约定在消息后面拼接一个固定的字符串 这个字符串是提前约定好的 只有牛郎和织女知道 然后对如下信息作散列算法 原始信息 + 固定字符串+时间戳 发送的信息是 原始信息 散列算法的值 时间戳 这样织女在收到消息之后 按照同样的方法对消息作散列 如果值一样 表示消息没有被篡改过</div>2020-11-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>在密码学里，最基础的概念就像是铁打的营盘，具有长久的生命力；而密码学算法就像是流水的兵，隔一阵儿就会换一茬。--记下来</div>2022-11-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习了</div>2022-11-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a8/35/85033228.jpg" width="30px"><span>亚东</span> 👍（0） 💬（0）<div>感觉不能单纯地用单向散列函数，因为这个算法是不可逆。在牛郎织女的场景中，织女最终是要收到信息的。但是可以用这个来做签名把织女的地址跟信息用单向散列函数生成散列值发给织女。织女验证一下自己解密后的信息生成的散列值跟牛郎发过来的是否一致。来判断信息是否完整，被篡改。</div>2022-04-26</li><br/>
</ul>