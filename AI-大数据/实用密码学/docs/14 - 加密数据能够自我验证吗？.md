你好，我是范学雷。

还记得上一讲，我们讲的消息验证码吗？我们讨论过可以使用消息验证码来验证消息的真伪。但是，不知道你有没有注意，在上一次讨论中，我们并没有讨论该如何安全地传递待验证消息。

而且，待验证信息的传递还是通过明文的方式进行的，这种方式，信息的私密性会受到影响。我们前面讨论过，单独的加密并不能解决信息的有效传递问题，总是存在这样或者那样的问题。

那么，我们能不能把消息验证码和信息加密结合起来，既保持信息的私密性，也保持信息的完整性呢？这就是我们这一次要解决的问题。

## 先加密还是后加密？

想要保持信息的私密性，我们可以在信息传输之前，把明文数据加密成密文数据，然后传输密文数据。如果我们还想要保持信息的完整性，我们就要使用消息验证码。

第一个来到我们面前的问题是：消息验证码和信息加密该怎么结合起来？或者换一种说法就是，怎么构造可认证的加密（Authenticated Encryption (AE)）呢？

加密和验证组合起来的方式不外乎三种方案。

### 加密并验证

第一种方案，就是加密明文数据，计算明文数据的消息验证码，输出密文数据和验证码。这种方案，我们简称为加密并验证。安全外壳协议（SSH）就是采用加密并验证的方案。
<div><strong>精选留言（7）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1f/cb/6f/b6693f43.jpg" width="30px"><span>Litt1eQ</span> 👍（3） 💬（7）<div>我有一个疑问，如果牛郎和织女采用对称加密的方式，他们两个人的秘钥是如何来协商的呢？ 如果牛郎想要保证约会信息的完整性和机密性，如果采用加密方案的话，他们二人之间需要进行秘钥的协商，但是他们之间的通信一般来说是不可信的，王母娘娘可能会派千里眼和顺风耳来窃听他们的秘钥，我能想到的方案是采用非对称加密的方案，牛郎先把自己的公钥发送给织女，然后织女利用牛郎发送给织女的公钥对他们之间传递信息的秘钥进行加密，然后发给牛郎，牛郎利用自己的私钥解开织女加密的内容，这样他们两个就获得了一个只有他们知道的一个对称加密的秘钥。
但是这样存在一个问题，这样是无法防止中间存在一个孙悟空，它变成织女的样子拿到了牛郎的公钥，然后自己伪造一个公钥变成牛郎，然后在发给织女，这样孙悟空就能完全解密牛郎和织女之间的通信了。
仅仅通过对称加密的方法的话，我目前没有想到比较好的方案来让他们传递秘钥。</div>2020-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ef/e8/076a6f59.jpg" width="30px"><span>张翀</span> 👍（1） 💬（1）<div>老师 原文中cbc攻击方案链接已经失效</div>2022-11-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（0） 💬（1）<div>带关联的认证加密算法 ： 加密和解密过程都是需要提前知道 关联信息的吗？ 如果是，怎么提前进行知道？</div>2022-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2022-11-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>能同时保护私密数据的完整性和公开数据的完整性，这是带关联的认证加密算法要解决的主要问题。--记下来</div>2022-11-09</li><br/><li><img src="" width="30px"><span>harryZ</span> 👍（0） 💬（0）<div>```
我们前面提到的 CBC 攻击方案是不是似乎又回来了？实际的攻击方案比我们前面讨论的复杂，如果你有兴趣，可以看看这篇论文。
```
这篇论文 这个链接失效了, 看是否有其它链接  或关键字让我们可以去其它地方搜索?</div>2022-05-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/07/69/43cf2251.jpg" width="30px"><span>Alan He</span> 👍（0） 💬（0）<div>意外收获，词汇 take away-收获。

</div>2022-04-10</li><br/>
</ul>