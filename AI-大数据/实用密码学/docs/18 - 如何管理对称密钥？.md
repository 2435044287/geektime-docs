你好，我是范学雷。

上一讲，我们讨论了合格的对称密钥需要具备什么条件，以及对称密钥是怎么产生的。但是，了解对称密钥是怎么产生的，是远远不够的，我们还要了解怎么管理这些对称密钥。

在我们讨论怎么管理之前，我们还要再给对称密钥分个类，划分的标准就是对称密钥要不要留存。那么，哪种密钥不需要留存呢？我们该怎么管理呢？这是我们这一次要讨论的问题。

## 对称密钥要不要留存？

你是不是有些迷惑，难道对称密钥不需要留存？如果不留存，为什么还要做密钥管理？

为什么我们要讨论对称密钥要不要留存？因为最好的管理，就是不管理或者少管理。按照这个思路，我们可以把对称密钥分成两类：即用即弃的对称密钥和需要留存的对称密钥。

### 即用即弃的对称密钥

即用即弃的对称密钥，就是用的时候才生成出来，不需要保存，用完了就扔掉的对称密钥。

那这种对称密钥的适用场景是什么呢？**即用即弃的对称密钥可以用在加密数据不需要保存的场景**。比如说， 像HTTPS这样的端到端传输协议，它的网络传输数据是加密的，而加密的网络传输数据是不需要保存到硬盘里的。

这种情况下，对称密钥可以使用计算机持有的秘密，也就是使用随机数来生成。还记得什么是计算机持有的秘密吗？你可以复习一下[17讲](https://time.geekbang.org/column/article/328197)，来回顾一下这个知识点。
<div><strong>精选留言（5）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/1e/b7/b20ab184.jpg" width="30px"><span>麋鹿在泛舟</span> 👍（5） 💬（2）<div>请教，一般kerberos 的使用场景不是集中认证吗？和通信加密是不是没有关系。

我认为，kerberos解决了在不可信集群内提供了各组件的互相认证（仿冒）问题，但是现在云化下，厂商有更靠谱简单的方案构建一个可信环境，攻击者都攻破信任域到内部了，能干的就太多了，kerberos也防不住啥破坏了。加上引入了管理复杂性和降低性能，用的越来越少了</div>2021-01-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（1） 💬（2）<div>即时通信的场景 如果使用非对称加密，每个用户生成一对密钥，自己持有私钥，公钥下发出去，那是不是也需要管理 用户体量的密钥数？</div>2022-08-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/ac/5c/bb67abe6.jpg" width="30px"><span>林子茗</span> 👍（0） 💬（1）<div>1.Kerberos 协议是怎么工作的，是怎么解决对称密钥的规模化通信问题的？
答：客户向Kerberos服务请求，Kerberos返回两部分信息：（1）Kerberos产生的客户和票据许可服务TGS之间的会话密钥，并用客户密钥加密；（2）票据许可票据TGT则用TGS的密钥加密；
然后客户解密出和TGS的会话密钥，使用会话密钥加密鉴别码，并且和原封不动的TGT一起发给TGS；
之后TGS解密出TGT，拿出会话密钥解密出鉴别码，对比鉴别码和TGT里面的信息是否能对得上；然后为客户和服务器产生会话密钥并用TGS和客户的会话密钥加密，同时产生服务器票据并用服务器的密钥加密，将这两个信息一起发给客户；
最后客户解密出和服务器的会话密钥，并用它加密鉴别码，将服务器票据和鉴别码发给服务器，服务器解密出票据再解密出鉴别码，验证成功后使用客户和服务器的会话密钥通信。

P.S.：老师，我虽然了解了Kerberos 协议的流程，但是还不太明白“Kerberos 协议，是怎么解决对称密钥的规模化通信问题的”？


2.如果让你使用 Kerberos 协议去设计一个即时通信软件的数据加密框架，你觉得会有哪些优点，会有哪些缺点？
答：优点：解决鉴别和密钥交换的问题，保证安全性；
缺点：（1）依赖于Kerberos服务和TGS服务是可信的，若这两个关键节点被攻击，实际也不安全；
（2）步骤多，可能延时高。</div>2023-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>对称密钥的规模化是使用对称密钥的一个大麻烦。--记下来</div>2022-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2022-11-11</li><br/>
</ul>