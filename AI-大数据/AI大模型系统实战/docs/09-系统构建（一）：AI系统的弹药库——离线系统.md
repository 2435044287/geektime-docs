你好，我是Tyler。

从今天开始的两节课，我们不但会回顾总结前面学到的内容，还会带你完成人工智能服务系统的实际架构。

你可能在想，我们[第5节课](https://time.geekbang.org/column/article/688311)学习策略建模的时候，不是已经给 AIRC 系统建模了吗。当时还分成了召回、排序、控制博弈和风控这几个模块，为什么还要再提系统构建呢？

这是一个很好的问题，其实第5节课我们更侧重学习业务建模方法，而学完了特征工程、模型工程和数据算法之后，我会带你从零开始，从真实应用的角度来构建一个AIRC的离线和在线系统。这个架构既可以满足搜索、广告、推荐这类经典内容分发场景的需求，也同样能兼容内容生成系统，也就是AIGC的需要。

这节课我们先来学习离线系统。离线系统是你的后勤总管，决定了你在线服务的上限。你能想象到的几乎所有对数据和算法的调优，都是在离线系统中完成的，所以**离线系统是构建AI系统的第一颗扣子**。

## 模型工程

设计一个离线系统的第一步，就是理清我们系统的数据流走向。下面我将带你一步步梳理模型训练的数据链路。

### 全量模型训练

![](https://static001.geekbang.org/resource/image/75/51/75e3bayy7569b1c0c729ab7fa2808351.jpg?wh=3900x1831 "全量模型训练流程")

首先是模型训练的数据流程。

因为业务应用（如APP，网站，客户端等）是用户行为和数据最丰富的地方，所以AI系统通常会在用户发生某些行为时，将日志上报到服务端，获取足够多的数据，供给模型训练使用。
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/1f/a4/32/12f16980.jpg" width="30px"><span>林清扬</span> 👍（4） 💬（3）<div>直接使用增量模型可能会在实效性上有所提升，但存在3个潜在问题。
1. 增量模型可能因为缺少全量数据的综合训练而容易受到噪声影响，导致模型性能下降。
2. 增量模型可能无法涵盖全量数据的多样性，特别是新出现的情况，影响模型的泛化能力。
3. 缺少全量数据的参与可能使得模型无法进行全面的反做弊训练，降低模型的鲁棒性。</div>2023-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/51/6e/efb76357.jpg" width="30px"><span>一只豆</span> 👍（3） 💬（1）<div>课程日益深入，再次感谢老师～试着回答一下
langchain 中使用的文档片段 Embedding 和 将用户和物品在高维空间的坐标的 Embedding 相比，有很大差别：后者使用真实的业务数据而且嵌入在一整套存储索引系统中，这远远不是文档这种载体能够媲美的。本质来说，是原型系统设计和工业级系统设计的差别吧。</div>2023-08-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ff/7b/cbe07b5c.jpg" width="30px"><span>顾琪瑶</span> 👍（3） 💬（1）<div>唯一能想到的是时效性的问题，假如是时效性的话延迟一天真的会这么重要吗？
有个问题想问下投影模型具体是怎么做的，是否有其他的文章详解呢？比如物品和客户具体是怎么关联起来的等等</div>2023-08-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/60/a8/d60df0d6.jpg" width="30px"><span>baron</span> 👍（2） 💬（1）<div>推荐系统的三要素是用户、产品、场景； 对用户与产品的embedding其实就是将用户与产品之间的关系在高维空间的表征；而文本的embedding则没有这种三要素的逻辑，是单要素逻辑，是通过模型通过学习大量文本数据种词与词之间的序列关系，而生成的词与词的高维空间表征； 这样的表征应该比用户产品这样的关系数据要更稀疏，维度更高；必然GPT的embedding向量维度到底12288维。 </div>2023-09-02</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqjZHY70Lke3YzZFibuibLTmt0NfXqj3zVBIGrauOzZj19B3RMo4iaY9ibXq3ar9lSGPdgcqzw2UrgMjQ/132" width="30px"><span>InfoQ_6792a017d8d3</span> 👍（1） 💬（1）<div>看到这里已经忍不住分享给朋友，要是23年看了这个课程，23年H2牵头的一个AI应用重要项目，可能效果会好很多
</div>2024-02-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（1） 💬（1）<div>是否有安卓手机上可以使用的chatGPT？</div>2023-08-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/c4/9d/0f4ea119.jpg" width="30px"><span>周晓英</span> 👍（3） 💬（0）<div>补充说明：
模型遗忘问题:

在连续的增量训练中，模型可能会遗忘早期学到的知识，尤其是如果新的数据与旧的数据有很大差异时。全量训练可以保证模型能够维持对整个数据分布的理解。
模型评估和验证的困难:

增量训练可能会使模型评估和验证变得更为困难，因为不同时间点的模型可能会有不同的性能表现。全量训练可以为模型提供一个稳定的评估和验证环境。
超参数优化的困难:

在增量训练的过程中，由于数据分布可能会发生变化，原有的超参数可能不再适用，而对超参数的调整和优化变得困难。全量训练提供了一个相对稳定的环境，有助于超参数的选择和优化。</div>2023-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/db/95/daad899f.jpg" width="30px"><span>Seachal</span> 👍（0） 💬（0）<div>课程讲了AI离线系统构建，重点在模型工程和存储索引。模型工程那块，说了全量模型训练怎么从日志收集到发布，还有增量模型的流程，强调了在线模型的实效安全。存储索引呢，就是倒排索引服务很重要，ElasticSearch能建在线全量倒排索引，还讲了在线特征制备和知识图谱生成。</div>2024-11-23</li><br/>
</ul>