你好，我是独行。

上一节课我们了解了机器学习的基本概念，学习了线性回归和逻辑回归，相信你对机器学习有了初步理解，这节课我们继续讲解机器学习的经典算法，先从决策树开始。

## 经典算法

### 决策树

决策树是一种常用的机器学习算法，用于**分类和回归任务**。通过从数据中学习决策规则来预测目标变量的值。想象你在玩一个“是或否”的猜谜游戏，每次你只能问一个问题，对方只能回答是或否，你的目标就是用最少的问题猜出对方心中的答案。在实际应用中，决策树有很多场景，比如客户分类、信用评分、医疗诊断等等，下面我举一个简单的例子。

我们要根据天气情况、温度和风速来决定进行什么活动，比如宅在家还是出去玩，我们准备一些简单的数据集。

- 天气状况：晴天（0）、阴天（1）、雨天（2）
- 温度：低（0）、中（1）、高（2）
- 风速：无风（0）、微风（1）、强风（2）

活动：

- 去野餐（0）
- 去博物馆（1）
- 在家看书（2）

我们看一下使用sklearn库提供的决策树算法和模型的示例代码。

```python
from sklearn.tree import DecisionTreeClassifier, plot_tree
import matplotlib.pyplot as plt
import numpy as np

# 创建数据集
X = np.array([
    [0, 2, 0],  # 晴天，高温，无风
    [1, 1, 1],  # 阴天，中温，微风
    [2, 0, 2],  # 雨天，低温，强风
    # ... 添加更多样本以增加模型的准确性
])
y = np.array([0, 1, 2])  # 分别对应去野餐、去博物馆、在家看书

# 初始化决策树模型，设置最大深度为5
clf = DecisionTreeClassifier(max_depth=5, random_state=42)

# 训练模型
clf.fit(X, y)

# 可视化决策树
plt.figure(figsize=(20, 10))
plot_tree(clf, filled=True, feature_names=["天气状况", "温度", "风速"], class_names=["去野餐", "去博物馆", "在家看书"], rounded=True, fontsize=12)
plt.show()

```
<div><strong>精选留言（8）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg" width="30px"><span>张申傲</span> 👍（10） 💬（3）<div>第9讲打卡~
思考题：激活函数可以使神经网络呈现非线性，是因为激活函数中引入了复合函数和非线性转换，简单来说就是针对每层网络，激活函数可以控制有哪些特征值、经过什么样的转换之后，再传递到下一层。如果没有激活函数，那么输入层的所有特征值都会按照固定的权重依次传递到隐藏层和输出层，经过换算之后，本质上就相当于只经历了一个线性的隐藏层。</div>2024-06-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg" width="30px"><span>阿斯蒂芬</span> 👍（1） 💬（1）<div>老师这个做菜的比喻很妙啊，生动形象。</div>2024-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/27/66/c04dacdd.jpg" width="30px"><span>朱俊帆</span> 👍（0） 💬（1）<div>做菜这个比喻太妙了，感觉我以后面试都可以这么讲</div>2024-12-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/3b/c8/37/64f10938.jpg" width="30px"><span>charlott</span> 👍（0） 💬（1）<div>老师您好，机器学习适合宽表数据集吗，尤其是在预测场景下，感觉目前的预测手段都是手写规则十分不便，如果使用机器学习的方式理论上是不是能达到更优良的效果？</div>2024-06-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/fa/f1/7d21b2b0.jpg" width="30px"><span>方梁</span> 👍（0） 💬（1）<div>如果没有激活函数，那么下层的节点和参数会几何级增长。</div>2024-06-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a0/c3/c5db35df.jpg" width="30px"><span>石云升</span> 👍（3） 💬（0）<div>学习概念性东西，还是要结合一些实际案例来学会比较好。有了AI之后，这个事情变得很简单了。举例：
1.产品评论情感分析（使用SVM）
2.客户流失预测（使用随机森林）
3.产品推荐系统（使用神经网络）

任务：对用户提交的产品评论进行情感分析，判断评论是正面、负面还是中性。
为什么选择SVM：
- 文本数据通常是高维的（每个单词都是一个维度）
- SVM在处理高维稀疏数据方面表现出色
- 我们主要关注二分类（正面vs负面）或三分类问题
实施步骤：
a) 数据预处理：
- 收集大量带标签的产品评论
- 进行文本清洗（去除标点、转换为小写等）
- 使用词袋模型或TF-IDF将文本转换为向量
b) 特征工程：
- 选择最相关的特征（如最常见的1000个词）
- 可能会使用词性标注或命名实体识别等技术增强特征
c) 模型训练：
- 选择合适的核函数（如线性核或RBF核）
- 使用网格搜索和交叉验证找到最佳参数
d) 模型评估：
- 使用准确率、精确率、召回率和F1分数评估模型
- 分析错误分类的案例以进一步改进
e) 部署和监控：
- 将模型集成到评论系统中
- 定期用新数据更新模型

任务：预测哪些客户可能在近期停止使用你的平台。
为什么选择随机森林：
- 可以处理各种类型的特征（数值型、类别型）
- 能处理大量特征，并提供特征重要性
- 对类别不平衡（流失客户通常是少数）有较好的处理能力
实施步骤：
a) 数据收集和预处理：
- 收集客户的历史行为数据（如购买频率、客户服务互动、浏览记录等）
- 处理缺失值和异常值
- 对类别特征进行编码
b) 特征工程：
- 创建新特征，如客户生命周期价值、最近一次购买到现在的时间等
- 标准化数值特征
c) 模型训练：
- 设置合适的树的数量和深度
- 使用交叉验证来调整参数
d) 模型评估：
- 使用 AUC-ROC 曲线评估模型性能
- 分析特征重要性，了解哪些因素最影响客户流失
e) 模型应用：
- 对可能流失的客户进行预警
- 制定针对性的留存策略

任务：基于用户行为和产品特征，为用户推荐可能感兴趣的产品。
为什么选择神经网络：
- 可以处理复杂的非线性关系
- 能够学习用户和产品的潜在特征
- 适合处理大规模数据和实时预测
实施步骤：
a) 数据收集：
- 用户历史行为数据（浏览、购买、评分等）
- 产品特征数据（类别、价格、品牌等）
- 用户特征数据（年龄、性别、位置等）
b) 数据预处理：
将用户和产品ID转换为嵌入向量
对数值特征进行归一化
对类别特征进行one-hot
c) 模型设计：
d) 模型训练：
e) 模型评估：
f) 模型部署和更新：
</div>2024-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e1/be/e7c7bb94.jpg" width="30px"><span>福禄妹妹</span> 👍（1） 💬（0）<div>激活函数进一步提高了网络的表现力。这是因为向网络添加了基于激活函数的“非线性” 表现力，通过非线性函数的叠加，可以表现更加复杂的东西。所以从另一个维度说，激活函数必须使用非线性的，比如ReLU</div>2024-11-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2e/0c/66/51161385.jpg" width="30px"><span>like life</span> 👍（1） 💬（0）<div>激活函数可以使神经网络呈非线性是因为在训练的过程中得益于自反馈的机制来不断调整参数从而导致每次得出的结果和特征都不一样，如果没有激活函数，神经网络则就是一个简单的预测模型</div>2024-11-10</li><br/>
</ul>