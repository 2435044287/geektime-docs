你好，我是乔新亮。这一讲，我们来聊聊如何实现架构的高性能设计。

前面我们讲过，产品思维有两个核心关键词：“契约精神”和“洞察人性”。其实高性能设计，也和契约精神是密切相关的。我将其总结为：高性能设计，一切围绕着契约精神。

你可能会想，高性能设计不就是可以支撑大流量、高并发的架构设计吗？和契约精神又有什么关系？

其实关系很大。所谓的高性能，实际上，是与业务强相关的。比如，对于一台网络游戏服务器来说，可以支撑 400 名玩家同时在线，就算高性能；对于一台流媒体服务器来说，可以支撑 10,000 用户同时在线观看，就算高性能。

当然，数据可能不准确，但逻辑大体如此。在实际的业务场景中，还会有许多其他技术指标被引入。比如游戏需要关注连接稳定性、视频需要关注延时，等等。

明确了性能和业务的关系，下面我们就来聊聊，如何进行高性能设计，也借此加深对契约精神的认知和理解。

## 契约精神是高性能架构设计的“拦路虎”

首先，我们要清楚，高性能设计可以大体拆解为两大步骤：

1. 清晰描述、定义性能目标；
2. 设计并实现这个目标。

而高性能架构的设计目标，是通过三类指标来具体定义的，分别是：

1. 系统响应时间，一般指服务/交易处理的时间，也包括网络响应时间；
2. 系统吞吐量，一般指系统的每秒交易量，通常需要结合并发量共同描述；
3. 系统容量，通常代表系统的可用资源数量，包括硬盘容量、网络带宽等。
<div><strong>精选留言（13）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/18/18/66/53ce5d28.jpg" width="30px"><span>如水</span> 👍（51） 💬（4）<div>技术行业发展到今天，基本不存在太多的技术挑战了。这句话我不赞同，我还没看到中国有好用的操作系统，这个技术没挑战吗？</div>2020-12-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/58/d6/4050cbe5.jpg" width="30px"><span>李克光</span> 👍（11） 💬（2）<div>&quot;任何复杂问题都可以被拆解为简单问题，只要拆解得足够细致。一定要牢记这一点，这种思维能力是技术人的安身立命之本。&quot;   --乔老师很好诠释了《 道德经》中 “天下难事，必作于易；天下大事，必作于细。是以圣人终不为大，故能成其大&quot; 。
非常感谢乔老师的技术传道，让我贯通了很多思路，收获良多。</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/69/d2/8a53f0a3.jpg" width="30px"><span>E</span> 👍（7） 💬（1）<div>乔老师看似在讲架构设计，实际上是在讲技术治理，契约精神是治理过程中的指导思想，乔老师也说到契约不可能无上限，因此本质上依然是在给大家布道“Trade-Off”思想。</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/da/e8/d49dfa94.jpg" width="30px"><span>Weehua</span> 👍（4） 💬（1）<div>我也非常认同乔老师的观点：在当今中国的互联网环境中，大部分公司都在使用技术，如何使用好技术我认为没有太大的挑战，我们遇到的坑，遇到的技术问题，大部分都是别人走过的路。2年前，带团队开始从0到1做大数据平台相关建设，其中遇到了很多挑战，最后都是通过各种学习和交流得到了很好的解决。

大部分公司发展很快，还没有到稳定的阶段，分工也不会那么细，所以在技术深度这块我认为是远远不够的。但是到了一定阶段，一定要慢下来，聚焦核心技术，还是要做一些优化的，所谓的技术壁垒，就是一直不断的做这些小优化，量变到质变。作为技术管理者，怎么使用技术，做事的思维和认知感觉才是最难的。</div>2020-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（2） 💬（1）<div>其实&quot;高可用和高性能&quot;可以放到一起：本质就是SRE，我们看看京东、阿里的双11其实非常典型的体现了这点。架构代码和架构的代价、硬件基础架构和资源合理使用、业务的取舍和问题的重要性。
可能自己在这条路上用了大量的经历研究：根据业务的合理性与重要性去合理的使用资源，对于不确定性和关键业务可能的问题做好充足的灾难预演与危机应对策略，早年”熔断“被太多各行的人去笑，可是放到今天而言-这种格局之大实在钦佩。自己在某些行业都经历且处理&#47;经历过极限危机，如果当时不曾合理处置对于所在企业就是重大事故。
Google的SRE中的一句话至今提醒这些年的我”没有Bug的程序是程序的特殊状态“，这几年很多人提出过运维无价值时我曾说过一句话”你做不到你的车子不在路上不抛锚，万一这个问题在高速公里上发生时，没有人帮你解决问题难道你要推你的车子下高速么“。
以上是个人对于高可用和高性能的一点薄见：还请老师指正。</div>2021-03-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/09/fb/52a662b2.jpg" width="30px"><span>spark</span> 👍（1） 💬（2）<div>对高性能的自顶向下的认知：流量控制、扩容、提升各组件的处理能力
对高性能的分解：
一，架构角度：硬件、异步、中间件、缓存、负载均衡、读写分离，集群，分片；
二，技术角度：网络IO模型、无锁多线程并行、数据结构、算法、网络传输时间、IO时间；

我写代码追求性能最好，至少要比竞争对手好。我们团队有人一个接口2s照常上线，我至少要优化的50ms以内。
从商业竞争角度看高性能，其实高性能不是壁垒，别人很容易超越，例如加个128G内存就可以从2s提升到10ms。</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/50/5f/d10a39c4.jpg" width="30px"><span>glutton</span> 👍（1） 💬（1）<div>还有一个点需要向乔老师请教，目前技术调整或者是技术壁垒基本不存在了，应届生基本对组件啥的很清楚了。。。
那么，程序员该如何提高自己竞争力呢？听课过程中，有一些点，比如提升认知?改变思维方式?可是感觉又欠缺实现路径。。。</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/9a/81/cd6d5e1e.jpg" width="30px"><span>Anyou Liu</span> 👍（1） 💬（8）<div>乔老师，测试环境资源有限，配置不如生产，数据量也达不到生产的要求，往往测试环境没问题的，到了生产环境性能还是有问题，测试环境的指标往往也不能直接类比到生产，有没有什么好的解决办法？</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/73/a0/7dcc9212.jpg" width="30px"><span>adang</span> 👍（0） 💬（1）<div>契约精神正是现在团队缺失的，每年 618、双 11、双 12 公司运维、运营、研发全员戒备监测系统是否有异常，出现异常马上处理，每次大促结束再全员复盘总结，对发现的问题进行修改，下一次再这样循环。据团队老人讲，现在已经好多了，只是不放心所以才全员盯着，基本上不会出现大问题，以前是全员通宵忙救火。即使到现在也没有很清晰的目录，一切都是差不多就行，到时候再说，顶多在大促前预先准备好扩容。

老师说的明确目标履行契约，我的整理是事先要做好明确的分析和研究，把每个细节都考虑清楚，在执行过程中做好监测跟踪，收集反馈并及时做出调整。可很多研发人员和管理者不愿意静下心来细致的思考分析，理由是，想的再细也会有遗漏，太浪费时间，只有真正做了才会发现问题，想的差不多就开始做，做的过程中再调整，才是最快的。结果也就没有了契约精神。

还有一个原因是研发人员对于违约成本没有切身体会，出了问题调整呗，没啥大不了，但是在商业合作方面，这样的事情那是大忌，因为事前没有约定清楚，那么出了问题全是要用钱解决的，所以就特别注意，锱铢必较。这也就回到了老师一直说的，要站在公司发展的角度看问题。</div>2021-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/39/8c/ff48ece3.jpg" width="30px"><span>小乙哥</span> 👍（0） 💬（1）<div>1.契约其实就是业务要求的目标，围绕这个目标，达成结果就是契约精神的体验。
2.具体的实现目标方法论，就是高性能设计的过程。核心是三大步: 保护系统；弹性设计；组建能力建设(这块会包含很多的术，比如分库分表，缓存等)</div>2021-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/f2/2a9a6e9a.jpg" width="30px"><span>行与修</span> 👍（0） 💬（1）<div>高可用设计，高性能设计背后是业务设计，架构设计，体系配套设计的全过程方法论。实践中需要以产品为基础持续优化提升，是一个演进过程，无法一蹴而就，往往不是一两个项目所能承载的。回看这三篇，乔老师的课程设计思路也是值得学习的！</div>2020-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/50/5f/d10a39c4.jpg" width="30px"><span>glutton</span> 👍（0） 💬（1）<div>契约，这个词儿用的很独特，我理解契约其实是目标的另一种表达方式
生产环境压测，才能真实反应系统上限和可能的问题。这块我有切身体会，测试环境压测没有问题，一上生产，耗时不符合预期，最后排查，是某个机房的数据库服务器网卡有问题，虽然这是一个特殊的例子，我是以此来表达，只有生产才是对用户交付的环境。
耗时方面，除了分位数，一些特殊的场景，需要关注下max，虽然压测过程中，tp99数据很理想，但是max过长，也需要单独优化（比如一些需要预热的场景，第一笔请求处理可能过长）</div>2020-12-11</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyPPFIyvytj0LJrpHicVrTqibuLWLWcR5VqzArSHZicwJYC6gKrIF6GTxx4MakS6xiaxZBCw8icCPB8wQ/132" width="30px"><span>Geek_2e6a7e</span> 👍（0） 💬（6）<div>加入你提供的服务是数据库，比如TiDB,怎样来提供性能指标。</div>2020-12-11</li><br/>
</ul>