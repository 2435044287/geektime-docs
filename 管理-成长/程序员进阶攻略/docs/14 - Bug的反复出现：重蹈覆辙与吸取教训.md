Bug 除了时间和空间两种属性，还有一个特点是和程序员直接相关的。在编程的路上，想必你也曾犯过一些形态各异、但本质重复的错误，导致一些 Bug 总是以不同的形态反复出现。在你捶胸顿足懊恼之时，不妨试着反思一下：为什么你总会写出有 Bug 的程序，而且有些同类型的 Bug 还会反复出现？

## 1. 重蹈覆辙

重蹈覆辙的错误，老实说曾经我经历过不止一次。

也许每次具体的形态可能有些差异，但仔细究其本质却是类似的。想要写出没有 Bug 的程序是不可能的，因为所有的程序员都受到自身能力水平的局限。而我所经历的重蹈覆辙型错误，总结下来大概都可以归为以下三类原因。

### 1.1 粗心大意

人人都会犯粗心大意的错误，因为这就是 “人” 这个系统的普遍固有缺陷（Bug）之一。所以，作为人的程序员一定会犯一些非常低级的、因为粗心大意而导致的 Bug。

这就好比写文章、写书都会有错别字，即使经历过三审三校后正式出版的书籍，都无法完全避免错别字的存在。

而程序中也有这类 “错别字” 类型的低级错误，比如：条件`if` 后面没有大括号导致的语义变化，`==`、`=` 和 `===` 的数量差别，`++` 或`--` 的位置，甚至 `;`的有无在某些编程语言中带来的语义差别。即使通过反复检查也可能有遗漏，而自己检查自己的代码会更难发现这些缺陷，这和自己不容易发现自己的错别字是一个道理。
<div><strong>精选留言（22）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/a4/5a/e708e423.jpg" width="30px"><span>third</span> 👍（29） 💬（1）<div>心得如下：

1.bug本质上是无法避免的，最好的办法不是不犯错，而是少犯错误，犯错之后尽快改正。最快的成长方法是不退步

2.bug的反复出现，有三个重要原因，粗心大意，认知偏差，熵增问题

3.认知偏差是错误的最大来源，思想错误，行动又怎么会正确呢？

4.熵增问题，是随着复杂增高，而必然有更高概率发生bug

5.应对这些问题，我们要从各方面吸取教训，其中最重要的是优化方法和塑造环境。

6.粗心大意，可以通过流程和工具来减少，建议补充代码单元测试

7.认知偏差，可以通过团队和技术手段来纠偏

8.熵增问题，通过业界不断迭代更新流行的框架模式来解决。

9.塑造环境，塑造一个正视错误，改正错误的环境</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg" width="30px"><span>钱</span> 👍（9） 💬（1）<div>世界是不完美的，人是这个世界的极小部分，人也是不完美的，如果想使人做的事情趋近于完美，那就需要集体的智慧了。之于编程一套好的流程能扼杀许多的Bug，自测、测试（包括：测试环境联调、预发布环境联通等）、代码review，上线前准备、上线中自验、上线后产品及业务验证等如果都做到位了，至少能保证主流程没问题，对于性能有要求的可以加上性能测试。现在我们基本是这么玩的，另外，就是各种监控和日志的加持啦！</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/05/97/b83ebf66.jpg" width="30px"><span>Geek_qrifj5</span> 👍（5） 💬（1）<div>胡大看问题的角度真是独特，而且深刻</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1e/81/c3e541c0.jpg" width="30px"><span>李正阳Lee</span> 👍（4） 💬（1）<div>看到塑造犯错环境这节，想起了桥水基金创始人达利欧对待犯错的态度。

他允许员工犯错，强调每个人应反思错误，不容许一错再错。并在公司内部建立了一个“错误日志”，用来记录每人犯过的错误和造成的不良后果，这样可以追根溯源，系统化的解决问题。

我们技术人也可以建立自己或团队的“错误日志”，在错误中成长。</div>2018-09-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/5b/6f/113e24e6.jpg" width="30px"><span>阿信</span> 👍（3） 💬（1）<div>程序之术这部分 笔记 (期待支持markdown)

# 总览
主要是讲解程序员技能的锤炼。
主线：设计、开发、bug处理 (按正常的功能开发流程介绍的)
* 设计
    * 认知设计。架构与实现，他们的连接与分界；框架和模式的区别
    * 如何来设计。从哪些维度来思考(多维度视图)
* 编码
    * 工业级编码包含哪些内容 (功能、控制、运维)
    * 编码的两种方式：粗放和精益
    * 编码的态度：炫技和克制
    * 编码的三阶段：调试、编码、运行
* bug处理
    * bug按特性进行的分类以及各分类介绍。空间特性和时间特性
    * bug出现的原因分析，以及降低bug的方法



# 05 架构与实现：它们的连接与分界
架构：做的是顶层设计，技术、框架选型，边界划分。熵尽量小。设计和实现做取舍
实现：交付代码，尽量简。围绕架构做的程序时间。
连接：
架构师：关注系统边界、关键点、战略性细节点

# 07 多维与视图：系统设计的思考维度与展现视图
理解或表现系统的视角。
组成视图：描述组成系统的子系统、服务、组件。便于总体了解系统服务组成，以及其职能。服务切分原则：高内聚，职能单一；正交化，同一个功能只有一个服 务提供
交互视图：系统组成部分中各部分的依赖、被依赖关系。整体的流转。
部署视图：系统如何来部署的。关于服务、中间件、使用者之间的网络传输，确认IO瓶颈，从高维度看系统设计的合理性
流程视图：功能逻辑流
状态视图：状态的变化流
我的理解：组成、交互、部署视图，适合描述顶层设计。流程、状态视图，适合描述具体的功能

# 08 代码与分类：工业级编程代码的分类与特征
总结：
对于最终需要交付运行的程序代码，
从代码的用途(or使用场景)上将作者代码分为三种：功能代码、控制代码、运维代码。
功能代码，满足于用户需求，为实现特定的业务功能而开发。
控制代码，对代码执行流的控制，如并行、异步、限流、熔断、超时控制等。RPC、中间件、代理服务器等，应该是对代码执行流的控制。控制代码的需求，是从众多(已有的或预见的)功能开发中提炼而来，基于一些共性的特征抽取。源于功能而高于功能。
运维代码，用于解决运行过程中出现的问题，或者为解决问题提供必要的信息。

结合工作，我们做的防重组件，是控制代码。基于pinpoint实现链路跟踪，是对业界已有的运维代码成果的使用

# 09 精益与粗放，编程的两种思路与方式
介绍编程的两种思路，完美型和现实型。
看这篇文章，脑海中想到了两件事情，一是卖油翁的故事；二是态度(吴军老师写的)一书中提到的一些观点：最好是更好的敌人(或者说进步一点比什么都不做好)、做事情时境界要高。
陶器制作第一组的同学，可以说是熟能生巧；陶器制作第二组的同学以及课程设计的同学，境界是比较高的，但在其事情落地上执行方式有点问题，因为没有找到完美的方案而踌躇不前，最终没有输出满意的成果。
套用到我们自身的工作，以及绝大多数程序员身上，大量的开发(+用心理解)可以提升我们的水平，我们要求输出的成果有deadline，设计时我们格局可以大一些，考虑后来的扩展，实现时可以分步来执行，多次的改进让我们朝着目标前进，甚至超过原有心中的完美方案。

# 10 炫技与克制：代码的两种味道与态度
炫技：能简单处理的采用了复杂的方式
克制：不随性。第一层意思是采用了简单的方案处理合适的问题；第二层意思是看到不好的代码、设计，克制立刻修改的冲动，了解整个逻辑后，在合适的时机进行重构。

# 11 三阶段进化：调试，编写与运行代码
介绍的是两种写代码的方式：一是走一步算一步，边写边调；二是先整理清楚整个思路，然后再动手。


# 12、13、14 bug分析
技术性bug，根据特征分为两类：
空间：环境过敏
时间：周期规律
环境过敏，像人到一个新环境过敏一样，程序运行在不同的环境，因为环境的差异而导致程序运行遇到问题。如磁盘故障，网络带宽低等，原本(在次品正常、网络带宽高机器上)运行正常的程序，运行出现了问题。

bug出现的原因分类：
粗心大意
认知偏差，和理解需求出现了偏差
熵增问题 (系统复杂度变高)

降低bug出现次数的方法：
粗心大意，可以通过流程和工具减少；
认知偏差，可以通过团队和技术手段来纠偏
熵增问题，重构，如使用业界更好的模式、框架等来降低复杂度
塑造环境。塑造一个正视错误、改正错误的环境。</div>2019-03-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f4/ee/8abb67ec.jpg" width="30px"><span>Frank.w</span> 👍（2） 💬（1）<div>总是粗心大意导致出现bug，甚至一些低级的条件语句发生错误。
自我总结：
1. 做好单元测试。
2.做好代码走查，在写完代码后，在今进行从新构思审查。
3.对于代码改动影响的所有代码进行测试。
4.提交测试，同时提交改动范围，改动代码所影响的所有功能。</div>2019-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e1/5c/86606d9c.jpg" width="30px"><span>湮汐</span> 👍（2） 💬（1）<div>我和胡老师一样，也被线程池池误导过。我也以为先创建线程到max，然后再进入队列，事实上和我们想的正好相反。而我总结了一下，我们之所以被误导，也是有原因的：数据库连接池就是先创建连接到max，如果没有可用连接时，就等待maxWait时间直到有空闲连接或抛出异常。
在学习的时候虽然有“触类旁通”，但是有时候确实会有一些细节不一样，没有去踩过这个坑，自然就会想当然了。
出错一直都是正常的，一定要敢于面对自己的错误，并且纠正自己的错误。</div>2018-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/64/04/18875529.jpg" width="30px"><span>艾尔欧唯伊</span> 👍（2） 💬（1）<div>我最近面试遇到这个问题，我就说错了。后来继续解释的时候发现说不通了，回来一看，发现之前理解的都是错的</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/64/04/18875529.jpg" width="30px"><span>艾尔欧唯伊</span> 👍（2） 💬（2）<div>线程池那个认知偏差真是一样一样的啊。。。</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg" width="30px"><span>海盗船长</span> 👍（1） 💬（1）<div>才看了几篇，就能感觉到胡大是个喜欢看书的人</div>2020-10-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/20/39/3168c4ca.jpg" width="30px"><span>二木🐶</span> 👍（1） 💬（1）<div>这篇文章写的真好</div>2018-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4e/8b/964b3b80.jpg" width="30px"><span>热勇</span> 👍（1） 💬（1）<div>非常值得反思的文章！！！为自己加油！谢谢老师</div>2018-09-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ae/e1/78701ecf.jpg" width="30px"><span>莫小鹏</span> 👍（1） 💬（1）<div>今天的文章不错</div>2018-09-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/de/ac/f279ac31.jpg" width="30px"><span>吴秀華</span> 👍（1） 💬（1）<div>我承认我是个经常出BUG的人。每次都是粗心大意或未完全了解需求造成的。我正在努力的完善自己的思维和工作态度。在工作中得不到认可和改进意见。在这里，非常感谢峰哥的分享，让我在迷茫中，看到曙光。</div>2018-09-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg" width="30px"><span>亚林</span> 👍（1） 💬（0）<div>嗯 站在更高的角度解决问题</div>2018-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/6e/93/6fef7aaa.jpg" width="30px"><span>石头</span> 👍（1） 💬（0）<div>首先要有一套流程避免大问题，然后对于个人来说有一个收获就是建立COF，不断总结优化提高。</div>2018-09-05</li><br/><li><img src="" width="30px"><span>！巴甫洛夫的狗</span> 👍（0） 💬（0）<div>既然最后引用了芒格语录，那么，在规避错误上其实也可以借鉴芒格的思想。作为一个保守派的思想家、投资人。芒格总结了23种心理偏差，上百种跨学科的思维方式，目的都是为了更为理性。像飞行员般列清单;如果我知道我在哪里死去，我就再也不去那个地方;祖母的规则;反过来想，都是避免错误的一些方式。</div>2022-01-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/bc/d5/036bc464.jpg" width="30px"><span>封志强</span> 👍（0） 💬（0）<div>老师，优秀哦</div>2021-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg" width="30px"><span>Sch0ng</span> 👍（0） 💬（0）<div>程序反复出现的问题一般不是程序的问题。
如果是程序的问题，还反复出现，那就是技术能力的问题。
既然反复出现了，说明问题不在技术能力，更可能在人身上。
比如强压预算，导致实现变形；比如强加需求，导致系统走形。
所以，有时候走不出bug，不一定是程序的原因，也有可能是所处的环境的原因。</div>2021-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/2b/39/19041d78.jpg" width="30px"><span>😳</span> 👍（0） 💬（0）<div>我出现的bug一般都是粗心大意，但是每次出现后，都会记住这个问题，以便后续少发生类似的事情，偶尔也会出现一些认知偏差的问题。</div>2020-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/56/ec/1c38b82c.jpg" width="30px"><span>香槟</span> 👍（0） 💬（0）<div>环境受制于公司和管理者本身的管理方式，目前看扁平化管理应该是做到了。通过采集系统请求错误，及时发现问题，这应该算工程师文化的一些吧，可是主动改善权力距离指数，这有细化的方式列举一二点吗</div>2019-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/97/46/fe1f21d8.jpg" width="30px"><span>北风一叶</span> 👍（0） 💬（0）<div>终于知道为什么我写的程序总是返工了，就是因为bug没有管理好，也没有吸取经验教训</div>2018-11-14</li><br/>
</ul>