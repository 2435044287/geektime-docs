你好，我是郑晔。

在“自动化”模块的最后，我们来聊一个很多人热衷讨论却没做好的实践：微服务。

在今天做后端服务似乎有一种倾向，如果你不说自己做的是微服务，出门都不好意思和人打招呼。

一有技术大会，各个大厂也纷纷为微服务出来站台，不断和你强调自己公司做微服务带来的各种收益，下面的听众基本上也是热血沸腾，摩拳擦掌，准备用微服务拯救自己的业务。

我就亲眼见过这样的例子，几个参加技术大会的人回到公司，跟人不断地说微服务的好，说服了领导，在接下来大的项目改造中启用了微服务。

结果呢？一堆人干了几个月，各自独立开发的微服务无法集成。最后是领导站出来，又花了半个月时间，将这些“微服务”重新合到了一起，勉强将这个系统送上了线。

人家的微服务那么美，为什么到你这里却成了烂摊子呢？因为你只学到了微服务的形。

## 微服务

大部分人对微服务的了解源自 James Lewis 和 Martin Fowler 在2014年写的[一篇文章](http://www.martinfowler.com/articles/microservices.html)，他们在其中给了微服务一个更清晰的定义，把它当作了一种新型的架构风格。

但实际上，早在这之前的几年，很多人就开始用“微服务”这个词进行讨论了。

“在企业内部将服务有组织地进行拆分”这个理念则脱胎于 SOA（Service Oriented Architecture，面向服务的架构），只不过，SOA 诞生自那个大企业操盘技术的年代，自身太过于复杂，没有真正流行开来。而微服务由于自身更加轻量级，符合程序员的胃口，才得以拥有更大的发展空间。
<div><strong>精选留言（26）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/32/e1/c9aacb37.jpg" width="30px"><span>段启超</span> 👍（32） 💬（2）<div>我是今年年初的时候接触到领域驱动设计的，看Eric的《领域驱动设计》确实给了我非常大的启发，给我目前工作中遇到的问题指明了方向。DDD改变了我思考问题的方式，让我把关注点回归业务，而不是一开始就去考虑技术的是实现问题。尤其是限界上下文的概念，让我明白了一直在搞，却总是搞不好的微服务到底是哪儿出了问题。
但是目前的困境是：想在公司内推行DDD，阻力真的很大，首先是很多人对DDD没概念，需要一定的学习成本，二是团队间相互隔离，沟通成本很高，起码的通用语言都很难达成。在上次迭代中，很多时间都花在弥补因为沟通不畅导致的扯皮中了，最后就是功能虽然实现了，代码却早已经改成了大泥球。还有就是不顾长远的赶进度，实现功能是首要的，领域模型就成了没有人去做，也没有时间去做事情。</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/ee/96a7d638.jpg" width="30px"><span>西西弗与卡夫卡</span> 👍（20） 💬（1）<div>领域驱动设计中把术语在不同领域中的差异提到了比较高的程度。这其实是日常工作中非常常见的问题，同一个名词，不同人的理解是不同的，在不同业务中的含义也不同。最近正在构建组织架构服务，不同人想的就不一样。行政&#47;HR想的是在企业IM里看到的是组织架构，实际上是按业务线划分。财务想的是，凭证进财务系统的时候，需要按照不同公司，这又是一个组织架构。业务团队之间会产生协作，比如都是为用户增长，参与协作的人又会形成某种组织架构。

在限界上下文中统一术语的认识，而不是花更多精力让所有参与者都统一术语，其实是非常务实的做法</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/ee/f5c5e191.jpg" width="30px"><span>LYy</span> 👍（14） 💬（1）<div>多谢老师推荐的书单 之前直接看&lt;领域驱动设计&gt;没看明白</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/94/76/aa2202b7.jpg" width="30px"><span>Wei</span> 👍（13） 💬（1）<div>又一篇解答了我疑惑的一篇好文章！ 我之前也是抱着“TDD其实不实用”的观念，老师TDD的章节让我明白了TDD的本质在于架构设计，而架构设计是从具体任务分解而来；关于微服务，我对其理解一直放在ops&#47;tools 方面，现在才明白其本质也是软件结构问题，服务的划分通过DDD， ops&#47;tools只是服务的implementation. 

另外提一下2017 年 Domain-Driven Design Distilled 出了Vaughn Vernon 讲解的视频版，现在积极补课中，上一个链接： https:&#47;&#47;learning.oreilly.com&#47;videos&#47;domain-driven-design-distilled&#47;9780134593449</div>2019-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg" width="30px"><span>enjoylearning</span> 👍（12） 💬（1）<div>说的好，领域驱动设计确实是进入微服务的前置条件，除了设置边界上下文，还要划分子域，实现领域驱动设计那本书看了后，其实还是要看一下Eric的那本书，一个是道，一个是术。</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/46/c0/106d98e7.jpg" width="30px"><span>Sam_Deep_Thinking</span> 👍（10） 💬（1）<div>如果是使用hibernate ，实施起DDD，会容易一些。但是互联网公司大部分用mybatis，毕竟sql得完全自己控制才好。</div>2019-06-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/52/67/fcba0967.jpg" width="30px"><span>zapup</span> 👍（8） 💬（1）<div>这篇真的太棒了！正如微服务里的两句话“微服务是双刃剑，拆得越细，优势越明显，缺点也越明显”，“要用好微服务，最好别做微服务”。深刻了！</div>2019-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/9b/a7/440aff07.jpg" width="30px"><span>风翱</span> 👍（7） 💬（1）<div>公司说我们的开发方式是敏捷开发，实际上只是使用了一些敏捷开发的方法，只有遵守敏捷开发的价值观和原则，才能算是敏捷开发。微服务也是一样，不是说拆分成多个服务去部署，就叫做微服务。也不是采用市面上常用的微服务框架，就是微服务了。</div>2019-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg" width="30px"><span>行者</span> 👍（7） 💬（1）<div>感触很深，之前我们在开发一个新项目中，3个人拆了10+个微服务，维护、排查问题都很麻烦；之后服务减少到3个才好很多；微服务很好，但是我们要明白为什么要微服务，以及微服务会带来哪些问题，千万不要一上来就微服务。 血淋淋的教训！</div>2019-04-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/8e/9562b0a7.jpg" width="30px"><span>川子</span> 👍（6） 💬（3）<div>老师有没有计划开辟一个专讲ddd的专栏</div>2019-07-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep58epOYWkVaxMIul9hvv0LWWKIYCWAib4ic4nnngvabQMRsP1ials3u4nOYkS8HbsyLvMh7hV0LIsqQ/132" width="30px"><span>desmond</span> 👍（6） 💬（1）<div>&quot;什么，讲了这么多，让我不用微服务?&quot;
&quot;及时止损&quot;对很多人来说，是不可接受的。</div>2019-04-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/7e/83/27fd9c50.jpg" width="30px"><span>ownraul</span> 👍（4） 💬（1）<div>一个很重要的点是, 即便没有DDD的概念, 我们自己的系统也一定需要有自己的业务模型, 任何需求的变化一定都是需要在这个业务模型上最先体现变化出来, 外部和我们系统的交互, 一定是先翻译转换为我们自己的内部模型, 然后再进行逻辑处理, 否则外部依赖源一旦增多, 很多转换会把整个系统代码污染到不想再维护的</div>2019-04-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/f2/2a9a6e9a.jpg" width="30px"><span>行与修</span> 👍（4） 💬（1）<div>老师说的很有道理，我们经常会忽视基本面去谈理想和目标。DDD是一套思维体系，虽然市面上有很好的资料给予我们借鉴，但怎么去定义自己的领域、子域的边界及彼此的交互关联不一而足。周围也有人为微服务而微服务，真要是落在纸面上却无从入手，背后是抽象能力还不足以支撑期望。另一方面是避免过度设计，就如上讲所说淘宝也是演进来的，DDD也不是一步到位的，需求在变要求在变，设计也就需要跟着变。总的说来我觉得就是需要提升抽象能力和做好持续改进的准备，不能操之过急也不能局限于眼下。</div>2019-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3b/03/5dcf4612.jpg" width="30px"><span>Calvin</span> 👍（2） 💬（1）<div>不错的文章，期待后面更多DDD方面的实践例子。
实际工作中很常见到的是做微服务了，但很时候微服务没有很好的模块化，结果还是往big ball of mud的方向写。</div>2019-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg" width="30px"><span>陈斯佳</span> 👍（1） 💬（1）<div>做为一个运维，表示没看懂😭 看来离程序员还有一段很长的距离……</div>2019-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/86/c8/abb7bfe3.jpg" width="30px"><span>君临易道</span> 👍（0） 💬（1）<div>个人感觉ddd还是从技术角度给出的方法论，真正难的是如何有一套业务方法论，先把业务目标 需求给整理和描述清楚，这样ddd才会发挥好作用，有些业务没有很久沉淀理不清弄好乱。</div>2020-07-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg" width="30px"><span>J.M.Liu</span> 👍（0） 💬（1）<div>郑老师，有个问题请教下:微服务应该不应该共享一个所谓的公共二方库common。比如一些枚举类，工具类，DTO类放入这个common库中。如果用common类，那么就增加了服务之间的耦合度，如果不使用，那么又会出现同一个类重复定义的问题。</div>2019-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/28/57/04d13bb8.jpg" width="30px"><span>Java维基</span> 👍（0） 💬（1）<div>DDD 是一本武林秘籍,屠龙宝刀,分场合使用</div>2019-08-22</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJat6pp5AbdicOVBUgPrJicTqkaYC0ZnicrdHb2qHAmvicOJKO3NFH2SczHj7fubVHUKSdRbY9jGCr7SQ/132" width="30px"><span>zangchao</span> 👍（1） 💬（0）<div>之前一直不理解为什么好多人设计都先设计数据库表，这样做到底好不好，觉得不太对又说不出不好在哪。听了老师“面向数据建模”相关描述，恍然大悟，应该明确这样其实是不好的</div>2023-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/4c/dd/c6035349.jpg" width="30px"><span>Bumblebee</span> 👍（1） 💬（0）<div>笔记

即便你学了 DDD，知道了限界上下文，也别轻易使用微服务。我推荐的一个做法是，先用分模块的方式在一个工程内，让服务先演化一段时间，等到真的觉得某个模块可以“毕业”了，再去开启微服务之旅。</div>2022-06-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2024-08-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/33/37/6088a9a2.jpg" width="30px"><span>蜘蛛别过来</span> 👍（0） 💬（0）<div>最近几篇感觉像是对一个抽象的东西的不同面进行讲解，
放在处理事情就是用简单方法处理问题直到复杂
放在技术架构就是把服务放在一个工程内演化，直到需要拿出去变成微服务
个人理解就是厚积薄发，水到渠成，太过刻意的设计反而会更加麻烦，遇到困难就想办法解决，如果是因为有解决办法然后设定了这种情景反而落了下乘</div>2022-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>我推荐的一个做法是，先用分模块的方式在一个工程内，让服务先演化一段时间，等到真的觉得某个模块可以“毕业”了，再去开启微服务之旅。--记下来</div>2022-04-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e9/a6/69907ec1.jpg" width="30px"><span>尔霍</span> 👍（0） 💬（0）<div>如何做好微服务，首先不要做微服务，先做好模块划分，让模块独自演化，等到发展到一定程度后再进行单独部署。使用限界上下文划分好你的模块</div>2022-04-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg" width="30px"><span>aoe</span> 👍（0） 💬（0）<div> 先买本《领域驱动设计精粹 》入门</div>2021-11-27</li><br/><li><img src="" width="30px"><span>whhbbq</span> 👍（0） 💬（0）<div>多谢老师推荐书单。
之前使用过DDD的防腐层设计，为了减少模块之间的耦合，隔离变化。其他概念还需要深入学习，并在实际项目中实践。</div>2019-05-08</li><br/>
</ul>