你好，我是郑晔。

在“以终为始”那个模块，我们留下了一个巨大的尾巴。在“[持续集成：集成本身就是写代码的一个环节](http://time.geekbang.org/column/article/75977)”这篇文章中，我们是站在“以终为始”的角度阐述了集成，尤其是持续集成的重要性。

但怎么做好持续集成，才是很多人真正关心的内容。今天，我们就来谈谈如何做好持续集成。

既然我们打算讨论持续集成，不妨停下来先思考一个问题：你对持续集成的第一印象是什么。

持续集成？Jenkins？没错，很多人对持续集成第一印象都是持续集成服务器，也就是 CI 服务器，当年是 CruiseControl，今天换成了 Jenkins。

也正是因为如此，很多人就把 CI 服务器理解成了持续集成。我就曾经接触过这样的团队，他们恨不得把所有的事情都放在 CI 服务器上做：在 CI 服务器上做了编译，跑了代码检查，运行了单元测试，做了测试覆盖率的统计等等。

或许你会疑问，这有什么不对的吗？

在做软件这件事上，我们不会用对与错去衡量，我只能说，这种做法是可行的，但它不是最佳实践。我希望你去思考，有没有比这更好的做法呢？

想要回答这个问题，我们还是要回到持续集成的本质上去。持续集成的诞生，就是人们尝试缩短集成周期的结果。为什么要缩短周期呢？因为我们希望尽早得到反馈，知道自己的工作结果是否有效。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIFicK7Bn88Lqte7rURlw3Lf53oAu1jhiciaVlKLib48dlIAOAF03L7tjQcx1ia5AJI26S7HIxwx780Qzw/132" width="30px"><span>操盘手爱德华</span> 👍（29） 💬（1）<div>诸位看的时候别忘了，虽然老师说了别人修复之前不能提交。但是后面还有一句，如果一时半会儿修不好，应该撤掉提交</div>2019-12-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/53/ae/a08024b2.jpg" width="30px"><span>Luke</span> 👍（12） 💬（1）<div>郑大文中提到工作中「心流」，在这里想要补充一下：Bob 大叔（Robot. C. Martin）认为「心流」仅适用于练习，而非正式的工作中的编码。「代码整洁之道—程序员的职业素养」中曾提到，开发人员在开发时应该避免进入这种状态，「心流」仅适用于练习，因为它会「将视野收拢到狭窄的状态」。

抄录原文如下：

一些曾经进入这种状态但最终又从中摆脱出来的人给出了一点儿忠告：避免进入流态区。这种意识状态并非真的极为高效，也绝非毫无错误。这其实只是一种「浅层冥想」状态，在这种状态下，为了追求所谓的速度，理性思考的能力会下降。... ... 如果你当时正在做 TDD，你会快速地重复「红&#47;绿&#47;重构」循环。你会收获一种愉悦感或征服感。问题在于，在流态区状态下，你其实放弃了顾及全局，因此，你很可能会做出一些后来不得不推倒重来的决策。在流态区写代码可能会快些，但是后面你将不得不更多地回头重新审视这些代码。</div>2021-06-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/ee/96a7d638.jpg" width="30px"><span>西西弗与卡夫卡</span> 👍（9） 💬（1）<div>有启发。常遇到的问题是，项目多了以后CI资源吃紧要排队。虽然可以自己用本地多做事，但这有点像“公地悲剧”，只是自己节约还不够，会被别人挤占资源，所以大家抢着上，结果大家都慢。如果有智能CI可以依据以往占用资源的多少来分配CI优先级，或许可以缓解。当然，不差钱的话，增加机器可能更简单</div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/22/a0/0e8d56df.jpg" width="30px"><span>孤星可</span> 👍（8） 💬（1）<div>快速反馈这个观点是很赞同的  本地验证这个个人不太看好  以普通 JAVA 项目为例  本地跑一次  耗时以分钟计  这个间隔有点长了 </div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/57/0b/8b2465d6.jpg" width="30px"><span>eyeandroid</span> 👍（4） 💬（2）<div>老师，我的意思是其它人的提交被CI检查出错后只会影响他这笔提交，并不会block其它人的提交，所以并不会存在等待其它人修复这个说法，请教下我的理解对吗？因为我工作中遇到的情况是这样</div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/57/0b/8b2465d6.jpg" width="30px"><span>eyeandroid</span> 👍（4） 💬（1）<div>CI 服务器一旦检查出错，要立即修复。原因很简单，你不修，别人就不能提交，很多人的工作就会因此停顿下来，团队的工作流就会被打断，耽误的是整个团队的工作。

老师，请教下上面这句话我不太理解。我在工作中遇到的CI是针对某笔提交的，某笔提交被CI服务器检查出错只会影响他这笔的提交，其它人可以继续做检查提交。

</div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/50/39/371c9918.jpg" width="30px"><span>Xunqf</span> 👍（2） 💬（1）<div>我们团队比较小，开发流程比较野路子，都是刚毕业的大学生，没多少开发经验，我们目前的开发流程是: 代码用GitHub托管，然后我们也用到了Jenkins，但是作为一个移动开发来说，对Jenkins的了解还仅限于自动打包工具，由于一开始使用的是手动打包，每次打一个包都要费好长时间，后来了解到自动打包，就很公司申请了一台电脑，用Jenkins搭建了一个自动打包服务器，然后定时去GitHub拉取代码打包，打包成功后上传蒲公英，然后发邮件通知下载，还不存在老师说的出错了就影响其他人提交的问题，感觉我们的持续集成是在GitHub上，缺失了测试环节。听老师讲完感觉我们做的太简单了，但是老师说的这些服务公司根本就没有，现有的这么简单的东西还是我们自己抽时间搞的，但是我们的主要任务毕竟是开发公司的业务产品，而Jenkins持续集成服务也非我专长，不太可能花太多精力去做这个。这个时候我该怎么办？</div>2019-03-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f2/f2/2a9a6e9a.jpg" width="30px"><span>行与修</span> 👍（2） 💬（1）<div>如果单元测试做的不到位，或者不满足A-TRIP，是不是执行CI的效果就会弱很多？
另外在持续集成的过程中，测试人员或者QA有可能参与其中吗？如果能参与的话，对他们的意义以及他们的贡献会是什么？</div>2019-03-01</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/I9hE8mC1d1s7WicOLbE00vH4FUzNjH764kJHEdQwPLmLyZyYeubQQdmlCwLRhpRd0eibicqnWH2YP2Cqb2vbfPubg/132" width="30px"><span>笨猪</span> 👍（1） 💬（1）<div>本地执行所有测试有点慢怎么办？
郑老师好，您在文章中提到在本地执行CI服务器相同的动作，那么当执行所有的检查花费时间较久时（比如超过5分钟），那么是不是也是打断了心流呢？这种问题怎么破？</div>2020-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d8/89/96375178.jpg" width="30px"><span>清菊</span> 👍（1） 💬（1）<div>我们遇到的问题是UI测试结果不稳定，这样的话是直接去掉这部分的测试吗？</div>2019-02-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/75/69/791d0f5e.jpg" width="30px"><span>rocedu</span> 👍（0） 💬（1）<div>https:&#47;&#47;weread.qq.com&#47;web&#47;reader&#47;65e328b05e10e265eb76e03  《心流》，微信读书可以免费阅读。</div>2021-02-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/af/07/a32e3f4e.jpg" width="30px"><span>灯火阑珊</span> 👍（0） 💬（1）<div>我目前的公司就是用邮件反馈持续集成结果😅</div>2020-11-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e0/a8/4e739cf6.jpg" width="30px"><span>Sic Pavis</span> 👍（0） 💬（2）<div>本地验证最大的问题，在于不是每个人都能自觉执行，放在ci上可以流程上确保检查执行。</div>2020-08-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/53/9b/d0a21378.jpg" width="30px"><span>时代先锋</span> 👍（0） 💬（1）<div>项目小，开发项目流程不规范</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（0） 💬（1）<div>我一直有一个疑问！很多专栏都提到了持续集成，都表达了持续集成中包含自动化测试，我很想知道如果包含了接口和ui的测试，那么持续集成其实也是包括部署环节的。再就是持续集成服务器是监控主干还是分支和主干同时监控？</div>2019-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3e/fb/51f8dfe7.jpg" width="30px"><span>like_jun</span> 👍（0） 💬（1）<div>要让团队认识到复盘的重要性。
让每个人都深入思考项目运作过程中遇到了哪些问题。才能做好复盘。</div>2019-03-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（1） 💬（0）<div>持续集成要快速有效反馈。本地检查后在提交ci服务器检查。ci服务器绿色时才可以提交，ci运行报错，必须尽快修复。报错可以高调明显，引起人们的注意。</div>2022-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg" width="30px"><span>陈斯佳</span> 👍（1） 💬（0）<div>今天这节课老师真的是解决了我一个在工作上一直在思考的大问题，就是之前一直有个执念，想推程序员使用CI服务器来进行构建，但是发现很吃力，现在才知道，其实更好的方法是让他们先在本地进行构建，等代码检查无误再推到ci服务器上，这样子更加科学。</div>2019-05-30</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/rRCSdTPyqWcW6U8DO9xL55ictNPlbQ38VAcaBNgibqaAhcH7mn1W9ddxIJLlMiaA5sngBicMX02w2HP5pAWpBAJsag/132" width="30px"><span>butterfly</span> 👍（1） 💬（1）<div>公司没有CI的，表示瑟瑟发抖</div>2019-05-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg" width="30px"><span>ifelse</span> 👍（0） 💬（0）<div>学习打卡</div>2024-07-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/fd/58/1af629c7.jpg" width="30px"><span>6点无痛早起学习的和尚</span> 👍（0） 💬（0）<div>我们团队没有在做持续集成，很多时候就是直接框框自己写自己代码，写完所有代码再写单测，然后能把增量代码跑通就行，最后提交代码，说实话我之前也是这样，但是最近学了这个课程，渐渐在养成习惯，写完一个功能代码就写单测跑一跑，但是也发现一个问题很多时候因为功能代码后期变动，单测也变动，工作量有点增加，所以就在纠结这个问题，后期变动主要还是前期没有确定好终</div>2023-06-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1f/9c/fa/0b9d9832.jpg" width="30px"><span>松鼠工作室</span> 👍（0） 💬（0）<div>老师你好，我们团队做的项目很烂很一般，没有用到持续集成这个东西，那么持续集成对我们来说还有必要嘛？如果我想用这个东西来提高我自身的开发效率又应当如何做呢？</div>2022-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/33/37/6088a9a2.jpg" width="30px"><span>蜘蛛别过来</span> 👍（0） 💬（0）<div>我是做游戏开发的，绿色状态才提交这个可太对了😂
配置表各传各的，红上加红，一卡就是一下午</div>2022-07-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/52/0a/65976e95.jpg" width="30px"><span>kougazhang</span> 👍（0） 💬（0）<div>最悲剧的是，CI 服务器配置还不行，经常莫名其妙地卡住。</div>2021-11-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/53/9b/d0a21378.jpg" width="30px"><span>时代先锋</span> 👍（0） 💬（0）<div>打卡</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg" width="30px"><span>丁丁历险记</span> 👍（0） 💬（0）<div>我每天在公司强调的，热手性</div>2019-11-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg" width="30px"><span>丁丁历险记</span> 👍（0） 💬（0）<div>本质是尽早得到反馈，早发现问题。</div>2019-11-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg" width="30px"><span>helloworld</span> 👍（0） 💬（0）<div>可视化CI监视器可以了解下</div>2019-04-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg" width="30px"><span>虢國技醬</span> 👍（0） 💬（0）<div>打卡</div>2019-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg" width="30px"><span>旭东(Frank)</span> 👍（0） 💬（0）<div>持续集成和持续发布是绑定的，这样只要你发布就必须解决集成问题。
持续集成之前的代码合并倒是需要更多的约定和规范，好多时候有人强制提交。

是git分支策略选择，以及代码合并方法也对持续集成有重大影响</div>2019-04-03</li><br/>
</ul>