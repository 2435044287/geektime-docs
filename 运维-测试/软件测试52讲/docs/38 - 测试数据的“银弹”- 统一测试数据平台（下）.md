你好，我是茹炳晟，今天我分享的主题是：“测试数据的“银弹”之统一测试数据平台（下）”。

在上一篇文章中，我和你分享了测试数据准备1.0时代的实践，在这个1.0时代，测试数据准备的最典型方法是，将测试数据准备的相关操作封装成数据准备函数。今天，我将继续为你介绍测试数据准备的2.0和3.0时代的实践，看看创建测试数据的方法，又发生了哪些变革。

在1.0时代，为了让数据准备函数使用更方便，避免每次调用前都必须准备所有参数的问题，我和你分享了很多使用封装函数隐藏默认参数初始化细节的方法。

但是，这种封装函数的方式，也会带来诸如需要封装的函数数量较多、频繁变更的维护成本较高，以及数据准备函数JAR版本升级的尴尬。所以，为了系统性地解决这些可维护性的问题，我们对数据准备函数的封装方式做了一次大变革，也由此进入了测试数据准备的2.0时代。

## 测试数据准备的2.0时代

在测试数据准备的2.0时代，数据准备函数不再以暴露参数的方式进行封装了，而是引入了一种叫作Builder Pattern（生成器模式）的封装方式。这个方式能够在保证最大限度的数据灵活性的同时，提供使用上的最大便利性，并且维护成本还非常低。

事实上，如果不考虑跨平台的能力，Builder Pattern可以说是一个接近完美的解决方案了。关于什么是“跨平台的能力”，我会在测试数据准备的3.0时代中解释，这里先和你介绍我们的主角：Builder Pattern。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/20/fb3861e8.jpg" width="30px"><span>Joie</span> 👍（33） 💬（6）<div>好激动，老师说到的3.0是我在项目中自己摸索总结出来的，上个月已经投产使用，目前在进行优化中，将数据自动生成，case的一些规则都进行分层处理。很棒，方向是对的，继续努力。</div>2018-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（20） 💬（1）<div>怎么觉得最近的文章都是普及概念了</div>2018-09-24</li><br/><li><img src="" width="30px"><span>Geek_723829</span> 👍（11） 💬（1）<div>内部数据库存储的是创建的同类型数据，还是存储的是同类型数据的ID而已，再到真实数据库中取？</div>2019-01-09</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epq90QG0AwMpPBwFMblmAiaaiawyDcF5J0Vlpib6vmqF94zPE7ObrQBINLVAH5bfdOku8N0SskiabfGCA/132" width="30px"><span>silver_mango</span> 👍（4） 💬（1）<div>从移动大会的ppt演讲一直追到这里，受益匪浅。思路非常重要。感谢老师!</div>2018-12-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c3/a9/aa5a5d8b.jpg" width="30px"><span>朝如青丝暮成雪</span> 👍（3） 💬（1）<div>最近数据这块出现了问题，回头有读了一遍。理解了测试数据2.0时代，但是到3.0就不太懂了，我目前的理解是：把准备数据函数抽象成接口，和swagger链接，这样直接通过swagger的图形界面输入要测试的数据，把测试数据写入数据库。是这样吗？麻烦老师回答一下。</div>2019-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4f/28/1f086e9a.jpg" width="30px"><span>rachel</span> 👍（3） 💬（3）<div>思路挺好。但是感觉是虚的、不落地。有源码供研究或更详细的框架设计思路就好了。</div>2018-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/90/f82fb5d3.jpg" width="30px"><span>蜜拉</span> 👍（3） 💬（1）<div>请问，Builder Pattern内部还是操作API或者数据库来造数据的嘛？</div>2018-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/35/50a6adc3.jpg" width="30px"><span>阿嬷</span> 👍（2） 💬（1）<div>如果使用pyrhon开发，是不是就不存在需要封装多个参数组合函数的问题？</div>2019-01-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c5/10/c0e61c5a.jpg" width="30px"><span>一池浮萍</span> 👍（2） 💬（1）<div>挺好的思路</div>2018-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/98/9779cf40.jpg" width="30px"><span>小北</span> 👍（1） 💬（1）<div>Restful API 不推荐使用create 这样的动词命名。貌似应该用put get post 这些表示创建修改的动作。</div>2018-09-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d6/dc/c454588f.jpg" width="30px"><span>痕近痕远</span> 👍（1） 💬（1）<div>涨见识了。</div>2018-09-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f8/92/eaafff96.jpg" width="30px"><span>Amos</span> 👍（0） 💬（2）<div>老师您好，统一数据平台，怎么处理多环境的问题</div>2018-12-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/80/af/e8cae64b.jpg" width="30px"><span>jizi</span> 👍（0） 💬（1）<div>不知不觉看了一大半了，真的受到很多启发，提供的思路也解决了目前工作中的一部分问题，很优质的内容，性价比很高！</div>2018-10-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/20/fb3861e8.jpg" width="30px"><span>Joie</span> 👍（0） 💬（1）<div>今天又看了一遍这个数据3.0的架构，对于recipe data management部分不太理解，是一些数据生成规则的管理吗？</div>2018-09-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/iadiaenjyXjdGj7GGp74D2tHGY2hcDwNKbqW6YDYtIOkFpkBGxKcjoWTFdiak8NwDbCXJH2lia0RYvSD43PfbWaBzw/132" width="30px"><span>shotgun</span> 👍（0） 💬（1）<div>3.0工具哪里有得下载使用？</div>2018-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/af/3d/28b61e6b.jpg" width="30px"><span>假装乐</span> 👍（0） 💬（1）<div>这个平台生成的结果是什么，是直接集成到测试工具上吗</div>2018-09-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/21/cf/f47e092d.jpg" width="30px"><span>咕咕咕</span> 👍（11） 💬（0）<div>非常感谢老师的分享，确实都是干货，但是鉴于自己是小白，很多东西都只是有了一个懵懂的概念。以后能够实际实践并且弄明白的时候再回来打卡。</div>2019-10-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/3b/97/ce00cd8d.jpg" width="30px"><span>coco張</span> 👍（5） 💬（6）<div>原来我们在用的已经是3.0版本了，很庆幸有个非常给力的tools团队</div>2020-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg" width="30px"><span>万历十五年</span> 👍（4） 💬（0）<div>计算机世界的一大法宝：遇到问题加一层，再结合设计模式，来解决数据准备的问题: 数据准备1.0时代是加一层模板模式的封装函数，2.0时代是builder pattern来封装函数，3.0时代是以saas方式封装成api。从1.0时代到3.0时代的这种渐进式的演进，都是要解决当时项目面临的实际问题。</div>2020-10-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（4） 💬（0）<div>有收获！学习文章后，接触了新的概念：Builder Pattern（生成器模式）、Build Strategy、跨平台的能力、统一测试数据平台，虽然自己现在工作还没有要做这样的工作，但是现在知道了概念，以后有需要，就能更加快速想到解决问题的思路。这些问题都是自己从来没有思考过的，阅读本篇文章是大开眼界了。</div>2020-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/48/de/bebd1bf6.jpg" width="30px"><span>SugarZh</span> 👍（4） 💬（3）<div>Build Pattern确实实现了统一封装，方便了调用；但是如果系统业务发生调整，对应的测试数据肯定就要发生改变，那么还是要从新修改Build Pattern底层的实现逻辑；这样的工作也不小啊；
毕竟对于纯互联网公司，业务随时可能发生变化，对应的测试数据的变化，也会带来一定的麻烦。</div>2018-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4c/b0/f22017b0.jpg" width="30px"><span>楚耳</span> 👍（3） 💬（1）<div>老师你文中提到，Core Service 会自动在后台创建一个 Jenkins job 当内部数据库少于20条数据时，自动补足数据，这个内部数据库的数据是用一条就删一条嘛，不然怎么知道只有20条是有效的数据， 还有这个job是循环去扫描数据库嘛，查看是否少于20条数据</div>2019-02-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/c6/d1/ba8a54e7.jpg" width="30px"><span>liangce</span> 👍（3） 💬（0）<div>赞一个，3.0版的核心功能大致已然了解。有好几个问题想继续请教一下：
1.测试数据的元数据具体指的是？
2.架构图中非核心部分
2.1 架构图中后面涉及到的“testdata preparation tool”指的是封装了数据制造api的sdk?
2.2 还有 “testdata validation tool” 指的又是什么？用处是什么？
3.数据质量和数量的管理机制，用哪些指标来度量数据质量？有一些什么样的管理机制？（沉淀有共性的基础数据、服务？下线失败率高的服务？清理历史无用的数据？）
4.关于多环境的问题
（开发环境、测试环境（功能、性能、异常）、预发布、线上），我本以为所有服务都有“环境”这个参数来控制agent我看您的回答中也提到有“数据版本”，版本是针对服务的、还是testcase、还是？能再详细一些介绍一下么？</div>2019-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/1c/e59a699b.jpg" width="30px"><span>海朋森</span> 👍（2） 💬（0）<div>测试数据准备的服务化，其实，是json schema的逆向</div>2020-08-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/22/ba/424be2c8.jpg" width="30px"><span>Geek_p79wqo</span> 👍（2） 💬（0）<div>Builder Pattern 这种模式用其他语言实现就好吧 里面没问题 只是有些时候 人少 真的拉不起来平台化🤦‍♀️</div>2019-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/26/154f9578.jpg" width="30px"><span>口水窝</span> 👍（2） 💬（1）<div>在我学习本篇文章后，对于3.0的看法就是，包装了一套能够顾兼容Java、Python和JavaScript框架的2.0版本，且一直在内部数据库中存储着100条待用的数据，这就减少了数据准备时间。但是基于我对Restful接口和SpringBoot框架不了解，对于3.0的原理还是懵懂的，且后面有点余味尤尽、戛然而止的感觉，不知道茹老师可否进一步扩展呢？</div>2019-05-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（0） 💬（0）<div>高级高级，这篇真的打开了思路，剩下要做的就是想想怎么在自己的项目中落地了~</div>2022-02-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/4a/23/6800a1b6.jpg" width="30px"><span>麥白</span> 👍（0） 💬（0）<div>上家公司目前来说就是3.0模式，但开发平台的人和使用的人沟通不够，对于使用的人来说，很多事业务测试，没有好的说明文档，用起来就很有问题，而且自己本身有很多功能测试需要执行，各种自动化之类的就像是完任务。很多问题吧！开发测试平台的人呢，觉得是功能测试人员不用，不反馈！还有就是开发的配合，接口文档粗糙，测试人员推动不起来，测试环境部署的接口，和线上差别大，但很多接口线上哪怕是单接口测试，项目经理或者测试负责人又怕产生太多脏数据，部署诸如灰度关键啥的，意义也不大，很难推动！需求迭代又很快！各种吧！</div>2022-01-03</li><br/><li><img src="" width="30px"><span>Geek_a451f1</span> 👍（0） 💬（0）<div>格局突然就豁然开朗了</div>2021-09-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/f2/fb/ecae913a.jpg" width="30px"><span>小安</span> 👍（0） 💬（0）<div>咨询一下，建造者模式中 OUT_OF_BOX是什么策略</div>2021-06-05</li><br/>
</ul>