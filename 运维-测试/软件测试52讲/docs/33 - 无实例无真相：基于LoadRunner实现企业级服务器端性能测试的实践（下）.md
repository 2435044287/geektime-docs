你好，我是茹炳晟。今天我和你分享的主题是：无实例无真相之基于LoadRunner实现企业级服务器端性能测试的实践（下）。

今天，我会继续和你分享如何基于LoadRunner完成企业级服务器端的性能测试。通过我上一次的分享，你已经清楚知道了，整个性能测试过程可以分为五个阶段，并且解决了整个测试过程中最难的一部分工作，即如何获取具体的性能测试需求。

现在，我们先来回顾一下，性能测试包含的五个阶段：性能需求收集以及负载计划制定、录制并增强虚拟用户脚本、创建并定义性能测试场景、执行性能测试场景，以及分析测试报告。所以，今天，我们就要解决剩下的4个阶段的问题了。

## 阶段2：录制并增强虚拟用户脚本

我已经在上篇文章中和你提到，完成了性能测试需求分析后，你就已经明确了要开发哪些性能测试脚本。现在，我们就一起来看看开发性能测试脚本的步骤，以及相关的技术细节。

从整体角度来看，用LoadRunner开发虚拟用户脚本主要包括以下四个步骤：

1. 识别被测应用使用的协议；
2. 录制脚本；
3. 完善录制得到的脚本；
4. 验证脚本的正确性。

这里需要注意的是，完善录制得到的脚本这一步，会包含大量的技术细节，也有很多对你来说可能是新概念的名词，所以我会着重讲解这一步，帮你克服性能测试道路上的这些“拦路虎”。
<div><strong>精选留言（21）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/bc/0a/2ac3417a.jpg" width="30px"><span>伪专家</span> 👍（8） 💬（1）<div>现在公司都用jemter，也是jemter2次开发，又叫全链路压测平台</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7d/40/bdcf7fa0.jpg" width="30px"><span>海</span> 👍（4） 💬（1）<div>老师，是否可以写一篇关于性能测试报告的分析和性能瓶颈的定位过程？</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/b8/ec758482.jpg" width="30px"><span>Cynthia🌸</span> 👍（1） 💬（1）<div>对于这篇里面提到的录制脚本等相关工作自己还是比较熟悉的。而对于性能测试的理解和整体把握上还不够成体系。
需要好好琢磨文章，实践，总结，实践。</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/43/f9/555d7aa0.jpg" width="30px"><span>人心向善</span> 👍（0） 💬（1）<div>检查点的作用说白了就是验证正确性，比如拿登录这个点来说：只有当用户成功登录系统后才会出现“welcome！admin”的这种提示，那么检查点就可以以“welcome！admin”这些信息作为check，原因就是因为只有用户登录后才会看到这个提示，不登录是看不到的！如果说页面上实在没有比较容易找到的检查点信息，可以以200 ok为检查点或者是具体返回值信息比如  返回success 0这些信息也可以，不过并不建议这样做</div>2018-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d6/54/3127cab2.jpg" width="30px"><span>赵明月</span> 👍（0） 💬（1）<div>也想看jmeter的</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（0） 💬（1）<div>我看老师好像还是用的LR11，是否从这里可以看出后续jmeter是主流！LR只是利于理解</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/7d/40/bdcf7fa0.jpg" width="30px"><span>海</span> 👍（8） 💬（0）<div>老师所有的文章，一路看过来每次都是意犹未尽，获益良多。这么好的文章，看一遍怎么够呢！非常感谢老师的辛苦用心。</div>2018-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/26/154f9578.jpg" width="30px"><span>口水窝</span> 👍（2） 💬（0）<div>想起4年前在前面一个公司的时候用过，但不知其中的原理，只是依葫芦画瓢，感觉不会写代码，不会百度，执行不起来，不会找原因，然后就没在看了，那时候可羡慕运行起来的高手了，现在在回头看，其实编程也不是很难，关键我们没有找对方向，没有找对下手点，以致于自己一直在这个范围之外彷徨！
  这几年冷静下里，想了想，生娃带娃的两年，逐渐使我慢慢明朗起来，要知道怎么去学，怎么去做。
  感谢茹老师，感谢极客时间。</div>2019-04-26</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIGzSM6be2xCNS00kQYHDgXO3icOoOSsvnz3FiaCov5Kgs6oaXkBicLbicuEerJjiaNPWxB0FTVmdur3kg/132" width="30px"><span>Xiye</span> 👍（2） 💬（0）<div>我们公司没有用Loadrunner，用得是Jmeter。在使用中，会有压力不够的问题，我们用一台机器做控制器，三台或四台机器做Agent端测试，经常一台机器超过200线程，性能就上不去了，检查发现瓶颈在于测试的Agent端。特别是我们项目转到Sprint boot架构下，这个问题就更加明显了。后来其他项目的同事推荐我们使用wrk，确实能提高了不少测试压力。 
对于性能测试，我觉得确实像老师说得最难的是需求的采集，计划的设计，报告的分析，其实脚本编写和工具的使用并不困难。很多时候到底需要什么样的性能测试环境，需要多大的压力，怎么样的压力场景，报告出来之后的结果是不是符合要求，这些才是最困难的。目前我也是从ResponseTime, Throughput, 服务器端的CPU, Memory, IO 来分析。老师，你觉得还有什么需要重点关注的？</div>2018-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/42/f3/db2a6e71.jpg" width="30px"><span>媚风轻扬</span> 👍（1） 💬（0）<div>性能测试感觉测试结果分析才是关键，一般有哪些手段呢</div>2020-03-20</li><br/><li><img src="" width="30px"><span>二马</span> 👍（1） 💬（0）<div>老师，最近用LR11测试HTTPS协议时，脚本始终报如下错误：X509 Certificate &amp; Key combination is either invalid or does not exist!  其中端口映射配置里，上传的证书无问题，选择的SSL version无问题，SSL Ciphers不确认，选择的默认选项，请问是否可能是SSL Ciphers的问题</div>2019-11-14</li><br/><li><img src="" width="30px"><span>二马</span> 👍（1） 💬（0）<div>老师，最近用LR11测试https时，脚本始终报如下错误：X509 Certificate &amp; Key combination is either invalid or does not exist</div>2019-11-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/59/24/0443e6bd.jpg" width="30px"><span>落恒</span> 👍（1） 💬（0）<div>有个个问题想请教一下老师：
有使用过LR12录制过测试脚本，录制的脚本会把所有的请求都自动生成对脚本。想问一下这些请求图片&#47;css样式url的是否会对服务器真实压测结果产生影响，是否需要删除无关的url
</div>2018-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c1/cb/55fef969.jpg" width="30px"><span>Sunshine</span> 👍（1） 💬（1）<div>老师可以介绍一下，如何去实现每隔10s增加100个用户的方法吗？上一篇提的一些场景不太明白如何去做。感谢🙏</div>2018-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/bc/0a/2ac3417a.jpg" width="30px"><span>伪专家</span> 👍（1） 💬（0）<div>测试迷茫</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/bc/0a/2ac3417a.jpg" width="30px"><span>伪专家</span> 👍（1） 💬（0）<div>招聘测试一般条件都要有测试工具开发经验…测试的基础，质量保证…质量度量过程都不是关注点…测试要的基础知识点比开发还要全面…工资待遇…重视程度…从目前的招聘信息对比差距越来越大……</div>2018-09-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg" width="30px"><span>亚林</span> 👍（0） 💬（0）<div>哎，我们公司没有性能测试要求。功能测试还是手工阶段。</div>2022-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（0） 💬（0）<div>以前也就用过LR和Jmeter录制脚本，整出来个性能测试报告。性能需求是拍脑袋定的，报告也不用分析（笑哭</div>2022-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（0） 💬（0）<div>虽然没有做性能测试，不过先学习老师的文章，具体操作没有深究，先留个印象吧！</div>2020-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/2e/01/14a478bb.jpg" width="30px"><span>happychap</span> 👍（0） 💬（0）<div>我们的性能测试脚本一般都采用java vuser协议，在lr的原生api上封装了个小框架，以屏蔽lr的诸多技术细节。用录制方式得到的脚本是c语言的，不好维护，遇到报文加解密和签名验签的场景就更尴尬了。</div>2019-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4a/ee/45ad0496.jpg" width="30px"><span>牛鬼蛇神VS魑魅魍魉</span> 👍（0） 💬（0）<div>晚安</div>2018-09-12</li><br/>
</ul>