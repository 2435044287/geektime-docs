在上一篇文章中，我用Selenium 2.0实现了我们的第一个GUI自动化测试用例，在你感觉神奇的同时，是否也隐隐感到一丝丝的担忧呢？比如，测试脚本中既有测试数据又有测试操作，所有操作都集中在一个脚本中等等。

那么，今天我就通过介绍GUI测试中两个非常重要的概念：测试脚本和数据的解耦，以及页面对象（Page Object）模型，带你看看如何优化这个测试用例。

## 测试脚本和数据的解耦

我在前面的文章中，和你分享过GUI自动化测试适用的场景，它尤其适用于需要回归测试页面功能的场景。那么，你现在已经掌握了一些基本的GUI自动化测试用例的实现方法，是不是正摩拳擦掌准备批量开发GUI自动化脚本，把自己从简单、重复的GUI界面操作中解放出来呢？

但是，你很快就会发现，如果在测试脚本中硬编码（hardcode）测试数据的话，测试脚本灵活性会非常低。而且，对于那些具有相同页面操作，而只是测试输入数据不同的用例来说，就会存在大量重复的代码。

举个最简单的例子，上一篇文章中实现的百度搜索的测试用例，当时用例中搜索的关键词是“极客时间”，假设我们还需要测试搜索关键词是“极客邦”和“InfoQ”的场景，如果不做任何处理，那我们就可能需要将之前的代码复制3份，每份代码的主体完全一致，只是其中的搜索关键词和断言（Assert）的预期结果不同。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/c6/f1/c10797f9.jpg" width="30px"><span>康美之心 淇水之情</span> 👍（30） 💬（3）<div>觉得data provide只是从行为操作上分离了数据的提供方式，没有从根本上解决自动化测试中测试数据本身的稳定性、快速响应变化、数据丢失、数据被修改的这些难点和blocker，比如生产数据库里的数据没半边会导入并refresh测试环境数据库，之前cases里使用的数据都没有了；比如几个小组在一个系统里使用同一个测试环境数据库，A组正在用的测试数据B组也正在用，B组还要把数据改变一下再用，或者B组用完后测试数据已经发生改变了；比如使用的测试数据本身随着时间是有实效性的到，状态会改变的，从active变成inactive的等；觉得自动化测试的其他方面都不是什么大问题，最主要的阻碍就是测试数据本身(特别是在真实的测试环境上时，单元测试不会有这些问题)，想问一下老师，有没有一些好的方法、方式、工具、工程实践来解决上述这些数据本身的问题？</div>2018-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c6/4f/0c215abf.jpg" width="30px"><span>红娟</span> 👍（13） 💬（2）<div>首先 周三的例子通过python+seleniun3实现了，并且还开始在项目中开始了脚本编写。有点小小的成就感
其次，今天课程的关键词 数据解偶，模块化，页面对象  
        数据解偶和模块化我是深有体会的，之前测试项目中有用到自动化，因为是嵌入式设备，所以大多数都是自己写脚本，并没有现成的平台可以用。所以经历很多摸索。一开始是流水账式，后来发现测试用例一多，就无法维护。后来就思考，能不能数据和期望结果是一张表格，测试用例其实就是数据不一样。哇，这一做不得了，测试框架很清晰，测试用例管理很灵活。维护也很简单。效率必须提高。如果早知道有数据解偶这个词就好了😊。会少走很多弯路。
       模块化，是写代码的一个必备功能。特别是像我们大多数是基于c开发，如果没有做到模块化，那维护就如看天书😊
      页面对象，不是太能理解。我感觉像c++里面的面向对象。狗就一大类，小狗，大狗，哈士奇……，那都是基于狗这个基类继承发展出来的不同属性……。

最后 回答问题，关于争议问题？我觉得就如标题所说，效率为王，那个形式好用就用那个。那个对提升效率有用就用那个。</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/27/7ff34a0c.jpg" width="30px"><span>ll</span> 👍（12） 💬（1）<div>更倾向于 页面模型只封装控件，这种方法其实也是模块化思想的深一层应用，控件是页面的更小单元，且一个产品或项目中使用的控件种类有限，但是页面却很多，每个页面控件组合方式又不同，在项目中两种方法多次实践后，将控件单独封装后，页面操作又节约大量的开发和维护成本。</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d0/0b/122f08ee.jpg" width="30px"><span>李真真</span> 👍（11） 💬（1）<div>我一直认为api测试就是接口测试，但是看老师写的貌似有不一样，请问具体有什么区别呢？</div>2018-07-27</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0" width="30px"><span>图·美克尔</span> 👍（3） 💬（1）<div>我觉得一个对象除了要有属性还得有行为。</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a4/19/e09d3529.jpg" width="30px"><span>CoolPanda</span> 👍（3） 💬（1）<div>数据驱动测试的思想不适用于 GUI测试
这个是想说“不仅”适用于GUI吧

</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5c/0f/df1b13e7.jpg" width="30px"><span>阿廉</span> 👍（2） 💬（1）<div>个人感觉分开好一些
提高了粒度
增加了灵活的使用性
（入行新手一个月 仅仅是个人感觉）</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/53/1e/7d098b33.jpg" width="30px"><span>年轻人的瞎折腾^.</span> 👍（0） 💬（1）<div>我们主要做后台服务，大部分都是对接口进行自动化，当多个接口一起运行时，有缓存的影响等，容易耦合，请问后台接口自动化如何解耦？</div>2018-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/db/13/bf8f0ac2.jpg" width="30px"><span>Mafia</span> 👍（0） 💬（1）<div>没有必要在 “传统“这个层面讲很多..</div>2018-07-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/18/cc/50fa3518.jpg" width="30px"><span>hohofugao</span> 👍（0） 💬（1）<div>老师讲讲接口测试，有没有好的实践</div>2018-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d4/84/7f584cb2.jpg" width="30px"><span>杜艳</span> 👍（0） 💬（1）<div>有源代码下载吗</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/b8/ec758482.jpg" width="30px"><span>Cynthia🌸</span> 👍（13） 💬（0）<div>我们之前采用过这样一种设计：
输入数据和要操作的页面元素，都作为数据在外部进行存储，根据不同业务，以用例的形式进行组织并按行存入数据库，一条用例对应有一行记录页面操作，另一行记录输入数据。
然后脚本中封装了一些方法，使得操作页面元素的写法更加清晰可读。这样在数据中就可以直接这样写click（id，“username”）表明是点击id=username的页面元素，当然对于更加复杂的页面元素，也设计了可读性较高的写法表示多层获取，方便用例设计人员编写。
脚本读取这样表示页面操作的数据之后，抽取出层级关系，即可拿到页面元素。
对应的读取输入数据。
因此主要的操作步骤和数据内容都放在外部存储，脚本就不必随着业务用例的修改而修改。
而对于重复的页面操作则使用了子用例的概念，直接按照编号或名称进行调用，避免冗余。
</div>2018-07-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/59/0b/27420fd7.jpg" width="30px"><span>@说了再见</span> 👍（6） 💬（0）<div>我们现在的自动化测试项目每一个 page 都对应一个 PageElement 和 PageOperation 类，前者封装页面元素，后者则是封装页面操作（通过调用 PageElement 中的元素进行定位，操作）</div>2019-07-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/58/49/985d98c8.jpg" width="30px"><span>smallfish</span> 👍（3） 💬（0）<div>老师最后的思考题很有意思，我的答案是，各有各的优缺点，应该根据项目实际进行选择。如果按照所有都封装的方案就是四层结构模型，1.页面封装所有元素，2.封装所有元素行为，3.方法封装所有页面操作流程，4.用例层。主要的歧义就在于第二层和第三层是否有必要存在，如果在页面的行为很多的情况下，第二层和第三层存在的必要性就很大。但基于编写GUI自动化一般是用于回归或冒烟测试，并不会将所有用例都进行涵盖的原则，第三层封装的页面行为方法并不会很多，所以我觉得首先第二层没有存在的必要，第三层可以考虑存在。</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/95/4544d905.jpg" width="30px"><span>sylan215</span> 👍（2） 💬（0）<div>1.数据驱动这个概念太重要了，从上层设计的角度看，数据分离是必须的，但有时候项目时间紧急，为了尽快满足实现，很多人就忽略了这些上层设计，只顾眼前利益，结果就影响了长远利益；

2.页面对象模型，这个名词之前就听说了，但是自己在写 selenium 时并没有进行充分的应用，曾经自己还为了 selenium 自动化设计了 4 层的分层实现逻辑，目前看起来和这个页面对象就是一样的道理，果然有理论性指导实践会更轻松；

3.关于最后的问题，我也觉得不能一概而论，比如我说的 4 层实现（原子操作层、函数层、实现层、用例层），我把登陆操作给放到了函数层，其他的控件操作则都是在用例层，一方面满足了分层和 PO 的要求，另一方面也保证了实现的简化；

以上，欢迎关注公众号「sylan215」一起沟通交流。</div>2019-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/41/e9/586275da.jpg" width="30px"><span>王征</span> 👍（2） 💬（0）<div>我同意对操作进行封装的观点，GUI自动化的其中一个问题就是对页面元素的定位操作耗费很多精力去维护，页面元素的多变性也是导致自动化不稳定的原因之一，对操作进行封装能够减少维护脚本的成本，我觉得还是值得投入的</div>2018-07-27</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/z2eIjB1sQWibfiaFCWH2iaVJd35BVcYEYMfcB3GT7VKNvowFc0od1j2YicyLpvh6By8NibxL1eXVxLDUR8JbvX8iawqA/132" width="30px"><span>Geek_5ed08b</span> 👍（1） 💬（0）<div>个人感觉页面对象把控件和操作封装在一起比较好。因为每类控件从业务上基本只会用到一个操作类型，一般不会超过两个。比如文本框就是输入，按钮就是点击，实在有特殊情况就多定义一个对象就好了，把控件和操作分开封装不太值得。</div>2021-10-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（1） 💬（0）<div>要理解Page Object模型，最好是有编程经验，不然刚开始的时候挺难理解模块化思想，特别是页面多了的时候，不知道是哪个调用了哪个，页面之间的跳转关系，页面之间传递driver。

老师这篇文章是讲得非常清晰了，赞！

按照老师这篇文章，我接触到的老师教授Page Object模型的课程，是在基于模块化的 GUI 测试用例和基于页面对象模型之间，使用了页面对象，但是操作方法内部的脚本可读性问题依然存在。

还有一点，学习Page Object模型时，千万不要直接埋头研究脚本代码，而是要从业务角度来理解脚本代码。</div>2020-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/6b/0d/2ad3a879.jpg" width="30px"><span>刘莹</span> 👍（1） 💬（0）<div>自动化测试脚本在什么时期进行开发？等程序交付验收后吗？</div>2020-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg" width="30px"><span>Maxwell</span> 👍（1） 💬（0）<div>页面方法的封装和调用都在一个文件里面么，还是分开呢？</div>2020-04-09</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLoTzR54OKKhIhPsUZ0N84oViaMf7xia9IickJ0zsicpVMza9gdtegNmN3Bw5EJictRACFcubTp9xpJmRQ/132" width="30px"><span>Geek__c1668bdf82c6</span> 👍（1） 💬（0）<div>我们之前写代码，数据放在单独地文件中，元素定位放在yaml文件中，实现数据和代码分离，不管数据还是页面ui变化，直接修改数据文件和yaml文件就可以了，节省维护成本，另外，我们会对共用功能进行封装，对不同页面进行封装，减少重复代码的使用，提高代码的质量，测试用例直接调用就可以了</div>2019-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/11/831cec7d.jpg" width="30px"><span>小寞子。(≥3≤)</span> 👍（1） 💬（0）<div>个人觉得可以让人工智能介入。利用图像识别。未来这方面是有潜力的。</div>2019-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/50/33/43833f7c.jpg" width="30px"><span>Nick</span> 👍（1） 💬（0）<div>你这里所说的页面对象, 应该就是类似MVVM的ViewModel, ViewModel是应该包含页面的操作</div>2018-10-11</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0" width="30px"><span>图·美克尔</span> 👍（1） 💬（0）<div>争论这个也没啥意思，如果代码写出来是给人看给人维护的关键是代码层级要清晰，注释要到位，结构要合理。其他不影响代码性能功能和使用效率的怎么组织都行啊……</div>2018-07-28</li><br/><li><img src="" width="30px"><span>Geek_72fa19</span> 👍（0） 💬（0）<div>老师&#xff0c;界面讲解图怎么没有</div>2024-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/5c/d5/3de7aed8.jpg" width="30px"><span>岁月如歌</span> 👍（0） 💬（0）<div>希望老师的代码可以直接复制粘贴到本地编辑器</div>2023-04-10</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/TpXzl8Tkc43nScElZibBJDqQ9mUtrrwBhe53w3RRQ3aD4OKMKS8o93BqdLal9DaTz3XTXibIk7kYhAaLFVibqPnWQ/132" width="30px"><span>Geek_9e7b2d</span> 👍（0） 💬（0）<div>Page Object 页面对象</div>2022-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（0） 💬（0）<div>脚本和数据解耦这个之前做接口测试的时候就接触到了，页面对象模型是个新知识点，get</div>2022-02-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（0） 💬（0）<div>对了，还补充一点，老师的伪代码中没有注释说明，其实真实的代码中是要写上注释，方便理解代码。</div>2020-07-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/80/cc/8455c6cf.jpg" width="30px"><span>二进制_1101</span> 👍（0） 💬（1）<div>一直都是页面控件与操作控件封装到一个class里的，因为有属性才有动作，而且我觉得同类调用</div>2020-03-25</li><br/>
</ul>