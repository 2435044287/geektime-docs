你好，我是茹炳晟，今天我和你分享的主题是“从小工到专家：聊聊测试执行环境的架构设计（下）”。

在上一篇文章中，我介绍了测试基础架构的概念，以及早期的和经典的两种测试基础架构。在文章的最后，我提到经典的测试基础架构中采用的Selenium Grid方案，在测试用例的数量持续增加的情况下，会带来集群扩容、Jenkins Job臃肿不堪等诸多问题，因此我们考虑将Selenium Grid迁移到Docker，并且提供便于Jenkins Job管理的统一测试执行平台。

所以，今天的这篇文章，我就会围绕这些瓶颈以及对应的解决方案来展开。

## 基于Docker实现的Selenium Grid测试基础架构

随着测试基础架构的广泛使用，以及大量的浏览器兼容性测试的需求，Selenium Grid中Node的数量会变得越来越大，也就是说我们需要维护的Selenium Node会越来越多。

在Node数量只有几十台的时候，通过人工的方式去升级WebDriver、更新杀毒软件、升级浏览器版本，可能还不是什么大问题。但是，当需要维护的Node数量达到几百台甚至几千台的时候，这些Node的维护工作量就会直线上升。虽然，你可以通过传统的运维脚本管理这些Node，但维护的成本依然居高不下。
<div><strong>精选留言（24）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（6） 💬（1）<div>我觉得可以整合现在大热的k8s实现自动扩缩容</div>2018-10-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/81/d4/e92abeb4.jpg" width="30px"><span>Jecy-8</span> 👍（1） 💬（1）<div>CI-CD这块老师能不能再深入讲解一下，比如有没有用到可视化的工具来集成</div>2018-10-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（1） 💬（2）<div>这一套架构估计能用到的企业也不多了</div>2018-10-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg" width="30px"><span>小老鼠</span> 👍（0） 💬（1）<div>1、你们这个平台是开源的吗？若是我想要份
2、selenium 我不太喜欢，里面问题好多。比如IE浏览器对于复杂页面，比如淘宝、京东首页无法获得元素，同样Chrome、FireFox就没问题</div>2018-11-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/a4/19/e09d3529.jpg" width="30px"><span>CoolPanda</span> 👍（5） 💬（1）<div>不知道老师还会不会继续回复这里的问题？
selenium-grid有个巨大的问题就是原生没有安全性选项，部署之后，所有能访问到console的URL的人都可以直接调用。请问老师是否真的在ebay内部大规模使用了，是自研二次开发了安全借口，还是借助防火墙网关等网络手段来控制访问？
谢谢。</div>2019-07-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/26/154f9578.jpg" width="30px"><span>口水窝</span> 👍（5） 💬（0）<div>看完了演进的过程，有种酣畅淋漓，大快人心的感觉，在技术飞速发展分时代，作者能够把这些事件的东西通过原理的形式展现出来，点赞！再有疑问，对于这些演进的原材料，是从官方文档了解来的吗？</div>2019-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（2） 💬（0）<div>现在的公司用的基础架构和这个很像，但是多了基础用例，配置管理，mock，性能，等。可以算是一个真正的devops平台了！</div>2019-05-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4c/b0/f22017b0.jpg" width="30px"><span>楚耳</span> 👍（1） 💬（1）<div>老师这套环境只能支持基于seleium的ui脚本执行，换其它脚本就行不通了，如果是自己基于python写的接口脚本呢，有什么好的分布式执行框架吗？</div>2019-04-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/d2/54/3fa394b4.jpg" width="30px"><span>无心</span> 👍（1） 💬（0）<div>CI 持续集成，在工作环境中，确实很方便，跟踪项目质量测试结果，敏捷测试 快速的迭代</div>2018-10-08</li><br/><li><img src="" width="30px"><span>Geek_67bb9d</span> 👍（0） 💬（0）<div>我想问一下测试用例的版本化管理 这个版本对应开发代码的版本 是一个增量用例的概念 还是全量呢？</div>2023-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/eb/72/d2156fff.jpg" width="30px"><span>Simon</span> 👍（0） 💬（0）<div>老师，有个疑问想请问下，“测试架构”跟“测试基础架构”是一回事吗？测试基础架构篇学习下来，文章中提到“测试基础架构”是广义上的测试执行环境，那“测试架构”是否包含“测试基础架构”呢？</div>2022-07-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/9b/a5/5df18431.jpg" width="30px"><span>yanzhang</span> 👍（0） 💬（0）<div>docker不是只能部署在Linux上吗？node能启动带UI界面的浏览器吗？</div>2022-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（0） 💬（0）<div>萝卜青菜，各取所需～</div>2022-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/57/a3/4bcf1b59.jpg" width="30px"><span>大宽</span> 👍（0） 💬（0）<div>Selenium Grid 可以用于api 测试吗</div>2022-01-28</li><br/><li><img src="" width="30px"><span>Geek_7a2d06</span> 👍（0） 💬（0）<div>跟我们公司的单元测试基础平台很像，终于理解了</div>2021-11-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e5/f0/fad6bf9e.jpg" width="30px"><span>tongzh</span> 👍（0） 💬（1）<div>Jenkins本身就可以提供Restful API供创建和调度Job，和这里讲的统一测试执行平台上提供的Restful API的功能有何异同？</div>2021-06-25</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/5GQZCecntmOibVjWkMWVnibqXEZhAYnFiaRkgfAUGdrQBWzfXjqsYteLee6afDEjvBLBVa5uvtWYTTicwO2jKia0zOw/132" width="30px"><span>Geek_a4cca6</span> 👍（0） 💬（0）<div>有些脚本案例是不允许并发跑的</div>2020-09-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（0） 💬（0）<div>老师这篇文章把整个测试执行环境架构讲清楚了，原来测试执行环境架构是一路演变，不断完善的过程。
测试用例版本，是一点启发。现在所在项目并没有对测试用例规定版本，代码部署也没有版本概念，都是用缺陷来跟踪，这次部署后哪些缺陷可以验证修复。</div>2020-08-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/15/4b/dc4fb21c.jpg" width="30px"><span>Geek_bd7eb1</span> 👍（0） 💬（0）<div>目前多数还是用的jekens</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/34/8b/de0ea38e.jpg" width="30px"><span>Lily🎵</span> 👍（0） 💬（0）<div>sqlmap支持其他类型的数据库hive、Libra、hadoop这些吗？</div>2019-03-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/53/1e/7d098b33.jpg" width="30px"><span>年轻人的瞎折腾^.</span> 👍（0） 💬（0）<div>想知道ci，cd在这里面扮演什么角色，会在测试框架那个流程使用，可以在哪里看相关内容，最近工作最新有用到</div>2019-01-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/cc/9c/ec71155f.jpg" width="30px"><span>胖虫子</span> 👍（0） 💬（0）<div>一般能用jenkins就狠很可以了，要到最后两层，得很大的企业才行</div>2018-11-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/95/96/0020bd67.jpg" width="30px"><span>夏洛克的救赎</span> 👍（0） 💬（0）<div>如何理解挡板测试呢？  </div>2018-11-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/3c/26/ef973b79.jpg" width="30px"><span>才子</span> 👍（0） 💬（1）<div>老师说的这个，对于接口测试也是这个思路吗？在接口测试中有类似selenium grid的分布式框架吗？</div>2018-10-21</li><br/>
</ul>