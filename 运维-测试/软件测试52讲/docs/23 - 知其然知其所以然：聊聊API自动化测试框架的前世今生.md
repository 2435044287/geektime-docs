你好，我是茹炳晟，今天我和你分享的主题是“知其然知其所以然：聊聊API自动化测试框架的前世今生”。

在上一篇文章中，我以一个简单的Restful API为例，分别介绍了cURL和Postman的使用方法，相信你已经对API测试有个感性认识了。

但是，我们不能仅仅停留在感性认识的层面，还需要熟悉并掌握这些测试方法，完成相应的API测试工作。所以，也就有了我今天分享的主题，希望可以通过对API自动化测试框架发展的介绍，让你理解API测试是如何一步一步地发展成今天的样子，以“知其所以然”的方式加深你对API自动化测试的理解。

接下来，我将会遵循由简入繁的原则，为你介绍API测试框架，以发现问题然后解决问题的思路为主线，展开今天的分享。

## 早期的基于Postman的API测试

早期的API测试，往往都是通过类似Postman的工具完成的。但是，由于这类工具都是基于界面操作的，所以有以下两个问题亟待解决：

1. 当需要频繁执行大量的测试用例时，基于界面的API测试就显得有些笨拙；
2. 基于界面操作的测试难以与CI/CD流水线集成。

所以，我们迫切需要一套可以基于命令行执行的API测试方案。这样，API测试可以直接通过命令行发起，与CI/CD流水线的整合也就方便得多了。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/30/f0/293da3e8.jpg" width="30px"><span>Martin 龚平</span> 👍（77） 💬（3）<div>用postman转python或者java测试脚本还是太慢了，而且需要一定编程技能，感觉已经是上一代了，我现在根据httprunner的yml的脚本规则，加上一些开源的组件，做了一个web页面可以进行代理抓包，测试人员无论从web页面还是app操作只要设置代理过来，就可以看到自己的所有请求，然后选择想自动化的请求，后台自动转成测试脚本，再在管理界面上通过拖拽等性质组装成自动化测试集，并可以执行调试、定时任务等。这样的自动化程度基本对编程技能降到了最低，而且生成测试脚本的成本比上一代低了很多</div>2018-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/b8/ec758482.jpg" width="30px"><span>Cynthia🌸</span> 👍（9） 💬（2）<div>感觉本篇对我最有用的，就是Response结果发生变化时的自动识别这块啊！自己在项目中遇到过类似的问题，虽然采取了一定的措施，但是没有想到作者这个解决方案。准备顺着作者的思路捋一捋，看看把他具体实现一下。</div>2018-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/26/154f9578.jpg" width="30px"><span>口水窝</span> 👍（4） 💬（1）<div>以前有用过locust，但不知道什么原理，就知道能压测，今天查了下可以和httprunner完美组合，先记下来，后面实践。</div>2019-04-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c0/bc/c49e1eaa.jpg" width="30px"><span>静静张</span> 👍（4） 💬（1）<div>老师你好，基于配置文件的api测试，和将数据外化到文件是一回事吗？</div>2018-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/8c/75/cf6bf22d.jpg" width="30px"><span>zhangliqun</span> 👍（2） 💬（1）<div>老师，接口自动化测试我看过robotframeworker接口自动化框架，老师RF框架和您讲的有差异呢？</div>2018-12-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/0f/46/0a7bd737.jpg" width="30px"><span>Yaoqi😀</span> 👍（0） 💬（1）<div>loadrunner怎么没有提及，也可以做api啊</div>2018-08-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4c/b0/f22017b0.jpg" width="30px"><span>楚耳</span> 👍（20） 💬（2）<div>我觉得老师对api的测试都是基于单个api的测试，我是做P2P这块的，公司的api执行后都会去操作数据库，操作各种表，api调用后，需要验证的是各表的字段是否修改正确，这个才是我们验证的重点，我想如果业务复杂的api基本都是跟数据库关联很大，Response的返回值验证都是次要的了。所以我觉得老师这个api测试的讲解不够深入</div>2019-03-22</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/vVHHYQw1kesqK5euoZ52vibmmhWSXdvBqSwed7FfHUx7ULESOnwaq9iaPWPq0KQZpPaHSj6UcLebfUqXDBfGyPuA/132" width="30px"><span>yudi5158</span> 👍（12） 💬（0）<div>response结果变化的自动识别，我目前项目使用了大量的json schema验证 效果还不错</div>2019-03-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d1/ec/8a949eba.jpg" width="30px"><span>不错的葱</span> 👍（12） 💬（1）<div>老师请教两个问题：
1.做api测试时，是否有必要对数据库做验证？比如测试添加接口，添加成功后是否需要逐一验证数据库字段是否正确；再比如，测试获取详情接口，是否需要把接口的返回和数据库中数据做对比验证。
2.引入数据驱动后，对于不同的输入，验证的步骤相差很大。比如：可能有的输入直接验证responseCode即可，而有的输入需要验证更多字段。这种情况应该如何处理呢？由于这个问题，我这里没有使用数据驱动，而是不同的数据写了不同的用例。</div>2018-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8c/95/4544d905.jpg" width="30px"><span>sylan215</span> 👍（8） 💬（0）<div>确实，Postman 作为自测工具或者开发之间的接口对接，还是很方便的，但是涉及批量每日回归执行，或者同一个接口的多参数验证等，稍微有点不方便，这应该也是那么的代码级 API 测试框架出现的原因吧。
相对于自动生成 API 测试代码，我更倾向于配置文件的方式，毕竟通过工具把 JSON 转换为自己需要的格式，说到底也是配置文件而已，只是还要增加一个转换的过程。
Response 结果发生变化时的自动识别，这个很赞，也给我提供了一些思路，目前我都是只校验不变的部分，这样会有覆盖不全的情况，后面我也会考虑这种自适应的实现。

以上，欢迎沟通交流，公众号「sylan215」

</div>2018-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/77/72/8f77ddb0.jpg" width="30px"><span>johnny</span> 👍（5） 💬（0）<div>老师将的逻辑结构严谨、清晰，能够由简入繁，既有实操，又有解决思路，赞。</div>2019-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/da/88/09ccab4a.jpg" width="30px"><span>颜瑞</span> 👍（4） 💬（0）<div>在框架的选择上，茹老师也提了一个开放性问题，Rest-Assured和HttpRunner哪个更合适。其实我也一直在犹豫，自己封装接口，对各个产品线上测试人员有编码的能力要求，另外框架的开发还是需要一定工作量的，HttpRunner少了这些编码成本。HttpRunner还没开始用，疑惑点在于数据准备和环境清理能否在这个框架里面实现，考虑到一些数据准备需要插表，是不是从扩展性和兼容性上讲，企业还是自己开发一套API测试框架的好？茹老师有什么建议么？</div>2018-10-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c5/25/72b513db.jpg" width="30px"><span>向日葵盛開の夏天</span> 👍（3） 💬（0）<div>使用过robotframework进行API测试，一个API测试都需要填写较长的表单，用起来感觉很复杂，冗余，在公司内部也不好做推广。目前，我还是比较喜欢用fiddler+jmeter，感觉使用起来还是蛮方便的，jmeter还可以集成到Jenkins下。对于老师说的自己封装API测试框架，很可惜，待的公司都项目较多的有很多的接口，自己封装API测试工程量太大，都没有实施的。</div>2018-08-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/4c/b0/f22017b0.jpg" width="30px"><span>楚耳</span> 👍（2） 💬（1）<div>老师 能具体讲下在框架中如何实现  可以灵活支持多个 API 的顺序调用，方便数据在多个 API 之间传递

，即上一个 API 调用返回结果中的某个字段值可以作为后续 API 调用的输入参数 这个需求吗 讲下设计思路</div>2018-09-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/1f/d3/6a108d88.jpg" width="30px"><span>Gavin</span> 👍（1） 💬（2）<div>现在的测试人员对编码能力有一定要求了，不会代码做起来真的有些吃力。
举个很简单的例子，懂Java代码在看Jmeter时使用BeanShell可以直接使用脚本，去获取请求中的参数并传递给下个请求使用，自己写不出来只能通过正则表达式或者JSON提取器，把值取到再在下个请求中引用，效率上感觉就差了一截...</div>2020-04-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/15/4b/dc4fb21c.jpg" width="30px"><span>Geek_bd7eb1</span> 👍（1） 💬（0）<div>数据校验也是接口测试的部分</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/22/ba/424be2c8.jpg" width="30px"><span>Geek_p79wqo</span> 👍（1） 💬（2）<div>自己搞了个 Python的api测试框架 基于yml配置的 随着业务改变框架功能 用起来还是挺好的 只是测试效率 不是特别高 由于自己写的 集成在 Jenkins 上也还好 总之 有轮子用轮子 不符合自己再改造就好</div>2019-10-21</li><br/><li><img src="" width="30px"><span>woJA1wCgAA2rguK0gcn0mXikQxdX_yxQ</span> 👍（0） 💬（0）<div>1.返回格式校验可以用jsonschema来做吧。
2.基于yml等配置文件等自动化其实也是换汤不换药的东西，工具等原理都是提供一些关键字做编排，然后生成固定的数据格式，然后去解析这样的固定格式的数据，基于配置只是省略了中间关键字编排的步骤。和所谓的excel数据驱动其实还是类似的。感觉目前没啥太划时代的工具出现</div>2022-04-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/07/36/d677e741.jpg" width="30px"><span>黑山老妖</span> 👍（0） 💬（0）<div>httprunner + locust 做自动测试的框架 。这个以后要试试。</div>2022-01-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（0） 💬（0）<div>逻辑清晰，简单易懂，就是实操对我来说有点困难。慢慢加油吧~</div>2021-12-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/ba/fb/a52f97ab.jpg" width="30px"><span>Leefon Zhou</span> 👍（0） 💬（1）<div>&quot;Response 结果变化时的自动识别&quot;这个不太理解，我们现在是这样的，每个case有个base值，每次执行这个case获得的response会跟这个base值做比较，有差别的话这个case就失败了。如果base没有修正，案例会一直是失败的。按照茹老师的介绍，response每次与上一次得到的response做比较，还是没有理解这样做的好处，麻烦指点下</div>2021-04-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/dc/33/a68c6b26.jpg" width="30px"><span>捷后愚生</span> 👍（0） 💬（0）<div>学习文章后，收获的新概念：
API 的后向兼容性
“Response 结果变化时的自动识别”技术。

response结果变化的自动识别，有json schema自动校验。每次运⾏的时候⾃动保存当前的schema，下次运⾏对⽐上次的schema如果发现变更就报错。</div>2020-07-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d1/37/e087a4ee.jpg" width="30px"><span>丹</span> 👍（0） 💬（2）<div>Response 结果发生变化时的自动识别   这个具体是怎么实施的能不能讲讲</div>2020-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1d/f7/15257efb.jpg" width="30px"><span>雨2333</span> 👍（0） 💬（1）<div>locust+httprunner，可以试一试</div>2019-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/55/26/154f9578.jpg" width="30px"><span>口水窝</span> 👍（0） 💬（0）<div>有了理论支持，后续每个阶段的工具都实践起来！</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/9d/17/650175f3.jpg" width="30px"><span>🐶 🐶</span> 👍（0） 💬（1）<div>使用httprunner做API自动化测试时，数据准备这块需要额外开发吗？ </div>2019-02-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/33/01/f7eb19f1.jpg" width="30px"><span>阿森</span> 👍（0） 💬（0）<div>有了api自动化集成测试平台，还要代码生成工具有啥用，restassured其实也是在httpclient上封装的，他不仅能发请求，还能断言</div>2018-12-01</li><br/><li><img src="" width="30px"><span>农夫山泉</span> 👍（0） 💬（0）<div>问下老师，现在用python3写接口自动化，用哪个框架最好</div>2018-10-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg" width="30px"><span>小老鼠</span> 👍（0） 💬（0）<div>在中小型公司有无必要引入了response 变化工具吗</div>2018-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg" width="30px"><span>Robert小七</span> 👍（0） 💬（0）<div>现在项目都是手工测试，如何将手工测试和接口测试相结合？也就是测试同学既要做手工也要做自动化如何开展！</div>2018-10-25</li><br/>
</ul>