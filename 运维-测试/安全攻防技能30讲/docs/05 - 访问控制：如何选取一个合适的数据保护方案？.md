你好，我是何为舟。

在上一讲中，我们主要从身份认证的场景和威胁上，对身份认证进行了介绍。同时，身份认证的核心问题是身份管理，因此我们可以采用单点登录的形式，来解决复杂的身份管理问题。常用的单点登录方式包括CAS流程、JWT、OAuth和OpenID。

那听了你对身份认证的规划之后，面试官觉得很满意，接着又问道：“既然身份认证都做到这么好了，是不是就不需要所谓的‘黄金法则’了？有了身份认证，还需要授权和审计做什么呢？”

对于这个问题，你肯定要先给出否定的回答，这个很显然。接着，你可以说：“通过身份认证，我们只能够确认用户的身份，而对用户的操作和访问行为的把控，就是授权和审计的任务了。”

接着，面试官又发问了：“我理解身份认证和授权的区别了。目前，我们公司的授权机制比较随意，基本就是有什么需求就做什么。如果是你，你会怎么优化授权机制呢？”

那这一讲中，我们就来介绍几种常见授权机制的概念和原理，以及在实际工作中我们该如何去选取合适的保护机制。这些通用的机制学习起来可能比较抽象，但“磨刀不误砍柴工”，理解了宏观上的知识基础，对我们后续学习各类具体的防御机制会有很大的帮助。

我个人认为，“授权”和“访问控制”其实是同一个概念，都是允许或者禁止某个用户做某件事情。现在行业内普遍用“访问控制”这个术语来讨论相关问题。因此，后续我们都会用“访问控制”来替代“授权”。如果你看到了这两种说法，知道它们是一个意思就可以了。
<div><strong>精选留言（28）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/17/18/a0/cf26f9f2.jpg" width="30px"><span>rock_</span> 👍（39） 💬（5）<div>MAC那的机密性不能低读、高写；完整性不能高读、低写，没太懂</div>2020-01-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg" width="30px"><span>tt</span> 👍（16） 💬（1）<div>最近一直在做统一认证和单点登录的事情，还有第三方API访问认证、授权（访问权控制）的事情，自己也查了好多资料，但经过老师的梳理，所有的东西一下子结构化、调理化了好多。

在做设计方案的时候，虽然最终方案八九不离十，但始终有一种朦胧感，和领导（而不是面试官，哈哈）汇报方案的时候也总是眉毛胡子一把抓，一会儿讲数据，一会儿讲现学现卖的攻击方法，一会儿讲到SESSION、TOKEN和CORS。

有了老师给的框架，这下方便设计和汇报了。从数据和防范给领导切入，在往回说如何授权（内网采用基于角色的访问控制，公网还要加上DAC），最后落实到该选取外网基于OAuth+自有应用状态、内网基于自有token+各内部模块维护自有状态的方法。</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/87/62/f99b5b05.jpg" width="30px"><span>曙光</span> 👍（14） 💬（2）<div>“为了保证完整性，MAC 不允许高级别的主体读取低级别的客体，不允许低级别的主体写入高级别的客体。”这个我没理解，既然是高级别的主体，为什么不能看低级别的内容呢？不能看到所有信息，还完整么？</div>2020-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/51/50/f5f2a121.jpg" width="30px"><span>律飛</span> 👍（5） 💬（1）<div>在设计授权机制前，需要先对需要安全保护的数据和访问控制的场景是什么。接着明确请求的发起者、请求的接收方、主体对客体进行的操作。根据实际需要，对DAC、role-BAC、rule-BAC、MAC进行组合选择使用。例如先根据role-BAC进行基于角色的访问控制，然后根据需要使具有管理员权限的DAC用户可以控制自己的文件能够被谁访问，再细化需求，判定是否需要MAC让主体和客体被划分为“秘密、私人、敏感、公开”这四个级别，</div>2019-12-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/e6/92/db9a2fcf.jpg" width="30px"><span>鸵鸟</span> 👍（2） 💬（1）<div>从MAC授权机制来看，如果需要同时保证机密性和完整性，那么不同安全级别的主体只能访问相同安全级别的客体。请问可以具体描述一下这两个点嘛？不是很理解</div>2019-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg" width="30px"><span>JianXu</span> 👍（1） 💬（1）<div>老师，关于审计日志，我们公司是有专门的中央日志系统的，这样各个系统把日志写入中央日志系统，查阅的人就会很方便，因为他不需要到各个系统里去看日志了。但是中央日志系统是不保证一条日志都不丢的，也就是中央日志系统的设计初衷是为了方便开发人员排查问题，而不是为了做审计。那是不是我就得做两套系统呢？感觉很浪费的样子。</div>2020-09-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg" width="30px"><span>honnkyou</span> 👍（1） 💬（1）<div>老师，【完整性不能高读、低写】这句不是很理解，能再多说两句吗？
</div>2020-05-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/01/d7/f835081c.jpg" width="30px"><span>bin的技术小屋</span> 👍（1） 💬（1）<div>老师，你们风控系统中的规则引擎大概是用什么实现的，我之前是用drools搞了一版，后来觉得觉得过于繁重，又用groovy弄了一版，把规则直接配置成动态脚本，实现热更新。还有在规则引擎的设计上除了要考虑规则的动态更新，版本，执行明细。可回溯，审计日志，这些特性，还需要考虑哪些方面呢？能否简单分享下你们的规则引擎大概得设计思路？</div>2020-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/89/e6/ab403ccb.jpg" width="30px"><span>boyxie</span> 👍（1） 💬（1）<div>大家对于数据权限的设计有没有什么最佳实践呢，我们现在是各数据冗余用户ID和机构ID，在操作数据时加上相应的SQL过滤各个ID，不知道有没有更加解耦的方式</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/12/15/874b9d62.jpg" width="30px"><span>Zhen</span> 👍（1） 💬（1）<div>条例清楚，特别是脑图把各个知识点总结的很清晰，赞!
另外，这里主要举的是网络安全的例子，其框架也可以应用到手机安全中。比如，认证阶段，不仅要通过口令、指纹、人脸等验证用户是否合法；另一方面，网络还需要验证手机是否可信是否安全；在授权或者Access control方面，SELinux&#47;SEAndroid也是基于MAC机制的，哪些资源可被哪些进程以哪种方式访问，都预先标记设置好了；如果需要在手机上播放加密流媒体，也会有DRM方面的鉴权解密操作，保证视频被安全的访问。</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/99/f0/d9343049.jpg" width="30px"><span>星亦辰</span> 👍（1） 💬（1）<div>数据库授权是DAC，限定自己的数据库可以被哪个服务器的哪个用户访问。
Iptables 是 rule back 根据来源 去向判断数据去留。

应用系统后台里应用最多的是 role bac。

某些机房的ACL属于 MAC 吧，强制策略。</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d0/78/a11a999d.jpg" width="30px"><span>COOK</span> 👍（0） 💬（1）<div>审计部分有没有什么比较好的工具或方法论</div>2020-03-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg" width="30px"><span>ZeroIce</span> 👍（0） 💬（1）<div>基于角色，基于规则，基于标签。似乎都是为了分类。例如：对于什么角色分配什么权限，也就是相当于给他打了个标签。两者由散变为汇总分类。基于角色=基于标签？有什么区别？不太理解这个问题</div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg" width="30px"><span>小晏子</span> 👍（0） 💬（4）<div>有个疑问请教老师：系统基于白名单的访问方式能划到哪一个类里呢？</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/fa/dd/f640711f.jpg" width="30px"><span>哈德韦</span> 👍（1） 💬（0）<div>请问一下对于那种数据级别的权限管理，一般业界采用哪种机制（或者哪几个组合）呢？比如一些报表，不同的人能够看到的字段是不同的，这怎么设置？ 我还看到有 Attribute-Based Access Control，适合在这种场景下使用吗？</div>2022-09-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg" width="30px"><span>MJ</span> 👍（1） 💬（0）<div>调理清晰 大赞</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg" width="30px"><span>Cy23</span> 👍（1） 💬（0）<div>首先根据role-BAC进行基于角色的访问控制，然后根据需要判定是否需要DAC用户可以控制自己的文件能够被谁访问，再细化需求，判定是否需要MAC让主体和客体被划分为“秘密、私人、敏感、公开”这四个级别，</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/39/d0/82/791d0f5e.jpg" width="30px"><span>大将</span> 👍（0） 💬（0）<div>威胁评估是否改成风险评估更为合适和恰当。威胁应该更说明的外因，但是里面还有一个步骤是识别漏洞，漏洞应该是脆弱性，也就是内因的一部分</div>2023-11-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg" width="30px"><span>怀揣梦想的学渣</span> 👍（0） 💬（0）<div>对MAC那部分的讲解没理解，感到困惑，不知道它和规则的那种有啥区别</div>2023-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f2/29/829f321f.jpg" width="30px"><span>smallFive55</span> 👍（0） 💬（0）<div>一般在业务系统中使用role-BAC来满足对公司内部的访问控制，使用rule-BAC来满足对外部用户的访问控制。
题外话：中小型企业中role-BAC的执行往往不能严格按照角色来控制，很多时候为了简化业务流程，会给一些用户分配额外的指定权限，而这些额外的权限又不好作为一个小的角色来配置，就会是的整个账号、角色、权限体系变得非常复杂~</div>2023-04-13</li><br/><li><img src="" width="30px"><span>黄福超</span> 👍（0） 💬（0）<div>多种授权的组合，根据数据的重要性来选择不同的授权模式，
每个授权都会设计一定的授权时间。明确的授权范围，并且加上授权的人的操作日志和埋点日期。
主要是用role-BAC 和rule-BAC  role比较简单都会设置比较短的授权时间，过时间之后重新授权，rule-bac比较耗性能</div>2022-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/17/1a/407bb918.jpg" width="30px"><span>🎶吾</span> 👍（0） 💬（0）<div>识别数据，识别攻击，识别漏洞，这句话点醒了我，最近公司也在做安全防范，但感觉一直没抓不住重点，现在有了新的认知，有思考的方向了</div>2020-09-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/7e/a4/222287bc.jpg" width="30px"><span>Asherah</span> 👍（0） 💬（0）<div>努力学习，看的似懂非懂，可能因为我不懂数据</div>2020-06-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d0/78/a11a999d.jpg" width="30px"><span>COOK</span> 👍（0） 💬（0）<div>授权四种模型，用得比较多的还是第二第三种</div>2020-03-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/e3/d7/d7b3505f.jpg" width="30px"><span>官</span> 👍（0） 💬（0）<div>威胁评估，在目前大数据的时代，漏洞和攻击感觉已经是老生常谈的问题了，我觉得识别数据的重要性还是被低估了。在AI模型的学习和你和上其实需要大量高质量的数据来“喂”算法模型。如果这些数据被窃取而背其他竞争对手所利用，感觉公司得整个竞争力都会下降。
而考虑自己之前更多的接触到ERP软件的开发，大部分都是以role-BAC为核心的系统，虽然能防外寇但是有时候还是防不了内鬼，也许随着系统的规模扩大，role-BAC和rule-BAC的模式或许更适合大型复杂的ERP系统作为访问控制机制
</div>2020-03-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/b7/c6/839984bc.jpg" width="30px"><span>周</span> 👍（0） 💬（0）<div>对于一个用户或者访客，最小权限原则很重要</div>2020-01-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（0） 💬（0）<div>      &quot;威胁评估&quot;这个如何去做其实是根源：通过威胁评估从而做好风险防范。访问控制的根源其实是由于威胁评估而引发的：我觉得我们可以这样去理解，由于有这些威胁评估故而我们要去做访问控制。
      举个例子：家里&#47;企业如果不装门和锁，可能任何人都能进入；如果天下无贼当然可以不控制-不过现实不可能，因此我们才需要各种各样的门。
     老师今天的课程其实吧威胁评估放到访问控制前面更好理解和解答今天的问题。迟到的补课，刚忙完其它，后面持续跟进学习和答题，从而更好的掌握知识。谢谢老师的分享。</div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg" width="30px"><span>追风筝的人</span> 👍（0） 💬（0）<div>dac    由用户进行授权控制</div>2019-12-18</li><br/>
</ul>