你好，我是何为舟。

从这一讲开始，我们讨论Linux系统和应用安全。我们知道，在开发一个应用的过程中，需要涉及代码、操作系统、网络和数据库等多个方面。所以，只是了解代码安全肯定是不够的，我们还需要了解常见的基础环境和工具中的安全机制，学会通过正确地配置这些安全机制，来提升安全保障。

谈到Linux，我相信你每天都在使用Linux进行各种开发和运维操作。但是，大多数情况下，公司不会给每一个员工分配专有的Linux服务器，而是多个开发和运维共用一台Linux服务器。那么，其他员工在使用Linux服务器的时候，会不会对我们自己的数据和进程产生影响呢？另外，我在Web安全中讲过，黑客可以通过很多漏洞控制Linux服务器，那我们又该如何避免和控制黑客的破坏呢？

## 如何理解Linux中的安全模型？

要解决这些安全问题，我们首先要了解一个安全模型，Linux的安全模型。

我们先来看一下Linux的构成，Linux可以分为内核层和用户层。用户层通过内核层提供的操作接口来执行各类任务。

内核层提供的权限划分、进程隔离和内存保护的安全功能，是用户层的安全基础。一旦内核安全被突破（比如黑客能够修改内核逻辑），黑客就可以任意地变更权限、操作进程和获取内存了。这个时候，任何用户层的安全措施都是没有意义的。
<div><strong>精选留言（17）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhuGLVRYZibOTfMumk53Wn8Q0Rkg0o6DzTicbibCq42lWQoZ8lFeQvicaXuZa7dYsr9URMrtpXMVDDww/132" width="30px"><span>hello</span> 👍（15） 💬（2）<div>请教老师，您说的“为了避免进程漏洞，适当的通过 iptables 进行访问限制，也能够起到不错的保护效果”，这句话不太明白，能否例举一两个事实应用的例子，多谢！</div>2020-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/b2/d2f03436.jpg" width="30px"><span>Chaos</span> 👍（8） 💬（1）<div>通常 Linux 发行版都会使用 User Private Group scheme 来创建用户（默认行为），也就是创建用户时，会创建一个同名的组，用户是这个组唯一成员，这个很多人不知道为什么。有兴趣的可以延伸阅读，看一下「为何 Unix-like 系统采用 User Private Group 方案」。开始用 Linux 时红帽系和 Fedora 已默认使用 UPG 方案，且基本是个人使用 Linux 桌面，没有多人使用服务器的情况，所以对 UPG 之前系统管理员所经历的权限管理菊花之痛理解不够深刻，这篇讲得很清楚，推荐阅读： https:&#47;&#47;twitter.com&#47;terrywang&#47;status&#47;1259661708223606784

原文 https:&#47;&#47;security.ias.edu&#47;how-and-why-user-private-groups-unix

另外善用 sudo 尽量不用 root 用户本身。

用容器之后，尤其是用 Docker 实现的话，会存在 rootless container 的 concern （目前只有 Podman 能解决问题）这个没有覆盖到 ;-)</div>2020-05-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（6） 💬（3）<div>我们为什么可以那么相信Linux内核呢？Linux内核就一定是安全的吗？ 我们使用的Linux镜像有可能也像Windows一样被事先植入后门之类的吗？ 还有如果Linux本身不可信的话，我们检测Linux是否安全的方法是不是也行不通了呢？</div>2020-01-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg" width="30px"><span>humor</span> 👍（2） 💬（1）<div>老师好，您说“我们普通的Linux使用者通常是没有能力和精力去关注Linux内核的安全”，那么对于Linux内核的安全，业界或者大公司会有专业的团队来检测Linux内核的安全吗？如果有的话，是不是就意味着只要是在官网发布的Linux镜像，我们普通的开发者就可以认为Linux是安全的了呢？</div>2020-02-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg" width="30px"><span>小晏子</span> 👍（2） 💬（4）<div>我的留言居然丢了…再写一下，
曾经使用过的linux服务器极少会用root账号登陆，系统管理员不会分配这个权限的，但是却有sudo用户权限，感觉sudo用户权限也是很高的权限了，个人认为给很多用户分配了sudo权限也是不安全的，应该限制，按照“最小权限”原则，应该区分用户权限，如果用户有安装软件需求，那就提交申请，不过这样会比较麻烦。</div>2020-01-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/24/b3/3dbdb243.jpg" width="30px"><span>弹弹君</span> 👍（1） 💬（1）<div>针对公司很多服务器的情况，使用Ansible这类工具批量管理密码策略，iptables，日志等，是常见的做法吗？</div>2020-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg" width="30px"><span>Cy23</span> 👍（1） 💬（1）<div>加深印象，看来我还差很多啊，基本上都给root权限了</div>2020-01-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg" width="30px"><span>大坏狐狸</span> 👍（0） 💬（2）<div>《鸟哥私房菜》里面说可以进入目录是由w 写的权限来控制的。</div>2020-03-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/96/d2/ed0f408b.jpg" width="30px"><span>Teresa</span> 👍（0） 💬（1）<div>nobody可以理解成访客登录吗？</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg" width="30px"><span>小老鼠</span> 👍（4） 💬（0）<div>老师，咬字要清楚</div>2020-01-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg" width="30px"><span>怀揣梦想的学渣</span> 👍（0） 💬（0）<div>2FA是否可以看作是当前的最佳实践呢</div>2023-06-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/5b/c3/eb099200.jpg" width="30px"><span>こ蘫铯迗悾</span> 👍（0） 💬（0）<div>请教老师，web应用防火墙和iptables是什么关系？如何配合才能起到更好的防护数据安全，老师可以讲讲或者举个例子 谢谢</div>2022-09-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/79/7e/11d3bb67.jpg" width="30px"><span>莫非</span> 👍（0） 💬（0）<div>可以讲下seLinux么</div>2021-05-16</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIovFO0icqOWLYEsN7IOCJRA8H7IXZQmYIyJdpaIBIsC0aL9lOfm2SkGlGvg6ZFDFZeBCMZ1Dfibxow/132" width="30px"><span>FreyZhi</span> 👍（0） 💬（0）<div>写的不错，受教</div>2021-02-26</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTqaqppkyn9avZHqCnONVJ2Cwp9fmr7yQqUB8icRMFgCbYEHPAyogHqfYjgKPQBteKxnEKQHJzDmQ/132" width="30px"><span>Geek_60821e</span> 👍（0） 💬（0）<div>selinux没提到，在什么场景中用呢？</div>2021-02-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/e3/d7/d7b3505f.jpg" width="30px"><span>官</span> 👍（0） 💬（0）<div>目前服务器好多情况下，运维组的成员直接就是root登录，感觉很不安全，还是应该把用户分开，做好文件和目录访问控制。</div>2020-03-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（0） 💬（0）<div>切换到nobody用户去执行确实是个非常实用的招数：学到了一招了；其它方面之前做的还算可以。</div>2020-01-09</li><br/>
</ul>