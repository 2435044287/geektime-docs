你好，我是何为舟。

上一讲，我们一起拆解学习了CIA三元组，也就是机密性、完整性和可用性。它们分别代表了数据的“不可见”“不可改”和“可读”。简单来说，以购买极客时间专栏为例，机密性就是未付费用户无法学习这个专栏，完整性就是这个专栏的内容不会变成别的其他方向的内容，可用性就是你作为付费用户，能够随时学习这个专栏。

理解了CIA，上一节最后面试官问的“安全是什么”的问题，你现在一定可以回答出来了。面试官点点头，接着说道：“你觉得该怎么去解决安全问题呢？”

毫无疑问，不同的应用、不同的模块会受到不同的安全威胁，当然，我们面对这些威胁也会有不同的解决方案。万变不离其宗。正如安全威胁都是针对CIA三元组产生的攻击一样，安全解决方案在根本思路上也都是相通的。

今天，我就从方法原则这个层面上，来给你讲讲安全解决方案的主要思路。这块内容看起来比较偏理论，我尽量多从实践角度来给你讲我的理解，但是你一定要耐心看完，这样可以确保你对后面实践的内容能够理解得更加深入。

## 什么是“黄金法则”？

对于安全解决方案来说，不同的教材会有不同的解释。就我个人而言，我比较喜欢“黄金法则”这种理解方式。下面我就用这种方式来具体给你讲讲。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg" width="30px"><span>ZeroIce</span> 👍（22） 💬（6）<div>老师，可否问个问题：一般登陆验证采用的是oauth2的验证码模式。但是在发送表单（登陆信息）的时候虽然是post，但是依然可以通过抓包获取，查看密码。请问一般怎样处理，即使被捕获了，密码还是看不到？前端那边加密的话，别人一看源码就知道了怎样加密或者获取密钥了。此问题比较困惑我，望老师解答一下。</div>2019-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg" width="30px"><span>小老鼠</span> 👍（7） 💬（1）<div>IAAAA与CIA有无对应关系？另外安全性与易用性永远是一对矛盾体吗？</div>2019-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/24/4d/29a93491.jpg" width="30px"><span>niuniu</span> 👍（6） 💬（1）<div>为什么说“我知道什么”是强度最弱的认证手段？有些书认为这是最强的认证手段，而“我是什么”是最弱的。我觉得还是有道理的，因为“我是什么”是无法改变的，而我知道什么是变化莫测的，只要有共产党员钢铁般的意志，即使是严刑拷打也无法得到他知道的。</div>2019-12-17</li><br/><li><img src="" width="30px"><span>fgdgtz</span> 👍（5） 💬（7）<div>你好老师，关于APP与服务器沟通安全我有个问题，望老师能解答。

api请求认证或加密一般都有key等，硬编码在APP，而APP有被反编译的风险，放c++ 编译成SO库，虽加大了安全系数，但黑客可直接用这SO库即可，而调用的逻辑，反编译代码里也有，如何安全存储？</div>2019-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/a6/9b/20b9fce3.jpg" width="30px"><span>攻城狮Ra</span> 👍（5） 💬（2）<div>  目前公司主要是通过加密服务器进行进行认证和授权，通过企业微信在网上办公，工作文档也都是上锁的，由于职务限制审计目前还没接触到，可以说句题外话，公司今天正好停电了，发电机发电之后服务器还是一直连接不上，运维修了半小时才好，可能是服务器老式。
  我觉得应该由部门BOSS跟上级反应，最好跟员工再简单培训下，公司现在纯IT的其实就2-3人，我实习进来的希望可以好好补补这方面知识</div>2019-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/1d/76/62c8df21.jpg" width="30px"><span>link</span> 👍（4） 💬（4）<div>银弹效应：妄图创造某种便捷的开发技术，从而使某个项目的实施提高效率。又或者指摆脱该项目的本质或核心，而达到超乎想象的成功。银弹在现实生活中是指能够解决棘手项目或者一件不可能的事情的方法或者技术手段。</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/99/f0/d9343049.jpg" width="30px"><span>星亦辰</span> 👍（2） 💬（1）<div>大佬解释下，双因子认证是什么意思 ？解决的是什么问题。 认证，授权，审计除了依靠日志还有没有别的办法？</div>2019-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg" width="30px"><span>JianXu</span> 👍（1） 💬（2）<div>老师，你怎么看谷歌BeyondCorp 项目，国内有公司搞零信任网络吗？如果不搞，那原因是什么呢？我很想知道哪里有类似于这样的分析：渗透类型1, 用A 这类方法做防御；渗透类型2, 用B这类方法做防御...  而现在我能看到的是 我们公司做了password less 的应用（这个我能理解）正在做IAM IDM 去apply 所有的应用，现在副总再说要做micro segmentation , 问题是我看到了一堆堆的工作，却不知道具体怎么来防治渗透。就跟让一个没有坏人道行高的人去抓坏人。</div>2020-08-27</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJibvQ9Dpib9EbP5P4OPIPDMcNW8dZGcAo5hhyKpm5uOibjIQz51M60U6c0V7Giaw4ic166ymjmsC3QTibg/132" width="30px"><span>吕作晶</span> 👍（1） 💬（1）<div>3A或者IAAAA原则是流程维度的东西，而CIA是目标维度的东西~两者是相互垂直的两个维度，相辅相成。而我现在所在的公司其实已经投入了大量的人力物力在做安全这块，每个季度都有培训和考试，每个月都有安全xxx的邮件提醒，所以感觉后续要做的事情不是如果让领导觉得我们需要做安全，而是让员工觉得这么多安全相关的动作是值得的。而不是疲于应付。目前其实没有很好的思路，因为感觉大家基本上都还是怕出事，那么跟着内部流程和标准来。而这样子的话，相当于把所有的事情都压给了安全人员，安全人员表示压力非常的大~</div>2020-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/eb/d3/b0dc0d00.jpg" width="30px"><span>二马</span> 👍（1） 💬（1）<div>安全遵循“木桶理论”，这个在实践中有时候会被误解，安全涉及的领域很多，是无法做到每个场景都要把短板提高，有些做到基本防护已经可以解决安全问题。所以，安全加固，先做好安全威胁建模，把影响最大，最可能被利用的威胁降低，即把这些威胁的安全防护之板做到极致，而不是纠结于短板不够好。</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg" width="30px"><span>追风筝的人</span> 👍（1） 💬（2）<div>SSL VPN用户在访问虚拟站点的时候会被radius服务器进行AAA认证 授权  审计。radius认证方式有2种 PAP认证即用户名密码认证，用户名是明文保存的，密码是MD5加密的，第2种是challenge认证 会有2次认证第一次用户名密码认证，第2次challenge动态密码认证。2次认证的比只有1次的radius认证安全级别高。1812端口负责认证授权，1813端口负责审计，radius客户端充当NAS网络接入服务器和radius Server交互  对用户行为做出响应的响应 响应有Access－accept，Access－reject  等。 有个问题是radius服务器关键有2个核心配置文件clients.conf(保存客户端配置文件 有client IP，sharesecret:testing123支持自定义修改  还可以设置ACL), users保存用户信息。  老师问题关于这2个配置文件有最简单的配置方法没，我看虚拟机里的配置文件里信息很多       还有本地配置的radius Server进行radtest测试返回了Access accept但是把radius Server IP配置在web UI虚拟站点认证没生效  但是1812端口是开启的，远程北京radius Server环境是可以的。看了配置本地环境没有数据库，远程环境有MySQL和其他一些配置环境。是不是raddb目录下配置文件不全导致web端认证没生效但测试radtest 返回的响应确实Access accept  为什么呢   本地环境参考博客radtest后accept  但是web端认证相同的user  认证不通过</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg" width="30px"><span>小晏子</span> 👍（1） 💬（1）<div>对于安全建设的问题的一些考虑：
1，首先保证公司基础设施的安全性，做白名单访问机制，密码认证等
2，其次是对公司成员的权限做细化，分出权限等级，比如哪个group的用户可以做添加删除操作，哪些group只有访问权限等
3，对于所有的web访问强制使用https
4，记录访问用户的行为，甚至可以使用大数据和ML算法对登录用户的行为进行风险分析，并定期给出分析报告.
5，对于用户登陆密码有限制，可以强制使用高的难度密码，如必须包含大小写字母，数字，符号等。
6，定期扫描互联网上是否有公司源代码泄露的情况。
7，监控所有公司电脑, 不允许安装非法软件等。</div>2019-12-10</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKagLyKbgMsyKTrLplWu3iauiaGh97dhwFbfQ7RSoCx1SYiaL3icV3UsA5njaUVIYV01a1d2gBzf4CCbQ/132" width="30px"><span>海格</span> 👍（0） 💬（1）<div>企业办公安全 随着企业的发展，有那些对应的解决方案呢</div>2020-06-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/e3/df7447ff.jpg" width="30px"><span>008</span> 👍（0） 💬（1）<div>我们产品因为是专网应用，部署在不同的客户环境中，我们经常忽略基本的安全问题，比如我们会使用简单的默认密码访问数据库、登录管理员账号、访问文件，甚至一些数据权限的限制为了方便是在客户端层面做的显示控制，其实数据已经请求到了客户端。无论是认证还是授权几乎都是仅仅考虑了“可用性”，无视“机密性”和“完整性”。
对于审计，虽然我们做了操作记录，但是并未详细记录修改内容为何，这个在真正需要时是否具有法律效应呢（先忽略这记录可能被篡改）</div>2020-03-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c2/42/17afefdb.jpg" width="30px"><span>树洞先生</span> 👍（0） 💬（1）<div>只有授权过的应用能访问接口，这个也属于安全中的授权吗</div>2020-01-05</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/51/50/f5f2a121.jpg" width="30px"><span>律飛</span> 👍（0） 💬（1）<div>问题1，最早的单位分级管理网络，专用网络密级最高，完全物理隔离，网络设备也有审计功能。
现在的公司安全意识较弱，主要靠https,用户密码、数据库部分信息的加密
问题2、管理层得重视，注意安全体系和流程设计，开发工程师也要不断学习，真正从心里重视安全，了解和学习安全，从项目的业务角度可列出一个高性价比的安全的清单，作为开发计划一部分，最终形成一个安全体系。
</div>2019-12-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/52/9d/5d51fda4.jpg" width="30px"><span>一命赌快乐</span> 👍（0） 💬（1）<div>安全工作确实需要自上而下。我司(某国企)这两年先是成立领导小组，再完善全套规章制度,设立专门干活的办公室，年底安全会包含网络安全议题，评选先进个人.……然后才逐步重视起来。
</div>2019-12-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/06/36/d288bcc7.jpg" width="30px"><span>3e21</span> 👍（0） 💬（2）<div>为了遵循CIA的安全原则，我们可以从哪些方面去做，认证，授权，审计这三样是对机密性，完整性的实现。在认证模块，我们系统采用的统一的鉴权中心做系统间调用的鉴权操作，在开发的项目中，授权采用的是开通产品很渠道，是数据库内进行的配置，审计是在系统的整个功能调用中加入日志记录</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/07/f3/38c85575.jpg" width="30px"><span>司鸿渐</span> 👍（0） 💬（1）<div>安全问题从三个层面：
1.国家立法，建立标准
2.企业根据法律和标准，实现自己的安全目标和政策
3.个人首先遵守标准和制度，其次是培养安全意识</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/13/2e/1a996e1d.jpg" width="30px"><span>Geek_shen</span> 👍（41） 💬（0）<div>最近刚好要做的一些事情

1、所有主机禁止root登陆
2、ssh设置登录尝试次数
3、普通用户禁止免密码切换成root
4、所有服务以独立普通账户启动，并且禁止登录
5、LDAP设置密码规则（大小写、数字、特殊字符，10位以上）
6、所有登录增加验证码，设置尝试次数（同客户端ip、同用户名等）
7、redis绑定在127.0.0.1，设置保护模式
8、Jenkins禁止弱口令、禁止脚本执行、禁止用户名查看
9、核心账号系统，需要二次验证
10、主机之间完全隔离，禁止免密跳转登录
11、合理设置.ssh目录和authorized_keys权限
12、协议加密：HTTP，SMTP、IMAP、LDAP、FTP，防止嗅探
13、网络隔离，内网核心资产和办公网络隔离
14、升级服务、插件、系统等版本，修复已经被发现的漏洞
15、涉及密钥等机密配置文件设置仅root可读写
16、MySQL给应用程序账号分配合理权限，控制select ... into outfile。控制root的访问范围
17、控制个人热点
18、爆破、入侵等报警
19、控制堡垒机访问云主机的权限
20、权限最小化原则，服务最少原则
21、堡垒机的私钥保证只有root可以获得，堡垒机以普通用户启动
22、梳理个人虚拟机
23、核心系统密码采用静态密码和动态密钥相结合，分开保管，防止被钓鱼
24、梳理所有机器的服务，不需要的关闭，能够限制在本地访问的设置本地访问
25、增强垃圾邮件检测，防止钓鱼邮件
26、加强对关键邮箱的保护，例如did@ test.com，采用密码分开保管的原则，避免被钓鱼
27、个人电脑的防护：防火墙、杀毒软件
28、清理不需要配置文件，停止运行的服务的数据等</div>2020-05-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" width="30px"><span>奕</span> 👍（5） 💬（0）<div>任何领域都没有银弹的</div>2019-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/ee/96a7d638.jpg" width="30px"><span>西西弗与卡夫卡</span> 👍（3） 💬（0）<div>我们是SSO加权限控制，再加事后审计。</div>2019-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/78/3e/c39d86f1.jpg" width="30px"><span>Chocolate</span> 👍（3） 💬（0）<div>我们采用 SSO 的登录方式，SSO 登录时对用户名和密码进行校验，SSO 通过在用户多次输入错误密码进行处理、每三个月更换一次密码（后台系统）等方式来加强认证的安全性；在业务系统中，用户的大部分操作都会对具体的权限进行验证；操作会以日志的形式进行记录。这样基本保证了用户和数据的安全，而且有些操作需要回溯的时候也能查到谁操作的、在哪个时间点操作的、操作了什么。

大部分情况下，事前防御属于认证，事中防御属于授权，事后防御属于审计。这句话很直观，很受益。</div>2019-12-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/20/3c/a8/3b4c69ff.jpg" width="30px"><span>scalad</span> 👍（1） 💬（0）<div>公司有个安全团队，很多东西都是停留在文档层面，真正能落地的少之又少，主要原因一方面安全是会影响业务效率的，另一方面是领导把安全团队领导层把它放在一个比较边缘的部门（说明领导层没重视这一块），使得它的重要性明显降低了。
所以企业在业务效率以及安全平衡需要有一个度也需要一个桥梁，这个我觉得更多的事业务的架构师或者项目经理去考虑，向上向领导层沟通安全的必要性，向下做好业务安全的设计</div>2022-07-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1c/fb/19/583cd804.jpg" width="30px"><span>此心如水只東流</span> 👍（1） 💬（0）<div>需要自上而下的推动。
一，由下面员工推动的话，开发的同事多半不会理你。
二，安全建设需要投入资源，比如招聘安全工程师，比如采购安全设备。
三，重要的是意识，上层有安全意识，下面的人自然而然也就会有安全意识。</div>2020-07-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/cf/80/012a0b90.jpg" width="30px"><span>以吻封笺</span> 👍（0） 💬（0）<div>请求进入系统必须先登录认证，认证后的请求都会先检查权限。系统在网关采集日志，进行统计分析，这是一个审计的过程，若发现请求异常（如：某个用户突增），网关会做流量限制，这是问责。

问责是对行为审计后的处理，具体的问责方式，如：黑名单、限流等</div>2024-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f2/29/829f321f.jpg" width="30px"><span>smallFive55</span> 👍（0） 💬（0）<div>安全管理是一个大工程，如果企业上层领导只关注业务推进，一味要求技术快速跟进业务、带动业务，而忽视安全工作的意义，就会导致系统漏洞百出。所以必须从上而下，从企业战略层面，梳理安全对企业战略的支撑意义，从集团层面重视安全，投入成本。</div>2023-04-13</li><br/><li><img src="" width="30px"><span>黄福超</span> 👍（0） 💬（0）<div>负责的系统中在认证，授权，审计做了哪些任务；
认证：对核心账号和非内网访问系统，添加了二次的认证
授权：针对功能的授权和数据的授权，分为两个任务，每个授权都有人员的审核和授权范围都控制在一周之内
审计：添加了操作日志和埋点日志。</div>2022-09-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/bd/78/be976ab3.jpg" width="30px"><span>LA</span> 👍（0） 💬（0）<div>我们做互动营销活动，通常业务场景是在微信等第三方平台，用户经过 OAuth 认证后服务端拿到用户在公众号的 openid，基于这个 openid 进活动库，生成唯一的身份标识 id，然后借助于这个 id，通过 jwt 生成t访问令牌，接下来的业务操作必须要求客户端携带令牌。

认证：颁发令牌

授权：这个令牌和操作访问以及粒度做绑定，校验

审计：通常是反查日志，一般异常情况 写 log

问责：看日志反映情况确定找谁。

做得其实不太好，访问令牌是基于活动为主题，粒度过大。

企业 IT 负责人根本不管安全的，出事了再说，态度摆那，哈哈哈哈，但平日爱嚷嚷，说我们得注意安全问题。

vpn 登录其实也算一个场景。</div>2022-06-22</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLXektNSKdywM1q6bw8QtUkWEficHcnfJmicQicQAfdPUOf25zv8N831slNEnx3VoC7fsSJZbAAicDiaPQ/132" width="30px"><span>Geek_liguo</span> 👍（0） 💬（0）<div>安全有一个悖论和痛点，没攻击的时候安全没啥用，有攻击了安全也没啥用（大部分），所以安全最好还是要至上而下去搭建</div>2022-05-17</li><br/>
</ul>