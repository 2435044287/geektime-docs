你好，我是秦晓辉。

今天我们就正式开始监控系统的学习之旅了，作为课程的第一讲，我想先让你了解一下监控相关的背景信息，对监控系统有一个整体性的了解。所以今天我们会先聊一聊监控的需求来源，也就是说监控系统都可以用来做什么，然后再跳出监控，从可观测性来看，监控与日志、链路之间的关系以及它们各自的作用。最后我们会介绍开源社区几个有代表性的方案以及它们各自的优缺点，便于你之后做技术选型。

掌握这些背景信息，是我们学习监控系统的基础。下面我们就先来了解一下监控的需求来源。

## 监控需求来源

最初始的需求，其实就是一句话：**系统出问题了我们能及时感知到**。当然，随着时代的发展，我们对监控系统提出了更多的诉求，比如：

- 通过监控了解数据趋势，知道系统在未来的某个时刻可能出问题，预知问题。
- 通过监控了解系统的水位情况，为服务扩缩容提供数据支撑。
- 通过监控来给系统把脉，感知到哪里需要优化，比如一些中间件参数的调优。
- 通过监控来洞察业务，提供业务决策的数据依据，及时感知业务异常。

目前监控系统越来越重要，同时也越来越完备。不但能够很好地解决上面这几点诉求，还沉淀出了很多监控系统中的稳定性相关的知识。当然，这得益于对监控体系的持续运营，特别是一些资深工程师的持续运营的成果。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/29/a1/69/0af5e082.jpg" width="30px"><span>顶级心理学家</span> 👍（20） 💬（5）<div>秦总，IaC 落地 概念不是很清楚，想深入了解下，感谢👍</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/25/19cbcd56.jpg" width="30px"><span>StackOverflow</span> 👍（18） 💬（2）<div>监控不同指标要配置一堆exporter维护起来也很麻烦</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/03/fe/d2c856c5.jpg" width="30px"><span>无聊的上帝</span> 👍（7） 💬（2）<div>老师你好,在工作中遇到了日志监控和链路追踪很难落地的问题.
被挑战的点如下,请教老师这种局可有破解方法?
1. ELK成本较高,价值性较低.出现问题研发直接看pod的log.代码质量确实高,线上环境从未遇见严重bug.
2. 链路追踪的价值是什么,能给业务带来哪些提升?</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/99/a8/6aaf7307.jpg" width="30px"><span>陈陈陈陈陈👅</span> 👍（7） 💬（1）<div>目前的困境是告警泛滥，希望能减少不必要的告警指标，但又会顾虑正式这些指标的缺失导致问题的发生</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5d/11/e1f36640.jpg" width="30px"><span>怀朔</span> 👍（7） 💬（2）<div>全球的化节点部署或者多机房的机房部署。 运维维护往往其实还是多套数据，同一个展示 或者多个数据  多地方展示 因为要考虑的权限 容量 告警聚合收敛等问题</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/56/b7/b9b42a06.jpg" width="30px"><span>LiangDu</span> 👍（5） 💬（5）<div>希望老师提供完善的告警规则和grafana仪表盘文件，对很多小白来说这两块才是核心。</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ad/78/abb7bfe3.jpg" width="30px"><span>Geek_e2uyqd</span> 👍（3） 💬（1）<div>多套监控系统维护确实是个问题 目前还没太好的方案</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（2） 💬（2）<div>请教老师几个问题：
Q1：生产环境中日志是开启的吗？
出了问题以后，通过日志来定位问题。但是，生产环境中一般不能开启日志吧。如果不开启的话，怎么利用日志来定位问题呢。好像是个矛盾的事情。

Q2：大厂开发人员是怎么查看日志的？
对于日志，开发人员是直接用Editplus一类的软件来打开看吗？还是说会用专门的工具软件来查看日志文件？如果用工具软件，用开源的软件还是公司自研的软件？

Q3：open-falcon架构图中怎么没有server？
Zabbix有server，Open-falcon是基于Zabbix发展起来的，按理说也应该有一个server，但架构图中看不出来哪个部分是server。

Q3：Prometheus两个问题
1 没有采用k8s的网站系统，可以用Prometheus吗？
2 Prometheus可以完成全面的监控吗？ 包括机器、网络、应用、各个中间件等。

Q4：指标监控数据一般怎么存储的？存在MySQL中吗？</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a6/95/3960d10e.jpg" width="30px"><span>奥特虾不会写代码</span> 👍（2） 💬（4）<div>老师你好，想请教一下对于网络连通性受限的场景下除了 Pushgateway 还有更好的方案不，因为 Pushgateway 使用下来的体验确实不尽如人意，公有云厂商的云主机也是通过类似于Pushgateway 的机制对外推送指标吗？</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/42/6d/7ba98ee6.jpg" width="30px"><span>Hello Strong</span> 👍（2） 💬（1）<div>两三年前因为公司需要，做过一次监控平台的选型，此前在用的就是zabbix，对k8s支持主要靠一些不太热门的插件模块，感觉灵活度太低。选型主要是Prometheus和在用的elk日志平台，前者作为tsdb非常适合指标数据，性能也强。后者的缺点也是前者的优点，但elastic在对采集源的支持度上其实还是可以的，k8s、各种数据中间件、队列、web gateway等都有，这点和Prometheus体系相比不会差太多，图形化方面grafana和kibana也都ok，告警组件方面如果不付费，elastic主要靠一些开源第三方项目的支持，这点不如Prometheus。最后选择了elk方案，原因有点无奈，一方面是Prometheus数据存储的高可用原因，还要再引入其他存储，另一方面elk是已经长期在用的日志平台，各方面都相对熟悉，而且能投入的硬件资源也有限，在数据规模不大的情况下用同一套能满足。</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ef/a2/6ea5bb9e.jpg" width="30px"><span>LEON</span> 👍（2） 💬（2）<div>老师，我是纯纯小白Exporter 是什么意思？</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/3a/31/b2/1c4fb098.jpg" width="30px"><span>嘉言</span> 👍（1） 💬（1）<div>老师，告警规则文件，一般在哪里可以找到</div>2024-10-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/8b/1b7d0463.jpg" width="30px"><span>晴空万里</span> 👍（1） 💬（1）<div>老师好 我们部门准备做一个监控平台 不知道这种切入点在哪里？老师的课程有用，市面上很少这种课程</div>2023-02-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg" width="30px"><span>不经意间</span> 👍（1） 💬（2）<div>目前我这边也存在传统的服务器监控和基于k8s的云原生服务的监控。
看看zabbix也支持了k8s的pod自动发现，有点犹豫要不要继续支持zabbix(其实zabbix最核心的还是自动发现对于一些指标的采集)，我目前还用exporter在zabbix上利用promql做指标的自动发现和处理。其实其他的也行，就看值不值得这么折腾。还有就是zabbix是支持单个指标的ttl的，不过好像prom设计理念中就不需要数据的长时间存储？(2年即以上时间)

不过现在也用了prom，直接上搭配的thanos和minio。</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/16/5c/d0476f9f.jpg" width="30px"><span>运维夜谈</span> 👍（1） 💬（1）<div>一直在想能不能基于Prometheus、Loki、skywalking，集成一个统一的管理平台，能实现监控部署的界面化操作，还能节省exporter部署的麻烦</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/4f/b0/ab179368.jpg" width="30px"><span>hshopeful</span> 👍（1） 💬（2）<div>关于指标监控，在 prometheus 还没有盛行的时候，百度内部的  argus 监控系统做得很牛逼（数据准确性、时效性、丰富的功能），后面开源的 open falcon 的架构跟百度监控系统的架构比较类似；阿里的鹰眼系统在链路追踪方面做得不错；腾讯内部各个 BG 基本上都有做监控系统，甚至不同部门，不同中心都单独造轮子，并没有形成合力，所以不是很好用；现在走在技术最前沿的可能是字节基于 eBPF 的可观测实践。</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/51/51/60d729d0.jpg" width="30px"><span>文康</span> 👍（1） 💬（3）<div>能不能讲一下指标的正常值范围和极限值范围？比如mysql慢查询多久是慢查询？硬盘的iops多少是正常？极限值是多少?</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg" width="30px"><span>第一装甲集群司令克莱斯特</span> 👍（1） 💬（1）<div>想当年，自己也参与过公司核心业务监控系统watchdog的开发。</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/a8/ad/73b8e8da.jpg" width="30px"><span>青青子衿</span> 👍（1） 💬（2）<div>13年那会刚开始做运维接触的是cacti，但是还没做一套完整的方案出来就被zabbix替代了。当时云原生也不普及，所以很多业务系统全部对接zabbix，包括主机，网络设备，数据库，不好采集的就通过shell脚本去定制化开发，创建监控项和触发器对接告警系统。现在由于容器化的普及，公司落地的监控方案都是kube-prometheus，但是很头疼监控数据永久花存储的问题。希望通过这个课程能够掌握prometheus的监控告警采集逻辑定义告警规则，同时能够掌握夜莺的基础架构体系。对了，学习打卡</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/44/c1/ebe870bb.jpg" width="30px"><span>李郝</span> 👍（1） 💬（1）<div>三大支柱，让我想起凤凰架构中的可观测理论，具体业务上应如和应用还是一知半解，期待后面的课程</div>2023-01-10</li><br/><li><img src="" width="30px"><span>Geek6570</span> 👍（1） 💬（1）<div>希望可以学习完，有方向或能力搭建混合云下的云原生环境监控，加油</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/9e/95/a9ca5bb8.jpg" width="30px"><span>修文</span> 👍（0） 💬（1）<div>关于Prometheus 的缺点，为什么老师说“对于 IaC 落地较好的公司，反而认为这样更好”，可以结合实际场景再展开讲讲吗？</div>2023-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2c/96/98/89b96cda.jpg" width="30px"><span>三年二班邱小东</span> 👍（0） 💬（1）<div>老师好，我们公司主要就是监控网络设备和服务器，但却用Prometheus，他能胜任吗？感觉Grafana界面扩展性好差，对外行很不友好，我也不能决定技术选型，Prometheus+Grafana监控硬件可以做的zabbix一样方便吗？</div>2023-01-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/f8/b8/0398768b.jpg" width="30px"><span>takumi</span> 👍（0） 💬（1）<div>大佬你好，比较好奇exporter和agnet有什么区别的区别嘛？看了一些文章里面涉及到Push和Pull两种模型，两者好像是模型上的区别？在一个可能agent能做的事情更多？期待大佬解答
</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/21/9a/114015aa.jpg" width="30px"><span>jay</span> 👍（0） 💬（1）<div>
请问老师:如果要监控遍布全国31省份的几百个节点，几千台物理服务器，上万的虚拟机。未来还要运行容器。用那个方案比较合适？ 我考虑过zb，但是性能比较差；Prometheus做邦联似乎可行，但是维护的压力也不小</div>2023-01-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/45/09/e2ecbd23.jpg" width="30px"><span>Xue Liang</span> 👍（0） 💬（1）<div>夜莺发展势头一直不错，之前我也一直在关注，希望通过这个课程能看到夜莺的架构设计，然后我也借鉴借鉴，学习学习。</div>2023-01-10</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83equXYHzYnWw7vLxnnVh0wQCdMoDroVfJpicVZ1cA3MTaBuTRvlCzI3c0ou1ia9tsgr00Fjg5ljFweQQ/132" width="30px"><span>渣渣左</span> 👍（0） 💬（1）<div>能监控C++应用吗？</div>2023-01-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/31/1c/2e/95b522a6.jpg" width="30px"><span>wusj</span> 👍（0） 💬（1）<div>刚好公司要做监控平台，来学习学习💪</div>2023-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg" width="30px"><span>张申傲</span> 👍（1） 💬（0）<div>第一讲打卡~
个人感觉监控系统的发展趋势，已经从原来的感知问题演进到现在的预测问题，关注的重点从技术逐渐转移到了业务。</div>2023-06-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/0e/2a/e6b443f0.jpg" width="30px"><span>孙荣辛.py</span> 👍（1） 💬（0）<div>Skywalking 目前发展趋势也很好，可以推荐给大家使用</div>2023-03-17</li><br/>
</ul>