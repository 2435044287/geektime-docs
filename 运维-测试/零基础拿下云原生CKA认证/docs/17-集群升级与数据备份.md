你好，我是雪飞。

刚开始使用 K8s 的时候，我们团队搭建了 V1.18 稳定版本的 K8s 集群，在上面部署了各种业务应用，这套环境长时间没有进行集群升级。随着业务迭代加快和系统安全需求提升，我们发现老版的 K8s 集群无法兼容一些新组件，因此必须要对集群升级。预期升级后的版本是 V1.26 版本，然而，由于版本跨度过大，升级时遇到了许多问题，花费了大量时间。因此，及时升级集群非常重要，避免留下技术债。

集群升级能够带来很多好处，比如确保集群能利用最新版本的新功能、性能提升和安全补丁，可以增强集群的稳定性和可靠性，同时提升兼容性和扩展性，满足不断变化的技术与业务需求。接下来，我们将深入了解 K8s 的升级过程。

## K8s 升级说明

在 K8s 升级过程中，首先需要备份集群数据。由于所有 K8s 集群相关数据都存储在 etcd 数据库中，所以我们需要先对 etcd 中的数据进行整体备份。如果集群升级过程中出现意外，可以利用 etcd 的快照数据进行回退恢复。

接下来，按照顺序先升级管理节点，即 Master 节点，然后再升级工作节点，也就是其他Worker 节点。为避免业务服务中断，通常采用滚动升级方式，逐个或分批升级工作节点，确保部分节点仍能正常运行，从而保障节点上的 Pod 能持续对外提供服务。
<div><strong>精选留言（1）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/4e/c7/8c2d0a3d.jpg" width="30px"><span>余泽锋</span> 👍（0） 💬（1）<div>老师怎么没有故障排查</div>2024-07-31</li><br/>
</ul>