你好，我是白园。

上节课我分享了关于解决容量问题的直接两个手段，**控制流量和增加资源**，除了这两个办法之外，还有哪些场景和解决方案呢？今天我就想通过2015年的一个案例来聊聊这个话题。

当时的情况是这样的，一部热门电视剧在网络上迅速传播，成为热点事件。由于短时间内大量用户下载该视频，最终导致百度网盘雪崩。今天我把这个故障的经验和教训分享给你，希望你能从中学到如何处理热点事件，如何处理雪崩。

## 网盘的架构设计

在深入探讨故障之前，我先简要介绍一下当时（2015年）网盘的架构设计，以便你更好地理解故障发生的根本原因。

网盘架构主要分为四个层次：

- **客户端：**主要是移动端和PC端两种。
- **产品层**：负责用户信息的管理工作，包括用户注册、登录、权限分配等。
- **中间层**：承担文件管理的职责，包括文件命名、格式处理、元数据维护等。
- **存储层**：作为数据的最终存储地，采用了百度自建的存储系统，即百度云存储（BOS）的前身，为网盘提供强大的数据存储能力。

![图片](https://static001.geekbang.org/resource/image/41/a3/410d1406f5ce83f35193b841fb12cba3.png?wh=1642x938)

故障的起因是某部热门电视剧更新后，有人把它上传到网盘并进行了公开分享。随后，很多用户开始迅速下载该文件，导致存储层先出现了问题。在网盘的日常使用中，大多数文件为私有文件，通常单个文件的下载次数较少，大约在1～2次。然而，在这种情况下，热点文件在短时间内的下载次数激增至数百次，导致磁盘I/O过载，形成了局部热点现象，显著延长了文件的下载时间。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/11/5f/f6/4cea3c45.jpg" width="30px"><span>我是病毒</span> 👍（1） 💬（0）<div>从我们碰到场景特别业务高峰期阶段基本上就是先限流在重启，要不应用服务根本就起不来</div>2024-08-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/39/cb/b9/e2d3f77f.jpg" width="30px"><span>Geek_Oision</span> 👍（0） 💬（0）<div>先限流</div>2025-01-14</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKeZ1x6odj97yeOg9YUHfeozWlmj9ib8LgUmz4hW2ouz3aplFoH53qDNs5Z8bpqjvMEWbwWn8gic3Bw/132" width="30px"><span>大秦小迷兔</span> 👍（0） 💬（0）<div>太子妃升职记么</div>2024-09-13</li><br/>
</ul>