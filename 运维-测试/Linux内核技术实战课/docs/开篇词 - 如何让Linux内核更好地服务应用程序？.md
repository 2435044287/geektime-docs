你好，我是邵亚方，欢迎加入我的课程，和我一起学习Linux内核知识。

从2010年接触Linux内核到现在，因为工作的关系，我参与解决了大量直接与生产环境相关的性能问题。前些年，我还在蘑菇街的时候，那会蘑菇街的业务增长速度非常快。你知道，业务增长了，随之而来的肯定就是服务的稳定性挑战了，比如TCP重传该怎么分析、怎么在运⾏时不打断任务的情况下排查内存泄漏问题、CPU sys利⽤率⾼怎么快速解决，这都是实实在在的问题，你会就会，不会就是不会。

以我们常见的TCP重传为例，如果你熟悉的话，服务器上一般都会有TCP重传率的监控，如下图所示：

![](https://static001.geekbang.org/resource/image/ba/f6/baee41941867cd5d0ee36c8f67d389f6.jpg?wh=896%2A488)

就像图片显示的那样，这么高的TCP重传率，必然会导致系统QPS减小，所以你不敢含糊，得赶紧找问题出在哪里。但真正排查的时候，你会发现不知道从哪里开始，因为发生重传时的现场信息并没有记录下来。之所以没有记录下来这些现场信息，是因为记录的成本太昂贵了。如果你排查过网络问题，你应该知道，网络数据量是非常大的，即使只记录TCP头部信息也是非常大的存储开销，而且信息记录的过程也会带来较多的性能开销。

为了解决这类问题，我们团队就针对TCP重传的监控做了很多的改进，这些改进可以在不对业务性能造成明显影响的情况下，提升团队定位和分析问题的效率。我们记录的TCP重传现场信息如下所示：
<div><strong>精选留言（16）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/9a/83/0802f4e7.jpg" width="30px"><span>Geek_lucky_brian</span> 👍（14） 💬（1）<div>前几天排查一个MySQL环境的问题，问题现象是运行久了之后会出现：有那么几秒钟内，CPU sys值冲高，很短时间内从10变成了80甚至90，随之还会出现tcp断链，以及磁盘性能下降。
最后的发现，出现这个问题的时候，都是在free内存只剩总共的1％时，而且sys变高的几秒内，伴随着page cache的清理。
所以，推测是free内存不足引起page cache清理，然后清理的优先级比较高，导致其他io包括网络和磁盘的服务质量下降，引发了断链。

老师看看这个结论对吗？</div>2020-08-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（4） 💬（3）<div>系统的东西接触不少：追的最猛的应当是成哥的东西-专栏书籍被我狗皮膏药的成手册用了。
太多的时候碰到人说我程序或者应用慢，可是当我提及系统时客户会觉得简单且不可能却又不会去否认这确实是一方面事实存在的原因。系统慢这条坑其实越挖越深，工具、原理、网络，现在只能挖内核去整体思考和理解，从而不要人家来句你系统慢就、、、</div>2020-08-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/df/6c/5af32271.jpg" width="30px"><span>Dylan</span> 👍（2） 💬（1）<div>真是惭愧，《深入理解 Linux 内核》这本书买了快10年了，到现在还是没看完，停留在内存管理和进程调度那部分~~</div>2020-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/25/2b/ca/71ff1fd7.jpg" width="30px"><span>谁家内存泄露了</span> 👍（1） 💬（1）<div>道理我都懂，为什么你的发量是这样？</div>2021-07-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/ac/96/ea51844f.jpg" width="30px"><span>Frère Jac</span> 👍（0） 💬（1）<div>我想了解什么情况下系统内核可以平滑升级，什么情况下不能。现在系统的内核版本太多了，有时候真的很难决策。比如现在系统使用的是redhat 6.7 的版本，但是因为应用版本升级原因，需要升级到7.x以上才行，之前记得有过挂载7.x镜像，然后建立本地yum源，可以升级过去，这次却不行，依赖项太多。退一步讲内核升级可以只升级必要的内核和关键的依赖</div>2021-08-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ee/28/c04a0c83.jpg" width="30px"><span>小炭</span> 👍（0） 💬（1）<div>学好系统底层知识，可上可下。是一项值得长期可投入的事情。</div>2020-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/99/4a/bdf26d5c.jpg" width="30px"><span>石头汤</span> 👍（31） 💬（2）<div>当我看到邵老师也要996的时候，手里的砖忽然变轻了</div>2020-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg" width="30px"><span>莫名</span> 👍（19） 💬（5）<div>TCP重传推荐使用bcc tcpretrans工具。</div>2020-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/90/8f/9c691a5f.jpg" width="30px"><span>奔跑的码仔</span> 👍（4） 💬（2）<div>本人是一名嵌入式linux程序猿，平时主要接触的是内核构建,裁剪以及一些设备驱动，再就是应用软件的设计和实现，不过也是嵌入式环境的。感觉这门课中设计的大多是linux在互联网方面的应用，不知道对于嵌入式linux 方向，咱们这门课适合吗？谢谢🙏</div>2020-08-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/83/c9/0b25d9eb.jpg" width="30px"><span>NullPointerException</span> 👍（3） 💬（0）<div>老师能分享下内核学习路线吗，不知道从哪里入手，学什么？</div>2022-03-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/64/9b/d1ab239e.jpg" width="30px"><span>J.Smile</span> 👍（3） 💬（0）<div>“能够深入到 Linux 内核层分析问题的这些人，他们看问题能直击本质，定位、分析问题的能力强，往往能解决别人解决不了的问题，所以他们基本上也是各自领域的翘楚。”
-----------------------------------------------
成为行业翘楚的人，解决别人解决不了的问题。</div>2020-08-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/3e/3c/fc3ad983.jpg" width="30px"><span>佳伦</span> 👍（1） 💬（0）<div>其他的内核课程都是基于内存管理，文件系统，进程调度这些知识框架分类的。而本课程别具一格，从实际场景出发，从实践到理论，这样更容易理解，学习动力和效率也更高，👍</div>2021-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg" width="30px"><span>hua168</span> 👍（1） 💬（2）<div>老大，像我们运维的，没有学过内核，会搭建、shell&#47;python编程，这类的。学习这门课还需要学习什么为基础吗？
要学C语言、数据结构和算法之类不？你上面提到的那些要不要学？</div>2020-08-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/ff/ce/73ee54bf.jpg" width="30px"><span>Linux云计算网络</span> 👍（0） 💬（0）<div>性能是系统性的，环环相扣，了解内核，能够对全盘思考更有帮助，目前内核一知半解，希望以此作为切入口，进入内核世界</div>2024-01-08</li><br/><li><img src="" width="30px"><span>福利社</span> 👍（0） 💬（0）<div>请教老师，我发现clock_gettime(MONOTONIC)一秒内时间经常比系统时间快1秒或6，7秒，这个时间是什么原理？可能是什么原因造成的？开发的虚拟机和容器环境，物理机没试过。</div>2022-09-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/8a/09/adf4a438.jpg" width="30px"><span>孙国庆</span> 👍（0） 💬（0）<div>很多内存管理的知识看了很多遍，还是觉得没有完全理解</div>2022-02-14</li><br/>
</ul>