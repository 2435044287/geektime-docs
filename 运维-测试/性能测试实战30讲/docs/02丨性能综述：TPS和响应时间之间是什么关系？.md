我们在上一篇文章中讲了性能测试的概念，肯定会有人觉得，那些概念很重要，怎么能轻易抹杀呢？那么，在今天的文章中，我们就来扒一扒性能场景，看看概念与实际之间的差别。

前面我们说了性能要有场景，也说了性能场景要有基准性能场景、容量性能场景、稳定性性能场景、异常性能场景。在我有限的十几年性能生涯中，从来没有见过有一个性能场景可以超出这几个分类。下面我将对前面说到的概念进行一一对应。

学习性能的人，一定看吐过一张图，现在让你再吐一次。如下：

![](https://static001.geekbang.org/resource/image/36/7d/36ee34ee92b75fd17d5314d74453367d.png?wh=629%2A336)  
在这个图中，定义了三条曲线、三个区域、两个点以及三个状态描述。

1. 三条曲线：吞吐量的曲线（紫色）、利用率（绿色）、响应时间曲线（深蓝色）。
2. 三个区域：轻负载区（Light Load）、重负载区（Heavy Load）、塌陷区（Buckle Zone）。
3. 两个点：最优并发用户数（The Optimum Number of Concurrent Users）、最大并发用户数（The Maximum Number of Concurrent Users）。
4. 三个状态描述：资源饱和（Resource Saturated）、吞吐下降（Throughput Falling）、用户受影响（End Users Effected）。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/dd/0f/ee37a7fe.jpg" width="30px"><span>zuozewei</span> 👍（101） 💬（6）<div>第一个问题：

日常生活中价值可以通俗的理解为“合算不合算”，“值得不值得”，这里泛指对性能项目的有益程度。

在价值工程中，价值是个科学的概念，其定义为：V=F&#47;C
式中： V——价值（Value）
	   F——功能评价值（Function Worthy）	
	   C——总成本（Total Cost）
可见，包括三个基本要素，即价值、功能和成本。

功能可解释为用途、目的等等。对于一个性能项目来说，功能就是性能验证 or 性能分析 or 性能调优。

概念这里简单理解为“思维惯性”，其会决定做一个性能项目的行为模式，是指实现功能（性能验证 or 性能分析 or 性能调优）所支付费用（成本）。

SO，为了提升价值，在功能（目的）不变的情况下唯有适当的降低不合适的成本，那么这些杂七杂八，逻辑关系不符合真实的场景的概念势必需要淘汰。


第二个问题：
性能场景中的“场景”比较正宗的描述是：在既定的环境（包括动态扩展等策略）、既定的数据（包括场景执行中的数据变化）、既定的执行策略、既定的监控之下，执行性能脚本，同时观察系统各层级的性能状态参数变化，并实时判断分析场景是否符合预期。

那么如何看性能数据呢？

一般有两个核心即趋势和证据链。

分析数据趋势需要对一个时间序列数据的分析，一般采用线性回归分析。

对于证据链查找，需要对不同时间序列数据的分析，一般采用数据的相关性分析。</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c7/8f/fcfaf45a.jpg" width="30px"><span>莫西 👫 小妞儿 👼 🎵</span> 👍（47） 💬（7）<div>老师，我有个疑问。“单交易容量测试”是对单独接口进行压测是吧？比如针对每一个接口都测了100、200、300并发。那么这个测试结果和“混合容量性能场景”测完的结果应该怎么对比分析呢？</div>2019-12-30</li><br/><li><img src="" width="30px"><span>suke</span> 👍（40） 💬（8）<div>但是由于用户数增加的幅度会超过队列长度，所以 TPS 仍然会增加 这句话没明白这个逻辑是为什么？能详细解释一下么</div>2020-03-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/a5/f8/045476ed.jpg" width="30px"><span>丑得带感</span> 👍（30） 💬（3）<div>有个问题想请教一下老师：
关于TPS与并发线程数，正常应该是以TPS作为系统容量的衡量标准，这个在系统性能比较好的时候很好和客户沟通（即TPS&gt;并发数）。
但是在系统性能较低的项目中，有时候就很难和客户沟通，比如一次项目中，系统在2000并发，系统TPS就到了最大1500多，RT、资源利用率那些也还好；但是接着增加并发到5000时，TPS基本比较平稳，没有什么下降，响应时间才刚刚超时。
对于这种情况，在估算系统可支撑最大在线人数时，客户就觉得应该依据最大并发数5000去算（RT可接受时），而不是依据最大系统TPS1500多去算，他们觉得你的每1个并发都是模拟的1个用户在实际使用，而响应时间没超时，就说明可以支撑这个并发数的用户同时使用（假设并发度100%时）。
我从响应时间分析，感觉他们的说法也没毛病，但是理智告诉我，从TPS看系统每秒最大也就能处理1500多，其余的请求应该会在队列超时，或被拒绝，但是5000并发持续压测10分钟，也没看到大量超时或报错（千分之一以下），拿不出证据来支撑，感觉真是性能三观都要被颠覆，一直耿耿于怀，还请老师解惑！</div>2019-12-23</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ6G2xZvNRmhyXBjmGbI5G8icGCCMPupr6yxZ1IcURwp7GTRHcpWGWpg9A0fLlyicmVdDwzqZqwiaOQ/132" width="30px"><span>jy</span> 👍（19） 💬（3）<div>
递增策略：比如分钟增加10个线程，100个线程要10分钟才全部启动完成，再持续运行10分钟，但是聚合报告统计的是这20分钟的tps，tps值明显会被前面10分钟拉低，如果这样测试出来的tps不达标怎么办？如果每分钟启动50个，2分钟即可全部启动，持续运行10分钟，tps达标。如何解释这两种情况呢？</div>2020-05-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/3f/51/d1bb22b0.jpg" width="30px"><span>微冷花谢</span> 👍（9） 💬（2）<div>请老师允许我一个新手留下自己的思考和疑问? 第一问，自己的思考是很多理论上的概念，不仅仅加深了我们对性能测试的理解的困难程度。同时，在实际发现性能瓶颈，实施性能优化，很多时候是没有太多帮助的。
第二问，之所以需要连续的一个符合实际的加压过程，是因为能够获取更加完整且准确的证据链。
个人疑问:关于如何去设计递增加压的过程，根据什么去设计，如何去设计出符合我们系统的加压过程?    
对于老师的两问，个人理解不一定正确，希望老师指正。
对于个人疑问，麻烦老师留下思路。
最后，老师的讲的真实在，谢谢老师的分享。虽然有一些我还没办法懂，但是我会极力的去吸收。谢谢老师！</div>2019-12-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/cd/71/a1771310.jpg" width="30px"><span>IT媚娘</span> 👍（7） 💬（2）<div>性能场景为什么要连续？而不是断开？
递增线程数，记录每次的性能指标，对比分析，画曲线，来观察指标变化的趋势，找出性能瓶颈，或者服务器最大处理能力</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/98/01/02182390.jpg" width="30px"><span>拥抱黑夜的白天</span> 👍（6） 💬（2）<div>1、市场上很多概念都是人云亦云，没有实际的应用到项目中去，而是以偏概全，甚至理解上存在误差、片面化，但是却被广泛的传播开造成了误导。而且没有通过实践证明的概念是没有实际的意义的。我认为真正的概念不是片面的、也不是单纯的理论性的，应该是从实际的业务中总结得出的结论，才会对实际的有指导意义。而我们也需要从项目中探索和积累经验、教训，不断丰富和完善我们的理论体系。总之一句话，实践出真知，任何没有实践做支撑的理论都是假想！
2、因为在实际的业务场景中，基本上不太会出现一下子增长很多用户量的情况，除非是限时秒杀这种业务场景，一般都是数据一点点增长上来的。我们做性能测试，要模拟还原真实的业务场景才有实际的意义和价值。</div>2020-05-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/55/a6/3d428868.jpg" width="30px"><span>LensAclrtn</span> 👍（6） 💬（6）<div>1. 为什么说市场上的概念对性能项目实施没有太大价值?
看完第1、2讲,感觉老师真的是很真诚很负责,说出了很多我们想说不敢说的话
就拿老师举例的配置测试来说,我当时陆陆续续接触到这么些概念的时候就在想,这都谁造出来的词,连配置这么个基本操作也要上升到XX测试的程度...最搞笑的是还有一种叫“文档测试”的.感觉这些都太重理论轻实践了.

说个题外话,我以前虽然也对性能测试、压力测试、负载测试颇有微词,但自己也不能总结提炼出一个更好的分类框架或者体系, 今天看到老师用性能场景来作为划分依据,就是重实践的表现,很值得我们学习呢.

2. 为什么性能场景要连续不要断开?
说来惭愧,我第一个负责压测的时候就是用的离散的性能场景,也就是一次测试过程中线程数是固定的. 现实中的性能场景都不是一成不变的, 用固定的线程数去压测的意义很有限</div>2019-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg" width="30px"><span>分清云淡</span> 👍（6） 💬（6）<div>QPS=并发数*常数&#47;RT  , 也就是到瓶颈后加并发后RT增加QPS不变，那么瓶颈基本在RT增加的节点上。</div>2019-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/91/bb/f1d1483f.jpg" width="30px"><span>Cyx</span> 👍（5） 💬（1）<div>老师，这段话没有懂，没有明白为什么TPS仍然会增加——很多时候，重负载区的资源饱和，和 TPS 达到最大值之间都不是在同样的并发用户数之下的。比如说，当 CPU 资源使用率达到 100% 之后，随着压力的增加，队列慢慢变长，但是由于用户数增加的幅度会超过队列长度，所以 TPS 仍然会增加，也就是说资源使用率达到饱和之后还有一段时间 TPS 才会达到上限。</div>2020-12-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/e9/34/83025564.jpg" width="30px"><span>-_-</span> 👍（5） 💬（1）<div>TPS 和QPS是一个东西么 我看概念是不一样的 但是有的用QPS 有的用TPS 这两个东西怎么个区别</div>2020-08-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/43/f9/555d7aa0.jpg" width="30px"><span>人心向善</span> 👍（4） 💬（1）<div>做了几年的测试都是比较传统，客户要求也比较明确，都是为了验收或者拿到一个简单的成果就行，他们的要求就是时间上不要超时，而且能达到我要求的并发数就行了，根本不会去考虑什么tps吞吐量这些东西，这样带来的坏处就是即使在实践中也很难达到能力的提升，时间长了就会进到一个错误的误区，就只是认为性能测试只看这几项要求，实则不是这样

还有就是做性能测试总体来说要求会的太多了，因为你不像开发精通一门语言就可以持续的做整个业务，性能测试这块完全取决于你的被测系统是什么架构由哪些新技术构成的，这个时候就会陷入另一种困境就是这个技术第一次接触，无论是从哪个角度对实施人员都是一头雾水，很难快速的进入到测试状态，即使是你的测试模型准备好了，测试出来的结果也不知道怎么去分析，如何分析...

简单的从网络、硬件、web应用这些、复杂点的到网络协议、磁盘利用、数据库参数、底层代码逻辑等等，这些都要一点点去分析比对的，但是这些东西一时间又不能全部去完全的理解并且能够上手，所以其实更多的时候是陷入了一种特别无奈的迷茫，但俗话又说：实践是检验真理的唯一标准，你只有去实践了才知道哪里对了哪里错了，经历了一定实践搞明白一些事情，觉得自己会了很多，可客户不这么想，他就觉得你技术不行，因为他要的很明确：结果就是结果，毕竟时间成本都在这里。

从这方面来说不仅技术上有问题，项目管理上也就出了问题了，因为已经不符合管理的三要素了....</div>2020-07-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/71/c8/908d9880.jpg" width="30px"><span>chary</span> 👍（4） 💬（1）<div>做了这么多年的性能测试，容量测试找拐点一致都是我头疼的，每次都是经过很多次反反复复的加压，梯度压测，最终找到拐点。经常会有无用功的时候，不知道高老师是不是也一样！有没有什么好的方法！谢谢</div>2019-12-30</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ergiaP9dmjrW39G73N9qv0icInW4xygvNehp0uc3IS0d6BozdIgl9eH2obNWhaLIiaw1aEOBHx0nibibDA/132" width="30px"><span>Technological life</span> 👍（3） 💬（2）<div>jmeter里的线程数是不是就是用户数呢？线程数和用户数的关系是什么呢？</div>2020-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/f6/0d/e16dff4e.jpg" width="30px"><span>瑞泉</span> 👍（3） 💬（3）<div>老师，我是测试的新人，在第一个图中没有看到两个点：最优并发用户数（The Optimum Number of Concurrent Users）、最大并发用户数（The Maximum Number of Concurrent Users）的标注，在第二张图中也没有，希望老师能标注一下，十分感谢！</div>2020-02-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/57/64/9a729a58.jpg" width="30px"><span>Eight Baby</span> 👍（3） 💬（4）<div>在具体的项目实施中，有经验的性能测试人员，都会更关心服务端能处理的请求数即 TPS，而不是压力工具中的线程数。确实这句话。特别感同身受。还和不少人解释多次。太心累了</div>2019-12-17</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKU8b6w5Y9WYgLH0as5P6XS69A0kFPZmXEiaSChlFgHUGjgo3lTflhV1B4PXOgU6wd4kKbjdoUqSIg/132" width="30px"><span>Geek_a5ffcf</span> 👍（2） 💬（2）<div>老师，其实tps和响应时间的关系就是tps=压力线程数&#47;响应时间，对吧</div>2022-04-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/1c/74/463105c3.jpg" width="30px"><span>luxuluck</span> 👍（2） 💬（1）<div>你好老师 请问你所给的TPS和响应时间曲线中的A、B、C、D、E 分别代表什么 ；A和B有什么区别啊</div>2022-03-28</li><br/><li><img src="" width="30px"><span>Geek3577</span> 👍（2） 💬（2）<div>您好，想问一下 TPS 的计算是：
TPS = 并发数&#47;响应时间  还是 TPS = 1000&#47;平均响应时间  有些搞混了这些计算
</div>2021-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/29/f0/c2/231d2f12.jpg" width="30px"><span>Geek_6bb</span> 👍（2） 💬（1）<div>老师你好！我想问下  1.基准测试里面提到的最大tps是指在响应时间指标内的tps，还是不看响应时间下的最大tps  2.比如我的A业务有一个接口，B业务有2个接口，C业务有5个接口  做混合场景的时候需要给B，C业务分别加一个事物控制器吗</div>2021-09-05</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/vEY47ia7RNvrFNBPJEH9fATq9BJDYajT3ialib61KToAcVa1Zlc2J8RcTl4mgrC72iaUfDGROkQjATNoxohm2wTVyw/132" width="30px"><span>dimens</span> 👍（2） 💬（1）<div>高老师，听了你的专题受益非浅。请叫一个问题，关于响应时延，你专题中并没有提及过分位时延，这些时延在性能测试中影响不大吗？而目前实际项目过程，部分项目直接就看99th时延做为参考指标，这种是否有必要，想听听你的看法和见解？</div>2021-08-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/26/93/2b/13bf1014.jpg" width="30px"><span>香茗已凉</span> 👍（2） 💬（1）<div>tps和响应时间到底是什么关系呢，老师没有给出具体回答，是不是随着响应时间增大，tps肯定会变小呢</div>2021-06-16</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/8oQ7n5tkeHumibyDIPdgG4IPIRP3V9byIqtKa78J0bLdTDVbWHKwDZg1kdm3anzWnlCvL9qib2zeTrk4IwJniaXHg/132" width="30px"><span>张大发</span> 👍（2） 💬（2）<div>老师 有几个疑问帮忙理一下 
第一个疑问失败的事物会计入到tps吗？
第二个疑问理想状态tps达到最大以后随着并发量增加tps为什么会有塌陷区？ 多出来的请求去队列排队 会对系统的处理能力造成影响吗，还是说cpu要同时处理多出来的用户请求造成切换的开销？
第三个疑问是 接上面 这时排队尾的个体等待时间确实变长 但整体处理能力不会因为排队长受影响  比如1秒处理1个事物，现在来5个先处理1个后面4个排队 每秒处理1个 这5个处理完整体也是花了5秒  它的tps还是1  这时平均响应时间怎么计算 是用整体5s&#47;5=1  还是 个体（1+2+3+4+5）&#47;5  =3 ？</div>2020-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/a6/15/0246a2f4.jpg" width="30px"><span>有梦想的tester</span> 👍（2） 💬（3）<div>基准测试中，有什么办法来确定达到了最大TPS了呢</div>2020-03-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/3f/39/a4c2154b.jpg" width="30px"><span>小昭</span> 👍（2） 💬（2）<div>思考题1、为什么说现在市场上的概念对性能项目的实施并没有太大的价值？
想到以下三个方面来回答：
（1）老师文中说了，很多概念都是操作层面的，而不是分析层面。但是性能测试不应只是执行性能测试得到结果，还应该包括分析和调优。所以这些概念显然是不完整的。
（2）我们都知道一个成语叫做“学以致用”，学习的知识最终是为了实际应用的，而这些概念对于实际应用没有任何用处。
（3）人的时间和精力是有限的，把时间和精力花在这些既不完整，又无法帮助我们应用到工作中的概念上，太得不偿失。

思考题2、性能场景为什么要连续？而不是断开？
上节内容给出了性能场景的定义：在既定的环境（包括动态扩展等策略）、既定的数据（包括场景执行中的数据变化）、既定的执行策略、既定的监控之下，执行性能脚本，同时观察系统各层级的性能状态参数变化，并实时判断分析场景是否符合预期。
性能场景的连续、断开其实是在问性能数据，即压力的连续、断开。
调优实际上是控制系统在饱和点之前，所以调优的前提是要先找出饱和点，而一串不连续的数据无法准确的找出饱和点。
此外，除了秒杀场景，一般情况下，压力都是逐步递增，呈线性变化的，我们在测试的时候应尽量模拟真实环境。（这道题表达的不是很清楚，自我感觉不算很明白。大概需要后续的课程来消化）


老师通过本节内容强调了性能场景的重要性，并且再次说明了网络上各种性能概念的不合理性，想到一句话：“造谣一张嘴，辟谣跑断腿”。概念真的太重要了，仿佛一个方向，如果一开始就走错了，那么再多的努力也被浪费了。
看完本节内容之后，真的非常好奇怎么设计性能场景了。</div>2020-03-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/51/72/31a56f56.jpg" width="30px"><span>炽焰</span> 👍（2） 💬（1）<div>我并发数的估算方式有些问题，网上提供了好几种计算方法，其中有一种是根据用户在线时间计算，C=nL&#47;T
L和T都是时间长度，那么他们的单位不都被约分掉了吗？剩下计算出来的并发数是什么？例如，2000人在1天里会活跃8小时，在线平均时长为4小时，那么
C=2000人*4小时&#47;8小时
=1000人？这个并发1000人是什么鬼？2000人的系统需要这么高的并发吗？不科学吧。</div>2020-03-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/a6/43/bcd2e39d.jpg" width="30px"><span>宝贝萱</span> 👍（1） 💬（1）<div>单场景测试目的只是通过单个业务功能或者接口测试，保证压测数据稳定性以及在单个功能压测的情况下功能或者接口的稳定性，为保证后续混合场景</div>2022-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1b/41/5b/aa3ca816.jpg" width="30px"><span>Cathy</span> 👍（1） 💬（1）<div>看了标题，有些紧张，有点不敢点开，担心归纳出什么数学公式出来，烧脑。
为了赶进度，不得不继续。还好，这一讲，继续探讨概念。上一讲从性能测试过程来讲，这一讲从性能场景的角度来讲。听了3遍，静下心来，终于听懂了。</div>2022-01-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/e2/2f/37544dc5.jpg" width="30px"><span>熊</span> 👍（1） 💬（1）<div>内网测试tps是外网的2倍，而且外网测试会有少部分没有响应的错误。这个是网络频率吗</div>2021-11-18</li><br/>
</ul>