你好，我是赵成，欢迎回来。

上一讲是我们引入SRE的关键，我们掌握了选择SLI指标和设定SLO目标的方法。你可以先回顾一下内容，看看是不是能回答这三个问题：选择SLI的两大原则是什么？VALET法则是什么？怎么来计算SLO？如果答案都很清晰，那么恭喜你，你攻克了SRE的一个关键知识点；如果有点模糊，那就回去复习一下，咱不求快，但求扎实。

今天，我们就顺着SLO这条线，继续深入，一起来看有了SLO之后，围绕着它我们可以做哪些事情，或者说我们具体应该怎么来应用SLO呢？还有，SLO设定后，是合理还是不合理，我们应该用什么样的方法来评估呢？如果设定得不合理，我们又应该怎么来调整呢？

带着这些问题，开始我们今天的学习。

## 落地SLO，先转化为Error Budget

SLO是目标，定目标总是一件激动人心的事，但是目标定了之后，这个目标怎么能指导我们的具体工作呢，有时候就没那么一目了然了。

这么说有点抽象，我举个生活中的例子。你通过好几轮考试，拿到了驾照，现在你可以开车上路了。交管局的目标就是你要遵守交规，安全驾驶。这个目标咋实现呢？我们都知道了，就是驾照记分制。你的驾照在1年的这个周期里，总共有12分，扣完了驾照失效，这样你就会关注自己还有几分，特别注意交规。用这个方式，就把你要趋近100%遵守交规的目标转变为你一年只有12分可扣，一个大目标就有了很具体的落地形式。
<div><strong>精选留言（26）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg" width="30px"><span>于加硕</span> 👍（10） 💬（1）<div>之前我们是按照故障范围来制定，例如多个服务，核心服务，网络区域，IDC等来划分等级区间。
文中提到告警这块我分下我自己实践：告警这块很多都是通过(监控产品本身优化)收敛，聚合等优化，其实还可以通过运营的角度进行优化，通过对告警信息进行多维度的统计分析，为优化指明方向，参考:https:&#47;&#47;blog.csdn.net&#47;qq_17472959&#47;article&#47;details&#47;105001854
 a.面向SRE

 	- 告警总量统计								#清晰直观的告诉SRE每天的历史总告警趋势
 	
 	- 各个业务线告警数量分析(统计数量与占比)	#告诉SRE我们应该去关注那条业务线的告警
 	
 	- 所有服务告警数量分析(统计数量与占比)		#便于服务负责人第一时间知道服务告警情况
 	
 	- 所有主机告警数量分析(统计数量与占比)		#便于SRE精准定位是否由于个别主机造成的告警总量上升
 	
 	- 各业务线告警明细分析(以此向下展示业务维度统计结果，服务维度统计结果，主机维度统计结果，告警类型统计结果)	#通过这样的层级展示，基本就理清了告警的构成


 b.面向监控
 
 	- 告警类型分析(统计各类告警数量与占比)		#目的告知监控系统负责人，有些监控项，或阈值需要关注与优化
 
 c.面向研发
 	
 	- 研发告警分析(统计研发名下所有项目告警数量与占比)	#如果是应用造成的长期告警，需要研发关注这个，共同优化告警

</div>2020-04-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/50/33/43833f7c.jpg" width="30px"><span>Nick</span> 👍（6） 💬（2）<div>文中有一段是这样描述的：“假设在 4 周的时间，这个应用所有的请求次数是 4,653,680，按照给出的 SLO 反向推导，就可以得到容许的错误次数，这就是错误预算。”

我有个疑问，4周内的总请求数是未知的，而且不是固定的，那这样错误预算无法提前制定阿？
</div>2020-04-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/0c/30/d4737cd5.jpg" width="30px"><span>lyonger</span> 👍（4） 💬（2）<div>感觉先要结合自身的系统或者应用做好各种数据分析，采集好SLI相关数据。接着推动周边团队达成共识，形成规范，这个推动只能靠大佬。有了规范和数据，就可以进行量化，出了问题大家不会互相甩锅。</div>2020-03-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg" width="30px"><span>于加硕</span> 👍（3） 💬（1）<div>推广SRE体系采用自上而下的方式。前提是我的上级要非常相信SRE能产出成果，于是我应该先做出一些SRE尝试的案例且取得成果，并向上影响。既而达成自上而下？目前想这么干，可行不赵老师？</div>2020-04-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（1） 💬（2）<div>老师的3种划分其实蛮典型：这其实是不少企业挺典型的。
有些可能就更加粗暴点了：硬件问题-这个不背锅，备件&#47;备用备用都出问题-你就被背吧；
系统问题：特例且及时上报了-不背，误操作导致或者隐瞒导致问题扩大了-等着大板子吧；
软件问题：有背锅侠供应商的那就他们了，没有且解释影响使用-等着处理吧。
其实结合运维体系那门课穿插-挺好的；挺容易理解。谢谢今天的分享。</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/03/d9/7538e630.jpg" width="30px"><span>终身学习者</span> 👍（0） 💬（1）<div>我们的故障定级和业务影响相关，这个要具体和应用、业务方进行沟通，确定实际业务影响时间、范围、损失金额，然后根据制定的标准进行对应。但是沟通过程也是个麻烦事。</div>2020-03-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/05/62/0a4e5831.jpg" width="30px"><span>soong</span> 👍（0） 💬（1）<div>产品处于验证阶段，目前暂未有故障定级，通过学习，愈发强化了建立稳定性共识的重要性，有必要立即着手建立一套关于稳定性的运作机制！</div>2020-03-31</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/6uxdSyhE7o3V1qHVaucicIlT4Emh6TrrVK40QQhltB3Ac1QAgj24uJsf3nLzJlXiaSJgDoYUGqpZfXBEPGyJQZQg/132" width="30px"><span>黑暗天使</span> 👍（0） 💬（1）<div>像基础服务如何定义slo，如db，缓存，消息中间件等服务，他们一般出问题，虽然一般都会反映到应用定的slo来，但一般公司应用运维应用的告警，基础服务团队接基础服务的告警，这样基础服务团队按照应用的用户体验还是几xx错误率有点行不通，这里有什么好的办法定义slo与sli么</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d0/29/271cf37c.jpg" width="30px"><span>lhc</span> 👍（0） 💬（1）<div>故障定级确实有点难。可分为几类情况
交易强相关: 定级严格，如客诉超过10并且成功率持续（5分钟）时间小于80%并且错误码大于20 定为pX，其他类似。
资金相关:涉及到资损，大于500小于1000 p4，大于1000 p3等等
接囗:根据成功率加错误码的持续时间来定。

故障定级一定要拉上各方一起定级，定的太高太低都不太好。</div>2020-03-25</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJrOl63enWXCRxN0SoucliclBme0qrRb19ATrWIOIvibKIz8UAuVgicBMibIVUznerHnjotI4dm6ibODA/132" width="30px"><span>Helios</span> 👍（0） 💬（1）<div>我们公司没啥故障定级，在客户内部署之后，如果遇到问题反馈给我们，然后开发反馈要多长时间能修复或者客户要求多长时间修复，等修复之后给客户一个补丁包😂

如果收到客户反馈必须要修复的问题，我们一般就是最高优先级，如果是能在下一个迭代中解决，那就在下个迭代中解决。

故障评级个人感觉主要是为了给一个响应的优先级（还有后续追责～），对于我们这种业务，目前只有一种优先级感觉还挺适用，请问老师有什麽建议没～</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/8d/76/994a9929.jpg" width="30px"><span>OlafOO</span> 👍（0） 💬（2）<div>之前公司是按照故障影响时长、人数、金额来定的</div>2020-03-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/46/b6/edfe7ce8.jpg" width="30px"><span>夜里吃西瓜</span> 👍（8） 💬（1）<div>请求次数是4,653,680，按照给出的 SLO 反向推导，就可以得到容许的错误次数。得出的结果是23268。但是我算的是2326.84  (4,653,680 * 0.0005)</div>2020-05-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/bf/22/26530e66.jpg" width="30px"><span>趁早</span> 👍（4） 💬（0）<div>感觉文中提高的error budget举的那个例子有点难实现哈，比如应用4周总的请求数，这个根本不太好预估哈，这个值不准  后面的错误率以及错误预算都是不准的</div>2020-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c9/68/1cf4dcf7.jpg" width="30px"><span>大表哥</span> 👍（1） 💬（1）<div>目前所在团队故障等级定级的标准是:影响用户数、既不影响用户数不算作故障、这是一种简单的方法也表达极致关注用户体验。</div>2023-04-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（1） 💬（0）<div>像是 Prometheus 这种请求响应时间90线都是通过 histogram 来实现的,只统计了小于某几个固定响应时间的请求个数，这样可以近似计算出90线，比如结果是80ms，但是可能 histogram 只统计了 50ms 和 100ms 两个固定区间的请求数据，比如小于等于50ms的请求有200个，小于等于100ms的请求有300个，如果想统计消耗的错误预算数，比如统计大于80ms请求个数，这个就没有办法计算了，老师有什么好的方法计算吗？</div>2020-06-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/46/5b/07858c33.jpg" width="30px"><span>Pixar</span> 👍（1） 💬（2）<div>关于通过ErrorBudget(EB)进行故障定级有两个比较疑惑的细节问题，赵老师能帮忙解答下吗？
1. 如何确定一个故障发生的起点与终点呢？ 比如一个工作日平稳运行的系统每小时EB消耗为1&#47;1000, 然后故障发生, 这个时候怎么来确定这个时间点就是故障发生的起始位置呢? 是通过消耗速率突然增加来检测吗？ 如果是的话检测周期怎么设定比较合适呢？ 
2. 知道了起始位置, 因为故障从发现到解决要维持一段时间, 所以这个故障在解决时间段内就会从p3上升至p1级别, 那么这个报警要怎么解决呢？</div>2020-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d0/b1/87853049.jpg" width="30px"><span>郑文祥</span> 👍（0） 💬（0）<div>错误预算是建立在已知的总请求数上的，未来四周的总请求数是估算出来的，感觉不太好落地，落地的话老师有什么建议吗？</div>2024-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/d0/b1/87853049.jpg" width="30px"><span>郑文祥</span> 👍（0） 💬（0）<div>老师您好，我想问一下，文中的故障等级设定是建立在假设“假设在 4 周的时间，这个应用所有的请求次数是 4,653,680，按照给出的 SLO 反向推导，就可以得到容许的错误次数，这就是错误预算。”的基础上的，如果是真实场景，这个请求次数是无法准确计算的，那这个故障等级设定该如何落地呢？</div>2024-12-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg" width="30px"><span>怀揣梦想的学渣</span> 👍（0） 💬（0）<div>我公司业务系统A资源占用率在日常无论是70%还是90%，随便弹告警，无所谓的。但是在指定时间段，就必须全力以赴的对待，因为只有指定时间是客户真实使用的时间。那个时间段是客户的领导办公室集中访问的时间。</div>2023-06-15</li><br/><li><img src="" width="30px"><span>Geek_91c9b9</span> 👍（0） 💬（0）<div>“人肉”投入程度  在03篇中对Ticket有过相似的疑问，就是这个指标如何衡量，是否适用？能否举出更具体的例子？
“用户满意度” 数据从何处得来？比如服务上线后，要做用户满意度调查？显然这不切实际。“真实渠道如客服投诉、客户访谈和舆情监控获取；虚拟渠道如真机模拟拨测。” 只是部分情况下可行。有没有更普遍的和可实践的评估方式？
</div>2022-03-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/60/05/3797d774.jpg" width="30px"><span>forever</span> 👍（0） 💬（0）<div>我们的应用提供在线票务购买功能，目前故障定级的依据是判断故障是否影响用户下单，使用影响下单用户的数量来做故障定级，比如:
影响用户下单数大于0,则认定为P2;
影响用户下单数大于50，则认定为P1；
影响用户下单数大于500，则认定为P0；
功能性比如限流风控导致用户无法顺利进行购票的，一般被认为是非P；
定级是还会考虑故障的影响时间，也有一个等级标准，
最终的定级都是通过故障复盘，拉着开发、业务、产品等相关人员一起敲定的，这样的话定级就是大家都认同的，减少相互扯皮的情况发生。

</div>2022-02-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/eb/ef/fc2d102c.jpg" width="30px"><span>老张</span> 👍（0） 💬（0）<div>我们公司，除了从监控维度的指标来故障定级之外，还有一个时间范围内的客诉量、企业资损、品牌价值的降低（这个有专门的品牌运营团队来评估给出结果）。</div>2022-02-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg" width="30px"><span>于加硕</span> 👍（0） 💬（0）<div>我自己的实践
    将SLO转化为不可用性，然后分析它的形成
        计算不可用性，定位到具体的api，逐个解决，降低不可用性，来提升可用性。</div>2020-10-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b0/8a/3ecf6853.jpg" width="30px"><span>Browser</span> 👍（0） 💬（0）<div>尝试使用SRE体系</div>2020-10-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg" width="30px"><span>mickey</span> 👍（0） 💬（0）<div>我感觉错误预算的燃尽图是很好的指标警示图，可以很直观的一言就可以看到当前系统状态和一段时间内系统的稳定情况，然后这个指标值的确立需要一个综合性的计算指标。</div>2020-05-19</li><br/><li><img src="" width="30px"><span>oci</span> 👍（0） 💬（0）<div>运维好工具</div>2020-03-27</li><br/>
</ul>