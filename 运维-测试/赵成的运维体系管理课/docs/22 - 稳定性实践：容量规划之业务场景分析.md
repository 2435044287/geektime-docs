上期文章我们从整体上介绍了极端业务场景下，如何做好稳定性保障工作。今天，我们结合电商大促这个场景，来看一下容量规划这项工作。

稳定性保障的一个难点是我们要面对一个非常复杂的因素，那就是业务模型，或者叫用户访问模型。因为它的不确定性，会衍生出很多不同的业务场景，而不同的场景，就会导致我们的应对策略有所不同。

所以，**容量规划，就是对复杂业务场景的分析，通过一定的技术手段（如压力测试），来达到对资源合理扩容、有效规划的过程。**

## 容量规划的场景分析

我们一直在讲，不能脱离业务场景空谈技术，所以我们还是先从电商大促这个业务场景入手来分析。

对于电商来说，核心链路就是交易链路。简单来说，就是用户要能登录，然后能通过浏览商品详情页下单订购，或者加购物车，通过购物车进行订购结算，这个过程中还要进行各种优惠的批价处理，库存的判断等等，形成订购之后，最终还要能够支付成功，一个完整的交易支付流程才算走完。

在大促的峰值时刻，场景可能又有不同，因为绝大部分用户选购什么商品，早已加入到了购物车中，且各种优惠券也已经申领成功，就等着最后这个时间点直接下单完成订购。所以，在大促这个场景下，交易下单这个环节是核心中的核心。

因为这个时间点的交易流量实在是太高了，所以近两年电商也改变了一些玩法，其目的就是希望减少峰值流量，让流量在整个大促阶段更加均匀。具体的运营和玩法细节这里就不详细介绍了。

那么，我们要应对的场景就相对清晰了，就是在大促零点峰值时刻，评估好交易流量，再进一步转化一下，就是每秒的交易订单峰值。

下图就是我们进行评估的路径分析示例，用户首先从首页、大促会场或者微信里的分享页面转化过来，然后通过搜索、店铺、详情页以及购物车进行最后的转化，形成订购下单和最终的支付。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/0f/d5/73ebd489.jpg" width="30px"><span>于加硕</span> 👍（0） 💬（0）<div>赵老师，你好，请教个问题：微服务架构下，就应用服务而言，HPA、VPA可以快速实现扩缩容容量，满足业务场景所需的容量，是不是不需要容量规划？提前将容量扩容上去。</div>2024-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg" width="30px"><span>恶魔果实</span> 👍（0） 💬（0）<div>如何能给出一个具体的运算过程例子，会很舒服，这样的概念其实都懂，就是不知道怎么根据压测结果推算多少容量合适。</div>2021-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1f/59/6d5a8060.jpg" width="30px"><span>Dragon</span> 👍（0） 💬（1）<div>扩容 扩的是什么</div>2018-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/1f/59/6d5a8060.jpg" width="30px"><span>Dragon</span> 👍（0） 💬（0）<div>扩容。扩的是什么？</div>2018-08-01</li><br/>
</ul>