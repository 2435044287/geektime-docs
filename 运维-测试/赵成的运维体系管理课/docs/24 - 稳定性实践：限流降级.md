本周我们继续来讨论稳定性实践的内容。在现实情况下，当面对极端的业务场景时，瞬时的业务流量会带来大大超出系统真实容量的压力。

为了应对，前面我们介绍了容量规划方面的实践经验。不过，我们不会无限度地通过扩容资源来提升容量，因为无论从技术角度，还是从成本投入角度，这样做都是不划算的，也是不现实的。

所以，我们通常采取的策略就是**限流降级**，以保障承诺容量下的系统稳定；同时还有业务层面的**开关预案**执行，峰值时刻只保障核心业务功能，非核心业务功能就关闭。

今天我们就先来介绍一下**限流降级的解决方案**。

## 什么是限流和降级

首先，我们先梳理清楚限流和降级的概念，明白它们会发挥怎样的作用，这样才便于我们理解后续的解决方案。

- **限流**，它的作用是根据某个应用或基础部件的某些核心指标，如QPS或并发线程数，来决定是否将后续的请求进行拦截。比如我们设定1秒QPS阈值为200，如果某一秒的QPS为210，那超出的10个请求就会被拦截掉，直接返回约定的错误码或提示页面。
- **降级**，它的作用是通过判断某个应用或组件的服务状态是否正常，来决定是否继续提供服务。以RT举例，我们根据经验，一个应用的RT在50ms以内，可以正常提供服务，一旦超过50ms，可能就会导致周边依赖的报错或超时。所以，这时我们就要设定一个策略，如果应用的RT在某段时间内超过50ms的调用次数多于N次，那该应用或该应用的某个实例就必须降级，不再对外提供服务，可以在静默一定时间后（比如5s或10s）重新开启服务。

这里再特别说一下降级，今天我们讲的内容可以理解为服务降级，后面我会介绍业务开关，可以理解为业务降级。这里只是叫法不同，不同的人有不同的理解，所以我们在讨论概念时，还是尽量回到我们要解决的问题和场景上来，上下文保持一致了，在观点和思路上也更容易达成一致。

讲到这里，再提个问题，我们讲的降级，和熔断这个概念是什么关系？你不妨停下来，按照我们刚刚讲过的思路思考一下。

## 常见的限流解决方案

我们先看几种常见的限流类型。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/c3/78/325a37e2.jpg" width="30px"><span>Tom</span> 👍（1） 💬（1）<div>又看到机器学习了</div>2018-03-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/ca/b8/bcfb6e4a.jpg" width="30px"><span>xiaoyao</span> 👍（2） 💬（1）<div>Nginx 限流 ，有具体的案例吗</div>2020-03-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/fa/1f/fa164066.jpg" width="30px"><span>as-范</span> 👍（0） 💬（0）<div>限流与（服务）降级个人在理解上还是有点混淆，其中的区别是什么？首先两者都是从服务提供方入手，是说限流在无论多么恶劣的条件下都保证最低限度的可用（比如200qps），而降级可以做到服务直接不提供服务的差别么？文中以判断服务状态&#47;核心指标，来决定提供后续服务&#47;拦截后续请求，从我的理解上来看，都是同一件事儿，rt与qps都算是服务的指标，不提供后续服务和拦截后续请求也可以是同样的处理手段。另外熔断个人理解是client对服务端异常时的主动处置，文中留了思考题，没有在本文中找到答案，后面还会认真的去寻找。作为开发能从本课中拎出运维的体系，把零散的运维动作串起来，对系统建设有自己的深入理解，感谢分享，也感谢互联时代~</div>2022-05-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/35/0d/132de214.jpg" width="30px"><span>patch_bug</span> 👍（0） 💬（0）<div>降级呢？</div>2021-08-09</li><br/>
</ul>