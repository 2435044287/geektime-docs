在前面5期文章中，我们分别详细介绍了持续交付体系基础层面的建设，主要是多环境和配置管理，这些是持续交付自动化体系的基础，是跟我们实际的业务场景和特点强相关的，所以希望你一定要重视基础的建设。

本期文章是我们持续交付系列的第6篇文章，从本期开始，我们进入到交付流水线体系相关的内容介绍中。

## 持续交付流水线简要说明

从一个应用的代码提交开始，到发布线上的主要环节，整个流程串起来就是一个简化的流水线模式。如下图所示：

![](https://static001.geekbang.org/resource/image/4d/d0/4dd0d31b8b6df7a3f0d58c7554a8e7d0.jpg?wh=622%2A277)

我们前面介绍了持续交付的多环境以及配置管理，而流水线模式的整个过程正是在这个基础上执行，所以它的某些环节和要素与我们的多环境是有一些交叉的。比如，功能测试会在线下相关的几个环境上完成，比如我们前面介绍到的开发联调环境、项目环境和集成测试环境。

但是，它们要达成的测试目的是不同的：对于非功能验收，我们会在线上的预发环境完成，因为预发环境更接近真实场景，所以像容量、性能、安全这些跟线上稳定性相关的能力验收，越接近真实环境，效果越好。

后面几期文章，我会结合我们的实践，分环节来介绍。本期文章我们先看项目需求分解和开发模式选择。

## 项目需求分解

持续交付我认为更多的是针对应用层面，所以项目需求分解这一部分，这里我们就不展开讲了。这里我们的工作重点，就是将项目管理中的需求与持续发布中的应用这二者很好地关联起来。

比较通用的做法，就是要求业务架构师在做需求分析和功能设计时，**要针对一个需求进行拆分，最终拆分成一个个的功能点，这些功能点最终落实到一个个对应的应用中，对应的逻辑体现就是应用代码的一个feature分支**。

如下图所示：

![](https://static001.geekbang.org/resource/image/49/69/499a10123bf4b2b30aa90d6c04d78269.jpg?wh=426%2A366)

举个简单的例子，比如我们要做大促的优惠活动，同一店铺商品购满500元，可以使用10元店铺内优惠券，同时还可以使用10元全站优惠券。

这样一个需求最终拆解下来，可能需要店铺应用支持多优惠活动的叠加，同时下单应用和购物车应用在计算价格时也要设定相关的优惠逻辑，这一个需求可能就拆出三四个功能点。

这样做的好处就是，**从一开始的需求管理维度，就确定了最终多个应用联调、测试以及最终发布的计划和协作方式**，从而就会让我们明确同一个项目环境中到底需要部署哪些应用，这些应用的发布顺序怎样安排。

比如，如果A应用依赖B应用，那么B应用就必须优先发布。所以，上述这个过程对于项目进度管理、团队协作以及最终的发布计划都是有帮助的。

讲到这里，你是不是又进一步感受到了运维的重要性呢？
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/10/16/dd/79057184.jpg" width="30px"><span>唐😊 木木</span> 👍（4） 💬（0）<div>分支开发模式看起来很像gitflow模式少了devlope和hotfix分支。直接把master当dev分支，拉出的特性开发分支然后merge到release分支，release在经过测试合并到master分支。不知道这么看对不对。</div>2019-06-14</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/24/33/bcf37f50.jpg" width="30px"><span>阿甘</span> 👍（0） 💬（0）<div>分支开发模式其实就是阿里的AoneFlow模式，这种模式虽然看起来比GitFlow简单，但是少了develop分支，代码的集成会偏后，合并冲突的概率会变大。</div>2024-09-08</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/oJiao7ZSm1eicvM61PaIYqTF3qz0b00Wiciag5iaP2JD1AUx8Xg0ABavbbOPbxXeL2Veep8Tr6AoAXSqLnZybeicjILQ/132" width="30px"><span>我在线</span> 👍（0） 💬（0）<div>一个需求拆分下来多个应用，但是有可能这些应用是由不同的团队在维护。这时候怎么协作呢</div>2024-02-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/6c/5b/5bf2c4cc.jpg" width="30px"><span>森馫鑫</span> 👍（0） 💬（0）<div>系统功能一直是按固定版本发布，因此基本都是选用了gitflow开发模式，不过对于新系统更加追求小步快走，在这个时候会用主干开发模式。</div>2018-07-15</li><br/>
</ul>