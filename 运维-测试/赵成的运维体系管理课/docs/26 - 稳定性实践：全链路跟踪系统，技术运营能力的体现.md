今天我们来分享全链路跟踪系统建设方面的内容。我们知道，随着微服务和分布式架构的引入，各类应用和基础组件形成了网状的分布式调用关系，这种复杂的调用关系就大大增加了问题定位、瓶颈分析、容量评估以及限流降级等稳定性保障工作的难度，如我们常见的调用网状关系。

![](https://static001.geekbang.org/resource/image/4c/f6/4c034ffe82db8509f252218f632ec2f6.png?wh=740%2A361)

图片出自：[https://www.linkedin.com/pulse/100-million-members-125-hours-watched-per-day-hundreds-probst/](https://www.linkedin.com/pulse/100-million-members-125-hours-watched-per-day-hundreds-probst/%5Breference_end%5D)

正是这样的背景，催生了**分布式链路跟踪**，也叫**全链路跟踪**的解决方案。

关于这一块的技术解决方案，在Google的Dapper论文发表之后，近些年业界已经有非常多且非常成熟的实践经验和开源产品。

比如阿里的鹰眼系统，就是全链路跟踪系统在国内的最佳实践；再比如美团点评的CAT分布式监控系统，也是从产品实践中逐步开源出来，在业界已经得到了非常广泛的应用；还有一些独立的开源产品，比如国内分布式监控技术专家吴晟创建的Skywalking项目，也是非常优秀的产品，而且也有比较广泛的应用。

除此之外，还有大量优秀的商业产品，这类产品通常叫APM，应用性能管理系统，比如国内的听云、博瑞、OneAPM等等，他们在产品化方面做的会更完善，在很多场景下可以非常方便地落地应用。

介绍上述这些产品，主要还是想说明，当前在分布式或全链路跟踪监控这个领域，无论是在技术还是产品层面都已经相对成熟，我们完全可以通过对这些产品的调研来选择适合自己的解决方案。

蘑菇街在这块也是自研了一套体系，但是技术方案和思路上跟上述这些开源或商业产品都很相似，所以技术层面我就不再做详细赘述。

如果想深入了解相关内容，一方面可以在网上找到非常多的资料，甚至是去阅读源码；另一方面还是推荐极客时间上陈皓老师的《左耳听风》专栏和杨波老师的《微服务架构核心20讲》，两位都是骨灰级的微服务和分布式架构专家，他们在技术层面的分享会更有深度和针对性。

## 全链路跟踪系统在技术运营层面的应用

接下来，主要分享我们利用全链路跟踪系统在技术运营层面做的一些事情，这里提到的运营，就是应用在线上运行时，我们根据应用运行数据所做的运行维护工作，这里我们会更加强调数据的作用。

同时，这里的一个核心技术点就是 **TraceID**，当请求从接入层进来时，这个TraceID就要被创建出来；或者是通过Nginx插件方式创建放到http的header里面；或者是通过RPC服务化框架生成。然后在后续的请求中，这个字段会通过框架自动传递到下一个调用方，而不需要业务考虑如何处理这个核心字段。

有了这个TraceID，我们就可以将一个完整的请求链路给串联起来了，这也是后面场景化应用的基础。下面我们就一起来看会有哪些具体的技术运营场景。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg" width="30px"><span>天草二十六</span> 👍（3） 💬（1）<div>透传是让框架去做，不要在程序里硬编码。
如果是有h5或者客户端的请求，让在http头部传入traceId，否则自己生成traceId.  
对于spring cloud体系，极力推荐sleuth，可以帮你做到，免去代码的硬耦合。</div>2019-09-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/42/76/256bbd43.jpg" width="30px"><span>松花皮蛋me</span> 👍（2） 💬（1）<div>老师如果有多级cdn缓存节点链路跟踪怎么做？</div>2018-03-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg" width="30px"><span>芝士老爹</span> 👍（0） 💬（0）<div>老师，想请教下：Java应用，使用线程池+异步的方式，怎么传递TraceID？
我们现在使用的框架不支持，想改造的话，思路在哪儿？</div>2018-11-22</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/44/6c/05d0872b.jpg" width="30px"><span>仔仔</span> 👍（0） 💬（0）<div>但是在很多公司里面，其实开发并不愿意取修改代码支持traceid的传递，真对这种情况，如何从运维层面取实现对应的分布式调用跟踪？</div>2018-10-22</li><br/>
</ul>