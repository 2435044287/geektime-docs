上期文章中我们介绍了CDN和云存储的实践，以及云生态的崛起之路，今天，我们继续聊一聊CDN。

我们通常意义上讲的CDN，更多的是针对静态资源类的内容分发网络，最典型的就是电商的各类图片，还有JS和CSS这样的样式文件。通过CDN能够让用户就近访问，提升用户体验。

但是这类文件只是以单纯的资源存在，与业务逻辑没有强关联。所以我们在技术上，可以使用业界通用的CDN和云存储解决方案。

需要注意的是，本文中我们讲到的实践内容，同样是遵从**静态内容，就近访问**这个原则的。

但是，因为其中包含了大量的业务逻辑，这就要求我们在面对不同的场景时，要有跟业务逻辑相关的定制化的解决方案。

下面，我们就一起来看看页面静态化架构和二级CDN建设。

## 静态化架构建设的业务场景

我们仍然回到电商的业务场景中来。对于电商，访问量最大的无疑是商品的详情页，绝大多数用户都要通过浏览商品详情，来决定是否下单。所以单就这一类页面，就占到全站30%+的流量。

那么，商品详情一般由哪些部分组成呢？我们看下面两个截图：

![](https://static001.geekbang.org/resource/image/4c/c0/4c327a6e6525eb2f9b09777f419079c0.jpg?wh=814%2A578)  
￼  
![](https://static001.geekbang.org/resource/image/6e/5e/6ea58723cbdb099c464c2fefbc0c915e.jpg?wh=599%2A397)  
￼  
以上两张图就是某个商品详情页的主要组成部分。我们可以看到，商品详情大致包括了商品名称、商品描述、产品参数描述、价格、SKU、库存、评价、优惠活动、优惠规则以及同款推荐等等信息。

这里我们仔细观察可以发现，其实对于商品描述类的信息，比如商品名称、商品描述、产品参数描述等等，一般在商品发布之后，就很少再变动，属于静态化的内容。

而优惠活动、优惠规则、价格等等则是可以灵活调整的，库存和评价这类信息也是随时变化，处于不断的更新中。

说到这里，我们会想到，如果能够把静态化的内容提取出来单独存放，业务请求时直接返回，而不用再通过调用应用层接口的方式，去访问缓存或者查询数据库，那访问效率一定是会大幅提升的。

所以，我们在参考和调研了业界的解决方案之后，引入了页面静态化架构。
<div><strong>精选留言（4）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/16/60/c1/5ca216ba.jpg" width="30px"><span>Ω ٩(ˊᗜˋ*)و</span> 👍（0） 💬（2）<div>请问ats这层可以去掉么，直接nginx实现动静分离</div>2020-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c4/e2/3de4371d.jpg" width="30px"><span>江龙</span> 👍（1） 💬（0）<div>有个问题请教下，示意图中，是一个接口中返回了静态信息+动态信息，那在做二级cdn时，由于这个接口包含了动态信息，那不是每次都需要回源吗？是否上面根据动静内容分为两个接口更合适些？</div>2018-09-03</li><br/><li><img src="" width="30px"><span>Geek_53261d</span> 👍（0） 💬（0）<div>高可用保障中提到的切换中心节点，具体是怎么做？直接将加速域名解析由cdn服务的cname切换为中心节点公网ip吗？这个解析一般也要几分钟到几十分钟呢？</div>2023-09-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/01/bb/7d15d44a.jpg" width="30px"><span>欧雄虎(Badguy）</span> 👍（0） 💬（0）<div>失效消息通过 HTTP 的 Purge 方法发送给 ATS，而失效中心则会通过订阅消息系统中特定的 Topic，或者 MySql 中特定的 binlong 变更，执行失效。老师这里方便再介绍详细一些么？</div>2020-11-27</li><br/>
</ul>