你好，我是DS Hunter。

上一讲，我们谈到了无收益的前端是如何为反爬提供基础保障支持的。但是你应该是知道的，前端没有什么秘密可言。那么，那部分前端不能做的，后端不好做的，我们放在哪里处理呢？

是的，最终还是BFF扛下了所有。BFF天生就是为了这些事情而生的。

在当前的浪潮下，大家似乎将BFF与Node.js划了等号，事实上并非如此。BFF：Backend For Frontend，服务于前端的后端，仅仅是一种设计思路，只不过Node.js在当前环境下是最优解而已。实际上，很多公司都会有一个API层来进行服务转发，这一层就相当于BFF层，它未必是Node.js站点。

这一讲，我们就来看一下BFF的主要功能以及实现方式。在学习的过程中，我也希望你能理解BFF存在的真正价值。我们先从BFF形成的第一步：选型，开始了解吧。

## BFF选型

关于BFF选型，理论上我们可以使用任何语言。但是实际上90%以上的公司，最终会选择Node.js。

### Node.js：Express

Node.js可以承载常规http请求，并且因为与前端使用相同的编程语言：JavaScript，因此能很方便的让前端人员兼职掉BFF工作。这是常规公司选型的理由之一。对于反爬来说，我们有更进一步的选型原因：
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg" width="30px"><span>neohope</span> 👍（0） 💬（1）<div>你们的公司出于各种原因，BFF 没有选择 Node.js 技术栈。那么，你是硬着头皮在这种技术栈做反爬呢，还是想办法让 BFF 转 Node.js 呢？如果你认为不可能成功，那么理由是什么呢？
两个极端的团队难以引入新技术，一是技术信仰的洁癖，二是技术思想过于陈旧。
布道不成，那就变通一下呗，AST等用到JS解析器器的想办法调用Node处理，其他Java、CPP、PHP、Go、Lua什么的写写呗

Express 的官方自定义 Engine 的 demo 里面，会频繁读文件。虽然 Node.js 是异步的，但是也顶不住没完没了的读硬盘啊。如何提升性能呢？
自己改Express【硬件省人不省】 或 用好缓存【硬件省人不省】 或 更换高速硬盘设备【钱多人懒不在乎】


集群实现随机，你精心配置，终于实现了 79.4%。然后机器扩容，随机值又变了。那么，如何处理这个问题呢？
第一个念头是，写个小工具，贪婪算法出方案，人工看下没啥问题就上了
非要人工的话，可以用3~5台为一组，配置出需要的数值，每次都上或下一组
</div>2022-03-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg" width="30px"><span>peter</span> 👍（0） 💬（1）<div>请教老师几个问题：
Q1： AST转换是指什么？
Q2： 机器核数一般10核，那么2倍是20个连接。但tomcat需要创建500个连接？
Q3： Node.js 天生是为单 CPU 设计的，而 Cluster 本身只是充分利用了多核
Q4：Node.js天生高并发，它的并发处理能力多大？比Nginx还强吗？
        Node比Java后端的并发能力强吗？ 如果是的话，那岂不是要取代Java后端了？
Q5：哪些毕业生会疯狂爬取数据啊？</div>2022-02-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg" width="30px"><span>leslie</span> 👍（0） 💬（1）<div>均衡看似简单，实则如西天取经。
集群随机的问题聊聊自己的薄见，不知老师是和观点？
集群部分随机，如同兵法～实实虚虚，实则虚之，虚则实之；不过这又给均衡带来了难题-哪里均衡？</div>2022-02-25</li><br/>
</ul>