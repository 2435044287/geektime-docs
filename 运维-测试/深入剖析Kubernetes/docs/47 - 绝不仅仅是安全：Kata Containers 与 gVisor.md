你好，我是张磊。今天我和你分享的主题是：绝不仅仅是安全之Kata Containers 与 gVisor。

在上一篇文章中，我为你详细地讲解了 kubelet 和 CRI 的设计和具体的工作原理。而在讲解 CRI 的诞生背景时，我也提到过，这其中的一个重要推动力，就是基于虚拟化或者独立内核的安全容器项目的逐渐成熟。

使用虚拟化技术来做一个像 Docker 一样的容器项目，并不是一个新鲜的主意。早在 Docker 项目发布之后，Google 公司就开源了一个实验性的项目，叫作 novm。这，可以算是试图使用常规的虚拟化技术来运行 Docker 镜像的第一次尝试。不过，novm 在开源后不久，就被放弃了，这对于 Google 公司来说或许不算是什么新鲜事，但是 novm 的昙花一现，还是激发出了很多内核开发者的灵感。

所以在2015年，几乎在同一个星期，Intel OTC （Open Source Technology Center） 和国内的 HyperHQ 团队同时开源了两个基于虚拟化技术的容器实现，分别叫做 Intel Clear Container 和 runV 项目。

而在2017年，借着 Kubernetes 的东风，这两个相似的容器运行时项目在中立基金会的撮合下最终合并，就成了现在大家耳熟能详的 Kata Containers 项目。 由于 Kata Containers 的本质就是一个精简后的轻量级虚拟机，所以它的特点，就是“像虚拟机一样安全，像容器一样敏捷”。
<div><strong>精选留言（14）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/12/4a/2f/42aa48d7.jpg" width="30px"><span>勇敢的心</span> 👍（40） 💬（1）<div>get到了重点：“gVisor 虽然现在没有任何优势，但是这种通过在用户态运行一个操作系统内核，来为应用进程提供强隔离的思路，的确是未来安全容器进一步演化的一个非常有前途的方向。”</div>2018-12-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/1c/e3/b8c5bfa2.jpg" width="30px"><span>🐵</span> 👍（12） 💬（1）<div>老师，你好，能不能推荐下K8S可以通过哪些项目管理KVM虚拟机</div>2019-01-08</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/GDYkD2X7pXSKUSaUFC8u3TBPaakaibnOBV2NYDc2TNfb8Su9icFMwSod6iaQX5iaGU2gT6xkPuhXeWvY8KaVEZAYzg/132" width="30px"><span>extraterrestrial！！</span> 👍（5） 💬（1）<div>之前的留言不能编辑，还向请教个问题：gvisor拦截系统调用，但是系统调用是内核态才能执行，gvisor拦截下来除了直接执行系统调用还有啥操作空间么？</div>2018-12-15</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/GDYkD2X7pXSKUSaUFC8u3TBPaakaibnOBV2NYDc2TNfb8Su9icFMwSod6iaQX5iaGU2gT6xkPuhXeWvY8KaVEZAYzg/132" width="30px"><span>extraterrestrial！！</span> 👍（2） 💬（1）<div>问个初级问题：看下来觉得kata使用了qemu，和我自己在qemu上跑个正常的ubuntu啥的系统好像没啥区别，就是**做了了精剪**? 这样精剪以后是个什么内核，功能够用么，会不会性能和现在的container差很多之类的...</div>2018-12-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIbKCwLRY5icgW3WtLn0JD7EDksicGFqLAsXTm89SjNhR0KIt3N5iaQEmeic4Ld50Yxsceicia5kBODibZPA/132" width="30px"><span>starnop</span> 👍（1） 💬（1）<div>磊哥您好，有个疑问请教一下，kata结合了runv与clear container，那么runv与clear container之间的区别是什么呢？各有什么优势？kata相比于他们又做了哪些优化呢？</div>2018-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/03/5e/818a8b1b.jpg" width="30px"><span>Alex</span> 👍（62） 💬（0）<div>回答最后的问题：
提供不了；因为gVisor是基于用户态内核的，无法真正做到与宿主机内核不一致的请求响应，因此满足不了对高版本内核请求的需求</div>2018-12-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg" width="30px"><span>拉欧</span> 👍（26） 💬（0）<div>无法提供，gVisor说白了只是一层代理，不是真正的内核；但是这也是google的牛逼之处，把所有的系统调用和协议都代理出来，不是大神级的技术专家，这种活根本做不了</div>2019-11-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/a5/08/2aecb51f.jpg" width="30px"><span>混沌渺无极</span> 👍（10） 💬（0）<div>思考题理解:
gvisor是宿主机kernel的&quot;客户端&quot;，不管怎么拦截容器的调用，最终还是要转为对宿主机kernel的调用，因此低版本的宿主机kernel没有的能力返回容器想要的响应。这时候还是虚拟机管用，因为甚至能在Linux上虚拟出window。</div>2018-12-10</li><br/><li><img src="" width="30px"><span>ch_ort</span> 👍（3） 💬（0）<div>Kata Container本质就是一个精简后的轻量级虚拟机，所以它的特点，就是“像虚拟机一样安全，像容器一样敏捷”。2018年，Google发布了gVisor，给容器进程配置了一个用Go语言实现的“极小独立内核”。

无论是Kata Container还是gVisor，实现安全的方式本质上都是让容器独立一个操作系统内核，避免共享宿主机内核。他们的主要区别是，Kata 通过硬件虚拟化出一台“小虚拟机”，在“小虚拟机”安装裁剪后的Linux内核，而gVisor则是“模拟”出了一个运行在用户态的操作系统内核，通过这个内核来限制容器进程向宿主机发起的调用。

gVisor虽然现在没有任何优势，但是这种通过在用户态运行一个操作系统内核，来为应用进程提供强隔离的思路，的确是未来安全容器进一步演化的一个非常有前途的方向。
</div>2020-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg" width="30px"><span>Heaven</span> 👍（1） 💬（0）<div>不能运行在gVisor中,gVisor本质上是委托给了实际的宿主机内核去执行,有些高版本的api,低版本再如何也无法实现</div>2020-10-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg" width="30px"><span>陈斯佳</span> 👍（0） 💬（0）<div>请教一下老师，Singularity容器是不是也是基于用户态的容器呢？</div>2021-11-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/c1/60/f5439f04.jpg" width="30px"><span>Geek_dn82ci</span> 👍（0） 💬（1）<div>Kata容器对vmm的层的依赖不仅是qemu吧？还需要kvm吧？</div>2020-10-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg" width="30px"><span>LH</span> 👍（0） 💬（0）<div>要掌握的东西太多了</div>2019-12-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/ca/d5/a2cd57c9.jpg" width="30px"><span>小明root</span> 👍（0） 💬（0）<div>后续课程中会讲解route这个概念么？</div>2018-12-10</li><br/>
</ul>