在本篇文章中，我将会对本专栏部分文章最后的思考题，进行一次集中的汇总和答疑。希望能够帮助你更好地理解和掌握 Kubernetes 项目。

问题1：你是否知道如何修复容器中的top指令以及/proc文件系统中的信息呢？（提示：lxcfs）

其实，这个问题的答案在提示里其实已经给出了，即 lxcfs 方案。通过lxcfs，你可以把宿主机的 /var/lib/lxcfs/proc 文件系统挂载到Docker容器的/proc目录下。使得容器中进程读取相应文件内容时，实际上会从容器对应的Cgroups中读取正确的资源限制。 从而得到正确的top 命令的返回值。

> 问题选自第6篇文章[《白话容器基础（二）：隔离与限制》](https://time.geekbang.org/column/article/14653)。

问题2：既然容器的rootfs（比如，Ubuntu镜像），是以只读方式挂载的，那么又如何在容器里修改Ubuntu镜像的内容呢？（提示：Copy-on-Write）

这个问题的答案也同样出现在了提示里。

简单地说，修改一个镜像里的文件的时候，联合文件系统首先会从上到下在各个层中查找有没有目标文件。如果找到，就把这个文件复制到可读写层进行修改。这个修改的结果会屏蔽掉下层的文件，这种方式就被称为copy-on-write。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3jUBQJMfLRQiaKpghicMot32AE70icSn1EsP7vX9t1V2qkp5oM0uXtnp5qmWlZgnXKk2mac0XdgVUQ/132" width="30px"><span>王天神</span> 👍（15） 💬（2）<div>心酸，慢慢的发现自己学习放弃了，有点难懂</div>2019-04-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/49/55/b6c9c0f4.jpg" width="30px"><span>liyinda0000</span> 👍（11） 💬（2）<div>您好 最近k8s的工作中有个问题 如果限制pods资源使用，比如limits内存设置1g，但如果应用程序由于内存使用的不好超出指定内存就会无限重启，查日志也不容易发现对应错误。
现有如下问题：
1）在生产环境中，使用limits是否是比较明智的方法？
2）个人感觉这种超出内存就杀掉进程的方法有点暴力，不知道这个算不算是个问题？新版本或将来的版本是否会有改进？
还望帮助指点，谢谢啦</div>2019-01-15</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6GcSnUMzR0H9haiaAxssjibGLQMLAsPKonh50g9W2Iz38LcZNGH39HPaANLtovXTp1YvsINIZoH6F0iaSGuxJMXZS/132" width="30px"><span>Geek_10d981</span> 👍（66） 💬（1）<div>负责的告诉各位朋友，K8S不容易理解。 我从1996-2003年在北京一个外企做UNIX，曾经给华为中兴讲UNIX课程，2004年移民，一直做技术，对UNIX CLUSTER。ORACLE RAC, WEBSPHERE ,JAVA都熟悉，我接触了AWS，感觉不复杂，AWS就是概念多，很多概念其实UNIX,ORACLE也有类似的，，，，目前我接触K8S，这个课程是比较复杂的，反复看书，动手，还要看英文原版图书，还需要 看UDEMY一些欧美的老师讲课，，，张磊讲解的课程比UNDEMY欧美老师讲解的要深入，非常不错，，，这个课程太划算了，不到20美元，我在北美购买随便一本书都是60-100美元</div>2020-05-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/60/c2/6d50bfdf.jpg" width="30px"><span>唐丹</span> 👍（20） 💬（0）<div>赞👍，跟了一遍，再复习两遍，不放过任何一个细节。多谢老师</div>2018-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg" width="30px"><span>陈斯佳</span> 👍（9） 💬（3）<div>学习k8s确实感觉很不容易。今年是我学习,
k8s第一年，年初考下CKA证书以后马上找了一份和K8s相关的工作，现在基本的命令概念还算比较熟，但是看了张磊老师的文章后，发现自己的理解还是非常的皮毛。如果遇到一点问题，也很难找到问题的根本原因，更别提优化了。不知道这条路还需要走多久，不过好在现在还是处在K8s的红利期，真正有实际操作经验的人还不多，趁这个机会，多学，多练，一定会有所收获的！</div>2021-11-11</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg" width="30px"><span>张三</span> 👍（4） 💬（0）<div>早上看了阿里的声东写的关于k8s的pdf，跟老师讲得很多内容都贴合，结合老师的专栏再好好学习。谢谢</div>2020-04-28</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132" width="30px"><span>kissingers</span> 👍（4） 💬（0）<div>没跟上节奏 不过干货满满 谢谢老师</div>2018-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg" width="30px"><span>亢（知行合一的路上）</span> 👍（3） 💬（0）<div>在思考中产生思考👍 
可以来自别人的问题，自己的问题，总之要刺激大脑不断思考，懂得越多，不同的知识之间越容易产生关联，经过长期努力，最终可能像老师一样融会贯通😄</div>2020-03-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/95/74/53c4e990.jpg" width="30px"><span>Rickybi</span> 👍（3） 💬（0）<div>感觉这50多篇文章值得反复看反复做笔记消化啊。</div>2018-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/86/fb/4add1a52.jpg" width="30px"><span>兵戈</span> 👍（3） 💬（0）<div>感谢磊哥的专栏分享，受益匪浅，还需时时回顾学习。期待下一期专栏</div>2018-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg" width="30px"><span>Johnson</span> 👍（2） 💬（0）<div>结课了 打卡 学的不扎实，还要结合实际深入理解</div>2018-12-21</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLMDBq7lqg9ZasC4f21R0axKJRVCBImPKlQF8yOicLLXIsNgsZxsVyN1mbvFOL6eVPluTNgJofwZeA/132" width="30px"><span>Run</span> 👍（1） 💬（0）<div>希望张磊老师再出点新课</div>2022-04-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/22/0a/7d/ac715471.jpg" width="30px"><span>独孤九剑</span> 👍（1） 💬（0）<div>听君一问答，胜读十年书。</div>2021-07-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/11/831cec7d.jpg" width="30px"><span>小寞子。(≥3≤)</span> 👍（1） 💬（0）<div>看完有一种可以手写k8源码的错觉。 我现在架构自己软件的时候也会开始借鉴一些k8的设计。 比如都是API, controller pattern, 等等等 感谢作者！</div>2021-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/bf/cd6bfc22.jpg" width="30px"><span>自然</span> 👍（1） 💬（1）<div>我们现在是传统的单体应用，多用GBK字符集，默认的docker镜像是不带GBK字符集的，这种情况怎么处理？</div>2020-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/98/61/ab1e3ac0.jpg" width="30px"><span>子非鱼</span> 👍（1） 💬（0）<div>好深，之前看完了cloudman的博客，现在更深入了，受益匪浅！</div>2018-12-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/44/f4/6b456c12.jpg" width="30px"><span>杜鹏</span> 👍（1） 💬（1）<div>生产环境中用的默认flannel网络，大规模部署情况下，经常碰到机器之间可以ping通，pod之间不可以。如果pod在同样的机器上重启的话，还是不可以ping通。必须要让pod在其他机器上启动才可以通。</div>2018-12-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/08/bd/a2a70bdc.jpg" width="30px"><span>锋</span> 👍（1） 💬（0）<div>张磊老师，你好！非常感谢您的分享，可以加下您微信吗？我的微信13666009543，再次感谢的分享！</div>2018-12-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2b/23/20/5fd6ed6f.jpg" width="30px"><span>碎竹落棋</span> 👍（0） 💬（0）<div>第一遍了，感觉不少地方还是似懂非懂，准备刷第二遍</div>2023-05-16</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/6b/0f/293b999c.jpg" width="30px"><span>旋风</span> 👍（0） 💬（0）<div>张大，请教一个权威的回答，k8s创建pod的整个流程</div>2022-08-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/2d/81/3e/d1e647c7.jpg" width="30px"><span>明宇</span> 👍（0） 💬（0）<div>两遍了，收获满满
</div>2022-04-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/f1/ed/4e249c6b.jpg" width="30px"><span>Vincent</span> 👍（0） 💬（0）<div>这次算是第二遍到达这里，第一遍真是云里雾里</div>2022-02-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg" width="30px"><span>追风筝的人</span> 👍（0） 💬（0）<div>第一遍打卡    容器间网络 从  docker0 网桥   CNI 插件 接口 以后 好难</div>2021-12-07</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/d7/88/7dcde249.jpg" width="30px"><span>庄周梦蝶</span> 👍（0） 💬（1）<div>既然k8s能提供服务发现，注册中心，负载均衡，网关，限流。为什么很多项目还是用k8s部署springcloud的nacos等，而不是用k8s自带的那些？</div>2021-10-24</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/CccT5NgKlZRlTL8f4BsIDqfJ8tRkHPyaR3SXnfgU7acxo2OO7vGzNWjfQBuFnbPPzVYH8Lh49f1jyicuuRSndcA/132" width="30px"><span>Md3zed</span> 👍（0） 💬（0）<div>第一遍打卡</div>2021-08-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/19/26/97/35e8765b.jpg" width="30px"><span>阿泽onebig</span> 👍（0） 💬（0）<div>感谢张磊的老师的付出，干货满满，接下来会再读几遍~~加强理解~</div>2021-01-03</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/be/1f/57c88dd1.jpg" width="30px"><span>小丢👣</span> 👍（0） 💬（0）<div>看了第三遍了，每一遍都有收获，感谢磊哥</div>2020-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/08/bf/cd6bfc22.jpg" width="30px"><span>自然</span> 👍（0） 💬（0）<div>我是做java后台开发的，看了文章有2个问题：
1.关于前面说的k8s提供的类似负载均衡的功能，像很多微服务架构 应用提供这个功能，还提供额外的其他功能 如服务自注册等，感觉这个和k8s的服务重复，这个是怎么考虑和取舍的呢？
2.前面老师也有说过，关于长连接的处理方式（像jdbc），想详细了解下这方面的编程处理（造成长连接短暂失效，如网络瞬断，改数据库密码，传统的单体应用通常需求重启应用）？</div>2020-06-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/14/76/20/2f9c6763.jpg" width="30px"><span>耶愿</span> 👍（0） 💬（0）<div>老师你好，请教一下:使用k8s搭微服务架构我理解网关应该是用ingress或者istio,那么服务间调用的服务发现也是用同样的方式吗，或者有其它方式？</div>2020-04-10</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/12/b3/9e8f4b4f.jpg" width="30px"><span>MoFanDon</span> 👍（0） 💬（0）<div>看完了。至少还要看两遍。</div>2019-04-02</li><br/>
</ul>