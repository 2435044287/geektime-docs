你好，我是王潇俊。我今天分享的主题是：如何做好容器镜像的个性化及合规检查。

你是否还记得我在第13 讲篇文章《容器技术真的是环境管理的救星吗？》中说到：容器不是银弹，镜像发布无法很好地满足用户的个性化需求？

在携程的发布标准化中，容器内的环境也是由发布系统定义的，用户即使登录到容器上去做变更，下一次发布之后还是会被回滚回来。但是，对 Dockerfile 的编写和控制需要一定的学习成本，因此我们又不可能将镜像的内容与构建流程完全交给用户来自定义。

于是，就有了我今天的分享，即如何做好容器镜像的个性化及合规检查？根据我在持续交付道路上摸爬滚打的实践经验，总结了以下三种方法来满足用户对容器镜像个性化需求：

1. 自定义环境脚本；
2. 平台化环境选项与服务集市；
3. 自定义镜像发布。

接下来的内容，我将根据这三种方法展开，并将介绍如何通过合规检查来规避个性化带来的风险。

## 用户自定义环境脚本

我们允许用户在编译后的代码包内放入包含自定义环境脚本的 .paas 目录（这是一个自定义的隐藏目录），来满足用户对环境的个性化需求。

这个.paas目录中，可能会存在build-env.sh和image-env.sh两个文件，分别运行于构建代码和构建镜像的过程中。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/LpOCzwApjeD0b88GEHaEupBbOCMPibiaU9KZuUDBXybiaTgVgFo2Iq7zeD8Qd1Lp6Kz6A0V8ocnVYviau60auZibPFA/132" width="30px"><span>Edward</span> 👍（0） 💬（1）<div>请教一下，学习docker从哪里入手，或者什么书籍，视频推荐呢</div>2018-08-14</li><br/><li><img src="" width="30px"><span>何雁秋</span> 👍（0） 💬（0）<div>个性化的东西不应该被引入到base,
可以单独创建一个工具镜像，仅仅用于开发测试用，
而不能被发布到生产。</div>2022-08-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/14/99/5b1ed92b.jpg" width="30px"><span>戴斌</span> 👍（0） 💬（0）<div>我们在实践过程中，发现阿里云的安全能不能扫描容器内的安全漏洞。同时，也在寻找容器安全的解决方案，感谢老师分享</div>2020-03-22</li><br/>
</ul>