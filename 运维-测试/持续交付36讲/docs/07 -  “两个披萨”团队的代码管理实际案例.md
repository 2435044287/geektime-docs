在亚马逊内部有所谓的“两个披萨”团队，指的是团队的人数不能多到两个披萨饼还不够吃的地步。也就是说，**团队要小到让每个成员都能做出显著贡献，并且相互依赖，有共同目标，以及统一的成功标准，这样团队的工作效率才会高。**

现在有很多互联网公司喜欢采用“两个匹萨”团队的模式，你可能很好奇，这些团队通常是如何实施代码管理的？

当前国内互联网公司通常采用特性分支开发的模式，我在第四篇文章《一切的源头，代码分支策略的选择》中，为你详细介绍了这种模式，下面我就以这种模式为例，为你解开困惑。

以迭代周期为一周的项目为例，我将按照从周一到周五的时间顺序，通过整个团队在每天的工作内容，跟你分享项目任务分配，分支创建、集成与分支合并、上线，包括分支删除的关系。你可以从中了解互联网公司研发团队日常代码管理的真实情况，体会团队为了提高研发效率，在代码管理上做出的创新与改进。

## 背景

周一上午 11：30，“复仇者” 团队的周会结束，会议室里陆续走出了6名工程师：

- “钢铁侠”：5年一线开发经验，现任“复仇者”项目经理及产品负责人；
- “美国队长”：6年开发经验，负责“复仇者”项目的技术架构，兼开发工作；
- “绿巨人”：3年开发经验，全栈开发；
- “雷神”：3年开发经验，全栈开发；
- “蜘蛛侠”：1年开发经验，负责几个成熟模块的维护；
- “黑寡妇”：资深测试工程师，负责系统集成与测试。
<div><strong>精选留言（30）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/13/75/4f/2edbb97e.jpg" width="30px"><span>陈文涛</span> 👍（4） 💬（1）<div>老师我很好奇，大厂不写设计文档，不做设计评审，不做需求评审么，还是这场景忽略掉了。。。。</div>2018-10-31</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/e9/e8/31df61df.jpg" width="30px"><span>军秋</span> 👍（4） 💬（2）<div>看B C是否有依赖A的功能，没有依赖撤回A，上线后两个，若有依赖，做个业务开关关闭A的功能保留BC依赖的功能，保证BC上线，A功能延期到下一个版本</div>2018-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg" width="30px"><span>james</span> 👍（4） 💬（2）<div>老师，smart merge 的作用是不是, 先选定 N 个分支组成一个 group, 之后 group 中任何一个分支变更, 都合并到 group 中另外的几个分支中?</div>2018-08-25</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/f8/22/a59136c2.jpg" width="30px"><span>Linton</span> 👍（1） 💬（1）<div>smart_merge是需要Gitlab通过源码方式一并安装吗? </div>2019-10-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/4c/51/a339d363.jpg" width="30px"><span>柠檬水</span> 👍（1） 💬（1）<div>您好，看过你们在Github上的smart_merge工具了，但是文档不像是Gitlab的一个插件，安装过程也和Gitlab的插件安装不同，能指点一下方向吗？谢谢。</div>2018-08-01</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/d7/a0/15c82d8b.jpg" width="30px"><span>Triton</span> 👍（0） 💬（1）<div>如果是BUG也需要创建分支吗？</div>2019-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/97/6d/abb7bfe3.jpg" width="30px"><span>frankie</span> 👍（0） 💬（1）<div>有了 Smart Merge，任何一个分支的变更会自动触发合并----那这个跟主干开发似乎差不多吧？</div>2018-11-13</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/19/c5/c941c9be.jpg" width="30px"><span>Guti</span> 👍（0） 💬（1）<div>感觉不怎么专业啊，连pull request都不用？携程自己开发的smart啥没看出多大作用</div>2018-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/31/e0/543d3a1d.jpg" width="30px"><span>Nick~毓</span> 👍（15） 💬（0）<div>多说一些 devops 持续交付 持续部署 持续集成 相关的理论 流程 标准 和实战经验吧</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/99/24/e1cb609e.jpg" width="30px"><span>破晓</span> 👍（10） 💬（0）<div>回滚到提交abc前，重新上bc。</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/88/21/50b2418a.jpg" width="30px"><span>alan</span> 👍（3） 💬（0）<div>非常需要这篇文章的经验，感谢！</div>2018-07-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/48/9e/99cb0a7a.jpg" width="30px"><span>心在飞</span> 👍（2） 💬（1）<div>1. 做个业务快关，关闭A功能。 需要提交新的commit  D
2. 删除A功能，在A的MR中点击revert，gitlab会自动产生新的commit D，不过这时候还需要做B，C的测试，确保他们功能没受影响。</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/db/ed/106a8ec9.jpg" width="30px"><span>王浩槟</span> 👍（2） 💬（0）<div>好羡慕好喜欢这个开发流程，一定要搭建出这个环境😻 </div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg" width="30px"><span>mgxian</span> 👍（2） 💬（0）<div>使用gitlab合并请求页面的revert功能 撤销a功能的合并</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg" width="30px"><span>james</span> 👍（1） 💬（0）<div>smart merge 的作用是不是, 先选定 N 个分支组成一个 group, 之后 group 中任何一个分支变更, 都合并到 group 中另外的几个分支中?</div>2018-08-25</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/0M3kK7d2sLapYh9VgqzQargLNkiaJbJZTDNjzLhm9s9FYbFUVDSKa74yvcvH5IHWgknuibmh9fObbrHXvfAib28IQ/132" width="30px"><span>手指饼干</span> 👍（1） 💬（0）<div>请问smart_merge是不是从master创建sprint26分支？如果feature分支往sprint26分支合并有冲突，到后面往master分支合并是不是要解决同样的冲突？</div>2018-07-27</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/d8/3b/b77b78c1.jpg" width="30px"><span>lee🙃</span> 👍（1） 💬（0）<div>撤回a分支的合并，保留b、C分支的合并</div>2018-07-19</li><br/><li><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0" width="30px"><span>图·美克尔</span> 👍（1） 💬（0）<div>在gitlab上找到a的合并请求，revert。</div>2018-07-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/24/33/bcf37f50.jpg" width="30px"><span>阿甘</span> 👍（0） 💬（0）<div>1. 建议画个分支管理图，这样比较好理解（特别其中还涉及到smart merge产生的虚拟分支）
2. 这个模式看起来很像aoneflow，发布也是基于smart merge的临时虚拟分支进行的对吗？</div>2024-09-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/71/e3/5c17b81a.jpg" width="30px"><span>花灰</span> 👍（0） 💬（0）<div>qa啥时候写的自动化case呀？</div>2021-07-26</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/69/11/831cec7d.jpg" width="30px"><span>小寞子。(≥3≤)</span> 👍（0） 💬（1）<div>和我们差不多 但是我对于个人branch 而不是feature branch 这种操作还是有点不赞同。 </div>2021-02-25</li><br/><li><img src="" width="30px"><span>Geek_745c15</span> 👍（0） 💬（0）<div>大家项目多久一个版本，如果是APP项目，如何划分版本周期</div>2020-08-29</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/3b/97/ce00cd8d.jpg" width="30px"><span>coco張</span> 👍（0） 💬（0）<div>我们都是monorepo的模式，fork代码再从自己的repo往原始库提交代码</div>2020-06-30</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/da/df/3739e120.jpg" width="30px"><span>howei</span> 👍（0） 💬（0）<div>我们都是主干开发，没有那么多分支，看的烦，合并什么的，所以分支相关的我不看了</div>2020-04-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/37/7c/ffa62584.jpg" width="30px"><span>猩猩</span> 👍（0） 💬（0）<div>没有看懂smart merge的作用。是自动往master合并吗？那周二下午”美国队长“做的merge request又是什么？</div>2019-08-08</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/21/c0/38816c31.jpg" width="30px"><span>春之绿野</span> 👍（0） 💬（0）<div>Revert掉A不就行了吗？
最后合进去的fix不测试吗？</div>2019-06-07</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erTZ0G0Kf5LcKaItbic4f0d2TFlVqQfdg2o9qC4zLmExQl49w6cWpc0O11guwt3xdpRax1XzQ8Sh6g/132" width="30px"><span>Jessica</span> 👍（0） 💬（0）<div>老师，我公司目前用的是GitHub管理代码，有办法在GitHub上使用Smart Merge插件吗？</div>2019-01-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/c6/4f/0c215abf.jpg" width="30px"><span>红娟</span> 👍（0） 💬（0）<div>合作很流畅啊 </div>2018-12-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/65/d5/88beb15a.jpg" width="30px"><span>李志博</span> 👍（0） 💬（0）<div>携程邮轮服务一点也不好，哼</div>2018-07-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg" width="30px"><span>weineel</span> 👍（0） 💬（0）<div>老师您好，最后的思考题已经困惑了好久了，期待解答。</div>2018-07-19</li><br/>
</ul>