在专栏的第13讲[《容器技术真的是环境管理的救星吗？》](https://time.geekbang.org/column/article/12404)中，我们初步结识了不可变基础设施（Immutable Infrastructure），这里我们再一起回顾一下：

> 在这种模式中，任何基础设施的实例（包括服务器、容器等各种软硬件）一旦创建之后便成为一种只读状态，不可对其进行任何更改。如果需要修改或升级某些实例，唯一的方式就是创建一批新的实例来替换它。

这种思想与不可变对象的概念完全相同。

为什么我会说，不可变基础设施的思想对持续交付的影响非常深远呢？因为不可变的思想正是解决了持续交付一直没有解决的一个难题，即环境、顺序、配置这些基础设施在测试环节和生产环节的不一致性所带来的问题。

那么，今天我就来详细分析一下不可变基础设施的由来、影响，以及如何实现的相关内容。

## 从持续交付中来

如果你是一个程序员，其实很容易理解不可变基础设施的概念，以及其实现的方式。因为它就和Java中的不可变类完全相同：类实例一旦创建，就无法变更，而可以变更的是指向实例的引用。

其实早在2011年出版的《持续交付：发布可靠软件的系统方法》一书中，就曾提到“蓝绿发布”的概念：你需要更新一组实例，但并不是直接在原有实例上进行变更，而是重新启动一批对等的实例，在新实例上更新，然后再用新实例替换老实例。此时老实例仍旧存在，以便回滚。
<div><strong>精选留言（3）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/ec/af/459eb517.jpg" width="30px"><span>Milo</span> 👍（4） 💬（1）<div>想了解下大家怎么处理数据库版本回滚的</div>2018-08-24</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/8a/1c/f8ea6063.jpg" width="30px"><span>春风百里</span> 👍（1） 💬（1）<div>请问，按照每一次变更都是一次发布，每一次发布都是一次独立镜像启动，那在配置中心做的配置变更，也算是一次发布，但是并没有产生新的独立镜像，这个怎么理解？</div>2020-03-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/54/ff/380eaec1.jpg" width="30px"><span>禾子先生</span> 👍（1） 💬（0）<div>不可变思想在mybatis的使用中有应用，通过MBG生成的代码不可变，有特殊需求，继承或新增。</div>2018-08-19</li><br/>
</ul>