你好，我是倪朋飞。

在正式介绍 eBPF 的使用方法和具体应用之前，我会用两讲的内容，带你了解eBPF的技术脉络和学习路线，为你后面的学习做好准备。

在开篇词里，我带你一起了解了这门课的设计思路和主要内容，也简单介绍了 eBPF 的主要应用场景，包括故障诊断、网络优化、安全控制、性能监控等。那你可能就要问了：为什么 eBPF 可以应用到这么广泛的领域呢？

eBPF 广泛的应用场景和强大的功能，跟它的发展历程、基本原理密切相关。那么，eBPF 的发展历程是什么样的？它又是如何在确保安全的前提下，允许非内核开发者去扩展内核的功能的呢？今天，我就带你一起来看看这些问题。

## eBPF 的发展历程是什么样的?

在开篇词中，我曾经提到，eBPF 是从 BPF (Berkeley Packet Filter) 技术扩展而来的。而说起 BPF，它的历史就更悠长了。

早在 1992 年的 USENIX 会议上，Steven McCanne 和 Van Jacobson 发布的论文“[The BSD Packet Filter: A New Architecture for User-level Packet Capture](https://www.tcpdump.org/papers/bpf-usenix93.pdf)” 就为 BSD 操作系统带来了革命性的包过滤机制 BSD Packet Filter（简称为 BPF），这比当时最先进的数据包过滤技术还快 20 倍。为什么性能这么好呢？这主要得益于 BPF 的两大设计：
<div><strong>精选留言（23）</strong></div><ul>
<li><img src="https://static001.geekbang.org/account/avatar/00/0f/71/c3/09e22c1d.jpg" width="30px"><span>大卫李</span> 👍（24） 💬（3）<div>非常高兴看到eBPF技术能在极客时间开学习专栏了，算是中文圈的一个里程碑！本人也在一直学习bpf技术（也简单写了发展史：https:&#47;&#47;davidlovezoe.club&#47;bpf ），希望跟倪老师及大家共勉。</div>2022-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg" width="30px"><span>余生</span> 👍（10） 💬（1）<div>极客上特别喜欢的几位大咖老师，倪朋飞、陶辉、刘超、彭东！</div>2022-01-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg" width="30px"><span>Unknown element</span> 👍（8） 💬（1）<div>老师我看您在评论区说ebpf程序是在加载到内核之前验证，那文中的执行顺序是不是不太准确？应该是 编译 验证 加载 内核执行？</div>2022-02-09</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/12/9f/fc/0232f005.jpg" width="30px"><span>我要收购腾讯</span> 👍（7） 💬（1）<div>用过 bcc profile + crd 的方式给公司内部的k8s控制台开发过一键生成火焰图的功能, （全套的可观测性部署不太适合开发测试用集群）</div>2022-01-21</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/13/24/59/e9867100.jpg" width="30px"><span>Unknown</span> 👍（7） 💬（2）<div>bcc tools 工具都很好用，比如Diffie-Hellman密钥交换算法使得就算有key都无法解密，不过如果通过bcc tools中的sslsniff能直接查看了，对调试来说挺方便的</div>2022-01-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/17/e6/ee/8fdbd5db.jpg" width="30px"><span>Damoncui</span> 👍（6） 💬（1）<div>好激动！目前正在看翻译版的《bpf之巅》，配合食用简直快乐到不行～英文版吃起来太痛苦……

选对课程、教程基本节约了一半时间！

希望和各类牛人一起加油进步！

ebpf一定会越来越火🔥～</div>2022-01-18</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg" width="30px"><span>Sports</span> 👍（2） 💬（1）<div>刚来到极客时间买的早期课程就有倪老师的Linux优化实战，看过多遍，大神必出精品！</div>2022-01-19</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/0f/60/36/1848c2b7.jpg" width="30px"><span>dovefi</span> 👍（1） 💬（1）<div>使用过bcc-tools 中的filetop cachetop等工具分析过缓存占用的问题，第一次接触到ebpf工具，同事的大佬也有使用systemtap解决过很多问题</div>2022-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/d0/d0/a6c6069d.jpg" width="30px"><span>坚</span> 👍（1） 💬（2）<div>倪老师好，我是做嵌入式开发，需要自己配置内核，在搭建bpf的使用环境的时候可以也提一下需要开启内核哪些配置吗？</div>2022-01-18</li><br/><li><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqKmVMIqxRO00L8J1iatIzeMHwzYb0s762j9B2dicy4P8tciat26cNDgoyMREjtluZEBXGvwz9nUSO2g/132" width="30px"><span>Geek_07f1e3</span> 👍（0） 💬（1）<div>曾利用bcc解决过容器DNS请求监控的问题场景，但是正如倪老师文末所提及的eBPF与内核版本之间的限制关系，导致方案最后没被通过，但也算是一次不错的实践体验。</div>2023-01-28</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/23/13/bd/3e86e791.jpg" width="30px"><span>十七</span> 👍（0） 💬（1）<div>嵌入式系统ebpf是否适合使用?</div>2022-03-04</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/1e/d0/d0/a6c6069d.jpg" width="30px"><span>坚</span> 👍（0） 💬（1）<div>老师，我想问一下eBPF和perf有关系吗？还是说这是两个东西</div>2022-02-17</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/18/2e/0d/72a65e1c.jpg" width="30px"><span>helloworld</span> 👍（0） 💬（1）<div>非常高兴看到这样的课程。我这里工作实践中用个疑问，我们一般遇到的操作系统低版本的比较多，比如centos内核3.1x的，怎么能做到在低版本适配呢？</div>2022-02-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/53/db/858337e3.jpg" width="30px"><span>Ethan Liu</span> 👍（0） 💬（2）<div>eBPF程序执行需要进行验证，不影响性能吗？</div>2022-01-20</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/10/82/de/7f6cae1f.jpg" width="30px"><span>娟</span> 👍（0） 💬（2）<div>bpf很早就有一些了解，觉得那些语法挺好玩，跟着大牛一起进步，系统化了解了解ebpf。希望结束的时候能很有收获。</div>2022-01-20</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/UWDBUEsDLIKpeIujPLsrRG9l0cFhWlXB9CcaOpNKrOdhDAia6PialmJZ4MQgYtBpDdu58leIDDlsOxaZsRvknZZA/132" width="30px"><span>Geek_cc0645</span> 👍（0） 💬（0）<div>原来的版本是 3.10，centos7, 请问下自己编译 5.4.286版本的内核，sudo modprobe bpf
modprobe: FATAL: Module bpf not found. 报错是因为什么，
使用的配置参数
CONFIG_BPF=y
CONFIG_BPF_SYSCALL=y
CONFIG_BPF_EVENTS=y
CONFIG_BPF_JIT=y
CONFIG_HAVE_EBPF_JIT=y</div>2024-12-12</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/15/ce/06/273dcc0d.jpg" width="30px"><span>愚人</span> 👍（0） 💬（0）<div>“但直到 eBPF 诞生前，BPF 都仅用于包过滤这个场景中”这里似乎不对哦，今天看到 Linux 的 seccomp 使用了 bpf 来更灵活地控制进程能使用哪些系统调用，这个机制在 2012 年的 3.5 版本内核引入，但从文章看起来 ebpf 的出现时间应该在 2014 年🤔</div>2024-10-02</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/31/21/41/d8f2fe6d.jpg" width="30px"><span>阴晦</span> 👍（0） 💬（0）<div>最近打算脱离云做传统软件的时候，突然想起来ebpf可以在一些注入网关之类的需要做代理转发的地方使用。
不过目前还没有是深入学习，还不知道想法现实与否</div>2024-08-27</li><br/><li><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKf9jqppL0WenjNzGAykMcWZuec94gvGYlb5LwhROXD8Ym0SkhnN3H1oObsqmoIoU95zqz8FGNIOA/132" width="30px"><span>屠步空杯</span> 👍（0） 💬（0）<div>倪老师，您提到的内核社区，具体位置在哪，能发一下吗？谢谢</div>2024-01-20</li><br/><li><img src="" width="30px"><span>Geek_5674cf</span> 👍（0） 💬（0）<div>老师，在androids系统中，通过ebpf是否可以实现转发指定app中指定接口的明文数据</div>2023-07-06</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/92/7c/12c571b6.jpg" width="30px"><span>Slience-0°C</span> 👍（0） 💬（0）<div>老师，eBPF可以做控制操作的功能？</div>2022-09-15</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/5f/43/3799a0f3.jpg" width="30px"><span>magina</span> 👍（0） 💬（0）<div>看完没懂“内核态引入一个新的虚拟机，所有指令都在内核虚拟机中运行”，怎么体现在文中的图上？</div>2022-07-23</li><br/><li><img src="https://static001.geekbang.org/account/avatar/00/11/17/18/e4382a8e.jpg" width="30px"><span>有识之士</span> 👍（0） 💬（0）<div>开发 eBPF 程序，如何进行调试？类似 go、java 这种高级语言可以方便 debug 一样的？ </div>2022-07-22</li><br/>
</ul>